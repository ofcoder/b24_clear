this.BX=this.BX||{};this.BX.Sign=this.BX.Sign||{};this.BX.Sign.V2=this.BX.Sign.V2||{};(function(e,t,s,i,a,r,l,n,o,c){"use strict";let d=e=>e,u,b;var p=babelHelpers.classPrivateFieldLooseKey("companyParty");var h=babelHelpers.classPrivateFieldLooseKey("userParty");var v=babelHelpers.classPrivateFieldLooseKey("api");var y=babelHelpers.classPrivateFieldLooseKey("setupParties");var g=babelHelpers.classPrivateFieldLooseKey("getAssignee");var m=babelHelpers.classPrivateFieldLooseKey("getSigner");var B=babelHelpers.classPrivateFieldLooseKey("reflowLayout");var P=babelHelpers.classPrivateFieldLooseKey("wrapContent");var S=babelHelpers.classPrivateFieldLooseKey("parseMembers");class L extends c.SignSettings{constructor(e,t){super(e,t,{next:{className:"ui-btn-success"},complete:{className:"ui-btn-success"},swapButtons:true});Object.defineProperty(this,S,{value:T});Object.defineProperty(this,P,{value:I});Object.defineProperty(this,B,{value:w});Object.defineProperty(this,m,{value:H});Object.defineProperty(this,g,{value:F});Object.defineProperty(this,y,{value:f});Object.defineProperty(this,p,{writable:true,value:void 0});Object.defineProperty(this,h,{writable:true,value:void 0});Object.defineProperty(this,v,{writable:true,value:void 0});const{config:i}=t;const{blankSelectorConfig:o,documentSendConfig:c,userPartyConfig:d}=i;this.documentSetup=new r.DocumentSetup(o);this.documentSend=new a.DocumentSend(c);babelHelpers.classPrivateFieldLooseBase(this,p)[p]=new l.Parties(o.region);babelHelpers.classPrivateFieldLooseBase(this,v)[v]=new s.Api;babelHelpers.classPrivateFieldLooseBase(this,h)[h]=new n.UserParty({mode:"edit",...d});this.subscribeOnEvents()}subscribeOnEvents(){super.subscribeOnEvents();this.documentSend.subscribe("changeTitle",(({data:e})=>{this.documentSetup.setDocumentTitle(e.title)}));this.documentSend.subscribe("disableBack",(()=>{this.wizard.toggleBtnActiveState("back",true)}));this.documentSend.subscribe("enableBack",(()=>{this.wizard.toggleBtnActiveState("back",false)}))}async applyDocumentData(e){const t=await this.setupDocument(e,true);if(!t){return false}const{entityId:i,representativeId:a,companyUid:r}=t;this.documentSend.documentData=t;this.editor.documentData=t;babelHelpers.classPrivateFieldLooseBase(this,p)[p].setEntityId(i);if(r){babelHelpers.classPrivateFieldLooseBase(this,p)[p].loadCompany(r)}if(a){babelHelpers.classPrivateFieldLooseBase(this,p)[p].loadRepresentative(a)}const l=await babelHelpers.classPrivateFieldLooseBase(this,v)[v].loadMembers(e);const n=babelHelpers.classPrivateFieldLooseBase(this,S)[S](l);const{signers:o=[],reviewers:c=[],editors:d=[]}=n;if(o.length>0){babelHelpers.classPrivateFieldLooseBase(this,h)[h].load(o)}if(c.length>0){babelHelpers.classPrivateFieldLooseBase(this,p)[p].loadValidator(c[0],s.MemberRole.reviewer)}if(d.length>0){babelHelpers.classPrivateFieldLooseBase(this,p)[p].loadValidator(d[0],s.MemberRole.editor)}return true}getStepsMetadata(){const e=this;return{setup:{get content(){const t=e.documentSetup.layout;babelHelpers.classPrivateFieldLooseBase(e,B)[B](t);return t},title:t.Loc.getMessage("SIGN_SETTINGS_B2B_LOAD_DOCUMENT"),beforeCompletion:async()=>{const e=this.documentSetup.validate();if(!e){return false}const t=await this.setupDocument();if(!t){return false}babelHelpers.classPrivateFieldLooseBase(this,p)[p].setEntityId(t.entityId);return true}},company:{get content(){const t=babelHelpers.classPrivateFieldLooseBase(e,p)[p].getLayout();babelHelpers.classPrivateFieldLooseBase(e,B)[B](t);return t},title:t.Loc.getMessage("SIGN_SETTINGS_B2E_COMPANY"),beforeCompletion:async()=>{const{uid:e}=this.documentSetup.setupData;try{await babelHelpers.classPrivateFieldLooseBase(this,p)[p].save(e)}catch{return false}return true}},employees:{title:t.Loc.getMessage("SIGN_SETTINGS_B2E_EMPLOYEES"),get content(){const t=babelHelpers.classPrivateFieldLooseBase(e,h)[h].getLayout();babelHelpers.classPrivateFieldLooseBase(e,B)[B](t);return t},beforeCompletion:async()=>{try{const e=babelHelpers.classPrivateFieldLooseBase(this,h)[h].validate();if(!e){return e}const t=await babelHelpers.classPrivateFieldLooseBase(this,y)[y]();const{uid:s,title:a,isTemplate:r,externalId:l,entityId:n}=this.documentSetup.setupData;const c=await this.documentSetup.loadBlocks(s);const d=babelHelpers.classPrivateFieldLooseBase(this,p)[p].getParties();const u=babelHelpers.classPrivateFieldLooseBase(this,p)[p].getSelectedProvider();this.editor.setSectionVisibilityByType(o.SectionType.SecondParty,u.code!==i.ProviderCode.sesRu);Object.assign(d,{employees:babelHelpers.classPrivateFieldLooseBase(this,h)[h].getUserIds().map((e=>({entityType:"user",entityId:e})))});this.documentSend.documentData={uid:s,title:a,blocks:c,externalId:l};this.documentSend.setPartiesData(d);this.documentSend.members=t;this.editor.documentData={isTemplate:r,uid:s,blocks:c,entityId:n};this.editor.entityData=t;await this.editor.waitForPagesUrls();await this.editor.renderDocument();this.wizard.toggleBtnLoadingState("next",false);await this.editor.show();return true}catch(e){console.error(e);return false}}},send:{get content(){const t=e.documentSend.getLayout();babelHelpers.classPrivateFieldLooseBase(e,B)[B](t);return t},title:t.Loc.getMessage("SIGN_SETTINGS_SEND_DOCUMENT"),beforeCompletion:()=>this.documentSend.sendForSign()}}}}async function f(){const{uid:e}=this.documentSetup.setupData;const s=babelHelpers.classPrivateFieldLooseBase(this,p)[p].getParties();const{representative:i,company:a,validation:r}=s;const{entityId:l}=a;const{entityId:n}=i;const o=babelHelpers.classPrivateFieldLooseBase(this,h)[h].getUserIds();let c=1;const d=r.map((e=>({...e,party:c++})));d.push(babelHelpers.classPrivateFieldLooseBase(this,g)[g](c,l));c++;d.push(...o.map((e=>babelHelpers.classPrivateFieldLooseBase(this,m)[m](c,e))));try{await babelHelpers.classPrivateFieldLooseBase(this,v)[v].setupB2eParties(e,n,d)}catch(e){throw e}const u=await babelHelpers.classPrivateFieldLooseBase(this,v)[v].loadMembers(e);if(!t.Type.isArrayFilled(u)){throw new Error}return u.map((e=>{var t,s,i;return{presetId:e==null?void 0:e.presetId,part:e==null?void 0:e.party,uid:e==null?void 0:e.uid,entityTypeId:(t=e==null?void 0:e.entityTypeId)!=null?t:null,entityId:(s=e==null?void 0:e.entityId)!=null?s:null,role:(i=e==null?void 0:e.role)!=null?i:null}}))}function F(e,t){return{entityType:"company",entityId:t,party:e,role:s.MemberRole.assignee}}function H(e,t){return{entityType:"user",entityId:t,party:e,role:s.MemberRole.signer}}function w(e){babelHelpers.classPrivateFieldLooseBase(this,P)[P](e);document.documentElement.scrollTop=0}function I(e){const s=[...e.children].filter((e=>t.Dom.hasClass(e,"sign-b2e-settings__item")));const i=s.some((e=>t.Dom.hasClass(e.firstElementChild,"sign-b2e-settings__counter")));if(i){return}s.forEach(((e,i)=>{const a=i===s.length-1?t.Tag.render(u||(u=d`<span class="sign-b2e-settings__counter_connect">`)):null;const r=t.Tag.render(b||(b=d`
				<div class="sign-b2e-settings__counter">
					<span class="sign-b2e-settings__counter_num" data-num="${0}"></span>
					${0}
				</div>
			`),i+1,a);t.Dom.prepend(r,e)}))}function T(e){return e.reduce(((e,t)=>{var s;const{entityType:i,entityId:a}=t;if(i!=="user"){return e}const r=`${t.role}s`;return{...e,[r]:[...(s=e[r])!=null?s:[],a]}}),{})}e.B2ESignSettings=L})(this.BX.Sign.V2.B2e=this.BX.Sign.V2.B2e||{},BX,BX.Sign.V2,BX.Sign.V2.B2e,BX.Sign.V2.B2e,BX.Sign.V2.B2e,BX.Sign.V2.B2e,BX.Sign.V2.B2e,BX.Sign.V2,BX.Sign.V2);
//# sourceMappingURL=sign-settings.bundle.map.js