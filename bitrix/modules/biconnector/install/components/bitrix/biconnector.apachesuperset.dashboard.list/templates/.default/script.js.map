{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { Loc, Type, Tag, Reflection, Dom, Text, Event, Runtime } from 'main.core';\nimport { DateTimeFormat } from 'main.date';\nimport { PopupWindowManager } from 'main.popup';\nimport { DashboardManager } from 'biconnector.apache-superset-dashboard-manager';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { ApacheSupersetAnalytics } from 'biconnector.apache-superset-analytics';\nimport type { DashboardAnalyticInfo } from 'biconnector.apache-superset-analytics';\nimport { Dialog } from 'ui.entity-selector';\nimport { Guide } from 'ui.tour';\nimport 'spotlight';\nimport { TagFooter } from 'biconnector.entity-selector';\nimport 'ui.alerts';\n\ntype Props = {\n\tgridId: ?string,\n\tisNeedShowTopMenuGuide: boolean,\n};\n\ntype LoginPopupParams = {\n\tdashboardId: number,\n\ttype: string,\n\teditUrl: string,\n\tappId: string,\n};\n\n/**\n * @namespace BX.BIConnector\n */\nclass SupersetDashboardGridManager\n{\n\t#dashboardManager: DashboardManager = null;\n\t#grid: BX.Main.grid;\n\t#filter: BX.Main.Filter;\n\t#tagSelectorDialog: ?Dialog;\n\t#topMenuGuideSpotlight: ?BX.SpotLight;\n\t#lastPinnedRowId: ?number;\n\n\tconstructor(props: Props)\n\t{\n\t\tthis.#dashboardManager = new DashboardManager();\n\n\t\tthis.#grid = BX.Main.gridManager.getById(props.gridId)?.instance;\n\t\tthis.#filter = BX.Main.filterManager.getById(props.gridId);\n\n\t\tthis.#subscribeToEvents();\n\n\t\tif (\n\t\t\tprops.isNeedShowTopMenuGuide\n\t\t\t&& !PopupWindowManager?.isAnyPopupShown()\n\t\t\t&& this.#grid.getRows().getBodyFirstChild().actionsButton\n\t\t)\n\t\t{\n\t\t\tthis.#topMenuGuideSpotlight = new BX.SpotLight({\n\t\t\t\ttargetElement: this.#grid.getRows().getBodyFirstChild().actionsButton,\n\t\t\t\ttargetVertex: 'middle-center',\n\t\t\t\tevents: {\n\t\t\t\t\tonTargetEnter: () => this.#topMenuGuideSpotlight.close(),\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.#topMenuGuideSpotlight.show();\n\t\t\tthis.#showTopMenuGuide();\n\t\t}\n\t\tthis.#colorPinnedRows();\n\t\tthis.#initHints();\n\t}\n\n\t#subscribeToEvents()\n\t{\n\t\tEventEmitter.subscribe('SidePanel.Slider:onMessage', (event) => {\n\t\t\tconst [sliderEvent] = event.getCompatData();\n\n\t\t\tif (sliderEvent.getEventId() === 'BIConnector.Superset.DashboardDetail:onDashboardBatchStatusUpdate')\n\t\t\t{\n\t\t\t\tconst eventArgs = sliderEvent.getData();\n\t\t\t\tif (eventArgs.dashboardList)\n\t\t\t\t{\n\t\t\t\t\tthis.onUpdatedDashboardBatchStatus(eventArgs.dashboardList);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (\n\t\t\t\tsliderEvent.getEventId() === 'BIConnector.Superset.DashboardTagGrid:onTagChange'\n\t\t\t\t|| sliderEvent.getEventId() === 'BIConnector.Superset.DashboardTagGrid:onTagDelete'\n\t\t\t)\n\t\t\t{\n\t\t\t\tif (this.#tagSelectorDialog)\n\t\t\t\t{\n\t\t\t\t\tthis.#tagSelectorDialog.destroy();\n\t\t\t\t\tthis.#tagSelectorDialog = null;\n\t\t\t\t}\n\n\t\t\t\tconst filterTagValues = this.getFilter().getFilterFieldsValues();\n\t\t\t\tif (Type.isUndefined(filterTagValues['TAGS.ID']) || filterTagValues['TAGS.ID'].length === 0)\n\t\t\t\t{\n\t\t\t\t\tthis.getGrid().reload();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst { tagId, title } = sliderEvent.getData();\n\t\t\t\tconst currentFilteredTags = filterTagValues['TAGS.ID'] ?? [];\n\t\t\t\tconst currentFilteredTagLabels = filterTagValues['TAGS.ID_label'] ?? [];\n\n\t\t\t\tconst index = currentFilteredTags.findIndex((id) => Text.toInteger(id) === Text.toInteger(tagId));\n\t\t\t\tif (sliderEvent.getEventId() === 'BIConnector.Superset.DashboardTagGrid:onTagDelete')\n\t\t\t\t{\n\t\t\t\t\tcurrentFilteredTags.splice(index, 1);\n\t\t\t\t\tcurrentFilteredTagLabels.splice(index, 1);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcurrentFilteredTagLabels[index] = title;\n\t\t\t\t}\n\n\t\t\t\tconst filterApi = this.getFilter().getApi();\n\t\t\t\tfilterApi.extendFilter({\n\t\t\t\t\t'TAGS.ID': currentFilteredTags,\n\t\t\t\t\t'TAGS.ID_label': currentFilteredTagLabels,\n\t\t\t\t});\n\n\t\t\t\tfilterApi.apply();\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('BIConnector.Superset.DashboardManager:onDashboardBatchStatusUpdate', (event) => {\n\t\t\tconst data = event.getData();\n\t\t\tif (!data.dashboardList)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst dashboardList = data.dashboardList;\n\t\t\tthis.onUpdatedDashboardBatchStatus(dashboardList);\n\t\t});\n\n\t\tBX.PULL && BX.PULL.extendWatch('superset_dashboard', true);\n\t\tEventEmitter.subscribe('onPullEvent-biconnector', (event: BaseEvent) => {\n\t\t\tconst [eventName, eventData] = event.data;\n\t\t\tif (eventName !== 'onSupersetStatusUpdated' || !eventData)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst status = eventData?.status;\n\t\t\tif (status)\n\t\t\t{\n\t\t\t\tthis.#onSupersetStatusChange(status);\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.Rest.Configuration.Install:onFinish', () => {\n\t\t\tthis.#grid.reload();\n\t\t});\n\n\t\tEventEmitter.subscribe('Grid::updated', () => {\n\t\t\tthis.#initHints();\n\t\t\tthis.#colorPinnedRows();\n\t\t});\n\n\t\tEventEmitter.subscribe('BIConnector.ExportMaster:onDashboardDataLoaded', () => {\n\t\t\tthis.#grid.tableUnfade();\n\t\t});\n\n\t\tEventEmitter.subscribe('BIConnector.DashboardManager:onEmbeddedDataLoaded', () => {\n\t\t\tthis.#grid.reload();\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.BIConnector.Settings:onAfterSave', () => {\n\t\t\tthis.#grid.reload();\n\t\t});\n\t}\n\n\t#initHints(): void\n\t{\n\t\tconst manager = BX.UI.Hint.createInstance({\n\t\t\tpopupParameters: {\n\t\t\t\tautoHide: true,\n\t\t\t},\n\t\t});\n\t\tmanager.init(this.#grid.getContainer());\n\t}\n\n\t#onSupersetStatusChange(status: string): void\n\t{\n\t\tif (status === 'READY')\n\t\t{\n\t\t\tthis.getGrid().reload();\n\t\t}\n\n\t\tif (status !== 'LOAD' && status !== 'ERROR')\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst statusMap = {\n\t\t\tLOAD: DashboardManager.DASHBOARD_STATUS_LOAD,\n\t\t\tERROR: DashboardManager.DASHBOARD_STATUS_COMPUTED_NOT_LOAD,\n\t\t};\n\n\t\tconst grid = this.getGrid();\n\t\tconst rows = grid.getRows().getBodyChild();\n\t\tfor (const row: BX.Grid.Row of rows)\n\t\t{\n\t\t\tconst dashboardId = row.getId();\n\t\t\tconst dashboardStatus = statusMap[status];\n\t\t\tif (dashboardStatus)\n\t\t\t{\n\t\t\t\tthis.updateDashboardStatus(dashboardId, dashboardStatus);\n\t\t\t}\n\t\t}\n\t}\n\n\t#showTopMenuGuide(): void\n\t{\n\t\tconst guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: this.#grid.getRows().getBodyFirstChild().node,\n\t\t\t\t\ttitle: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_TOP_MENU_GUIDE_TITLE'),\n\t\t\t\t\ttext: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_TOP_MENU_GUIDE_TEXT'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\t\tBX.userOptions.save('biconnector', 'top_menu_guide', 'is_over', true);\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\trounded: false,\n\t\t\t\t\tposition: 'bottom',\n\t\t\t\t\tareaPadding: 0,\n\t\t\t\t},\n\t\t\t],\n\t\t\tonEvents: true,\n\t\t});\n\t\tguide.start();\n\t}\n\n\t#colorPinnedRows(): void\n\t{\n\t\tthis.#lastPinnedRowId = 0;\n\t\tconst rows = this.#grid.getRows().getBodyChild();\n\t\tfor (const row: BX.Grid.Row of rows)\n\t\t{\n\t\t\tif (row.node.querySelector('.dashboard-unpin-icon'))\n\t\t\t{\n\t\t\t\tDom.addClass(row.node, 'biconnector-dashboard-pinned');\n\t\t\t\tthis.#lastPinnedRowId = row.getId();\n\t\t\t}\n\t\t}\n\t}\n\n\tonUpdatedDashboardBatchStatus(dashboardList: Array)\n\t{\n\t\tfor (const dashboard of dashboardList)\n\t\t{\n\t\t\tthis.updateDashboardStatus(dashboard.id, dashboard.status);\n\t\t}\n\t}\n\n\tgetGrid(): BX.Main.grid\n\t{\n\t\treturn this.#grid;\n\t}\n\n\tgetFilter(): BX.Main.Filter\n\t{\n\t\treturn this.#filter;\n\t}\n\n\t/**\n\t * @param params LoginPopupParams\n\t * @param openedFrom\n\t */\n\tshowLoginPopup(params: LoginPopupParams, openedFrom: string = 'unknown')\n\t{\n\t\tconst grid = this.getGrid();\n\t\tif (params.type === 'CUSTOM')\n\t\t{\n\t\t\tgrid.tableFade();\n\t\t}\n\n\t\tthis.#dashboardManager.processEditDashboard(\n\t\t\t{\n\t\t\t\tid: params.dashboardId,\n\t\t\t\ttype: params.type,\n\t\t\t\teditLink: params.editUrl,\n\t\t\t},\n\t\t\t() => {\n\t\t\t\tgrid.tableUnfade();\n\t\t\t},\n\t\t\t(popupType) => {\n\t\t\t\tApacheSupersetAnalytics.sendAnalytics('edit', 'report_edit', {\n\t\t\t\t\tc_sub_section: popupType,\n\t\t\t\t\tc_element: openedFrom,\n\t\t\t\t\ttype: params.type.toLowerCase(),\n\t\t\t\t\tp1: ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(params.appId),\n\t\t\t\t\tp2: params.dashboardId,\n\t\t\t\t\tstatus: 'success',\n\t\t\t\t});\n\t\t\t},\n\t\t\t(popupType) => {\n\t\t\t\tApacheSupersetAnalytics.sendAnalytics('edit', 'report_edit', {\n\t\t\t\t\tc_sub_section: popupType,\n\t\t\t\t\tc_element: openedFrom,\n\t\t\t\t\ttype: params.type.toLowerCase(),\n\t\t\t\t\tp1: ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(params.appId),\n\t\t\t\t\tp2: params.dashboardId,\n\t\t\t\t\tstatus: 'error',\n\t\t\t\t});\n\t\t\t},\n\t\t);\n\t}\n\n\trestartDashboardLoad(dashboardId: number): void\n\t{\n\t\tconst row = this.#grid.getRows().getById(dashboardId);\n\t\tif (row)\n\t\t{\n\t\t\tconst btn = row.node.querySelector('#restart-dashboard-load-btn');\n\t\t\tif (Type.isDomNode(btn))\n\t\t\t{\n\t\t\t\tconst isDisabled = btn.getAttribute('disabled');\n\t\t\t\tif (isDisabled)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tbtn.setAttribute('disabled', 'true');\n\t\t\t\tDom.addClass(btn, 'dashboard-status-label-error-btn__loading');\n\t\t\t}\n\t\t}\n\n\t\tthis.#dashboardManager\n\t\t\t.restartDashboardImport(dashboardId)\n\t\t\t.then(\n\t\t\t\t(response) => {\n\t\t\t\t\tconst dashboardIds = response?.data?.restartedDashboardIds;\n\t\t\t\t\tif (!dashboardIds)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (const restartedDashboardId of dashboardIds)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.updateDashboardStatus(restartedDashboardId, 'L');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t)\n\t\t\t.catch()\n\t\t;\n\t}\n\n\tsetDashboardStatusReady(dashboardId: number): void\n\t{\n\t\tconst row = this.#grid.getRows().getById(dashboardId);\n\t\tif (row)\n\t\t{\n\t\t\tconst label = row.node.getElementsByClassName('dashboard-status-label')[0];\n\t\t\tDom.addClass(label, 'ui-label-success');\n\t\t\tDom.removeClass(label, 'ui-label-primary');\n\t\t\tlabel.querySelector('span').innerText = Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_STATUS_READY');\n\t\t}\n\t}\n\n\tupdateDashboardStatus(dashboardId: number, status: string): void\n\t{\n\t\tconst row = this.#grid.getRows().getById(dashboardId);\n\t\tif (row)\n\t\t{\n\t\t\tconst labelWrapper = row.node.querySelector('.dashboard-status-label-wrapper');\n\t\t\tconst label = labelWrapper.querySelector('.dashboard-status-label');\n\t\t\tconst reloadBtn = labelWrapper.querySelector('#restart-dashboard-load-btn');\n\n\t\t\tswitch (status)\n\t\t\t{\n\t\t\t\tcase DashboardManager.DASHBOARD_STATUS_READY:\n\t\t\t\t\tif (reloadBtn)\n\t\t\t\t\t{\n\t\t\t\t\t\treloadBtn.remove();\n\t\t\t\t\t}\n\t\t\t\t\tDom.addClass(label, 'ui-label-success');\n\t\t\t\t\tDom.removeClass(label, 'ui-label-primary');\n\t\t\t\t\tDom.removeClass(label, 'ui-label-danger');\n\t\t\t\t\tlabel.querySelector('span').innerText = Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_STATUS_READY');\n\t\t\t\t\tbreak;\n\t\t\t\tcase DashboardManager.DASHBOARD_STATUS_LOAD:\n\t\t\t\t\tif (reloadBtn)\n\t\t\t\t\t{\n\t\t\t\t\t\treloadBtn.remove();\n\t\t\t\t\t}\n\t\t\t\t\tDom.addClass(label, 'ui-label-primary');\n\t\t\t\t\tDom.removeClass(label, 'ui-label-success');\n\t\t\t\t\tDom.removeClass(label, 'ui-label-danger');\n\t\t\t\t\tlabel.querySelector('span').innerText = Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_STATUS_LOAD');\n\t\t\t\t\tbreak;\n\t\t\t\tcase DashboardManager.DASHBOARD_STATUS_FAILED:\n\t\t\t\t\tif (!reloadBtn)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst createdReloadBtn = this.createReloadBtn(dashboardId);\n\t\t\t\t\t\tDom.append(createdReloadBtn, labelWrapper);\n\t\t\t\t\t}\n\t\t\t\t\tDom.addClass(label, 'ui-label-danger');\n\t\t\t\t\tDom.removeClass(label, 'ui-label-success');\n\t\t\t\t\tDom.removeClass(label, 'ui-label-primary');\n\t\t\t\t\tlabel.querySelector('span').innerText = Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_STATUS_FAILED');\n\t\t\t\t\tbreak;\n\t\t\t\tcase DashboardManager.DASHBOARD_STATUS_COMPUTED_NOT_LOAD:\n\t\t\t\t\tif (reloadBtn)\n\t\t\t\t\t{\n\t\t\t\t\t\treloadBtn.remove();\n\t\t\t\t\t}\n\t\t\t\t\tDom.addClass(label, 'ui-label-danger');\n\t\t\t\t\tDom.removeClass(label, 'ui-label-success');\n\t\t\t\t\tDom.removeClass(label, 'ui-label-primary');\n\t\t\t\t\tlabel.querySelector('span').innerText = Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_STATUS_NOT_LOAD');\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tcreateReloadBtn(dashboardId: number): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div id=\"restart-dashboard-load-btn\" onclick=\"BX.BIConnector.SupersetDashboardGridManager.Instance.restartDashboardLoad(${dashboardId})\" class=\"dashboard-status-label-error-btn\">\n\t\t\t\t<div class=\"ui-icon-set --refresh-5 dashboard-status-label-error-icon\"></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tduplicateDashboard(dashboardId: number, analyticInfo: DashboardAnalyticInfo = null): void\n\t{\n\t\tconst grid = this.getGrid();\n\t\tgrid.tableFade();\n\n\t\treturn this.#dashboardManager.duplicateDashboard(dashboardId)\n\t\t\t.then((response) => {\n\t\t\t\tconst gridRealtime: BX.Grid.Realtime = grid.getRealtime();\n\t\t\t\tconst newDashboard = response.data.dashboard;\n\n\t\t\t\tgridRealtime.addRow({\n\t\t\t\t\tid: newDashboard.id,\n\t\t\t\t\tcolumns: newDashboard.columns,\n\t\t\t\t\tactions: newDashboard.actions,\n\t\t\t\t\tinsertAfter: this.#lastPinnedRowId,\n\t\t\t\t});\n\n\t\t\t\tconst editableData = grid.getParam('EDITABLE_DATA');\n\t\t\t\tif (BX.type.isPlainObject(editableData))\n\t\t\t\t{\n\t\t\t\t\teditableData[newDashboard.id] = { TITLE: newDashboard.title };\n\t\t\t\t}\n\n\t\t\t\tgrid.tableUnfade();\n\t\t\t\tconst counterTotalTextContainer = grid.getCounterTotal().querySelector('.main-grid-panel-content-text');\n\t\t\t\tcounterTotalTextContainer.textContent++;\n\n\t\t\t\tthis.#initHints();\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_COPY_NOTIFICATION_ADDED'),\n\t\t\t\t});\n\n\t\t\t\tif (analyticInfo !== null)\n\t\t\t\t{\n\t\t\t\t\tApacheSupersetAnalytics.sendAnalytics('edit', 'report_copy', {\n\t\t\t\t\t\ttype: analyticInfo.type,\n\t\t\t\t\t\tp1: ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(analyticInfo.appId),\n\t\t\t\t\t\tp2: dashboardId,\n\t\t\t\t\t\tstatus: 'success',\n\t\t\t\t\t\tc_element: analyticInfo.from,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tgrid.tableUnfade();\n\t\t\t\tif (response.errors)\n\t\t\t\t{\n\t\t\t\t\tthis.#notifyErrors(response.errors);\n\t\t\t\t}\n\n\t\t\t\tif (analyticInfo !== null)\n\t\t\t\t{\n\t\t\t\t\tApacheSupersetAnalytics.sendAnalytics('edit', 'report_copy', {\n\t\t\t\t\t\ttype: analyticInfo.type,\n\t\t\t\t\t\tp1: ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(analyticInfo.appId),\n\t\t\t\t\t\tp2: dashboardId,\n\t\t\t\t\t\tstatus: 'error',\n\t\t\t\t\t\tc_element: analyticInfo.from,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t#notifyErrors(errors: Array): void\n\t{\n\t\tif (errors[0] && errors[0].message)\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Text.encode(errors[0].message),\n\t\t\t});\n\t\t}\n\t}\n\n\texportDashboard(dashboardId: number): void\n\t{\n\t\tconst grid = this.getGrid();\n\t\tgrid.tableFade();\n\n\t\treturn this.#dashboardManager.exportDashboard(dashboardId, 'grid_menu');\n\t}\n\n\tdeleteDashboard(dashboardId: number): void\n\t{\n\t\tMessageBox.confirm(\n\t\t\tLoc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_POPUP_TITLE'),\n\t\t\t(messageBox, button) => {\n\t\t\t\tbutton.setWaiting();\n\t\t\t\tthis.#dashboardManager.deleteDashboard(dashboardId)\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tthis.getGrid().reload();\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\tif (response.errors)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#notifyErrors(response.errors);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t},\n\t\t\tLoc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_POPUP_CAPTION_YES'),\n\t\t\t(messageBox) => messageBox.close(),\n\t\t\tLoc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_POPUP_CAPTION_NO'),\n\t\t);\n\t}\n\n\tcreateEmptyDashboard()\n\t{\n\t\tBX.BIConnector.ApacheSupersetAnalytics.sendAnalytics('new', 'report_new', {\n\t\t\ttype: 'custom',\n\t\t\tc_element: 'new_button',\n\t\t});\n\n\t\tconst grid = this.getGrid();\n\t\tgrid.tableFade();\n\t\tthis.#dashboardManager.createEmptyDashboard()\n\t\t\t.then((response) => {\n\t\t\t\tgrid.tableUnfade();\n\t\t\t\tconst gridRealtime: BX.Grid.Realtime = grid.getRealtime();\n\t\t\t\tconst newDashboard = response.data.dashboard;\n\t\t\t\tgridRealtime.addRow({\n\t\t\t\t\tid: newDashboard.id,\n\t\t\t\t\tcolumns: newDashboard.columns,\n\t\t\t\t\tactions: newDashboard.actions,\n\t\t\t\t\tinsertAfter: this.#lastPinnedRowId,\n\t\t\t\t});\n\n\t\t\t\tconst editableData = grid.getParam('EDITABLE_DATA');\n\t\t\t\tif (BX.type.isPlainObject(editableData))\n\t\t\t\t{\n\t\t\t\t\teditableData[newDashboard.id] = { TITLE: newDashboard.title };\n\t\t\t\t}\n\n\t\t\t\tgrid.tableUnfade();\n\t\t\t\tconst counterTotalTextContainer = grid.getCounterTotal().querySelector('.main-grid-panel-content-text');\n\t\t\t\tcounterTotalTextContainer.textContent++;\n\t\t\t\tthis.#initHints();\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tgrid.tableUnfade();\n\n\t\t\t\tif (response.errors)\n\t\t\t\t{\n\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_CREATE_EMPTY_NOTIFICATION_ERROR'),\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t#buildDashboardTitleEditor(\n\t\tid: number,\n\t\ttitle: string,\n\t\tonCancel: () => void,\n\t\tonSave: (innerTitle: string) => void,\n\t): HTMLElement\n\t{\n\t\tconst input = Tag.render`\n\t\t\t<input class=\"main-grid-editor main-grid-editor-text\" type=\"text\">\n\t\t`;\n\t\tinput.value = title;\n\n\t\tconst saveInputValue = () => {\n\t\t\tconst value = input.value;\n\t\t\tDom.removeClass(input, 'dashboard-title-input-danger');\n\t\t\tif (value.trim() === '')\n\t\t\t{\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_CHANGE_TITLE_ERROR_EMPTY'),\n\t\t\t\t});\n\n\t\t\t\tDom.addClass(input, 'dashboard-title-input-danger');\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tDom.style(buttons, 'display', 'none');\n\t\t\tDom.attr(input, 'disabled', true);\n\t\t\tonSave(input.value);\n\t\t};\n\n\t\tEvent.bind(input, 'keydown', (event) => {\n\t\t\tif (event.keyCode === 13)\n\t\t\t{\n\t\t\t\tsaveInputValue();\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t\telse if (event.keyCode === 27)\n\t\t\t{\n\t\t\t\tonCancel();\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t});\n\n\t\tconst applyButton = Tag.render`\n\t\t\t<a>\n\t\t\t\t<i\n\t\t\t\t\tclass=\"ui-icon-set --check\"\n\t\t\t\t\tstyle=\"--ui-icon-set__icon-size: 21px; --ui-icon-set__icon-color: var(--ui-color-palette-gray-40);\"\n\t\t\t\t></i>\n\t\t\t</a>\n\t\t`;\n\n\t\tconst cancelButton = Tag.render`\n\t\t\t<a>\n\t\t\t\t<i\n\t\t\t\t\tclass=\"ui-icon-set --cross-60\"\n\t\t\t\t\tstyle=\"--ui-icon-set__icon-size: 21px; --ui-icon-set__icon-color: var(--ui-color-palette-gray-40);\"\n\t\t\t\t></i>\n\t\t\t</a>\n\t\t`;\n\n\t\tconst buttons = Tag.render`\n\t\t\t<div class=\"dashboard-title-wrapper__buttons\">\n\t\t\t\t${applyButton}\n\t\t\t\t${cancelButton}\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(cancelButton, 'click', () => {\n\t\t\tonCancel();\n\t\t});\n\n\t\tEvent.bind(applyButton, 'click', saveInputValue);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"dashboard-title-wrapper__item dashboard-title-edit\">\n\t\t\t\t${input}\n\t\t\t\t<div class=\"dashboard-title-wrapper__buttons-wrapper\">\n\t\t\t\t\t${buttons}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getTitlePreview(dashboardId: number): ?HTMLElement\n\t{\n\t\tconst grid = this.getGrid();\n\t\tconst row = grid.getRows().getById(dashboardId);\n\t\tif (!row)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst wrapper = row.getCellById('TITLE')?.querySelector('.dashboard-title-wrapper');\n\t\tif (!wrapper)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst previewSection = wrapper.querySelector('.dashboard-title-preview');\n\t\tif (previewSection)\n\t\t{\n\t\t\treturn previewSection;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\trenameDashboard(dashboardId: number): void\n\t{\n\t\tconst grid = this.getGrid();\n\t\tconst row = grid.getRows().getById(dashboardId);\n\t\tif (!row)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst rowNode = row.getNode();\n\t\tDom.removeClass(rowNode, 'dashboard-title-edited');\n\n\t\tconst wrapper = row.getCellById('TITLE')?.querySelector('.dashboard-title-wrapper');\n\t\tif (!wrapper)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst editor = this.#buildDashboardTitleEditor(\n\t\t\tdashboardId,\n\t\t\trow.getEditData().TITLE,\n\t\t\t() => {\n\t\t\t\tthis.cancelRenameDashboard(dashboardId);\n\t\t\t},\n\t\t\t(innerTitle) => {\n\t\t\t\tconst oldTitle = this.#getTitlePreview(dashboardId).querySelector('a').innerText;\n\t\t\t\tthis.#getTitlePreview(dashboardId).querySelector('a').innerText = innerTitle;\n\n\t\t\t\tconst rowEditData = row.getEditData();\n\t\t\t\trowEditData.TITLE = innerTitle;\n\t\t\t\tconst editableData = grid.getParam('EDITABLE_DATA');\n\t\t\t\tif (BX.type.isPlainObject(editableData))\n\t\t\t\t{\n\t\t\t\t\teditableData[row.getId()] = rowEditData;\n\t\t\t\t}\n\n\t\t\t\tDom.addClass(rowNode, 'dashboard-title-edited');\n\t\t\t\tconst msg = Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_CHANGE_TITLE_SUCCESS', {\n\t\t\t\t\t'#NEW_TITLE#': Text.encode(innerTitle),\n\t\t\t\t});\n\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: msg,\n\t\t\t\t});\n\n\t\t\t\tthis.cancelRenameDashboard(dashboardId);\n\t\t\t\tthis.#setDateModifyNow(dashboardId);\n\n\t\t\t\tthis.#dashboardManager.renameDashboard(dashboardId, innerTitle)\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tif (response.errors)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#notifyErrors(response.errors);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.#getTitlePreview(dashboardId).querySelector('a').innerText = oldTitle;\n\t\t\t\t\t\trowEditData.TITLE = oldTitle;\n\t\t\t\t\t});\n\t\t\t},\n\t\t);\n\n\t\tconst preview = wrapper.querySelector('.dashboard-title-preview');\n\t\tif (preview)\n\t\t{\n\t\t\tDom.style(preview, 'display', 'none');\n\t\t}\n\t\tDom.append(editor, wrapper);\n\n\t\tconst editBtn = row.getCellById('EDIT_URL')?.querySelector('a');\n\n\t\tconst actionsClickHandler = () => {\n\t\t\tEvent.unbind(row.getActionsButton(), 'click', actionsClickHandler);\n\t\t\tif (editBtn)\n\t\t\t{\n\t\t\t\tEvent.unbind(editBtn, 'click', actionsClickHandler);\n\t\t\t}\n\t\t\tthis.cancelRenameDashboard(dashboardId);\n\t\t};\n\t\tEvent.bind(row.getActionsButton(), 'click', actionsClickHandler);\n\t\tif (editBtn)\n\t\t{\n\t\t\tEvent.bind(editBtn, 'click', actionsClickHandler);\n\t\t}\n\t}\n\n\tcancelRenameDashboard(dashboardId): void\n\t{\n\t\tconst row = this.getGrid().getRows().getById(dashboardId);\n\t\tif (!row)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst editSection = row.getCellById('TITLE')?.querySelector('.dashboard-title-edit');\n\t\tconst previewSection = row.getCellById('TITLE')?.querySelector('.dashboard-title-preview');\n\n\t\tif (editSection)\n\t\t{\n\t\t\tDom.remove(editSection);\n\t\t}\n\n\t\tif (previewSection)\n\t\t{\n\t\t\tDom.style(previewSection, 'display', 'flex');\n\t\t}\n\t}\n\n\t#setDateModifyNow(dashboardId: number)\n\t{\n\t\tconst dateModifyCell = this.#grid.getRows().getById(dashboardId)?.getCellById('DATE_MODIFY');\n\t\tif (!dateModifyCell)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst cellContent = dateModifyCell.querySelector('.main-grid-cell-content span');\n\n\t\tconst date = DateTimeFormat.format(\n\t\t\tDateTimeFormat.getFormat('FORMAT_DATETIME'),\n\t\t\tMath.floor(Date.now() / 1000),\n\t\t);\n\t\tconst readableDate = Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_DATE_MODIFY_NOW');\n\t\tconst newCellContent = Tag.render`\n\t\t\t<span data-hint=\"${date}\" data-hint-no-icon data-hint-interactivity>${readableDate}</span>\n\t\t`;\n\n\t\tDom.replace(cellContent, newCellContent);\n\t\tthis.#initHints();\n\t}\n\n\thandleTagClick(tagJson: string): void\n\t{\n\t\tconst tag = JSON.parse(tagJson);\n\t\tthis.handleFilterChange({\n\t\t\tfieldId: 'TAGS.ID',\n\t\t\t...tag,\n\t\t});\n\t}\n\n\thandleTagAddClick(dashboardId: number, preselectedIds: [], event: BaseEvent): void\n\t{\n\t\tconst onTagsChange = () => {\n\t\t\tconst tags = this.#tagSelectorDialog.getSelectedItems().map((item) => item.getId());\n\t\t\tthis.#dashboardManager\n\t\t\t\t.setDashboardTags(dashboardId, tags)\n\t\t\t\t.then(\n\t\t\t\t\t() => {\n\t\t\t\t\t\tthis.getGrid().updateRow(dashboardId, null, null, () => {\n\t\t\t\t\t\t\tconst anchor = this.getGrid()\n\t\t\t\t\t\t\t\t.getRows()\n\t\t\t\t\t\t\t\t.getById(dashboardId)\n\t\t\t\t\t\t\t\t?.getCellById('TAGS')\n\t\t\t\t\t\t\t;\n\n\t\t\t\t\t\t\tif (anchor && this.#tagSelectorDialog)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.#tagSelectorDialog.setTargetNode(anchor);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tconst filterTagValues = this.getFilter().getFilterFieldsValues();\n\t\t\t\t\t\tconst currentFilteredTags = filterTagValues['TAGS.ID'] ?? [];\n\t\t\t\t\t\tif (currentFilteredTags.length > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst filtered = tags.filter((tagId) => currentFilteredTags.includes(String(tagId)));\n\t\t\t\t\t\t\tif (filtered.length === 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.#tagSelectorDialog.destroy();\n\n\t\t\t\t\t\t\t\tthis.#tagSelectorDialog = null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t};\n\t\tconst entityId = 'biconnector-superset-dashboard-tag';\n\n\t\tconst preselectedItems = [];\n\t\tJSON.parse(preselectedIds).forEach((id) => preselectedItems.push([entityId, id]));\n\t\tthis.#tagSelectorDialog = new Dialog({\n\t\t\tid: 'biconnector-superset-tag-widget',\n\t\t\ttargetNode: event.getData().button,\n\t\t\tenableSearch: true,\n\t\t\twidth: 350,\n\t\t\theight: 400,\n\t\t\tmultiple: true,\n\t\t\tdropdownMode: true,\n\t\t\tcompactView: true,\n\t\t\tcontext: entityId,\n\t\t\tclearUnavailableItems: true,\n\t\t\tentities: [\n\t\t\t\t{\n\t\t\t\t\tid: entityId,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tdashboardId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tpreselectedItems,\n\t\t\tsearchOptions: {\n\t\t\t\tallowCreateItem: false,\n\t\t\t},\n\t\t\tfooter: TagFooter,\n\t\t\tevents: {\n\t\t\t\tonSearch: (event: BaseEvent) => {\n\t\t\t\t\tconst query = event.getData().query;\n\n\t\t\t\t\tconst footer: TagFooter = this.#tagSelectorDialog.getFooter();\n\t\t\t\t\tconst footerWrapper = this.#tagSelectorDialog.getFooterContainer();\n\t\t\t\t\tif (Type.isStringFilled(query.trim()) && footer.canCreateTag())\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.show(footerWrapper.querySelector('#tags-widget-custom-footer-add-new'));\n\t\t\t\t\t\tDom.show(footerWrapper.querySelector('#tags-widget-custom-footer-conjunction'));\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tDom.hide(footerWrapper.querySelector('#tags-widget-custom-footer-add-new'));\n\t\t\t\t\tDom.hide(footerWrapper.querySelector('#tags-widget-custom-footer-conjunction'));\n\t\t\t\t},\n\t\t\t\t'Search:onItemCreateAsync': (searchEvent: BaseEvent) => {\n\t\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t\tconst { searchQuery } = searchEvent.getData();\n\t\t\t\t\t\tconst name = searchQuery.getQuery();\n\n\t\t\t\t\t\tthis.#dashboardManager.addTag(name)\n\t\t\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\t\t\tconst newTag = result.data;\n\t\t\t\t\t\t\t\tconst item = this.#tagSelectorDialog.addItem({\n\t\t\t\t\t\t\t\t\tid: newTag.ID,\n\t\t\t\t\t\t\t\t\tentityId,\n\t\t\t\t\t\t\t\t\ttitle: name,\n\t\t\t\t\t\t\t\t\ttabs: 'all',\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tif (item)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\titem.select();\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch((result) => {\n\t\t\t\t\t\t\t\tconst errors = result.errors;\n\t\t\t\t\t\t\t\terrors.forEach((error) => {\n\t\t\t\t\t\t\t\t\tconst alert = Tag.render`\n\t\t\t\t\t\t\t\t\t\t<div class=\"dashboard-tag-already-exists-alert\">\n\t\t\t\t\t\t\t\t\t\t\t<div class='ui-alert ui-alert-xs ui-alert-danger'> \n\t\t\t\t\t\t\t\t\t\t\t\t<span class='ui-alert-message'>\n\t\t\t\t\t\t\t\t\t\t\t\t\t${error.message}\n\t\t\t\t\t\t\t\t\t\t\t\t</span> \n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t`;\n\n\t\t\t\t\t\t\t\t\tDom.prepend(alert, this.#tagSelectorDialog.getFooterContainer());\n\t\t\t\t\t\t\t\t\tsetTimeout(\n\t\t\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\t\t\tDom.remove(alert);\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t3000,\n\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t;\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t'Item:onSelect': Runtime.debounce(onTagsChange, 100, this),\n\t\t\t\t'Item:onDeselect': Runtime.debounce(onTagsChange, 100, this),\n\t\t\t},\n\t\t});\n\n\t\tthis.#tagSelectorDialog.show();\n\t}\n\n\thandleOwnerClick(ownerData: Object)\n\t{\n\t\tthis.handleFilterChange({\n\t\t\tfieldId: 'OWNER_ID',\n\t\t\t...ownerData,\n\t\t});\n\t}\n\n\thandleCreatedByClick(ownerData: Object)\n\t{\n\t\tthis.handleFilterChange({\n\t\t\tfieldId: 'CREATED_BY_ID',\n\t\t\t...ownerData,\n\t\t});\n\t}\n\n\thandleFilterChange(fieldData: Object)\n\t{\n\t\tconst filterFieldsValues = this.getFilter().getFilterFieldsValues();\n\t\tlet currentFilteredField = filterFieldsValues[fieldData.fieldId] ?? [];\n\t\tlet currentFilteredFieldLabel = filterFieldsValues[`${fieldData.fieldId}_label`] ?? [];\n\n\t\tif (fieldData.IS_FILTERED)\n\t\t{\n\t\t\tcurrentFilteredField = currentFilteredField.filter((value) => parseInt(value, 10) !== fieldData.ID);\n\t\t\tcurrentFilteredFieldLabel = currentFilteredFieldLabel.filter((value) => value !== fieldData.TITLE);\n\t\t}\n\t\telse if (!currentFilteredField.includes(fieldData.ID))\n\t\t{\n\t\t\tcurrentFilteredField.push(fieldData.ID);\n\t\t\tcurrentFilteredFieldLabel.push(fieldData.TITLE);\n\t\t}\n\n\t\tconst filterApi = this.getFilter().getApi();\n\t\tconst filterToExtend = {};\n\t\tfilterToExtend[fieldData.fieldId] = currentFilteredField;\n\t\tfilterToExtend[`${fieldData.fieldId}_label`] = currentFilteredFieldLabel;\n\n\t\tfilterApi.extendFilter(filterToExtend);\n\t\tfilterApi.apply();\n\t}\n\n\taddToTopMenu(dashboardId: number): Promise\n\t{\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_ADD_TO_TOP_MENU_SUCCESS'),\n\t\t});\n\t\tthis.#switchTopMenuAction(dashboardId, true);\n\n\t\treturn this.#dashboardManager.addToTopMenu(dashboardId)\n\t\t\t.then((response) => {})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.#grid.updateRow(dashboardId);\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_ADD_TO_TOP_MENU_ERROR'),\n\t\t\t\t});\n\t\t\t})\n\t\t;\n\t}\n\n\tdeleteFromTopMenu(dashboardId: number): Promise\n\t{\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_FROM_TOP_MENU_SUCCESS'),\n\t\t});\n\t\tthis.#switchTopMenuAction(dashboardId, false);\n\n\t\treturn this.#dashboardManager.deleteFromTopMenu(dashboardId)\n\t\t\t.then((response) => {})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.#grid.updateRow(dashboardId);\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_FROM_TOP_MENU_ERROR'),\n\t\t\t\t});\n\t\t\t})\n\t\t;\n\t}\n\n\t#switchTopMenuAction(dashboardId: number, isInTopMenu: boolean)\n\t{\n\t\tconst row = this.#grid.getRows().getById(dashboardId);\n\t\tconst rowActions = row?.getActions();\n\t\tfor (const [index, action] of rowActions.entries())\n\t\t{\n\t\t\tif (isInTopMenu && action.ACTION_ID === 'addToTopMenu')\n\t\t\t{\n\t\t\t\trowActions[index].ACTION_ID = 'deleteFromTopMenu';\n\t\t\t\trowActions[index].onclick = `BX.BIConnector.SupersetDashboardGridManager.Instance.deleteFromTopMenu(${dashboardId})`;\n\t\t\t\trowActions[index].text = Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_ACTION_ITEM_DELETE_FROM_TOP_MENU');\n\t\t\t}\n\t\t\telse if (!isInTopMenu && action.ACTION_ID === 'deleteFromTopMenu')\n\t\t\t{\n\t\t\t\trowActions[index].ACTION_ID = 'addToTopMenu';\n\t\t\t\trowActions[index].onclick = `BX.BIConnector.SupersetDashboardGridManager.Instance.addToTopMenu(${dashboardId})`;\n\t\t\t\trowActions[index].text = Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_ACTION_ITEM_ADD_TO_TOP_MENU');\n\t\t\t}\n\t\t}\n\t\trow.setActions(rowActions);\n\n\t\tconst titleCell = row?.getCellById('TITLE');\n\t\tlet dashboardTitle = '';\n\t\tif (titleCell)\n\t\t{\n\t\t\tconst titleWrapper = titleCell.querySelector('.dashboard-title-wrapper__item');\n\t\t\tdashboardTitle = titleWrapper.querySelector('a').innerText;\n\t\t}\n\n\t\tconst menu: BX.Main.interfaceButtons = BX.Main.interfaceButtonsManager.getById('biconnector_superset_menu');\n\t\tif (isInTopMenu && dashboardTitle)\n\t\t{\n\t\t\tmenu.addMenuItem({\n\t\t\t\tid: `biconnector_superset_menu_dashboard_${dashboardId}`,\n\t\t\t\ttext: dashboardTitle,\n\t\t\t\turl: `/bi/dashboard/detail/${dashboardId}/?openFrom=menu`,\n\t\t\t\tonClick: '',\n\t\t\t});\n\t\t\tconst menuItem = menu.getItemById(`biconnector_superset_menu_dashboard_${dashboardId}`);\n\t\t\tconst firstMenuItem = menu.getVisibleItems();\n\t\t\tDom.insertBefore(menuItem, firstMenuItem[0]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst menuItem = menu.getItemById(`biconnector_superset_menu_dashboard_${dashboardId}`);\n\t\t\tmenu.deleteMenuItem(menuItem);\n\t\t}\n\t}\n\n\tpin(dashboardId: number): void\n\t{\n\t\treturn this.#dashboardManager.pin(dashboardId)\n\t\t\t.then(() => {\n\t\t\t\tthis.#grid.reload();\n\t\t\t})\n\t\t\t.catch(() => {})\n\t\t;\n\t}\n\n\tunpin(dashboardId: number): void\n\t{\n\t\treturn this.#dashboardManager.unpin(dashboardId)\n\t\t\t.then(() => {\n\t\t\t\tthis.#grid.reload();\n\t\t\t})\n\t\t\t.catch(() => {})\n\t\t;\n\t}\n}\n\nReflection.namespace('BX.BIConnector').SupersetDashboardGridManager = SupersetDashboardGridManager;\n"],"names":["SupersetDashboardGridManager","props","DashboardManager","BX","Main","gridManager","getById","gridId","instance","filterManager","isNeedShowTopMenuGuide","PopupWindowManager","isAnyPopupShown","getRows","getBodyFirstChild","actionsButton","SpotLight","targetElement","targetVertex","events","onTargetEnter","close","show","dashboardList","dashboard","updateDashboardStatus","id","status","params","openedFrom","grid","getGrid","type","tableFade","processEditDashboard","dashboardId","editLink","editUrl","tableUnfade","popupType","ApacheSupersetAnalytics","sendAnalytics","c_sub_section","c_element","toLowerCase","p1","buildAppIdForAnalyticRequest","appId","p2","row","btn","node","querySelector","Type","isDomNode","isDisabled","getAttribute","setAttribute","Dom","addClass","restartDashboardImport","then","response","dashboardIds","data","restartedDashboardIds","restartedDashboardId","label","getElementsByClassName","removeClass","innerText","Loc","getMessage","labelWrapper","reloadBtn","DASHBOARD_STATUS_READY","remove","DASHBOARD_STATUS_LOAD","DASHBOARD_STATUS_FAILED","createdReloadBtn","createReloadBtn","append","DASHBOARD_STATUS_COMPUTED_NOT_LOAD","Tag","render","analyticInfo","duplicateDashboard","gridRealtime","getRealtime","newDashboard","addRow","columns","actions","insertAfter","editableData","getParam","isPlainObject","TITLE","title","counterTotalTextContainer","getCounterTotal","textContent","UI","Notification","Center","notify","content","from","errors","exportDashboard","MessageBox","confirm","messageBox","button","setWaiting","deleteDashboard","reload","BIConnector","createEmptyDashboard","rowNode","getNode","wrapper","getCellById","editor","getEditData","cancelRenameDashboard","innerTitle","oldTitle","rowEditData","getId","msg","Text","encode","renameDashboard","preview","style","editBtn","actionsClickHandler","Event","unbind","getActionsButton","bind","editSection","previewSection","tagJson","tag","JSON","parse","handleFilterChange","fieldId","preselectedIds","event","onTagsChange","tags","getSelectedItems","map","item","setDashboardTags","updateRow","anchor","setTargetNode","filterTagValues","getFilter","getFilterFieldsValues","currentFilteredTags","length","filtered","filter","tagId","includes","String","destroy","entityId","preselectedItems","forEach","push","Dialog","targetNode","getData","enableSearch","width","height","multiple","dropdownMode","compactView","context","clearUnavailableItems","entities","options","searchOptions","allowCreateItem","footer","TagFooter","onSearch","query","getFooter","footerWrapper","getFooterContainer","isStringFilled","trim","canCreateTag","hide","searchEvent","Promise","resolve","reject","searchQuery","name","getQuery","addTag","result","newTag","addItem","ID","tabs","select","error","alert","message","prepend","setTimeout","Runtime","debounce","ownerData","fieldData","filterFieldsValues","currentFilteredField","currentFilteredFieldLabel","IS_FILTERED","value","parseInt","filterApi","getApi","filterToExtend","extendFilter","apply","addToTopMenu","deleteFromTopMenu","pin","unpin","EventEmitter","subscribe","getCompatData","sliderEvent","getEventId","eventArgs","onUpdatedDashboardBatchStatus","isUndefined","currentFilteredTagLabels","index","findIndex","toInteger","splice","PULL","extendWatch","eventName","eventData","manager","Hint","createInstance","popupParameters","autoHide","init","getContainer","statusMap","LOAD","ERROR","rows","getBodyChild","dashboardStatus","guide","Guide","steps","target","text","onClose","userOptions","save","rounded","position","areaPadding","onEvents","start","onCancel","onSave","input","saveInputValue","buttons","attr","keyCode","preventDefault","applyButton","cancelButton","dateModifyCell","cellContent","date","DateTimeFormat","format","getFormat","Math","floor","Date","now","readableDate","newCellContent","replace","isInTopMenu","rowActions","getActions","entries","action","ACTION_ID","onclick","setActions","titleCell","dashboardTitle","titleWrapper","menu","interfaceButtonsManager","addMenuItem","url","onClick","menuItem","getItemById","firstMenuItem","getVisibleItems","insertBefore","deleteMenuItem","Reflection","namespace"],"mappings":"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"}