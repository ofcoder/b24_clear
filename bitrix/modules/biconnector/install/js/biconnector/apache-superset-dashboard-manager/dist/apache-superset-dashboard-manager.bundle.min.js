this.BX=this.BX||{},function(t,e,n,a,o,r,i){"use strict";var d;function s(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var a=0,o=function(){};return{s:o,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,d=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){d=!0,r=t},f:function(){try{i||null==n.return||n.return()}finally{if(d)throw r}}}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}var u=function(){function t(){babelHelpers.classCallCheck(this,t),this.subscribeOnEvents()}return babelHelpers.createClass(t,[{key:"subscribeOnEvents",value:function(){BX.PULL&&BX.PULL.extendWatch("superset_dashboard",!0),o.EventEmitter.subscribe("onPullEvent-biconnector",(function(t){var e=babelHelpers.slicedToArray(t.data,2),n=e[0],a=e[1];if("onDashboardStatusUpdated"===n&&a){var r=null==a?void 0:a.dashboardList;r&&o.EventEmitter.emit("BIConnector.Superset.DashboardManager:onDashboardBatchStatusUpdate",{dashboardList:r})}}))}},{key:"processEditDashboard",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};"CUSTOM"===t.type?this.processLoginDashboard(t,e,n,a):this.processCopyDashboard(t,e,n,a)}},{key:"processCopyDashboard",value:function(t){var r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},u="SYSTEM"===t.type?e.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_COPY_SYSTEM_DASHBOARD_ATTENTION"):e.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_COPY_MARKET_DASHBOARD_ATTENTION"),l=e.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="dashboard-login-popup-copy-attention">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),u),b="popup_copy",h=new a.Button({text:e.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_CONTINUE_BTN"),color:a.Button.Color.PRIMARY,onclick:function(){h.setWaiting(!0),r.duplicateDashboard(t.id).then((function(t){s(b);var n=t.data.dashboard;return n?r.getDashboardEmbeddedData(n.id):(BX.UI.Notification.Center.notify({content:BX.util.htmlspecialchars(e.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_COPY_ERROR"))}),null)})).then((function(t){o.EventEmitter.emit("BIConnector.DashboardManager:onCopyDashboard",{dashboard:t.data.dashboard});var e={id:t.data.dashboard.id,editLink:t.data.dashboard.editUrl,type:t.data.dashboard.type};r.processLoginDashboard(e,(function(){i(),p.close(),o.EventEmitter.emit("BIConnector.DashboardManager:onEmbeddedDataLoaded")}),s,c)})).catch((function(t){var n;c(b),t.errors&&e.Type.isStringFilled(null===(n=t.errors[0])||void 0===n?void 0:n.message)&&BX.UI.Notification.Center.notify({content:e.Text.encode(t.errors[0].message)})}))}}),p=new n.Popup({content:l,overlay:!0,width:620,className:"dashboard-login-popup",closeIcon:!0,closeByEsc:!0,disableScroll:!0,titleBar:e.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_TITLE"),buttons:[h,new a.Button({text:e.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_CANCEL_BTN"),color:a.Button.Color.LIGHT,onclick:function(){p.close()}})],events:{onClose:function(){i("popup_copy")}}});p.show()}},{key:"processLoginDashboard",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},o="popup_login";this.getEditUrl(t).then((function(t){n(o),t&&window.open(t,"_blank").focus()})).catch((function(){a(o),window.open(t.editLink,"_blank").focus()})).finally((function(){e()}))}},{key:"duplicateDashboard",value:function(t){return e.ajax.runAction("biconnector.dashboard.copy",{data:{id:t}})}},{key:"exportDashboard",value:function(t,e){return new i.DashboardExportMaster({dashboardId:t,openedFrom:e}).showPopup()}},{key:"deleteDashboard",value:function(t){return e.ajax.runAction("biconnector.dashboard.delete",{data:{id:t}})}},{key:"renameDashboard",value:function(t,n){return e.ajax.runAction("biconnector.dashboard.rename",{data:{id:t,title:n}})}},{key:"restartDashboardImport",value:function(t){return e.ajax.runAction("biconnector.dashboard.restartImport",{data:{id:t}}).then((function(t){var e,n=null==t||null===(e=t.data)||void 0===e?void 0:e.restartedDashboardIds;if(n){var a,r=[],i=s(n);try{for(i.s();!(a=i.n()).done;){var d=a.value;r.push({id:Number(d),status:"L"})}}catch(t){i.e(t)}finally{i.f()}o.EventEmitter.emit(window,"BIConnector.Superset.DashboardManager:onDashboardBatchStatusUpdate",{dashboardList:r})}}))}},{key:"setDashboardTags",value:function(t,n){return e.ajax.runAction("biconnector.dashboard.setDashboardTags",{data:{id:t,tags:n}})}},{key:"addTag",value:function(t){return e.ajax.runAction("biconnector.dashboardTag.add",{data:{title:t}})}},{key:"createEmptyDashboard",value:function(){return e.ajax.runAction("biconnector.dashboard.createEmptyDashboard",{data:{}})}},{key:"getEditUrl",value:function(t){return new Promise((function(n,a){e.ajax.runAction("biconnector.dashboard.getEditUrl",{data:{dashboardId:t.id,editUrl:t.editLink}}).then((function(t){var e=t.data;e&&n(e)})).catch((function(t){a(t)}))}))}},{key:"addToTopMenu",value:function(t){return e.ajax.runAction("biconnector.dashboard.addToTopMenu",{data:{dashboardId:t}})}},{key:"deleteFromTopMenu",value:function(t){return e.ajax.runAction("biconnector.dashboard.deleteFromTopMenu",{data:{dashboardId:t}})}},{key:"pin",value:function(t){return e.ajax.runAction("biconnector.dashboard.pin",{data:{dashboardId:t}})}},{key:"unpin",value:function(t){return e.ajax.runAction("biconnector.dashboard.unpin",{data:{dashboardId:t}})}},{key:"getDashboardEmbeddedData",value:function(t){return BX.ajax.runAction("biconnector.dashboard.getDashboardEmbeddedData",{data:{id:t}})}}],[{key:"openSettingsSlider",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=null===t?"/bitrix/components/bitrix/biconnector.apachesuperset.setting/slider.php":"/bitrix/components/bitrix/biconnector.apachesuperset.dashboard.setting/slider.php",a=new e.Uri(n);null!==t&&a.setQueryParam("DASHBOARD_ID",e.Text.toNumber(t)),BX.SidePanel.Instance.open(a.toString(),{width:790,allowChangeHistory:!1,cacheable:!1})}}]),t}();babelHelpers.defineProperty(u,"DASHBOARD_STATUS_LOAD","L"),babelHelpers.defineProperty(u,"DASHBOARD_STATUS_READY","R"),babelHelpers.defineProperty(u,"DASHBOARD_STATUS_FAILED","F"),babelHelpers.defineProperty(u,"DASHBOARD_STATUS_COMPUTED_NOT_LOAD","NL"),t.DashboardManager=u}(this.BX.BIConnector=this.BX.BIConnector||{},BX,BX.Main,BX.UI,BX.Event,BX,BX.BIConnector);
//# sourceMappingURL=apache-superset-dashboard-manager.bundle.map.js