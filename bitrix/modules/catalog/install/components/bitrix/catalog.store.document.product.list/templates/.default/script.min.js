this.BX=this.BX||{};this.BX.Catalog=this.BX.Catalog||{};this.BX.Catalog.Store=this.BX.Catalog.Store||{};(function(e,t,i,r,n,a,o,s,l,u,d,c,h){"use strict";s=s&&s.hasOwnProperty("default")?s["default"]:s;var v;var g=function(){function e(t){babelHelpers.classCallCheck(this,e);this.editor=t}babelHelpers.createClass(e,[{key:"load",value:function e(t,r){if(!this.hintPopup){this.hintPopup=new i.Popup("ui-hint-popup-"+this.editor.getId(),null,{darkMode:true,closeIcon:true,animation:"fading-slide"})}this.hintPopup.setBindElement(t);this.hintPopup.adjustPosition();this.hintPopup.setContent(u.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(["\n\t\t\t<div class='ui-hint-content'>","</div>\n\t\t"])),u.Text.encode(r)));return this.hintPopup}},{key:"show",value:function e(){if(this.hintPopup){this.hintPopup.show()}}},{key:"close",value:function e(){if(this.hintPopup){this.hintPopup.close()}}}]);return e}();function f(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function p(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?f(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):f(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function E(e,t,i){y(e,t);t.set(e,i)}function y(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var b=new WeakMap;var S=function(){function e(t){babelHelpers.classCallCheck(this,e);E(this,b,{writable:true,value:{basePrice:0,finalPrice:0,extra:null,extraType:e.EXTRA_TYPE_PERCENTAGE}});babelHelpers.classPrivateFieldSet(this,b,p(p({},babelHelpers.classPrivateFieldGet(this,b)),t))}babelHelpers.createClass(e,[{key:"getBasePrice",value:function e(){return babelHelpers.classPrivateFieldGet(this,b).basePrice}},{key:"getFinalPrice",value:function e(){return babelHelpers.classPrivateFieldGet(this,b).finalPrice}},{key:"getExtra",value:function e(){return babelHelpers.classPrivateFieldGet(this,b).extra}},{key:"getExtraType",value:function e(){return babelHelpers.classPrivateFieldGet(this,b).extraType}},{key:"calculateBasePrice",value:function t(i){babelHelpers.classPrivateFieldGet(this,b).basePrice=i;babelHelpers.classPrivateFieldGet(this,b).extra=u.Text.toNumber(babelHelpers.classPrivateFieldGet(this,b).extra);if(babelHelpers.classPrivateFieldGet(this,b).extraType===e.EXTRA_TYPE_MONETARY){babelHelpers.classPrivateFieldGet(this,b).finalPrice=babelHelpers.classPrivateFieldGet(this,b).basePrice+babelHelpers.classPrivateFieldGet(this,b).extra}else{babelHelpers.classPrivateFieldGet(this,b).finalPrice=babelHelpers.classPrivateFieldGet(this,b).basePrice*(1+babelHelpers.classPrivateFieldGet(this,b).extra/100)}return this}},{key:"calculateFinalPrice",value:function t(i){babelHelpers.classPrivateFieldGet(this,b).finalPrice=i;var r=u.Text.toNumber(babelHelpers.classPrivateFieldGet(this,b).basePrice);if(r<=0){babelHelpers.classPrivateFieldGet(this,b).extraType=e.EXTRA_TYPE_MONETARY}if(babelHelpers.classPrivateFieldGet(this,b).extraType===e.EXTRA_TYPE_MONETARY){babelHelpers.classPrivateFieldGet(this,b).extra=babelHelpers.classPrivateFieldGet(this,b).finalPrice-r}else{babelHelpers.classPrivateFieldGet(this,b).extra=(babelHelpers.classPrivateFieldGet(this,b).finalPrice/r-1)*100}return this}},{key:"calculateExtra",value:function e(t){babelHelpers.classPrivateFieldGet(this,b).extra=t;if(u.Type.isNil(t)){return this}return this.calculateBasePrice(babelHelpers.classPrivateFieldGet(this,b).basePrice)}},{key:"calculateExtraType",value:function t(i){if(i!==e.EXTRA_TYPE_MONETARY){i=e.EXTRA_TYPE_PERCENTAGE}babelHelpers.classPrivateFieldGet(this,b).extraType=i;return this.calculateFinalPrice(babelHelpers.classPrivateFieldGet(this,b).finalPrice)}}]);return e}();babelHelpers.defineProperty(S,"EXTRA_TYPE_PERCENTAGE",1);babelHelpers.defineProperty(S,"EXTRA_TYPE_MONETARY",2);var m;var P=function(){function e(t){babelHelpers.classCallCheck(this,e);this.text=t.text||u.Loc.getMessage("CATALOG_DOCUMENT_PRODUCT_LIST_ACCESS_DENIED_TEXT");this.hint=t.hint;this.isReadOnly=t.isReadOnly===true}babelHelpers.createClass(e,[{key:"renderTo",value:function e(t){var i=this.isReadOnly?"ui-ctl-no-border catalog-document-product-list-access-denied-readonly":"ui-ctl-disabled catalog-document-product-list-access-denied";var r=u.Tag.render(m||(m=babelHelpers.taggedTemplateLiteral(['\n\t\t<div\n\t\t\tclass="ui-ctl ui-ctl-w100 ui-ctl-before-icon ui-ctl-after-icon ','"\n\t\t\tdata-hint="','"\n\t\t\tdata-hint-no-icon\n\t\t>\n\t\t\t<div class="ui-ctl-before catalog-document-product-list-access-denied-lock"></div>\n\t\t\t<div class="ui-ctl-after catalog-document-product-list-access-denied-hint"></div>\n\t\t\t<div class="ui-ctl-element">',"</div>\n\t\t</div>\n\t\t"])),i,this.hint,this.text);t.innerHTML="";t.appendChild(r);BX.UI.Hint.createInstance({popupParameters:{angle:{offset:100}}}).init()}}]);return e}();var C,T,I;function A(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=R(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var r=0;var n=function e(){};return{s:n,n:function t(){if(r>=e.length)return{done:true};return{done:false,value:e[r++]}},e:function e(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a=true,o=false,s;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();a=t.done;return t},e:function e(t){o=true;s=t},f:function e(){try{if(!a&&i["return"]!=null)i["return"]()}finally{if(o)throw s}}}}function R(e,t){if(!e)return;if(typeof e==="string")return _(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return _(e,t)}function _(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function F(e,t){k(e,t);t.add(e)}function k(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function O(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var N="EDIT";var w="SET";var D=new WeakSet;var H=new WeakSet;var M=new WeakSet;var B=new WeakSet;var U=new WeakSet;var L=new WeakSet;var G=new WeakSet;var x=new WeakSet;var V=new WeakSet;var W=new WeakSet;var X=new WeakSet;var q=new WeakSet;var j=new WeakSet;var Y=new WeakSet;var K=new WeakSet;var Q=new WeakSet;var z=new WeakSet;var $=new WeakSet;var Z=new WeakSet;var J=new WeakSet;var ee=new WeakSet;var te=new WeakSet;var ie=new WeakSet;var re=new WeakSet;var ne=function(){function e(t,i,r,n){babelHelpers.classCallCheck(this,e);F(this,re);F(this,ie);F(this,te);F(this,ee);F(this,J);F(this,Z);F(this,$);F(this,z);F(this,Q);F(this,K);F(this,Y);F(this,j);F(this,q);F(this,X);F(this,W);F(this,V);F(this,x);F(this,G);F(this,L);F(this,U);F(this,B);F(this,M);F(this,H);F(this,D);babelHelpers.defineProperty(this,"fields",{});babelHelpers.defineProperty(this,"storeSelectors",[]);babelHelpers.defineProperty(this,"externalActions",[]);babelHelpers.defineProperty(this,"cache",new u.Cache.MemoryCache);babelHelpers.defineProperty(this,"modeChanges",{EDIT:N,SET:w});babelHelpers.defineProperty(this,"validatingFields",new Map);this.setId(t);this.setSettings(r);this.setEditor(n);this.setModel(i,r);this.initFields(i);O(this,H,oe).call(this);O(this,B,le).call(this);O(this,M,se).call(this);O(this,L,ue).call(this,this.getSettingValue("storeHeaderMap",{}));O(this,D,ae).call(this);O(this,te,Ie).call(this);requestAnimationFrame(this.initHandlers.bind(this))}babelHelpers.createClass(e,[{key:"getNode",value:function e(){var t=this;return this.cache.remember("node",(function(){var e=t.getField("ID",0);return t.getEditorContainer().querySelector('[data-id="'.concat(e,'"]'))}))}},{key:"getSelector",value:function e(){return this.mainSelector}},{key:"getBarcodeSelector",value:function e(){return this.barcodeSelector}},{key:"getId",value:function e(){return this.id}},{key:"setId",value:function e(t){this.id=t}},{key:"getSettings",value:function e(){return this.settings}},{key:"setSettings",value:function e(t){this.settings=u.Type.isPlainObject(t)?t:{}}},{key:"getSettingValue",value:function e(t,i){return this.settings.hasOwnProperty(t)?this.settings[t]:i}},{key:"setSettingValue",value:function e(t,i){this.settings[t]=i}},{key:"setEditor",value:function e(t){this.editor=t}},{key:"getEditor",value:function e(){return this.editor}},{key:"getEditorContainer",value:function e(){return this.getEditor().getContainer()}},{key:"getHintPopup",value:function e(){return this.getEditor().getHintPopup()}},{key:"initHandlers",value:function e(){var t=this.getEditor();this.getNode().querySelectorAll("input").forEach((function(e){u.Event.bind(e,"input",t.changeProductFieldHandler);u.Event.bind(e,"change",t.changeProductFieldHandler);u.Event.bind(e,"mousedown",(function(e){return e.stopPropagation()}));u.Event.bind(e,"blur",t.blurProductFieldHandler)}));this.getNode().querySelectorAll("select").forEach((function(e){u.Event.bind(e,"change",t.changeProductFieldHandler);u.Event.bind(e,"mousedown",(function(e){return e.stopPropagation()}))}))}},{key:"initHandlersForSelectors",value:function e(){var t=this;var i=this.getEditor();var r=["MAIN_INFO","BARCODE_INFO"];var n=this.getSettingValue("storeHeaderMap",{});r=[].concat(babelHelpers.toConsumableArray(r),babelHelpers.toConsumableArray(Object.keys(n)));r.forEach((function(e){t.getNode().querySelectorAll('[data-name="'.concat(e,'"] input[type="text"]')).forEach((function(e){u.Event.bind(e,"input",i.changeProductFieldHandler);u.Event.bind(e,"change",i.changeProductFieldHandler);u.Event.bind(e,"mousedown",(function(e){return e.stopPropagation()}))}))}))}},{key:"layoutBarcode",value:function e(){var t=this.getNode().querySelector('[data-name="BARCODE_INFO"]');if(this.barcodeSelector&&t){t.innerHTML="";if(O(this,J,Ce).call(this)){this.barcodeSelector.renderTo(t)}}}},{key:"layoutStoreSelector",value:function e(t){var i=this;Object.keys(t).forEach((function(e){var t="".concat(i.getId(),"_").concat(e);i.storeSelectors.forEach((function(r){if(r.getId()===t){var n=i.getNode().querySelector('[data-name="'.concat(e,'"]'));if(n){n.innerHTML="";if(O(i,Z,Pe).call(i)){r.renderTo(n)}}}}))}))}},{key:"setRowNumber",value:function e(t){this.getNode().querySelectorAll(".main-grid-row-number").forEach((function(e){e.textContent="".concat(t,".")}))}},{key:"getFields",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var i;if(u.Type.isArrayFilled(t)){i={};var r=A(t),n;try{for(r.s();!(n=r.n()).done;){var a=n.value;i[a]=this.getField(a)}}catch(e){r.e(e)}finally{r.f()}}else{i=u.Runtime.clone(this.fields)}var o=O(this,x,ce).call(this);for(var s in o){if(Object.hasOwnProperty.call(o,s)&&Object.hasOwnProperty.call(i,s)){i[s]=o[s]}}return i}},{key:"initFields",value:function e(t){this.getModel().initFields(t,false);this.setFields(t)}},{key:"setFields",value:function e(t){for(var i in t){if(t.hasOwnProperty(i)){this.setField(i,t[i])}}}},{key:"getField",value:function e(t,i){if(t!=="REAL_VALUES"){var r=O(this,x,ce).call(this);if(r&&Object.hasOwnProperty.call(r,t)){return r[t]}}return this.fields.hasOwnProperty(t)?this.fields[t]:i}},{key:"setField",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;this.fields[t]=i;if(r){this.getModel().setField(t,i)}}},{key:"getUiFieldId",value:function e(t){return"".concat(this.getId(),"_").concat(t)}},{key:"getBasePrice",value:function e(){return this.getField("BASE_PRICE",0)}},{key:"getAmount",value:function e(){return this.getField("AMOUNT",1)}},{key:"updateFieldByEvent",value:function e(t,i){var r=i.target;var n=r.type==="checkbox"?r.checked:r.value;var a=i.type==="input"||i.type==="change"?N:w;this.updateField(t,n,a)}},{key:"updateDropdownField",value:function e(t,i){this.updateField(t,i,N)}},{key:"updateField",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:w;this.resetExternalActions();this.updateFieldValue(t,i,r);this.executeExternalActions()}},{key:"updateFieldValue",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:w;switch(t){case"SKU_ID":this.changeProductId(i);break;case"BASE_PRICE":this.changeBasePrice(i,r);break;case"PURCHASING_PRICE":this.changePurchasingPrice(i,r);break;case"AMOUNT":this.changeAmount(i,r);break;case"MEASURE_CODE":this.changeMeasureCode(i,r);break;case"BARCODE":this.changeBarcode(i,r);break;case"STORE_FROM":case"STORE_TO":this.changeStore(i,t);break;case"STORE_FROM_TITLE":case"STORE_TO_TITLE":this.changeStoreName(i,t);break;case"NAME":case"MAIN_INFO":this.changeProductName(i,r);break;case"SORT":this.changeSort(i,r);break;case"COMMENT":this.changeComment(i,r);break}}},{key:"updateFieldByName",value:function e(t,i){switch(t){case"TAX_INCLUDED":this.setTaxIncluded(i);break}}},{key:"changeProductId",value:function e(t){var i=this.parseInt(t);this.setProductId(i)}},{key:"handleCopyAction",value:function e(t,i){var r;(r=this.getEditor())===null||r===void 0?void 0:r.copyRow(this);var n=i.getMenuWindow();if(n){n.destroy()}}},{key:"handleDeleteAction",value:function e(t,i){var r;(r=this.getEditor())===null||r===void 0?void 0:r.deleteRow(this);var n=i.getMenuWindow();if(n){n.destroy()}this.unsubscribeEvents();O(this,W,ve).call(this)}},{key:"unsubscribeEvents",value:function e(){this.getBarcodeSelector().unsubscribeEvents()}},{key:"handleSelectExtraPriceType",value:function e(t,i){this.changeExtraType(i.type,N);var r=i.getMenuWindow();if(r){r.destroy()}}},{key:"changeExtraType",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:w;var r="%";if(t===S.EXTRA_TYPE_MONETARY){r=this.getEditor().getCurrencyText()}else{t=S.EXTRA_TYPE_PERCENTAGE}if(t===this.getField("BASE_PRICE_EXTRA_RATE")){return}if(i===N){var n=O(this,V,he).call(this).calculateExtraType(t);this.changeExtra(n.getExtra());this.changeBasePrice(n.getFinalPrice())}var a=this.getNode().querySelector('[data-name="BASE_PRICE_EXTRA_RATE"]');if(u.Type.isDomNode(a)){a.innerHTML=r}this.setField("BASE_PRICE_EXTRA_RATE",t)}},{key:"changeExtra",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:w;var r=u.Type.isNil(t)||t===""?null:this.parseFloat(t,this.getPricePrecision());this.setField("BASE_PRICE_EXTRA",r);if(r===null){return}if(i===N){var n=O(this,V,he).call(this).calculateExtra(r);this.changeBasePrice(n.getFinalPrice())}else{var a=this.getNode().querySelector('[data-name="BASE_PRICE_EXTRA"]');if(u.Type.isDomNode(a)){a.value=r}}}},{key:"changeBasePrice",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:w;var r=this.parseFloat(t,this.getPricePrecision());this.setBasePrice(r,i)}},{key:"changePurchasingPrice",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:w;if(O(this,ie,Ae).call(this)){return}var r=this.parseFloat(t,this.getPricePrecision());this.setPurchasingPrice(r,i)}},{key:"changeAmount",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:w;var r=this.parseFloat(t,this.getQuantityPrecision());this.setAmount(r,i)}},{key:"changeMeasureCode",value:function e(t){var i=this;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:w;this.getEditor().getMeasures().filter((function(e){return e.CODE===t})).forEach((function(e){return i.setMeasure(e,r)}))}},{key:"changeBarcode",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:w;var r=t.toString();var n=this.getField("BARCODE")!==r;if(n&&i===w){this.setField("BARCODE",r);this.setField("DOC_BARCODE",r);this.addActionProductChange()}else if(i===N){this.setField("DOC_BARCODE",r);this.addActionProductChange()}}},{key:"changeStore",value:function e(t,i){var r=u.Text.toNumber(t);var n=this.getField(i)!==r;if(n){this.setField(i,r);this.setStoreAmount(t,i);this.layoutStoreSelector(this.getSettingValue("storeHeaderMap",{}));this.addActionProductChange();if(this.getEditor().getSettingValue("isCalculableStorePurchasingPrice")){this.debouncedPurchasingPriceCalculation()}}}},{key:"changeStoreName",value:function e(t,i){var r=t.toString();this.setField(i,r);this.addActionProductChange()}},{key:"changeProductName",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:w;var r=t.toString();var n=this.getField("NAME")!==r;if(n&&i===w){this.setField("NAME",r);this.addActionProductChange()}}},{key:"changeSort",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:w;var r=this.parseInt(t);if(i===w){this.setField("SORT",r)}var n=this.getField("SORT")!==r;if(n){this.addActionProductChange()}}},{key:"changeComment",value:function e(t){var i=u.Type.isNil(t)?"":t.toString().trim();if(i!==this.getField("COMMENT")){this.setField("COMMENT",i);this.addActionProductChange()}}},{key:"refreshFieldsLayout",value:function e(){var t,i,r;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];for(var a in this.fields){if(this.fields.hasOwnProperty(a)&&!n.includes(a)){this.updateUiField(a,this.fields[a])}}this.updateUiMeasure(this.getField("MEASURE_CODE"),this.getField("MEASURE_NAME"));(t=this.getSelector())===null||t===void 0?void 0:t.reloadFileInput();(i=this.getSelector())===null||i===void 0?void 0:i.layout();(r=this.getBarcodeSelector())===null||r===void 0?void 0:r.layout();this.updateUiStoreValues()}},{key:"setModel",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i="catalog_document_grid_".concat(this.getId());if(i){var n=l.ProductModel.getById(i);if(n){this.model=n}}if(!(this.model instanceof l.ProductModel)){this.model=new l.ProductModel({id:i,currency:this.getEditor().getCurrencyId(),iblockId:t.IBLOCK_ID,basePriceId:t.BASE_PRICE_ID,skuTree:u.Type.isStringFilled(t.SKU_TREE)?JSON.parse(t.SKU_TREE):null,storeMap:t.STORE_AMOUNT_MAP,fields:t});if(u.Type.isObject(t.IMAGE_INFO)){this.model.getImageCollection().setPreview(t.IMAGE_INFO.preview);this.model.getImageCollection().setEditInput(t.IMAGE_INFO.input);this.model.getImageCollection().setMorePhotoValues(t.IMAGE_INFO.values)}if(!u.Type.isNil(t.DETAIL_URL)){this.model.setDetailPath(t.DETAIL_URL)}}r.EventEmitter.subscribe(this.model,"onErrorsChange",u.Runtime.debounce(O(this,W,ve),500,this));r.EventEmitter.subscribe(this.model,"onChangeStoreData",this.updateUiStoreValues.bind(this))}},{key:"getModel",value:function e(){return this.model}},{key:"setProductId",value:function e(t){var i=this.getField("PRODUCT_ID")!==t;if(i){this.setField("PRODUCT_ID",t);this.setField("SKU_ID",t);this.updateUiStoreValues();this.addActionProductChange();this.addActionUpdateTotal();O(this,re,Re).call(this)}}},{key:"setBasePrice",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:w;t=Math.max(t,0);if(i===w){this.updateUiField("BASE_PRICE",t.toFixed(this.getPricePrecision()))}this.setField("BASE_PRICE",t);this.addActionProductChange();this.addActionUpdateTotal();this.updateRowTotalPrice()}},{key:"updateRowTotalPrice",value:function e(){var t=this.getEditor().getSettingValue("totalCalculationSumField","PURCHASING_PRICE");var i=this.getAmount()*this.getField(t,0);i=Math.max(i,0);this.setField("TOTAL_PRICE",i);this.updateUiField("TOTAL_PRICE",i.toFixed(this.getPricePrecision()))}},{key:"updateProductStoreValues",value:function e(){var t=this;this.storeSelectors.forEach((function(e){e.setProductId(t.getModel().getSkuId())}))}},{key:"updateUiStoreValues",value:function e(){var t=this;var i=this.getSettingValue("storeHeaderMap",{});Object.keys(i).forEach((function(e){var r=i[e];var n=t.getField(r);if(r==="STORE_FROM"){var a=t.model.getStoreCollection().getStoreAmount(n);if(a<=0){var s=t.model.getStoreCollection().getMaxFilledStore();var l=o.StoreSelector.getById("".concat(t.getId(),"_").concat(e));if(s.AMOUNT>a&&l){l.onStoreSelect(s.STORE_ID,s.STORE_TITLE);n=s.STORE_ID}}}t.setStoreAmount(n,r)}));this.layoutStoreSelector(this.getSettingValue("storeHeaderMap",{}))}},{key:"setStoreAmount",value:function e(t,i){var r=this;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:w;if(!this.model.getStoreCollection().isInited()){return}if(n===w){var a;var o={_AMOUNT:function e(){return r.model.getStoreCollection().getStoreAmount(t)},_RESERVED:function e(){return r.model.getStoreCollection().getStoreReserved(t)},_AVAILABLE_AMOUNT:function e(){return r.model.getStoreCollection().getStoreAvailableAmount(t)}};for(var s in o){if(Object.hasOwnProperty.call(o,s)){var l=O(this,$,me).call(this,i+s);if(l){l.innerHTML="";if(O(this,Z,Pe).call(this)){a=o[s]()||0;var d="".concat(a," ").concat(u.Text.encode(this.getField("MEASURE_NAME")));var c=d;if(s==="_AVAILABLE_AMOUNT"){c=a>0?d:'<span class="text--danger">'.concat(d,"</span>")}l.innerHTML=c}}}}}}},{key:"setPurchasingPrice",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:w;if(O(this,ie,Ae).call(this)){return}t=Math.max(t,0);if(i===w){this.updateUiField("PURCHASING_PRICE",t.toFixed(this.getPricePrecision()))}this.setField("PURCHASING_PRICE",t);this.addActionProductChange();this.addActionUpdateTotal();this.updateRowTotalPrice()}},{key:"setAmount",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:w;if(i===w){this.updateUiInputField("AMOUNT",t)}var r=this.getField("AMOUNT")!==t;if(r){this.setField("AMOUNT",t);this.addActionProductChange();this.addActionUpdateTotal();this.updateRowTotalPrice();if(this.getEditor().getSettingValue("isCalculableStorePurchasingPrice")){this.debouncedPurchasingPriceCalculation()}}}},{key:"calculateStoreCostPrice",value:function e(){var t=this;if(this.isEmptyRow()){return}u.ajax.runComponentAction(this.editor.getComponentName(),"calculateStoreCostPrice",{mode:"class",signedParameters:this.editor.getSignedParameters(),data:{productId:this.getField("SKU_ID"),quantity:this.getField("AMOUNT"),storeId:this.getField("STORE_FROM"),currency:this.editor.getCurrencyId()}}).then((function(e){t.setPurchasingPrice(e.data)}))}},{key:"setMeasure",value:function e(t){var i=this;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:w;if(this.model.isEmpty()){this.setField("MEASURE_CODE",t.CODE);this.setField("MEASURE_NAME",t.SYMBOL);this.updateUiMeasure(t.CODE,t.SYMBOL);return}if(r===N){this.getModel().showSaveNotifier("measureChanger_".concat(this.getId()),{title:u.Loc.getMessage("CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_MEASURE_CHANGED_QUERY"),declineCancelTitle:u.Loc.getMessage("CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_DECLINE_SAVE"),events:{onSave:function e(){i.setField("MEASURE_CODE",t.CODE);i.setField("MEASURE_NAME",t.SYMBOL);i.updateUiMeasure(i.getField("MEASURE_CODE"),i.getField("MEASURE_NAME"));i.getModel().save(["MEASURE_CODE","MEASURE_NAME"])},onCancel:function e(){i.updateUiMeasure(i.getField("MEASURE_CODE"),i.getField("MEASURE_NAME"))}}})}else{this.updateUiMeasure(t.CODE,t.SYMBOL)}this.addActionProductChange()}},{key:"getInputByFieldName",value:function e(t){var i=this.getUiFieldId(t);var r=document.getElementById(i);if(!u.Type.isElementNode(r)){r=this.getNode().querySelector('[name="'.concat(i,'"]'))}return r}},{key:"getInputWrapperByFieldName",value:function e(t){var i=this.getInputByFieldName(t);if(u.Type.isElementNode(i)){return u.Type.isElementNode(i.parentNode)?i.parentNode:i}return undefined}},{key:"updateUiInputField",value:function e(t,i){var r=this.getInputByFieldName(t);if(u.Type.isElementNode(r)){r.value=i}}},{key:"updateUiCheckboxField",value:function e(t,i){var r=this.getInputByFieldName(t);if(u.Type.isElementNode(r)){r.checked=i==="Y"}}},{key:"getMoneyFieldDropdownApi",value:function e(t){if(!u.Reflection.getClass("BX.Main.dropdownManager")){return null}return BX.Main.dropdownManager.getById("".concat(this.getId(),"_").concat(t,"_control"))}},{key:"updateMoneyFieldUiWithDropdownApi",value:function e(t,i){if(t.getValue()===i){return}if(t.menu){t.menu.destroy()}var r=t.menu.itemsContainer.querySelector('[data-value="'.concat(i,'"]'));var n=r&&t.getMenuItem(r);if(n){t.refresh(n);t.selectItem(n)}}},{key:"updateUiMoneyField",value:function e(t,i,r){var n=this.getInputByFieldName(t);if(!u.Type.isElementNode(n)){return}n.dataset.value=i;var a=n.querySelector("span.main-dropdown-inner");if(!u.Type.isElementNode(a)){return}a.innerHTML=r}},{key:"updateUiMeasure",value:function e(t,i){this.updateUiMoneyField("MEASURE_CODE",t,u.Text.encode(i));this.updateUiStoreValues()}},{key:"updateUiHtmlField",value:function e(t,i){var r=this.getNode().querySelector('[data-name="'.concat(t,'"]'));if(u.Type.isElementNode(r)){r.innerHTML=i}}},{key:"updateUiCurrencyFields",value:function e(){var t=this;var i=this.getEditor().getCurrencyText();var r="".concat(this.getEditor().getCurrencyId());var n=["BASE_PRICE_CURRENCY","PURCHASING_PRICE_CURRENCY"];n.forEach((function(e){var n=[];n.push({NAME:i,VALUE:r});u.Dom.attr(t.getInputByFieldName(e),"data-items",n);t.updateUiMoneyField(e,r,i)}))}},{key:"updateUiField",value:function e(t,i){var r=this.getUiFieldName(t);if(!r){return}var a=this.getUiFieldType(t);if(!a){return}switch(a){case"input":this.updateUiInputField(r,i);break;case"money":i=BX.util.number_format(i,this.getPricePrecision(),".","");this.updateUiInputField(r,i);break;case"money_html":i=n.CurrencyCore.currencyFormat(i,this.getEditor().getCurrencyId(),true);this.updateUiHtmlField(r,i);break}}},{key:"getUiFieldName",value:function e(t){var i=null;switch(t){case"AMOUNT":case"MEASURE_CODE":case"BASE_PRICE":case"PURCHASING_PRICE":case"TOTAL_PRICE":i=t;break}return i}},{key:"getUiFieldType",value:function e(t){var i=["BASE_PRICE","PURCHASING_PRICE","TOTAL_PRICE"];if(i.includes(t)){var r,n;var a=(r=this.getEditor())===null||r===void 0?void 0:r.getColumnInfo(t);if((a===null||a===void 0?void 0:(n=a.editable)===null||n===void 0?void 0:n.TYPE)==="MONEY"){return"money"}return"money_html"}if(t==="AMOUNT"){return"input"}return null}},{key:"parseInt",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return this.getEditor().parseInt(t,i)}},{key:"parseFloat",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;return this.getEditor().parseFloat(t,i,r)}},{key:"getPricePrecision",value:function e(){return this.getEditor().getPricePrecision()}},{key:"getQuantityPrecision",value:function e(){return this.getEditor().getQuantityPrecision()}},{key:"getCommonPrecision",value:function e(){return this.getEditor().getCommonPrecision()}},{key:"resetExternalActions",value:function e(){this.externalActions.length=0}},{key:"addExternalAction",value:function e(t){this.externalActions.push(t)}},{key:"addActionProductChange",value:function e(){this.addExternalAction({type:this.getEditor().actions.productChange,id:this.getId()})}},{key:"addActionUpdateTotal",value:function e(){this.addExternalAction({type:this.getEditor().actions.updateTotal})}},{key:"executeExternalActions",value:function e(){if(this.externalActions.length===0){return}this.getEditor().executeActions(this.externalActions);this.resetExternalActions()}},{key:"isEmptyRow",value:function e(){return!u.Type.isStringFilled(this.getField("NAME","").trim())&&this.model.isEmpty()&&this.getBasePrice()<=0}},{key:"validate",value:function e(){var t=[];if(!O(this,z,Se).call(this,this.getAmount())){O(this,Q,be).call(this,"AMOUNT",O(this,z,Se));t.push(u.Loc.getMessage("CATALOG_DOCUMENT_PRODUCT_LIST_INVALID_AMOUNT_2"))}return t}}]);return e}();function ae(){var e=this;if(this.getEditor().isReadOnly()||this.getField("EDITABLE")===false){return}this.debouncedPurchasingPriceCalculation=u.Runtime.debounce(this.calculateStoreCostPrice,500,this);var t=this.getNode().querySelector(".main-grid-cell-action .main-grid-cell-content");if(u.Type.isDomNode(t)){var r=u.Tag.render(C||(C=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<a\n\t\t\t\t\thref="#"\n\t\t\t\t\tclass="main-grid-row-action-button"\n\t\t\t\t></a>\n\t\t\t'])));u.Event.bind(r,"click",(function(t){var n=[{text:u.Loc.getMessage("CATALOG_DOCUMENT_PRODUCT_LIST_COPY_ACTION"),onclick:e.handleCopyAction.bind(e)},{text:u.Loc.getMessage("CATALOG_DOCUMENT_PRODUCT_LIST_DELETE_ACTION"),onclick:e.handleDeleteAction.bind(e)}];i.PopupMenu.show({id:"".concat(e.getId(),"_actions_popup"),bindElement:r,items:n});t.preventDefault();t.stopPropagation()}));u.Dom.append(r,t)}}function oe(){var e={iblockId:this.model.getIblockId(),basePriceId:this.model.getBasePriceId(),currency:this.model.getCurrency(),model:this.model,config:{ENABLE_SEARCH:true,IS_ALLOWED_CREATION_PRODUCT:this.getSettingValue("isAllowedCreationProduct",true),ENABLE_IMAGE_INPUT:true,ROLLBACK_INPUT_AFTER_CANCEL:true,ENABLE_INPUT_DETAIL_LINK:true,ROW_ID:this.getId(),ENABLE_SKU_SELECTION:true,ENABLE_EMPTY_PRODUCT_ERROR:true,RESTRICTED_PRODUCT_TYPES:this.getEditor().getRestrictedProductTypes(),URL_BUILDER_CONTEXT:this.editor.getSettingValue("productUrlBuilderContext")},mode:a.ProductSelector.MODE_EDIT};this.mainSelector=new a.ProductSelector("catalog_document_grid_".concat(this.getId()),e);var t=this.getNode().querySelector('[data-name="MAIN_INFO"]');if(t){var i=t.querySelector(".main-grid-row-number");if(!u.Type.isDomNode(i)){u.Dom.append(u.Tag.render(T||(T=babelHelpers.taggedTemplateLiteral(['<div class="main-grid-row-number"></div>']))),t)}var n=t.querySelector(".main-grid-row-product-selector");if(!u.Type.isDomNode(n)){n=u.Tag.render(I||(I=babelHelpers.taggedTemplateLiteral(['<div class="main-grid-row-product-selector"></div>'])));u.Dom.append(n,t)}this.mainSelector.renderTo(n)}r.EventEmitter.subscribe(this.mainSelector,"onBeforeCreate",O(this,X,ge).bind(this))}function se(){var e=["COMMENT"];for(var t=0,i=e;t<i.length;t++){var r=i[t];var n=this.getNode().querySelector('[name="'.concat(r,'"]'));if(n){var a=this.getField(r);n.value=u.Type.isNil(a)?"":a}}}function le(){var e={iblockId:this.model.getIblockId(),basePriceId:this.model.getBasePriceId(),currency:this.model.getCurrency(),model:this.model,inputFieldName:"BARCODE",type:a.ProductSelector.INPUT_FIELD_BARCODE,config:{ENABLE_SEARCH:true,IS_ALLOWED_CREATION_PRODUCT:this.getSettingValue("isAllowedCreationProduct",true),ENABLE_INFO_SPOTLIGHT:this.editor.getSettingValue("showBarcodeSpotlightInfo",true),ENABLE_BARCODE_QR_AUTH:this.editor.getSettingValue("showBarcodeQrAuth",true),IS_INSTALLED_MOBILE_APP:this.editor.getSettingValue("isInstalledMobileApp",null),ENABLE_IMAGE_INPUT:false,ROLLBACK_INPUT_AFTER_CANCEL:true,ENABLE_INPUT_DETAIL_LINK:false,ROW_ID:this.getId(),ENABLE_SKU_SELECTION:false,ENABLE_SKU_TREE:false,ENABLE_EMPTY_PRODUCT_ERROR:false,RESTRICTED_PRODUCT_TYPES:this.getEditor().getRestrictedProductTypes()},mode:a.ProductSelector.MODE_EDIT,scannerToken:this.getEditor().scannerToken};this.barcodeSelector=new a.ProductSelector("catalog_document_grid_".concat(this.getId(),"_barcode"),e);r.EventEmitter.subscribe(this.barcodeSelector,"onBeforeCreate",O(this,X,ge).bind(this));r.EventEmitter.subscribe(this.barcodeSelector,"onSpotlightClose",O(this,q,fe).bind(this));r.EventEmitter.subscribe(this.barcodeSelector,"onBarcodeQrClose",O(this,j,pe).bind(this));r.EventEmitter.subscribe(this.barcodeSelector,"onBarcodeScannerInstallChecked",O(this,Y,Ee).bind(this));r.EventEmitter.subscribe(this.barcodeSelector,"onBarcodeChange",O(this,K,ye).bind(this));this.layoutBarcode()}function ue(e){var t=this;Object.keys(e).forEach((function(i){var n={inputFieldId:e[i],inputFieldTitle:"".concat(e[i],"_TITLE"),isDisabledEmpty:true,config:{ENABLE_SEARCH:true,ENABLE_INPUT_DETAIL_LINK:false,ROW_ID:t.getId()},mode:o.StoreSelector.MODE_EDIT,model:t.model};var a=new o.StoreSelector("".concat(t.getId(),"_").concat(i),n);r.EventEmitter.subscribe(a,"onChange",u.Runtime.debounce(O(t,G,de).bind(t),500,t));r.EventEmitter.subscribe(a,"onClear",u.Runtime.debounce(O(t,G,de).bind(t),500,t));t.storeSelectors.push(a)}));this.layoutStoreSelector(e)}function de(e){var t=this;var i=e.getData();i.fields.forEach((function(e){t.updateField(e.NAME,e.VALUE)}))}function ce(){if(this.realValues){return this.realValues}try{var e=this.getField("REAL_VALUES");if(e){var t=JSON.parse(atob(e));if(u.Type.isPlainObject(t)){this.realValues=t}}}catch(e){console.error("Cannot parse REAL_VALUE: ".concat(e.getMessage()))}return this.realValues}function he(){var e=u.Type.isNumber(this.getModel().getField("BASE_PRICE_EXTRA"))?this.getModel().getField("BASE_PRICE_EXTRA"):null;return new S({basePrice:u.Text.toNumber(this.getModel().getField("PURCHASING_PRICE")),finalPrice:u.Text.toNumber(this.getModel().getField("BASE_PRICE")),extra:e,extraType:u.Text.toNumber(this.getModel().getField("BASE_PRICE_EXTRA_RATE"))})}function ve(){var e=this.getModel().getErrorCollection().getErrors();for(var t in e){if(t===a.ProductSelector.ErrorCodes.NOT_SELECTED_PRODUCT||t===o.StoreSelector.ErrorCodes.NOT_SELECTED_STORE){this.getSelector().layoutErrors()}}this.getEditor().handleProductErrorsChange()}function ge(e){var t=e.getData(),i=t.model;i.setField("BARCODE",this.barcodeSelector.getNameInputFilledValue());i.setField("NAME",this.mainSelector.getNameInputFilledValue())}function fe(e){this.editor.closeBarcodeSpotlights()}function pe(e){this.editor.closeBarcodeQrAuths()}function Ee(e){this.editor.enableSendBarcodeMobilePush()}function ye(e){var t=e.getData(),i=t.value;this.changeBarcode(i,N)}function be(e,t){var i=this;var r=this.getInputByFieldName(e);var n=this.getInputWrapperByFieldName(e);if(t(r.valueAsNumber)||this.validatingFields.get(e)){return}this.validatingFields.set(e,true);n.classList.add("main-grid-editor-cell-danger");var a=function a(o){if(t(o.target.valueAsNumber)){i.validatingFields.set(e,false);u.Event.unbind(r,"blur",a);n.classList.remove("main-grid-editor-cell-danger")}};u.Event.bind(r,"blur",a)}function Se(e){return e>0}function me(e){return this.getNode().querySelector('[data-name="'.concat(e,'"]'))}function Pe(){return!this.getModel().isService()}function Ce(){return!this.getModel().isService()}function Te(){return this.getField("ACCESS_DENIED")===true}function Ie(){var e=this;if(!O(this,ee,Te).call(this)){O(this,re,Re).call(this);return}var t=this.getEditor().getSettingValue("hiddenFields");var i=this.getEditor().getGridColumnIndexes();t.forEach((function(t){var r=i[t];if(r===undefined){return}var n=e.getNode().querySelector(".main-grid-cell:nth-child(".concat(r+1,") .main-grid-cell-content"));if(u.Type.isElementNode(n)){n.innerHTML=""}}));var r=i.AMOUNT;if(r){var n=this.getNode().querySelector(".main-grid-cell:nth-child(".concat(r+1,") .main-grid-cell-content"));if(n){var a=new P({hint:u.Loc.getMessage("CATALOG_DOCUMENT_PRODUCT_LIST_ACCESS_DENIED_STORE_HINT"),isReadOnly:this.getEditor().isReadOnly()});a.renderTo(n)}}}function Ae(){return this.getField("ACCESS_DENIED_TO_PURCHASING_PRICE")===true}function Re(){if(!O(this,ie,Ae).call(this)){return}var e=this.getEditor().getGridColumnIndexes();var t=e.PURCHASING_PRICE;if(t){var i=this.getNode().querySelector(".main-grid-cell:nth-child(".concat(t+1,")"));if(i){var r=i.querySelector(".main-grid-editor-container");if(r){r.remove()}var n=i.querySelector(".main-grid-cell-content");if(n){var a=new P({hint:u.Loc.getMessage("CATALOG_DOCUMENT_PRODUCT_LIST_ACCESS_DENIED_PURCHASING_PRICE_HINT"),isReadOnly:this.getEditor().isReadOnly()});a.renderTo(n);n.style.display="block"}}}}var _e=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"_settings",{});this._settings=t?t:{};this.eventHandlers={}}babelHelpers.createClass(e,[{key:"registerEventHandler",value:function e(t,i){if(!this.eventHandlers[t])this.eventHandlers[t]=[];this.eventHandlers[t].push(i);BX.addCustomEvent(this,t,i)}},{key:"fireEvent",value:function e(t,i){BX.onCustomEvent(this,t,i)}},{key:"unregisterEventHandlers",value:function e(t){if(this.eventHandlers[t]){for(var i=0;i<this.eventHandlers[t].length;i++){BX.removeCustomEvent(this,t,this.eventHandlers[t][i])}delete this.eventHandlers[t]}}}]);return e}();var Fe,ke,Oe,Ne;function we(e,t){He(e,t);t.add(e)}function De(e,t,i){He(e,t);t.set(e,i)}function He(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Me(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Be=new WeakMap;var Ue=new WeakMap;var Le=new WeakMap;var Ge=new WeakMap;var xe=new WeakSet;var Ve=new WeakSet;var We=new WeakSet;var Xe=new WeakSet;var qe=new WeakSet;var je=new WeakSet;var Ye=function(){function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var r=arguments.length>2?arguments[2]:undefined;babelHelpers.classCallCheck(this,e);we(this,je);we(this,qe);we(this,Xe);we(this,We);we(this,Ve);we(this,xe);De(this,Be,{writable:true,value:void 0});De(this,Ue,{writable:true,value:void 0});De(this,Le,{writable:true,value:void 0});De(this,Ge,{writable:true,value:new u.Cache.MemoryCache});babelHelpers.classPrivateFieldSet(this,Be,t);babelHelpers.classPrivateFieldSet(this,Ue,i);babelHelpers.classPrivateFieldSet(this,Le,r)}babelHelpers.createClass(e,[{key:"show",value:function e(){this.getPopup().show()}},{key:"getPopup",value:function e(){var t=this;return babelHelpers.classPrivateFieldGet(this,Ge).remember("settings-popup",(function(){return new i.Popup(babelHelpers.classPrivateFieldGet(t,Le).getId()+"_"+Math.random()*100,babelHelpers.classPrivateFieldGet(t,Be),{autoHide:true,draggable:false,offsetLeft:0,offsetTop:0,angle:{position:"top",offset:43},noAllPaddings:true,bindOptions:{forceBindPosition:true},closeByEsc:true,content:Me(t,Ve,Qe).call(t)})}))}},{key:"updateCheckboxState",value:function e(){var t=this;var i=this.getPopup().getContentContainer();babelHelpers.classPrivateFieldGet(this,Ue).filter((function(e){return e.action==="grid"&&u.Type.isArray(e.columns)})).forEach((function(e){var r=true;e.columns.forEach((function(e){if(!babelHelpers.classPrivateFieldGet(t,Le).getGrid().getColumnHeaderCellByName(e)){r=false}}));var n=i.querySelector('input[data-setting-id="'+e.id+'"]');if(u.Type.isDomNode(n)){n.checked=r}}))}}]);return e}();function Ke(e){return babelHelpers.classPrivateFieldGet(this,Ue).filter((function(t){return t.id===e}))[0]}function Qe(){var e=this;var t=u.Tag.render(Fe||(Fe=babelHelpers.taggedTemplateLiteral(["\n\t\t\t<div class='ui-entity-editor-popup-create-field-list'></div>\n\t\t"])));babelHelpers.classPrivateFieldGet(this,Ue).forEach((function(i){t.append(Me(e,We,ze).call(e,i))}));return t}function ze(e){var t=u.Tag.render(ke||(ke=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<input type="checkbox">\n\t\t'])));t.checked=e.checked;t.dataset.settingId=e.id;var i=u.Type.isStringFilled(e.desc)?u.Tag.render(Oe||(Oe=babelHelpers.taggedTemplateLiteral(['<span class="ui-entity-editor-popup-create-field-item-desc">',"</span>"])),e.desc):"";var r=u.Tag.render(Ne||(Ne=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<label class="ui-ctl-block ui-entity-editor-popup-create-field-item ui-ctl-w100">\n\t\t\t\t<div class="ui-ctl-w10" style="text-align: center">','</div>\n\t\t\t\t<div class="ui-ctl-w75">\n\t\t\t\t\t<span class="ui-entity-editor-popup-create-field-item-title">',"</span>\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</label>\n\t\t"])),t,e.title,i);u.Event.bind(r,"change",Me(this,Xe,$e).bind(this));return r}function $e(e){var t=Me(this,xe,Ke).call(this,e.target.dataset.settingId);if(!t){return}var i=e.target.checked;Me(this,qe,Ze).call(this,t,i)}function Ze(e,t){var i=this;var r=[];var n=babelHelpers.classPrivateFieldGet(this,Le).getGrid().getRows().getHeadFirstChild().getCells();Array.from(n).forEach((function(e){if("name"in e.dataset){r.push(e.dataset.name)}}));u.ajax.runComponentAction(babelHelpers.classPrivateFieldGet(this,Le).getComponentName(),"setGridSetting",{mode:"class",data:{signedParameters:babelHelpers.classPrivateFieldGet(this,Le).getSignedParameters(),settingId:e.id,selected:t,currentHeaders:r}}).then((function(){e.checked=t;if(e.id==="ADD_NEW_ROW_TOP"){var r=t?"top":"bottom";babelHelpers.classPrivateFieldGet(i,Le).setSettingValue("newRowPosition",r);var n=babelHelpers.classPrivateFieldGet(i,Le).changeActivePanelButtons(r);var a=n.querySelector('[data-role="product-list-settings-button"]');i.getPopup().setBindElement(a)}else{babelHelpers.classPrivateFieldGet(i,Le).reloadGrid()}i.getPopup().close();var o=t?u.Loc.getMessage("CATALOG_DOCUMENT_PRODUCT_LIST_SETTING_ENABLED"):u.Loc.getMessage("CATALOG_DOCUMENT_PRODUCT_LIST_SETTING_DISABLED");Me(i,je,Je).call(i,o.replace("#NAME#",e.title),{category:"popup-settings"})}))}function Je(e,t){t=t||{};BX.UI.Notification.Center.notify({content:e,stack:t.stack||null,position:"top-right",width:"auto",category:t.category||null,autoHideDelay:t.autoHideDelay||3e3})}function et(e,t){it(e,t);t.add(e)}function tt(e,t,i){it(e,t);t.set(e,i)}function it(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function rt(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var nt=new WeakMap;var at=new WeakMap;var ot=new WeakSet;var st=new WeakSet;var lt=new WeakSet;var ut=new WeakSet;var dt=new WeakSet;var ct=new WeakSet;var ht=function(){function e(t,i){babelHelpers.classCallCheck(this,e);et(this,ct);et(this,dt);et(this,ut);et(this,lt);et(this,st);et(this,ot);babelHelpers.defineProperty(this,"fieldHintIsBusy",false);babelHelpers.defineProperty(this,"activeHintGuide",null);tt(this,nt,{writable:true,value:void 0});tt(this,at,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,at,t);babelHelpers.classPrivateFieldSet(this,nt,i)}babelHelpers.createClass(e,[{key:"processFieldTour",value:function e(t,i,r){var n=this;var a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];if(this.fieldHintIsBusy){return}this.fieldHintIsBusy=true;i.events={onClose:function e(){r();n.fieldHintIsBusy=false;n.activeHintGuide=null}};if(rt(this,lt,ft).call(this,t)){var o=rt(this,ct,yt).call(this,t,i);rt(this,dt,Et).call(this,(function(){o.close()}))}else{var s=babelHelpers.classPrivateFieldGet(this,nt).call(this).getContainer();var l=s.querySelector(".main-grid-ear-left");var u=s.querySelector(".main-grid-ear-right");var d=t.getClientRects()[0].x;var c=s.getClientRects()[0].x;var h=null;if(d>c){h=rt(this,ut,pt).call(this,u)}else{h=rt(this,ut,pt).call(this,l)}rt(this,ot,vt).call(this,t,(function(){h.close();var e=rt(n,ct,yt).call(n,t,i);rt(n,dt,Et).call(n,(function(){e.close()}))}),[],a)}}},{key:"getActiveHint",value:function e(){if(!this.fieldHintIsBusy){return null}else if(this.activeHintGuide instanceof c.Guide){return this.activeHintGuide}return null}}]);return e}();function vt(e,t){var i,r=this;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];var o=(i=rt(this,st,gt)).call.apply(i,[this,e].concat(babelHelpers.toConsumableArray(a)));var s=function e(i){var a;if((a=rt(r,lt,ft)).call.apply(a,[r].concat(babelHelpers.toConsumableArray(o)))){u.Event.unbind(babelHelpers.classPrivateFieldGet(r,nt).call(r).getScrollContainer(),"scroll",e);u.Event.unbind(window,"resize",e);t.apply(void 0,babelHelpers.toConsumableArray(n))}};u.Event.bind(babelHelpers.classPrivateFieldGet(this,nt).call(this).getScrollContainer(),"scroll",s);u.Event.bind(window,"resize",s)}function gt(e){var t,i;var r=[];for(var n=arguments.length,a=new Array(n>1?n-1:0),o=1;o<n;o++){a[o-1]=arguments[o]}for(var s=0,l=a;s<l.length;s++){var u=l[s];r.push({node:u,nodeRect:u.getClientRects()[0]})}var d={node:e,nodeRect:e.getClientRects()[0]};r.push(d);r.sort((function(e,t){var i=e.nodeRect.x;var r=t.nodeRect.x;if(i<r){return-1}else if(i>r){return 1}else{return 0}}));var c=(t=babelHelpers.classPrivateFieldGet(this,nt).call(this))===null||t===void 0?void 0:(i=t.getContainer().getClientRects())===null||i===void 0?void 0:i[0];function h(e,t){return Math.abs(e-t)<c.width}while(r.length>1&&!h(r[0].nodeRect.x,r[r.length-1].nodeRect.x)){var v=r[0];var g=r[r.length-1];if(v===d){r.pop()}else if(g===d){r.shift()}else{var f=d.nodeRect.x-v.nodeRect.x;var p=g.nodeRect.x-d.nodeRect.x;if(f>=p){r.shift()}else{r.pop()}}}return r.map((function(e){return e.node}))}function ft(){var e,t;var i=(e=babelHelpers.classPrivateFieldGet(this,nt).call(this))===null||e===void 0?void 0:(t=e.getContainer().getClientRects())===null||t===void 0?void 0:t[0];if(i===undefined){return false}var r=i.x;var n=i.x+i.width;for(var a=arguments.length,o=new Array(a),s=0;s<a;s++){o[s]=arguments[s]}for(var l=0,u=o;l<u.length;l++){var d;var c=u[l];var h=(d=c.getClientRects())===null||d===void 0?void 0:d[0];if(h===undefined){return false}var v=h.x;var g=h.x+h.width;if(v<r||g>n){return false}}return true}function pt(e){var t=new BX.SpotLight({id:"arrow_spotlight",targetElement:e,autoSave:true,targetVertex:"middle-center",zIndex:200});t.show();t.container.style.pointerEvents="none";return t}function Et(e){var t=this;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var r=babelHelpers.classPrivateFieldGet(this,nt).call(this).getContainer();var n=r.querySelector(".main-grid-ear-left");var a=r.querySelector(".main-grid-ear-right");r.style.pointerEvents="none";n.style.pointerEvents="none";a.style.pointerEvents="none";var o=function o(s){r.style.pointerEvents="auto";n.style.pointerEvents="auto";a.style.pointerEvents="auto";u.Event.unbind(babelHelpers.classPrivateFieldGet(t,at),"click",o);e.apply(void 0,babelHelpers.toConsumableArray(i))};setTimeout((function(){u.Event.bind(babelHelpers.classPrivateFieldGet(t,at),"click",o)}),500)}function yt(e,t){var i=new c.Guide({steps:[Object.assign({target:e},t)],onEvents:true});this.activeHintGuide=i;i.showNextStep();return i}function bt(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function St(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?bt(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):bt(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function mt(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=Pt(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var r=0;var n=function e(){};return{s:n,n:function t(){if(r>=e.length)return{done:true};return{done:false,value:e[r++]}},e:function e(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a=true,o=false,s;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();a=t.done;return t},e:function e(t){o=true;s=t},f:function e(){try{if(!a&&i["return"]!=null)i["return"]()}finally{if(o)throw s}}}}function Pt(e,t){if(!e)return;if(typeof e==="string")return Ct(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Ct(e,t)}function Ct(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function Tt(e,t){At(e,t);t.add(e)}function It(e,t,i){At(e,t);t.set(e,i)}function At(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Rt(e,t,i){_t(e,t);return i}function _t(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function Ft(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var kt="template_0";var Ot=2;var Nt=function e(t){if(!u.Type.isPlainObject(t)){return false}for(var i in t){return false}return true};var wt=new WeakMap;var Dt=new WeakSet;var Ht=new WeakSet;var Mt=new WeakSet;var Bt=function(){function e(t){babelHelpers.classCallCheck(this,e);Tt(this,Mt);Tt(this,Ht);Tt(this,Dt);babelHelpers.defineProperty(this,"products",[]);babelHelpers.defineProperty(this,"productsWasInitiated",false);babelHelpers.defineProperty(this,"cache",new u.Cache.MemoryCache);It(this,wt,{writable:true,value:void 0});babelHelpers.defineProperty(this,"actions",{productChange:"productChange",productListChanged:"productListChanged",updateListField:"listField",updateTotal:"total"});babelHelpers.defineProperty(this,"updateFieldForList",null);babelHelpers.defineProperty(this,"productRowAddHandler",this.handleProductRowAdd.bind(this));babelHelpers.defineProperty(this,"productRowCreateHandler",this.handleProductRowCreate.bind(this));babelHelpers.defineProperty(this,"showBarcodeSettingsPopupHandler",this.handleShowBarcodeSettingsPopup.bind(this));babelHelpers.defineProperty(this,"showSettingsPopupHandler",this.handleShowSettingsPopup.bind(this));babelHelpers.defineProperty(this,"onSaveHandler",this.handleOnSave.bind(this));babelHelpers.defineProperty(this,"onEditorSubmit",this.handleEditorSubmit.bind(this));babelHelpers.defineProperty(this,"onFocusToProductList",this.handleProductListFocus.bind(this));babelHelpers.defineProperty(this,"onBeforeGridRequestHandler",this.handleOnBeforeGridRequest.bind(this));babelHelpers.defineProperty(this,"onGridUpdatedHandler",this.handleOnGridUpdated.bind(this));babelHelpers.defineProperty(this,"onGridRowMovedHandler",this.handleOnGridRowMoved.bind(this));babelHelpers.defineProperty(this,"onBeforeProductChangeHandler",this.handleOnBeforeProductChange.bind(this));babelHelpers.defineProperty(this,"onProductChangeHandler",this.handleOnProductChange.bind(this));babelHelpers.defineProperty(this,"onProductClearHandler",this.handleOnProductClear.bind(this));babelHelpers.defineProperty(this,"dropdownChangeHandler",this.handleDropdownChange.bind(this));babelHelpers.defineProperty(this,"onScanEmitHandler",this.handleMobileScanEvent.bind(this));babelHelpers.defineProperty(this,"changeProductFieldHandler",this.handleFieldChange.bind(this));babelHelpers.defineProperty(this,"blurProductFieldHandler",this.handleFieldBlur.bind(this));babelHelpers.defineProperty(this,"updateTotalDataDelayedHandler",u.Runtime.debounce(this.updateTotalDataDelayed,100,this));this.setId(t)}babelHelpers.createClass(e,[{key:"init",value:function e(){var t;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.setSettings(i);this.scannerToken=(t=this.scannerToken)!==null&&t!==void 0?t:u.Text.getRandom(16);if(this.canEdit()){this.addFirstRowIfEmpty();this.enableEdit()}this.initForm();this.initProducts();this.initGridData();this.paintColumns();babelHelpers.classPrivateFieldSet(this,wt,new ht(this.getContainer(),this.getGrid.bind(this)));r.EventEmitter.emit("DocumentProductListController",[this]);Ft(this,Dt,Ut).call(this);this.subscribeDomEvents();this.subscribeCustomEvents();this.getContainer().querySelectorAll(".catalog-document-product-list-add-block").forEach((function(e){BX.UI.Hint.init(e)}))}},{key:"subscribeDomEvents",value:function e(){var t=this;var i=this.getContainer();if(u.Type.isElementNode(i)){i.querySelectorAll('[data-role="product-list-add-button"]').forEach((function(e){if(t.getSettingValue("isOnecInventoryManagementRestricted")===true){u.Dom.addClass(e,"ui-btn-icon-lock")}u.Event.bind(e,"click",t.productRowAddHandler)}));if(this.getSettingValue("enabledCreateProductButton",true)){i.querySelectorAll('[data-role="product-list-create-button"]').forEach((function(e){u.Event.bind(e,"click",t.productRowCreateHandler)}))}i.querySelectorAll('[data-role="product-list-settings-button"]').forEach((function(e){u.Event.bind(e,"click",t.showSettingsPopupHandler)}));i.querySelectorAll('[data-role="product-list-barcode-settings-button"]').forEach((function(e){u.Event.bind(e,"click",t.showBarcodeSettingsPopupHandler)}))}}},{key:"unsubscribeDomEvents",value:function e(){var t=this;var i=this.getContainer();if(u.Type.isElementNode(i)){i.querySelectorAll('[data-role="product-list-select-button"]').forEach((function(e){u.Event.unbind(e,"click",t.productSelectionPopupHandler)}));i.querySelectorAll('[data-role="product-list-add-button"]').forEach((function(e){u.Event.unbind(e,"click",t.productRowCreateHandler)}));i.querySelectorAll('[data-role="product-list-barcode-settings-button"]').forEach((function(e){u.Event.unbind(e,"click",t.productRowAddHandler)}));i.querySelectorAll('[data-role="product-list-settings-button"]').forEach((function(e){u.Event.unbind(e,"click",t.showSettingsPopupHandler)}))}}},{key:"subscribeCustomEvents",value:function e(){r.EventEmitter.subscribe("BX.UI.EntityEditor:onSave",this.onSaveHandler);r.EventEmitter.subscribe("BX.UI.EntityEditorAjax:onSubmit",this.onEditorSubmit);r.EventEmitter.subscribe("onFocusToProductList",this.onFocusToProductList);r.EventEmitter.subscribe("Grid::beforeRequest",this.onBeforeGridRequestHandler);r.EventEmitter.subscribe("Grid::updated",this.onGridUpdatedHandler);r.EventEmitter.subscribe("Grid::rowMoved",this.onGridRowMovedHandler);r.EventEmitter.subscribe("BX.Catalog.ProductSelector:onBeforeChange",this.onBeforeProductChangeHandler);r.EventEmitter.subscribe("BX.Catalog.ProductSelector:onChange",this.onProductChangeHandler);r.EventEmitter.subscribe("BX.Catalog.ProductSelector:onClear",this.onProductClearHandler);r.EventEmitter.subscribe("Dropdown::change",this.dropdownChangeHandler);r.EventEmitter.subscribe("BarcodeScanner::onScanEmit",this.onScanEmitHandler)}},{key:"unsubscribeCustomEvents",value:function e(){r.EventEmitter.unsubscribe("BX.UI.EntityEditor:onSave",this.onSaveHandler);r.EventEmitter.unsubscribe("BX.UI.EntityEditorAjax:onSubmit",this.onEditorSubmit);r.EventEmitter.unsubscribe("onFocusToProductList",this.onFocusToProductList);r.EventEmitter.unsubscribe("Grid::beforeRequest",this.onBeforeGridRequestHandler);r.EventEmitter.unsubscribe("Grid::updated",this.onGridUpdatedHandler);r.EventEmitter.unsubscribe("Grid::rowMoved",this.onGridRowMovedHandler);r.EventEmitter.unsubscribe("BX.Catalog.ProductSelector:onBeforeChange",this.onBeforeProductChangeHandler);r.EventEmitter.unsubscribe("BX.Catalog.ProductSelector:onChange",this.onProductChangeHandler);r.EventEmitter.unsubscribe("BX.Catalog.ProductSelector:onClear",this.onProductClearHandler);r.EventEmitter.unsubscribe("Dropdown::change",this.dropdownChangeHandler);r.EventEmitter.unsubscribe("BarcodeScanner::onScanEmit",this.onScanEmitHandler)}},{key:"handleMobileScanEvent",value:function e(t){var i,r;var n=t.getData();if(this.scannerToken!==n.id||!u.Type.isStringFilled(n.barcode)){return}var a=mt(this.products),o;try{for(a.s();!(o=a.n()).done;){var s,l;var d=o.value;if(((s=d.getBarcodeSelector())===null||s===void 0?void 0:(l=s.searchInput)===null||l===void 0?void 0:l.getNameInput())===document.activeElement){var c;(c=d.getBarcodeSelector().searchInput)===null||c===void 0?void 0:c.applyScannerData(n.barcode);return}}}catch(e){a.e(e)}finally{a.f()}var h=mt(this.products),v;try{for(h.s();!(v=h.n()).done;){var g,f,p,E;var y=v.value;if(((g=y.getBarcodeSelector())===null||g===void 0?void 0:(f=g.searchInput)===null||f===void 0?void 0:f.getNameInput().value)===""&&((p=y.getSelector())===null||p===void 0?void 0:(E=p.searchInput)===null||E===void 0?void 0:E.getNameInput().value)===""){var b;(b=y.getBarcodeSelector().searchInput)===null||b===void 0?void 0:b.applyScannerData(n.barcode);return}}}catch(e){h.e(e)}finally{h.f()}var S=this.addProductRow();(i=this.getProductById(S))===null||i===void 0?void 0:(r=i.getBarcodeSelector().searchInput)===null||r===void 0?void 0:r.applyScannerData(n.barcode)}},{key:"selectProductInRow",value:function e(t,i){var r=this;if(!u.Type.isStringFilled(t)||u.Text.toNumber(i)<=0){return}requestAnimationFrame((function(){var e;(e=r.getProductSelector(t))===null||e===void 0?void 0:e.onProductSelect(i)}))}},{key:"handleOnSave",value:function e(t){var i=l.ProductModel.getLastActiveSaveNotification();if(i){i.close()}var r=[];this.products.forEach((function(e){var t={fields:St({},e.fields),rowId:e.fields.ROW_ID};r.push(t)}));this.setSettingValue("items",r)}},{key:"handleEditorSubmit",value:function e(t){}},{key:"handleProductListFocus",value:function e(t){if(this.isReadOnly()){return}var i=false;var r=mt(this.products),n;try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.isEmptyRow()){i=true;this.focusProductSelector(a.fields["ROW_ID"]);break}}}catch(e){r.e(e)}finally{r.f()}if(!i){this.handleProductRowAdd()}}},{key:"onInnerCancel",value:function e(){this.reloadGrid(false)}},{key:"changeActivePanelButtons",value:function e(t){var i=this.getContainer();var r=i.querySelector(".catalog-document-product-list-add-block-"+t);if(u.Type.isDomNode(r)){u.Dom.removeClass(r,"catalog-document-product-list-add-block-hidden");u.Dom.addClass(r,"catalog-document-product-list-add-block-active")}var n=t==="top"?"bottom":"top";var a=i.querySelector(".catalog-document-product-list-add-block-"+n);if(u.Type.isDomNode(a)){u.Dom.addClass(a,"catalog-document-product-list-add-block-hidden");u.Dom.removeClass(a,"catalog-document-product-list-add-block-active")}return r}},{key:"reloadGrid",value:function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(r===null){r=!i}this.getGrid().reloadTable("POST",{useProductsFromRequest:i},(function(){return t.actionUpdateTotalData({isInternalChanging:r})}))}},{key:"handleOnBeforeGridRequest",value:function t(i){var n=this;var a=i.getCompatData(),o=babelHelpers.slicedToArray(a,2),s=o[0],l=o[1];if(!s||!s.parent||s.parent.getId()!==this.getGridId()){return}var u=!("useProductsFromRequest"in l.data);var d=u?true:l.data.useProductsFromRequest;l.url=this.getReloadUrl();l.method="POST";l.sessid=BX.bitrix_sessid();l.data=St(St({},l.data),{},{useProductsFromRequest:d,signedParameters:this.getSignedParameters(),products:d?this.getProductsFields(Rt(e,e,Gt).call(e)):null});var c=false;if(l.data["action_button_"+l.gridId]==="delete"){c=true}this.clearEditor();if(u){r.EventEmitter.subscribeOnce("Grid::updated",(function(e){var t=e.getCompatData(),i=babelHelpers.slicedToArray(t,1),r=i[0];if(!r||r.getId()!==n.getGridId()){return}n.actionUpdateTotalData({isInternalChanging:false});if(c){n.executeActions([{type:n.actions.productListChanged}])}}))}}},{key:"handleOnGridUpdated",value:function e(t){var i=t.getCompatData(),r=babelHelpers.slicedToArray(i,1),n=r[0];if(!n||n.getId()!==this.getGridId()){return}this.getSettingsPopup().updateCheckboxState()}},{key:"handleOnGridRowMoved",value:function e(t){var i=t.getCompatData(),r=babelHelpers.slicedToArray(i,3),n=r[0],a=r[2];if(!a||a.getId()!==this.getGridId()){return}var o=this.resortProductsByIds(n);if(o){this.refreshSortFields();this.numerateRows();this.executeActions([{type:this.actions.productListChanged}])}}},{key:"initPageEventsManager",value:function e(){var t=this.getSettingValue("componentId");this.pageEventsManager=new _e({id:t})}},{key:"getPageEventsManager",value:function e(){if(!this.pageEventsManager){this.initPageEventsManager()}return this.pageEventsManager}},{key:"canEdit",value:function e(){return this.getSettingValue("allowEdit",false)===true}},{key:"enableEdit",value:function e(){var t=this.getGrid().getRows().getRows();t.forEach((function(e){if(!e.isHeadChild()&&!e.isTemplate()&&!Nt(e.getEditData())){e.edit()}}))}},{key:"addFirstRowIfEmpty",value:function e(){var t=this;if(this.getGrid().getRows().getCountDisplayed()===0){requestAnimationFrame((function(){return t.addProductRow()}))}}},{key:"clearEditor",value:function e(){this.unsubscribeProductsEvents();this.products=[];this.productsWasInitiated=false;this.destroySettingsPopup();this.unsubscribeDomEvents();this.unsubscribeCustomEvents();u.Event.unbindAll(this.container)}},{key:"wasProductsInitiated",value:function e(){return this.productsWasInitiated}},{key:"unsubscribeProductsEvents",value:function e(){this.products.forEach((function(e){var t=e.getSelector();if(t){t.unsubscribeEvents()}var i=e.getBarcodeSelector();if(i){i.unsubscribeEvents()}}))}},{key:"destroy",value:function e(){this.setForm(null);this.clearController();this.clearEditor()}},{key:"setController",value:function e(t){if(this.controller===t){return}if(this.controller){this.controller.clearProductList()}this.controller=t}},{key:"clearController",value:function e(){this.controller=null}},{key:"getId",value:function e(){return this.id}},{key:"setId",value:function e(t){this.id=t}},{key:"getSettings",value:function e(){return this.settings}},{key:"setSettings",value:function e(t){this.settings=t?t:{}}},{key:"getSettingValue",value:function e(t,i){return this.settings.hasOwnProperty(t)?this.settings[t]:i}},{key:"setSettingValue",value:function e(t,i){this.settings[t]=i}},{key:"getComponentName",value:function e(){return this.getSettingValue("componentName","")}},{key:"getReloadUrl",value:function e(){return this.getSettingValue("reloadUrl","")}},{key:"getSignedParameters",value:function e(){return this.getSettingValue("signedParameters","")}},{key:"getContainerId",value:function e(){return this.getSettingValue("containerId","")}},{key:"getGridId",value:function e(){return this.getSettingValue("gridId","")}},{key:"getLanguageId",value:function e(){return this.getSettingValue("languageId","")}},{key:"getSiteId",value:function e(){return this.getSettingValue("siteId","")}},{key:"getCatalogId",value:function e(){return this.getSettingValue("catalogId",0)}},{key:"isReadOnly",value:function e(){return this.getSettingValue("readOnly",true)}},{key:"setReadOnly",value:function e(t){this.setSettingValue("readOnly",t)}},{key:"getCurrencyId",value:function e(){return this.getSettingValue("currencyId","")}},{key:"setCurrencyId",value:function e(t){this.setSettingValue("currencyId",t);return n.CurrencyCore.loadCurrencyFormat(t)}},{key:"isSalesOrdersDocument",value:function e(){var t=["REALIZATION","W"];return t.includes(this.settings.documentType)}},{key:"changeCurrencyId",value:function e(t){var i=this;var r=this.getCurrencyId();if(r===t){return}this.setCurrencyId(t).then((function(){var e=[];i.products.forEach((function(i){i.getModel().setOption("currency",t);e.push({fields:i.getFields(),id:i.getId()})}));if(e.length>0){u.ajax.runComponentAction(i.getComponentName(),"calculateProductPrices",{mode:"class",signedParameters:i.getSignedParameters(),data:{products:e,currencyId:t,oldCurrencyId:r}}).then(i.onCalculatePricesResponse.bind(i))}var n=i.getGridEditData();var a=n[kt];a["CURRENCY"]=i.getCurrencyId();var o=["BASE_PRICE","PURCHASING_PRICE"];o.forEach((function(e){if(a[e]&&a[e]["CURRENCY"]){a[e]["CURRENCY"]["VALUE"]=i.getCurrencyId()}}));i.setGridEditData(n)}))}},{key:"onCalculatePricesResponse",value:function e(t){var i=t.data;this.products.forEach((function(e){if(u.Type.isObject(i[e.getId()])){e.updateField("BASE_PRICE",i[e.getId()]["BASE_PRICE"]);e.updateField("PURCHASING_PRICE",i[e.getId()]["PURCHASING_PRICE"]);e.updateUiCurrencyFields()}}));this.updateTotalDataDelayed();this.updateTotalUiCurrency()}},{key:"updateTotalUiCurrency",value:function e(){var t=this;var i=BX(this.getSettingValue("totalBlockContainerId",null));if(u.Type.isElementNode(i)){var r=["totalCost"];i.querySelectorAll(".catalog-document-product-list-result-grid-total").forEach((function(e){for(var i=0,a=r;i<a.length;i++){var o=a[i];var s=e.querySelector('[data-total="'+o+'"]');if(s){e.innerHTML=n.CurrencyCore.getPriceControl(s,t.getCurrencyId())}}}))}}},{key:"getCurrencyText",value:function e(){var t=this.getCurrencyId();if(!u.Type.isStringFilled(t)){return""}var i=n.CurrencyCore.getCurrencyFormat(t);return i&&i.FORMAT_STRING.replace(/(^|[^&])#/,"$1").trim()||""}},{key:"getDataFieldName",value:function e(){return this.getSettingValue("dataFieldName","")}},{key:"getDataSettingsFieldName",value:function e(){var t=this.getDataFieldName();return u.Type.isStringFilled(t)?t+"_SETTINGS":""}},{key:"getPricePrecision",value:function e(){return this.getSettingValue("pricePrecision",Ot)}},{key:"getQuantityPrecision",value:function e(){return this.getSettingValue("quantityPrecision",Ot)}},{key:"getCommonPrecision",value:function e(){return this.getSettingValue("commonPrecision",Ot)}},{key:"getMeasures",value:function e(){return this.getSettingValue("measures",[])}},{key:"getDefaultMeasure",value:function e(){return this.getSettingValue("defaultMeasure",{})}},{key:"getRowIdPrefix",value:function e(){return this.getSettingValue("rowIdPrefix","catalog_entity_product_list_")}},{key:"parseInt",value:function(e){function t(t){return e.apply(this,arguments)}t.toString=function(){return e.toString()};return t}((function(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var i;var r=u.Type.isNumber(e);var n=u.Type.isStringFilled(e);if(!r&&!n){return t}if(n){e=e.replace(/^\s+|\s+$/g,"");var a=e.indexOf("-")===0;i=parseInt(e.replace(/[^\d]/g,""),10);if(isNaN(i)){i=t}else{if(a){i=-i}}}else{i=parseInt(e,10);if(isNaN(i)){i=t}}return i}))},{key:"parseFloat",value:function(e){function t(t){return e.apply(this,arguments)}t.toString=function(){return e.toString()};return t}((function(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Ot;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var r;var n=u.Type.isNumber(e);var a=u.Type.isStringFilled(e);if(!n&&!a){return i}if(a){e=e.replace(/^\s+|\s+$/g,"");var o=e.indexOf(".");var s=e.indexOf(",");var l=e.indexOf("-")===0;if(o<0&&s>=0){var d=e.substr(0,s);var c=e.length-s-1;if(c>0){d+="."+e.substr(s+1,c)}e=d}e=e.replace(/[^\d.]+/g,"");r=parseFloat(e);if(isNaN(r)){r=i}if(l){r=-r}}else{r=parseFloat(e)}if(t>=0){r=this.round(r,t)}return r}))},{key:"round",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Ot;var r=Math.pow(10,i);return Math.round(t*r)/r}},{key:"getContainer",value:function e(){var t=this;return this.cache.remember("container",(function(){return document.getElementById(t.getContainerId())}))}},{key:"initForm",value:function e(){var t=this.getSettingValue("formId","");var i=u.Type.isStringFilled(t)?BX("form_"+t):null;if(u.Type.isElementNode(i)){this.setForm(i)}}},{key:"isExistForm",value:function e(){return u.Type.isElementNode(this.getForm())}},{key:"getForm",value:function e(){return this.form}},{key:"setForm",value:function e(t){this.form=t}},{key:"initFormFields",value:function e(){var t=this.getForm();if(u.Type.isElementNode(t)){var i=this.getDataField();if(!u.Type.isElementNode(i)){this.initDataField()}var r=this.getDataSettingsField();if(!u.Type.isElementNode(r)){this.initDataSettingsField()}}}},{key:"initFormField",value:function e(t){var i=this.getForm();if(u.Type.isElementNode(i)&&u.Type.isStringFilled(t)){i.appendChild(u.Dom.create("input",{attrs:{type:"hidden",name:t}}))}}},{key:"removeFormFields",value:function e(){var t=this.getDataField();if(u.Type.isElementNode(t)){u.Dom.remove(t)}var i=this.getDataSettingsField();if(u.Type.isElementNode(i)){u.Dom.remove(i)}}},{key:"initDataField",value:function e(){this.initFormField(this.getDataFieldName())}},{key:"initDataSettingsField",value:function e(){this.initFormField(this.getDataSettingsFieldName())}},{key:"getFormField",value:function e(t){var i=this.getForm();if(u.Type.isElementNode(i)&&u.Type.isStringFilled(t)){return i.querySelector('input[name="'+t+'"]')}return null}},{key:"getDataField",value:function e(){return this.getFormField(this.getDataFieldName())}},{key:"getDataSettingsField",value:function e(){return this.getFormField(this.getDataSettingsFieldName())}},{key:"getProductCount",value:function e(){return this.products.filter((function(e){return!e.isEmptyRow()})).length}},{key:"initProducts",value:function e(){var t=this.getSettingValue("items",[]);var i=mt(t),r;try{for(i.s();!(r=i.n()).done;){var n=r.value;var a=St({},n.fields);this.products.push(new ne(n.rowId,a,this.getSettingValue("rowSettings",{}),this))}}catch(e){i.e(e)}finally{i.f()}this.numerateRows();this.productsWasInitiated=true;this.updateTotalDataDelayed()}},{key:"numerateRows",value:function e(){this.products.forEach((function(e,t){e.setRowNumber(t+1)}))}},{key:"getGrid",value:function e(){var t=this;return this.cache.remember("grid",(function(){var e=t.getGridId();if(!u.Reflection.getClass("BX.Main.gridManager.getInstanceById")){throw Error("Cannot find grid with '".concat(e,"' id."))}return BX.Main.gridManager.getInstanceById(e)}))}},{key:"getGridColumnIndexes",value:function e(){var t=this;return this.cache.remember("getGridColumnIndexes",(function(){var e={};var i=t.getGrid().getHead().querySelectorAll(".main-grid-cell-head");for(var r=0;r<i.length;r++){var n=i[r];var a=n.dataset.name;if(a){e[a]=r}}return e}))}},{key:"initGridData",value:function e(){var t=this.getSettingValue("templateGridEditData",null);if(t){this.setGridEditData(t)}}},{key:"paintColumns",value:function e(){var t=this.getSettingValue("paintedColumns",null);var i=this.getGrid();if(i&&u.Type.isArray(t)){t.forEach((function(e){var t=i.getRows().getRows();t.forEach((function(t){var i=t.getCellById(e);if(i){u.Dom.addClass(i,"main-grid-cell-light-blue-background")}}))}))}}},{key:"getGridEditData",value:function e(){return this.getGrid().arParams.EDITABLE_DATA}},{key:"getColumnInfo",value:function e(t){var i,r;return((i=this.getGrid())===null||i===void 0?void 0:(r=i.arParams)===null||r===void 0?void 0:r.COLUMNS_ALL[t])||{}}},{key:"setGridEditData",value:function e(t){this.getGrid().arParams.EDITABLE_DATA=t}},{key:"setOriginalTemplateEditData",value:function e(t){this.getGrid().arParams.EDITABLE_DATA[kt]=t}},{key:"handleProductErrorsChange",value:function e(){if(Ft(this,Ht,Lt).call(this)){this.controller.disableSaveButton()}else{this.controller.enableSaveButton()}}},{key:"handleFieldChange",value:function e(t){var i=t.target.closest("tr");if(i&&i.hasAttribute("data-id")){var r=this.getProductById(i.getAttribute("data-id"));if(r){var n=t.target.getAttribute("data-name");if(!u.Type.isStringFilled(n)){var a=t.target.closest("td");n=this.getFieldCodeByGridCell(i,a)}if(n){r.updateFieldByEvent(n,t)}}}}},{key:"handleFieldBlur",value:function e(t){var i=t.target.closest("tr");var r=t.target.value;var n=t.target.getAttribute("data-name");if(!u.Type.isStringFilled(n)){var a=t.target.closest("td");n=this.getFieldCodeByGridCell(i,a)}if(this.isSalesOrdersDocument()&&n==="AMOUNT"&&r<=0){t.target.value=1;this.handleFieldChange(t);BX.UI.Notification.Center.notify({width:"auto",content:u.Loc.getMessage("CATALOG_DOCUMENT_PRODUCT_LIST_INVALID_AMOUNT_REALIZATION")})}}},{key:"handleDropdownChange",value:function e(t){var i=t.getData(),r=babelHelpers.slicedToArray(i,5),n=r[0],a=r[4];var o=new RegExp(this.getRowIdPrefix()+"([A-Za-z0-9]+)_(\\w+)_control","i");var s=n.match(o);if(s){var l=babelHelpers.slicedToArray(s,3),u=l[1],d=l[2];var c=this.getProductById(u);if(c){c.updateDropdownField(d,a)}}}},{key:"getProductById",value:function e(t){var i=this.getRowIdPrefix()+t;return this.getProductByRowId(i)}},{key:"getProductByRowId",value:function e(t){return this.products.find((function(e){return e.getId()===t}))}},{key:"getFieldCodeByGridCell",value:function e(t,i){if(!u.Type.isDomNode(t)||!u.Type.isDomNode(i)){return null}var r=this.getGrid();if(r){var n=r.getRows().getHeadFirstChild();var a=babelHelpers.toConsumableArray(t.cells).indexOf(i);return n.getCellNameByCellIndex(a)}return null}},{key:"addProductRow",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var i=this.createGridProductRow();var r=i.getId();if(t){var n;var a=(n=this.getGrid().getRows().getById(t.getField("ID")))===null||n===void 0?void 0:n.getNode();if(a){a.parentNode.insertBefore(i.getNode(),a.nextSibling)}}this.initializeNewProductRow(r,t);this.getGrid().bindOnRowEvents();return r}},{key:"handleProductRowAdd",value:function e(){if(this.getSettingValue("isOnecInventoryManagementRestricted")===true){t.OneCPlanRestrictionSlider.show();return}var i=this.addProductRow();this.focusProductSelector(i)}},{key:"handleProductRowCreate",value:function e(){}},{key:"handleShowBarcodeSettingsPopup",value:function e(){this.getSettingsPopup().show()}},{key:"handleShowSettingsPopup",value:function e(){this.getSettingsPopup().show()}},{key:"destroySettingsPopup",value:function e(){if(this.cache.has("settings-popup")){this.cache.get("settings-popup").getPopup().destroy();this.cache["delete"]("settings-popup")}}},{key:"getSettingsPopup",value:function e(){var t=this;return this.cache.remember("settings-popup",(function(){return new Ye(t.getContainer().querySelector('.catalog-document-product-list-add-block-active [data-role="product-list-settings-button"]'),t.getSettingValue("popupSettings",[]),t)}))}},{key:"getHintPopup",value:function e(){var t=this;return this.cache.remember("hint-popup",(function(){return new g(t)}))}},{key:"createGridProductRow",value:function e(){var t=u.Text.getRandom();var i=this.redefineTemplateEditData(t);var n=this.getGrid();var a;if(this.getSettingValue("newRowPosition")==="bottom"){a=n.appendRowEditor()}else{a=n.prependRowEditor()}var o=a.getNode();if(u.Type.isDomNode(o)){o.setAttribute("data-id",t);a.makeCountable()}if(i){this.setOriginalTemplateEditData(i)}r.EventEmitter.emit("Grid::thereEditedRows",[]);n.adjustRows();n.updateCounterDisplayed();n.updateCounterSelected();return a}},{key:"handleDeleteRow",value:function e(t,i){i.preventDefault();var r=this.getProductByRowId(t);if(r){this.deleteRow(t)}}},{key:"redefineTemplateEditData",value:function e(t){var i=this.getGridEditData();var r=i[kt];var n=this.prepareCustomEditData(r,t);this.setOriginalTemplateEditData(St(St({},r),n));return r}},{key:"prepareCustomEditData",value:function e(t,i){var r={};var n=this.getSettingValue("templateIdMask","");for(var a in t){if(t.hasOwnProperty(a)){if(u.Type.isStringFilled(t[a])&&t[a].indexOf(n)>=0){r[a]=t[a].replace(new RegExp(n,"g"),i)}else if(u.Type.isPlainObject(t[a])){r[a]=this.prepareCustomEditData(t[a],i)}else{r[a]=t[a]}}}return r}},{key:"initializeNewProductRow",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var r={};if(i!==null){r=Object.assign(r,i===null||i===void 0?void 0:i.getFields())}else{r=St(St({},this.getSettingValue("templateItemFields",{})),{CURRENCY:this.getCurrencyId()})}if(u.Type.isNil(i)&&this.products.length>0){var n=this.getSettingValue("newRowPosition")==="bottom"?this.products[this.products.length-1]:this.products[0];var a=this.getSettingValue("stores",{});var o=n.getSettingValue("storeHeaderMap",{});Object.values(o).forEach((function(e){var t=n.getField(e);if(u.Type.isNil(a[t])){return}r[e]=n.getField(e);var i=e+"_TITLE";r[i]=n.getField(i)}))}var s=this.getRowIdPrefix()+t;r.ID=t;r.ROW_ID=t;if(u.Type.isObject(r.IMAGE_INFO)){delete r.IMAGE_INFO.input}var l=new ne(s,r,this.getSettingValue("rowSettings",{}),this);if(i instanceof ne){this.products.splice(1+this.products.indexOf(i),0,l);l.refreshFieldsLayout()}else if(this.getSettingValue("newRowPosition")==="bottom"){this.products.push(l)}else{this.products.unshift(l)}this.refreshSortFields();this.numerateRows();l.updateUiCurrencyFields();this.updateTotalUiCurrency();return l}},{key:"getProductSelector",value:function e(t){return this.getProductById(t).getSelector()}},{key:"focusProductSelector",value:function e(t){var i=this;requestAnimationFrame((function(){var e;(e=i.getProductSelector(t))===null||e===void 0?void 0:e.searchInDialog().focusName()}))}},{key:"handleOnBeforeProductChange",value:function e(t){var i=t.getData();var r=this.getProductByRowId(i.rowId);if(r){this.getGrid().tableFade();r.resetExternalActions()}}},{key:"handleOnProductChange",value:function e(t){var i=t.getData();var r=this.getProductByRowId(i.rowId);if(r&&i.fields){var n,a;delete i.fields.ID;r.setFields(i.fields);Object.keys(i.fields).forEach((function(e){r.updateFieldValue(e,i.fields[e])}));r.setField("IS_NEW",i.isNew?"Y":"N");(n=r.getSelector())===null||n===void 0?void 0:n.layout();(a=r.getBarcodeSelector())===null||a===void 0?void 0:a.layout();r.updateProductStoreValues();r.initHandlersForSelectors();r.layoutStoreSelector(r.getSettingValue("storeHeaderMap",{}));r.layoutBarcode();r.executeExternalActions();if(this.isSalesOrdersDocument()){r.changeAmount(r.getAmount()>0?r.getAmount():1)}this.getGrid().tableUnfade()}else{this.getGrid().tableUnfade()}}},{key:"handleOnProductClear",value:function e(t){var i=t.getData(),r=i.selectorId,n=i.rowId;var a=this.getProductByRowId(n);if(a&&a.getSelector().getId()===r){var o;a.initHandlersForSelectors();a.setMeasure(this.getDefaultMeasure());a.changePurchasingPrice(0);a.changeBasePrice(0);a.changeAmount(0);a.updateUiStoreValues();a.updateProductStoreValues();a.changeBarcode("");(o=a.getBarcodeSelector())===null||o===void 0?void 0:o.setConfig("ENABLE_SEARCH",true).layout();a.executeExternalActions()}}},{key:"compileProductData",value:function e(){if(!this.isExistForm()){return}this.initFormFields();var t=this.getDataField();var i=this.getDataSettingsField();this.cleanProductRows();if(u.Type.isElementNode(t)&&u.Type.isElementNode(i)){t.value=this.prepareProductDataValue()}}},{key:"prepareProductDataValue",value:function t(){var i="";if(this.getProductCount()){var r=[];this.products.forEach((function(t){var i=t.getFields(Rt(e,e,Gt).call(e));if(!/^[0-9]+$/.test(i["ID"])){i["ID"]=0}i["CUSTOMIZED"]="Y";r.push(i)}));i=JSON.stringify(r)}return i}},{key:"executeActions",value:function e(t){if(!u.Type.isArrayFilled(t)){return}var i=mt(t),r;try{for(i.s();!(r=i.n()).done;){var n=r.value;if(!u.Type.isPlainObject(n)||!u.Type.isStringFilled(n.type)){continue}switch(n.type){case this.actions.productChange:this.actionSendProductChange(n);break;case this.actions.productListChanged:this.actionSendProductListChanged();break;case this.actions.updateTotal:this.actionUpdateTotalData();break}}}catch(e){i.e(e)}finally{i.f()}}},{key:"actionSendProductChange",value:function e(t){if(!u.Type.isStringFilled(t.id)){return}var i=this.getProductByRowId(t.id);if(!i){return}if(this.controller){this.controller.productChange()}}},{key:"actionSendProductListChanged",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.controller){this.controller.productChange(t)}}},{key:"actionUpdateListField",value:function e(t){if(!u.Type.isStringFilled(t.field)||!("value"in t)){return}this.updateFieldForList=t.field;var i=mt(this.products),r;try{for(i.s();!(r=i.n()).done;){var n=r.value;n.updateFieldByName(t.field,t.value)}}catch(e){i.e(e)}finally{i.f()}this.updateFieldForList=null}},{key:"actionUpdateTotalData",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.updateTotalDataDelayedHandler(t)}},{key:"updateTotalDataDelayed",value:function e(){var t=0;var i=this.getSettingValue("totalCalculationSumField","PURCHASING_PRICE");this.products.forEach((function(e){return t+=u.Text.toNumber(e.getField(i))*u.Text.toNumber(e.getField("AMOUNT"))}));this.setTotalData({totalCost:t})}},{key:"getProductsFields",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var i=[];var r=mt(this.products),n;try{for(r.s();!(n=r.n()).done;){var a=n.value;i.push(a.getFields(t))}}catch(e){r.e(e)}finally{r.f()}return i}},{key:"setTotalData",value:function e(t){var i;var r=BX(this.getSettingValue("totalBlockContainerId",null));if(u.Type.isElementNode(r)){var a=this.getCurrencyId();var o=["totalCost"];for(var s=0,l=o;s<l.length;s++){var d=l[s];var c=r.querySelector('[data-total="'+d+'"]');if(u.Type.isElementNode(c)&&d in t){c.innerHTML=n.CurrencyCore.currencyFormat(t[d],a,false)}}}(i=this.controller)===null||i===void 0?void 0:i.setTotal(t)}},{key:"ajaxResultCommonCheck",value:function e(t){if(!u.Type.isPlainObject(t)){return false}if(!u.Type.isStringFilled(t.status)){return false}if(t.status!=="success"){return false}if(!u.Type.isPlainObject(t.data)){return false}if(!u.Type.isStringFilled(t.data.action)){return false}if(!("result"in t.data)){return false}return true}},{key:"deleteRow",value:function e(t){var i=this.getGrid().getRows().getById(t.getField("ID"));if(i){u.Dom.remove(i.getNode());this.getGrid().getRows().reset()}var n=this.products.indexOf(t);if(n>-1){this.products.splice(n,1);this.refreshSortFields();this.numerateRows()}r.EventEmitter.emit("Grid::thereEditedRows",[]);this.addFirstRowIfEmpty();this.executeActions([{type:this.actions.productListChanged},{type:this.actions.updateTotal}])}},{key:"copyRow",value:function e(t){this.addProductRow(t);this.refreshSortFields();this.numerateRows();r.EventEmitter.emit("Grid::thereEditedRows",[]);this.executeActions([{type:this.actions.productListChanged},{type:this.actions.updateTotal}])}},{key:"cleanProductRows",value:function e(){var t=this;this.products.filter((function(e){return e.isEmptyRow()})).forEach((function(e){return t.deleteRow(e)}))}},{key:"resortProductsByIds",value:function e(t){var i=false;if(u.Type.isArrayFilled(t)){this.products.sort((function(e,r){if(t.indexOf(e.getField("ID"))>t.indexOf(r.getField("ID"))){return 1}i=true;return-1}))}return i}},{key:"refreshSortFields",value:function e(){this.products.forEach((function(e,t){return e.setField("SORT",(t+1)*10,false)}))}},{key:"handleOnTabShow",value:function e(){r.EventEmitter.emit("onDemandRecalculateWrapper",[this])}},{key:"closeBarcodeSpotlights",value:function e(){this.products.forEach((function(e){var t;(t=e.getBarcodeSelector())===null||t===void 0?void 0:t.removeSpotlight()}));this.setSettingValue("showBarcodeSpotlightInfo",false)}},{key:"closeBarcodeQrAuths",value:function e(){this.products.forEach((function(e){var t;(t=e.getBarcodeSelector())===null||t===void 0?void 0:t.removeQrAuth()}));this.setSettingValue("showBarcodeQrAuth",false)}},{key:"enableSendBarcodeMobilePush",value:function e(){this.products.forEach((function(e){var t;(t=e.getBarcodeSelector())===null||t===void 0?void 0:t.setConfig("IS_INSTALLED_MOBILE_APP",true)}));this.setSettingValue("isInstalledMobileApp",true)}},{key:"validate",value:function e(){if(this.getProductCount()===0){return[u.Loc.getMessage("CATALOG_DOCUMENT_PRODUCT_LIST_IS_EMPTY")]}var t=[];this.products.forEach((function(e){t=t.concat(e.validate())}));return t}},{key:"showFieldTourHint",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:"";if(this.products.length>0){var o=this.products[0].getNode();if(this.getProductByRowId(a)){o=this.getProductByRowId(a).getNode()}var s=[];var l=mt(n),u;try{for(l.s();!(u=l.n()).done;){var d=u.value;var c=o.querySelector('[data-name="'.concat(d,'"]'));if(c!==null){s.push(c)}}}catch(e){l.e(e)}finally{l.f()}var h=o.querySelector('[data-name="'.concat(t,'"]'));if(h!==null){babelHelpers.classPrivateFieldGet(this,wt).processFieldTour(h,i,r,s)}}}},{key:"getActiveHint",value:function e(){return babelHelpers.classPrivateFieldGet(this,wt).getActiveHint()}},{key:"getRestrictedProductTypes",value:function e(){return this.getSettingValue("restrictedProductTypes",[])}},{key:"processApplyActionButtonClick",value:function e(t){if(t==="STORE_FROM_INFO"||t==="STORE_TO_INFO"){Ft(this,Mt,xt).call(this,t)}}}]);return e}();function Ut(){this.getGrid()._clickOnRowActionsButton=function(){}}function Lt(){return this.products.filter((function(e){return e.getModel().getErrorCollection().hasErrors()})).length>0}function Gt(){return["ID","SKU_ID","AMOUNT","PURCHASING_PRICE","BASE_PRICE","BASE_PRICE_EXTRA","BASE_PRICE_EXTRA_RATE","COMMENT","DOC_BARCODE","BARCODE","STORE_TO","STORE_FROM","BASE_PRICE_ID","BASKET_ID","DOC_ID","ELEMENT_ID","IBLOCK_ID","MEASURE_CODE","MEASURE_NAME","NAME","OFFERS_IBLOCK_ID","PARENT_PRODUCT_ID","PRODUCT_ID","ROW_ID","STORE_FROM_AMOUNT","STORE_FROM_AVAILABLE_AMOUNT","STORE_FROM_RESERVED","STORE_FROM_TITLE","STORE_TO_AMOUNT","STORE_TO_AVAILABLE_AMOUNT","STORE_TO_RESERVED","STORE_TO_TITLE","TOTAL_PRICE","TYPE"]}function xt(e){var t,i=this;var r=(t=this.getGrid())===null||t===void 0?void 0:t.getActionsPanel();var n=r===null||r===void 0?void 0:r.getValues();var a=n[e];if(!n||u.Type.isUndefined(a)){return}var s=this.getGrid().getRows().getSelected();if(s.length===0){return}var l=this.getSettingValue("stores",{});var d=l[a];if(!u.Type.isNil(d)){var c=(d===null||d===void 0?void 0:d.TITLE)||"";s.forEach((function(t){var r=i.products.find((function(e){return e.getField("ID")===t.getId()}));if(r){var n=o.StoreSelector.getById(r.getId()+"_"+e);if(n){n.onStoreSelect(a,c)}}}));var v="M";var g=this.settings.documentType!==v?"CATALOG_DOCUMENT_PRODUCT_LIST_ACTION_STORE_CHANGED_HINT":"CATALOG_DOCUMENT_PRODUCT_LIST_ACTION_"+e+"_CHANGED_HINT";h.UI.Notification.Center.notify({content:u.Loc.getMessage(g,{"#STORE_NAME#":u.Text.encode(c)}),autoHide:true,autoHideDelay:4e3})}var f=r.getDropdowns().find((function(e){return e.id==="actionListId_control"}));if(f){r.removeItemsRelativeCurrent(f.parentNode);u.Dom.attr(f,"data-value",null);var p=f.querySelector(".main-dropdown-inner");if(p){p.innerText=u.Loc.getMessage("CATALOG_DOCUMENT_PRODUCT_LIST_ACTION_DEFAULT")}}}e.Editor=Bt;e.PageEventsManager=_e})(this.BX.Catalog.Store.ProductList=this.BX.Catalog.Store.ProductList||{},BX.Catalog,BX.Main,BX.Event,BX.Currency,BX.Catalog,BX.Catalog,BX.Catalog.DocumentCard,BX.Catalog,BX,BX,BX.UI.Tour,BX);
//# sourceMappingURL=script.map.js