{"version":3,"file":"copilot-text-controller.bundle.js","sources":["../src/copilot-text-controller-engine.js","../src/menu-item-commands/base-command.js","../src/menu-item-commands/add-below-command.js","../src/menu-item-commands/cancel-command.js","../src/menu-item-commands/edit-result-command.js","../src/menu-item-commands/generate-with-required-user-message-command.js","../src/menu-item-commands/generate-without-required-user-message.js","../src/menu-item-commands/open-about-copilot.js","../src/menu-item-commands/open-feedback-form-command.js","../src/menu-item-commands/repeat-command.js","../src/menu-item-commands/repeat-generate-command.js","../src/menu-item-commands/save-command.js","../src/menu-item-commands/set-engine-command.js","../src/menu-item-commands/close-command.js","../src/menu-item-commands/open-image-configurator.js","../src/menu-items/copilot-error-menu-items.js","../src/menu-items/copilot-providers-menu-items.js","../src/menu-items/copilot-menu-items.js","../src/menu-items/copilot-result-menu-items.js","../src/menu-items/copilot-general-menu-items.js","../../src/copilot-menu/copilot-menu-item.js","../src/menu-item/about-copilot-menu-item.js","../src/menu-item/change-request-menu-item.js","../src/menu-item/copy-result-menu-item.js","../src/menu-item/feedback-menu-item.js","../src/menu-item/market-menu-item.js","../src/menu-item/open-copilot-menu-item.js","../src/menu-item/provider-menu-item.js","../src/menu-item/repeat-copilot-menu-item.js","../src/menu-item/settings-menu-item.js","../src/menu-item/cancel-copilot-menu-item.js","../src/menu-item/connect-model-menu-item.js","../src/copilot-text-controller.js"],"sourcesContent":["import { Engine, type GetToolingResultData, Text as PayloadText } from 'ai.engine';\nimport type { AjaxResponse } from 'main.core';\nimport { Type, BaseError } from 'main.core';\nimport type { EngineInfo } from './types/engine-info';\n\ntype CopilotTextControllerEngineOptions = {\n\tcategory: string;\n\tengine: Engine;\n\tuseResultStack: boolean;\n\tmoduleId: string;\n\tcontextId: string;\n\tcontextParameters: any;\n}\n\nexport class CopilotTextControllerEngine\n{\n\t#engine: Engine;\n\t#category: string;\n\t#context: string;\n\t#useResultStack: boolean = true;\n\t#selectedText: string;\n\t#userMessage: string;\n\t#commandCode: string;\n\t#selectedEngineCode: string;\n\t#currentGenerateRequestId: number;\n\t#resultStack: string[] = [];\n\n\tstatic #toolingDataByCategory: {data: GetToolingResultData} = {};\n\n\tconstructor(options: CopilotTextControllerEngineOptions)\n\t{\n\t\tthis.#category = options.category;\n\t\tthis.#useResultStack = options.useResultStack ?? this.#useResultStack;\n\t\tthis.#initEngine({\n\t\t\tmoduleId: options.moduleId,\n\t\t\tcategory: options.category,\n\t\t\tcontextId: options.contextId,\n\t\t\tcontextParameters: options.contextParameters,\n\t\t});\n\t}\n\n\tasync init(): Promise\n\t{\n\t\tif (CopilotTextControllerEngine.#toolingDataByCategory[this.#category] === undefined)\n\t\t{\n\t\t\tCopilotTextControllerEngine.#toolingDataByCategory[this.#category] = this.#engine.getTooling('text');\n\t\t}\n\n\t\tconst res = await CopilotTextControllerEngine.#toolingDataByCategory[this.#category];\n\t\tCopilotTextControllerEngine.#toolingDataByCategory[this.#category] = res;\n\n\t\tthis.#selectedEngineCode = this.#getSelectedEngineCode(res.data.engines);\n\t}\n\n\tasync completions(): Promise<string>\n\t{\n\t\tthis.#setEnginePayload();\n\n\t\tconst id = Math.round(Math.random() * 10000);\n\n\t\tthis.#currentGenerateRequestId = id;\n\n\t\ttry\n\t\t{\n\t\t\tconst res = await this.#engine.textCompletions();\n\n\t\t\tconst result = res.data.result || res.data.last.data;\n\n\t\t\tif (this.#currentGenerateRequestId !== id)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (this.#useResultStack)\n\t\t\t{\n\t\t\t\tthis.#addResultToStack(result);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\t\tcatch (res)\n\t\t{\n\t\t\tif (this.#currentGenerateRequestId !== id)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tthrow getBaseErrorFromResponse(res);\n\t\t}\n\t}\n\n\tgetPrompts(): Prompt[]\n\t{\n\t\treturn this.#getTooling().prompts;\n\t}\n\n\tgetPermissions()\n\t{\n\t\treturn this.#getTooling().permissions;\n\t}\n\n\tgetEngines(): EngineInfo[]\n\t{\n\t\treturn this.#getTooling().engines;\n\t}\n\n\tsetSelectedEngineCode(code: string)\n\t{\n\t\tthis.#selectedEngineCode = code;\n\t}\n\n\tgetSelectedEngineCode(): string\n\t{\n\t\treturn this.#selectedEngineCode;\n\t}\n\n\tgetCategory(): string\n\t{\n\t\treturn this.#category;\n\t}\n\n\tgetContextId(): string\n\t{\n\t\treturn this.#engine.getContextId();\n\t}\n\n\tsetContext(context: string): void\n\t{\n\t\tthis.#context = context;\n\t}\n\n\tsetSelectedText(selectedText: string): void\n\t{\n\t\tthis.#selectedText = selectedText;\n\t}\n\n\tgetOriginalMessage(): string\n\t{\n\t\treturn this.#selectedText || this.#context || '';\n\t}\n\n\tsetUserMessage(userMessage: string): void\n\t{\n\t\tthis.#userMessage = userMessage;\n\t}\n\n\tgetCommandCode(): string\n\t{\n\t\treturn this.#commandCode;\n\t}\n\n\tsetCommandCode(commandCode: string): void\n\t{\n\t\tthis.#commandCode = commandCode;\n\t}\n\n\tcancelCompletion(): void\n\t{\n\t\tthis.#currentGenerateRequestId = -1;\n\t}\n\n\tisCopilotFirstLaunch(): boolean\n\t{\n\t\treturn Boolean(this.#getTooling().first_launch);\n\t}\n\n\tsetCopilotBannerLaunchedFlag(): void\n\t{\n\t\tthis.#engine.setBannerLaunched();\n\t}\n\n\tsetAnalyticParameters(parameters: {[key: string]: string}): void\n\t{\n\t\tthis.#engine.setAnalyticParameters(parameters);\n\t}\n\n\tasync getDataForFeedbackForm(): Promise<any>\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst feedDataResult = await this.#engine.getFeedbackData();\n\t\t\tconst messages = feedDataResult.data.context_messages;\n\t\t\tconst authorMessage = feedDataResult.data.original_message;\n\t\t\tconst payload = this.#engine.getPayload();\n\n\t\t\treturn payload ? {\n\t\t\t\tcontext_messages: messages,\n\t\t\t\tauthor_message: authorMessage,\n\t\t\t\t...payload.getRawData(),\n\t\t\t\t...payload.getMarkers(),\n\t\t\t} : {};\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error(error);\n\t\t\tconst payload = this.#engine.getPayload();\n\n\t\t\treturn payload ? {\n\t\t\t\t...payload.getRawData(),\n\t\t\t\t...payload.getMarkers(),\n\t\t\t} : {};\n\t\t}\n\t}\n\n\t#addResultToStack(result: string): void\n\t{\n\t\tconst stackSize = 3;\n\n\t\tthis.#resultStack.unshift(result);\n\t\tif (this.#resultStack.length > stackSize)\n\t\t{\n\t\t\tthis.#resultStack.pop();\n\t\t}\n\t}\n\n\t#getSelectedEngineCode(engines: EngineInfo[]): string | undefined\n\t{\n\t\tconst selectedEngine = engines.find((engine: EngineInfo) => engine.selected);\n\n\t\treturn selectedEngine?.code || engines[0]?.code;\n\t}\n\n\t#getTooling(): GetToolingResultData\n\t{\n\t\treturn CopilotTextControllerEngine.#toolingDataByCategory[this.#category]?.data;\n\t}\n\n\t#setEnginePayload(): void\n\t{\n\t\tconst command = this.#commandCode;\n\t\tconst userMessage = this.#userMessage || undefined;\n\t\tconst originalMessage = this.getOriginalMessage();\n\n\t\tconst payload = new PayloadText({\n\t\t\tprompt: {\n\t\t\t\tcode: command,\n\t\t\t},\n\t\t\tengineCode: this.#selectedEngineCode,\n\t\t});\n\n\t\tpayload.setMarkers({\n\t\t\toriginal_message: this.#isCommandRequiredContextMessage(command) ? originalMessage : undefined,\n\t\t\tuser_message: this.#isCommandRequiredUserMessage(command) ? userMessage : undefined,\n\t\t\tcurrent_result: this.#resultStack,\n\t\t});\n\n\t\tthis.#engine.setPayload(payload);\n\t}\n\n\t#isCommandRequiredUserMessage(commandCode): boolean\n\t{\n\t\tconst prompts = this.#getTooling().prompts;\n\t\tconst searchPrompt: Prompt | undefined = this.#getPromptByCode(prompts, commandCode);\n\n\t\tif (!searchPrompt)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn searchPrompt.required.user_message;\n\t}\n\n\t#isCommandRequiredContextMessage(commandCode): boolean\n\t{\n\t\tconst prompts = this.#getTooling().prompts;\n\t\tconst searchPrompt: Prompt | undefined = this.#getPromptByCode(prompts, commandCode);\n\n\t\tif (!searchPrompt)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn searchPrompt.required.context_message;\n\t}\n\n\t#getPromptByCode(prompts: Prompt[], commandCode: string): Prompt | null\n\t{\n\t\tlet searchPrompt = null;\n\n\t\tprompts.some((prompt: Prompt) => {\n\t\t\tif (prompt.code === commandCode)\n\t\t\t{\n\t\t\t\tsearchPrompt = prompt;\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn prompt.children?.some((childrenPrompt) => {\n\t\t\t\tif (childrenPrompt.code === commandCode)\n\t\t\t\t{\n\t\t\t\t\tsearchPrompt = childrenPrompt;\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t});\n\t\t});\n\n\t\treturn searchPrompt;\n\t}\n\n\t#initEngine(initEngineOptions: InitEngineOptions): void\n\t{\n\t\tthis.#engine = new Engine();\n\t\tthis.#engine\n\t\t\t.setModuleId(initEngineOptions.moduleId)\n\t\t\t.setContextId(initEngineOptions.contextId)\n\t\t\t.setContextParameters(initEngineOptions.contextParameters)\n\t\t\t.setParameters({\n\t\t\t\tpromptCategory: initEngineOptions.category,\n\t\t\t});\n\t}\n}\n\ntype InitEngineOptions = {\n\tmoduleId: string;\n\tcontextId: string;\n\tcontextParameters: any;\n\tcategory: string;\n}\n\nfunction getBaseErrorFromResponse(res: AjaxResponse<any>): BaseError | null\n{\n\tif (res instanceof Error)\n\t{\n\t\treturn new BaseError(res.message, 'undefined', {});\n\t}\n\n\tif (Type.isString(res))\n\t{\n\t\treturn new BaseError(res, 'undefined', {});\n\t}\n\n\tconst firstErrorData = res.errors[0];\n\n\tif (!firstErrorData)\n\t{\n\t\treturn null;\n\t}\n\n\tconst {\n\t\tmessage,\n\t\tcode,\n\t\tcustomData,\n\t} = firstErrorData;\n\n\treturn new BaseError(message, code, customData);\n}\n","import type { CopilotTextController } from 'ai.copilot.copilot-text-controller';\n\nexport type BaseCommandOptions = {\n\tcopilotTextController: CopilotTextController;\n}\n\nexport class BaseCommand\n{\n\tcopilotTextController: CopilotTextController;\n\n\tconstructor(options: BaseCommandOptions)\n\t{\n\t\tthis.copilotTextController = options?.copilotTextController;\n\t}\n}\n","import { BaseCommand } from './base-command';\n\nexport class AddBelowCommand extends BaseCommand\n{\n\texecute(): void\n\t{\n\t\tthis.copilotTextController.emit('add_below', {\n\t\t\tresult: this.copilotTextController.getAiResultText(),\n\t\t\tcode: this.copilotTextController.getLastCommandCode(),\n\t\t});\n\t}\n}\n","import type { CopilotInput } from 'ai.copilot';\nimport { Dom } from 'main.core';\nimport type { BaseCommandOptions } from './base-command';\nimport { BaseCommand } from './base-command';\n\ntype CancelCommandOptions = {\n\tinputField: CopilotInput;\n\tcopilotContainer: HTMLElement;\n} | BaseCommandOptions;\n\nexport class CancelCommand extends BaseCommand\n{\n\t#copilotContainer: HTMLElement;\n\t#inputField: CopilotInput;\n\n\tconstructor(options: CancelCommandOptions)\n\t{\n\t\tsuper(options);\n\n\t\tthis.#copilotContainer = options.copilotContainer;\n\t\tthis.#inputField = options.inputField;\n\t}\n\n\texecute()\n\t{\n\t\tthis.copilotTextController.destroyAllMenus();\n\t\tthis.copilotTextController.openGeneralMenu();\n\t\tthis.copilotTextController.clearResultStack();\n\t\tthis.#inputField.clearErrors();\n\t\tthis.#inputField.clear();\n\t\tif (this.copilotTextController.isReadonly() === false)\n\t\t{\n\t\t\tthis.#inputField.enable();\n\t\t}\n\t\tthis.copilotTextController.clearResultField();\n\t\tDom.removeClass(this.#copilotContainer, '--error');\n\t\t// this.#selectedCommand = null;\n\t\tthis.copilotTextController.emit('cancel');\n\t\tthis.#inputField.focus();\n\t\tthis.copilotTextController.getAnalytics().sendEventCancel();\n\t}\n}\n","import type { CopilotInput, CopilotMenu } from 'ai.copilot';\nimport { Dom } from 'main.core';\nimport type { BaseCommandOptions } from './base-command';\nimport { BaseCommand } from './base-command';\n\ntype EditResultCommandOptions = {\n\tinputField: CopilotInput;\n\tgeneralMenu: CopilotMenu;\n\tcopilotContainer: HTMLElement;\n} | BaseCommandOptions;\n\nexport class EditResultCommand extends BaseCommand\n{\n\t#inputField: CopilotInput;\n\t#copilotContainer: HTMLElement;\n\n\tconstructor(options: EditResultCommandOptions)\n\t{\n\t\tsuper(options);\n\n\t\tthis.#inputField = options.inputField;\n\t\tthis.#copilotContainer = options.copilotContainer;\n\t}\n\n\texecute(): void\n\t{\n\t\tthis.copilotTextController.destroyAllMenus();\n\t\tthis.#inputField.enable();\n\t\tthis.#inputField.clearErrors();\n\t\tDom.removeClass(this.#copilotContainer, '--error');\n\t\t// this.#resultField.clearResult();\n\t\tthis.copilotTextController.openGeneralMenu();\n\t\tthis.#inputField.focus();\n\t\tthis.copilotTextController.getAnalytics().sendEventEditResult();\n\t\t// this.#selectedCommand = null;\n\t}\n}\n","import { BaseCommand, type BaseCommandOptions } from './base-command';\n\ntype GenerateWithRequiredUserMessageCommandOptions = {\n\tcommandCode: string;\n} | BaseCommandOptions;\n\nexport class GenerateWithRequiredUserMessageCommand extends BaseCommand\n{\n\t#commandCode: string;\n\n\tconstructor(options: GenerateWithRequiredUserMessageCommandOptions)\n\t{\n\t\tsuper(options);\n\n\t\tthis.#commandCode = options.commandCode;\n\t}\n\n\texecute(): void\n\t{\n\t\tthis.copilotTextController.generateWithRequiredUserMessage(this.#commandCode);\n\t}\n}\n","import { BaseCommand, type BaseCommandOptions } from './base-command';\n\ntype GenerateWithoutRequiredUserMessageOptions = {\n\tcommandCode: string;\n\tprompts: Array;\n} | BaseCommandOptions;\n\nexport class GenerateWithoutRequiredUserMessage extends BaseCommand\n{\n\t#commandCode: string;\n\t#prompts: Array[] = [];\n\n\tconstructor(options: GenerateWithoutRequiredUserMessageOptions)\n\t{\n\t\tsuper(options);\n\n\t\tthis.#prompts = options.prompts;\n\t\tthis.#commandCode = options.commandCode;\n\t}\n\n\texecute()\n\t{\n\t\tthis.copilotTextController.generateWithoutRequiredUserMessage(this.#commandCode, this.#prompts);\n\t}\n}\n","import { Reflection } from 'main.core';\nimport { BaseCommand } from './base-command';\n\nexport class OpenAboutCopilot extends BaseCommand\n{\n\texecute()\n\t{\n\t\tconst articleCode = '19092894';\n\n\t\tconst Helper = Reflection.getClass('top.BX.Helper');\n\n\t\tif (Helper)\n\t\t{\n\t\t\tHelper.show(`redirect=detail&code=${articleCode}`);\n\t\t}\n\t}\n}","import { Runtime, Loc } from 'main.core';\nimport type { BaseCommandOptions } from './base-command';\nimport { BaseCommand } from './base-command';\nimport 'ui.feedback.form';\n\ntype OpenFeedbackFormCommandOptions = {\n\tcategory: string;\n\tisBeforeGeneration: boolean;\n} | BaseCommandOptions;\n\nexport class OpenFeedbackFormCommand extends BaseCommand\n{\n\t#category: string;\n\t#isBeforeGeneration: boolean;\n\n\tconstructor(options: OpenFeedbackFormCommandOptions)\n\t{\n\t\tsuper(options);\n\n\t\tthis.#category = options.category;\n\t\tthis.#isBeforeGeneration = options.isBeforeGeneration;\n\t}\n\n\tasync execute(): Promise\n\t{\n\t\tawait this.#openFeedbackForm();\n\t}\n\n\tasync #openFeedbackForm(): void\n\t{\n\t\tconst senderPagePreset = `${this.#category},${this.#isBeforeGeneration ? 'before' : 'after'}`;\n\t\tlet data = null;\n\n\t\tif (this.#isBeforeGeneration === false)\n\t\t{\n\t\t\tdata = await this.copilotTextController.getDataForFeedbackForm();\n\t\t}\n\n\t\tconst contextMessages = data?.context_messages?.length > 0 ? JSON.stringify(data?.context_messages) : undefined;\n\t\tconst authorMessage = data?.author_message ?? undefined;\n\n\t\tconst formIdNumber = Math.round(Math.random() * 1000);\n\n\t\tRuntime.loadExtension(['ui.feedback.form'])\n\t\t\t.then(() => {\n\t\t\t\tBX.UI.Feedback.Form.open(\n\t\t\t\t\t{\n\t\t\t\t\t\tid: `ai.copilot.feedback-${formIdNumber}`,\n\t\t\t\t\t\tforms: [\n\t\t\t\t\t\t\t{ zones: ['es'], id: 684, lang: 'es', sec: 'svvq1x' },\n\t\t\t\t\t\t\t{ zones: ['en'], id: 686, lang: 'en', sec: 'tjwodz' },\n\t\t\t\t\t\t\t{ zones: ['de'], id: 688, lang: 'de', sec: 'nrwksg' },\n\t\t\t\t\t\t\t{ zones: ['com.br'], id: 690, lang: 'com.br', sec: 'kpte6m' },\n\t\t\t\t\t\t\t{ zones: ['ru', 'by', 'kz'], id: 692, lang: 'ru', sec: 'jbujn0' },\n\t\t\t\t\t\t],\n\t\t\t\t\t\tpresets: {\n\t\t\t\t\t\t\tsender_page: senderPagePreset,\n\t\t\t\t\t\t\tprompt_code: data?.prompt?.code,\n\t\t\t\t\t\t\tuser_message: data?.user_message,\n\t\t\t\t\t\t\toriginal_message: data?.original_message,\n\t\t\t\t\t\t\tauthor_message: authorMessage,\n\t\t\t\t\t\t\tcontext_messages: contextMessages,\n\t\t\t\t\t\t\tlast_result0: data?.current_result?.[1],\n\t\t\t\t\t\t\tlanguage: Loc.getMessage('LANGUAGE_ID'),\n\t\t\t\t\t\t\tcp_answer: data?.current_result?.[0],\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tconsole.err(err);\n\t\t\t});\n\t}\n}\n","import { BaseCommand } from './base-command';\n\nexport class RepeatCommand extends BaseCommand\n{\n\texecute(): void\n\t{\n\t\tthis.copilotTextController.generate();\n\t}\n}\n","import { BaseCommand } from './base-command';\n\nexport class RepeatGenerateCommand extends BaseCommand\n{\n\texecute(): void\n\t{\n\t\tthis.copilotTextController.adjustMenusPosition();\n\t\tthis.copilotTextController.generate();\n\t}\n}\n","import { BaseEvent } from 'main.core.events';\nimport { BaseCommand } from './base-command';\n\nexport class SaveCommand extends BaseCommand\n{\n\texecute(): void\n\t{\n\t\tthis.copilotTextController.emit('save', new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tresult: this.copilotTextController.getAiResultText(),\n\t\t\t\tcode: this.copilotTextController.getLastCommandCode(),\n\t\t\t},\n\t\t}));\n\n\t\tthis.copilotTextController.getAnalytics().sendEventSave();\n\t}\n}\n","import type { EngineInfo } from '../types/engine-info';\nimport type { BaseCommandOptions } from './base-command';\nimport { BaseCommand } from './base-command';\n\ntype SetEngineCommandOptions = {\n\tengineCode: string;\n\tengines: EngineInfo[];\n} | BaseCommandOptions;\nexport class SetEngineCommand extends BaseCommand\n{\n\t#engineCode: string;\n\n\tconstructor(options: SetEngineCommandOptions)\n\t{\n\t\tsuper(options);\n\n\t\tthis.#engineCode = options.engineCode;\n\t}\n\n\texecute()\n\t{\n\t\tthis.copilotTextController.setSelectedEngine(this.#engineCode);\n\t}\n}\n","import { BaseCommand } from './index';\n\nexport class CloseCommand extends BaseCommand\n{\n\texecute()\n\t{\n\t\tthis.copilotTextController.emit('close');\n\t}\n}\n","import { BaseCommand } from './base-command';\n\nexport class OpenImageConfigurator extends BaseCommand\n{\n\texecute(): void\n\t{\n\t\tthis.copilotTextController.emit('show-image-configurator');\n\t}\n}\n","import type { CopilotInput, CopilotMenuItem } from 'ai.copilot';\nimport type { CopilotTextController } from 'ai.copilot.copilot-text-controller';\nimport { Loc } from 'main.core';\nimport { CancelCommand, EditResultCommand, RepeatCommand } from '../menu-item-commands/index';\n\ntype CopilotErrorMenuItemsOptions = {\n\tinputField: CopilotInput;\n\tcopilotTextController: CopilotTextController;\n\tcopilotContainer: HTMLElement;\n}\n\nexport class CopilotErrorMenuItems\n{\n\tstatic getMenuItems(options: CopilotErrorMenuItemsOptions): CopilotMenuItem\n\t{\n\t\tconst {\n\t\t\tinputField,\n\t\t\tcopilotTextController,\n\t\t\tcopilotContainer,\n\t\t} = options;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tcode: 'repeat',\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_REPEAT'),\n\t\t\t\ticon: 'left-semicircular-anticlockwise-arrow-1',\n\t\t\t\tcommand: new RepeatCommand({\n\t\t\t\t\tcopilotTextController,\n\t\t\t\t}),\n\t\t\t\tnotHighlight: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_EDIT'),\n\t\t\t\tcode: 'edit',\n\t\t\t\ticon: 'pencil-60',\n\t\t\t\tcommand: new EditResultCommand({\n\t\t\t\t\tinputField,\n\t\t\t\t\tcopilotTextController,\n\t\t\t\t\tcopilotContainer,\n\t\t\t\t}),\n\t\t\t\tnotHighlight: true,\n\n\t\t\t},\n\t\t\t{\n\t\t\t\tcode: 'cancel',\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_CANCEL'),\n\t\t\t\ticon: 'cross-45',\n\t\t\t\tcommand: new CancelCommand({\n\t\t\t\t\tcopilotTextController,\n\t\t\t\t\tinputField,\n\t\t\t\t\tcopilotContainer,\n\t\t\t\t}),\n\t\t\t\tnotHighlight: true,\n\t\t\t},\n\t\t];\n\t}\n}\n","import { Extension, Loc } from 'main.core';\nimport type { CopilotMenuItem } from 'ai.copilot';\nimport type { CopilotTextController } from 'ai.copilot.copilot-text-controller';\nimport { Main as MainIconSet, Actions as ActionsIconSet } from 'ui.icon-set.api.core';\nimport { SetEngineCommand } from '../menu-item-commands/index';\nimport type { EngineInfo } from '../types/engine-info';\n\ntype CopilotProvidersMenuItemsOptions = {\n\tselectedEngineCode: string;\n\tengines: EngineInfo[];\n\tcanEditSettings?: boolean;\n\tcopilotTextController: CopilotTextController;\n}\n\nexport class CopilotProvidersMenuItems\n{\n\tstatic getMenuItems(options: CopilotProvidersMenuItemsOptions): CopilotMenuItem[]\n\t{\n\t\tconst { engines, selectedEngineCode, canEditSettings = false, copilotTextController } = options;\n\n\t\tconst connectAiMenuItem: CopilotMenuItem = {\n\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_CONNECT_AI'),\n\t\t\tdisabled: true,\n\t\t\ticon: ActionsIconSet.PLUS_50,\n\t\t};\n\n\t\tlet result = [\n\t\t\t...getMenuItemsFromEngines(engines, selectedEngineCode, copilotTextController),\n\t\t\tconnectAiMenuItem,\n\t\t\t{ separator: true },\n\t\t\tgetMarketMenuItem(),\n\t\t];\n\n\t\tif (canEditSettings)\n\t\t{\n\t\t\tconst settingsPageLink = Extension.getSettings('ai.copilot.copilot-text-controller').settingsPageLink;\n\n\t\t\tresult = [...result, {\n\t\t\t\tcode: 'ai_settings',\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_MENU_ITEM_AI_SETTINGS'),\n\t\t\t\ticon: ActionsIconSet.SETTINGS_4,\n\t\t\t\thref: settingsPageLink,\n\t\t\t}];\n\t\t}\n\n\t\treturn result;\n\t}\n}\n\nfunction getMenuItemsFromEngines(\n\tengines: EngineInfo[],\n\tselectedEngineCode: string,\n\tcopilotTextController: CopilotTextController,\n): CopilotMenuItem[]\n{\n\treturn engines.map((engine): CopilotMenuItem => {\n\t\treturn {\n\t\t\tcode: engine.code,\n\t\t\ttext: engine.title,\n\t\t\ticon: MainIconSet.ROBOT,\n\t\t\tselected: selectedEngineCode === engine.code,\n\t\t\tcommand: new SetEngineCommand({\n\t\t\t\tengines,\n\t\t\t\tcopilotTextController,\n\t\t\t\tengineCode: engine.code,\n\t\t\t}),\n\t\t};\n\t});\n}\n\nfunction getMarketMenuItem(): CopilotMenuItem\n{\n\treturn {\n\t\tcode: 'market',\n\t\thref: '/market/collection/ai_provider_partner_crm/',\n\t\ttext: Loc.getMessage('AI_COPILOT_SEARCH_IN_MARKET'),\n\t\ticon: MainIconSet.MARKET_1,\n\t\tarrow: false,\n\t};\n}\n","import type { CopilotMenuItem } from 'ai.copilot';\n\nexport class CopilotMenuItems\n{\n\tstatic getMenuItems(options: any): CopilotMenuItem[]\n\t{\n\t\tthrow new Error('You must override method: getMenuItems');\n\t}\n}\n","import type { CopilotInput, CopilotMenu, CopilotMenuItem } from 'ai.copilot';\nimport type { CopilotTextController } from 'ai.copilot.copilot-text-controller';\nimport { UI } from 'ui.notification';\nimport {\n\tAddBelowCommand,\n\tCancelCommand,\n\tEditResultCommand,\n\tRepeatGenerateCommand,\n\tOpenFeedbackFormCommand,\n\tSaveCommand,\n\tCloseCommand,\n} from '../menu-item-commands/index';\n\nimport { CopilotMenuItems } from './copilot-menu-items';\nimport { Loc } from 'main.core';\nimport { Actions, Main } from 'ui.icon-set.api.core';\n\ntype CopilotResultMenuItemsOptions = {\n\tprompts: Prompt[];\n\tselectedText: string;\n\tresultMenu?: CopilotMenu;\n\tinputField: CopilotInput;\n\terrorMenu?: CopilotMenu;\n\tgeneralMenu?: CopilotMenu;\n\tcopilotTextController: CopilotTextController;\n\tcopilotContainer: HTMLElement,\n}\n\nexport class CopilotResultMenuItems extends CopilotMenuItems\n{\n\tstatic getMenuItems(options: CopilotResultMenuItemsOptions, category: string): CopilotMenuItem[]\n\t{\n\t\tconst {\n\t\t\tprompts,\n\t\t\tselectedText,\n\t\t\tcopilotContainer = null,\n\t\t} = options;\n\n\t\tconst inputField = options.inputField ?? null;\n\t\tconst copilotTextController = options.copilotTextController ?? null;\n\n\t\tconst saveMenuItemText = selectedText ? 'AI_COPILOT_COMMAND_REPLACE' : 'AI_COPILOT_COMMAND_SAVE';\n\t\tconst saveMenuItem: CopilotMenuItem = {\n\t\t\ttext: Loc.getMessage(saveMenuItemText),\n\t\t\tcode: 'save',\n\t\t\ticon: 'check',\n\t\t\tcommand: new SaveCommand({\n\t\t\t\tcopilotTextController,\n\t\t\t}),\n\t\t\tnotHighlight: true,\n\t\t};\n\n\t\tconst editMenuItem: CopilotMenuItem = {\n\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_EDIT'),\n\t\t\tcode: 'edit',\n\t\t\ticon: 'pencil-60',\n\t\t\tcommand: new EditResultCommand({\n\t\t\t\tinputField,\n\t\t\t\tcopilotTextController,\n\t\t\t\tcopilotContainer,\n\t\t\t}),\n\t\t\tnotHighlight: true,\n\t\t};\n\n\t\tconst addBelowMenuItem: CopilotMenuItem | null = selectedText\n\t\t\t? {\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_ADD_BELOW'),\n\t\t\t\tcode: 'add_below',\n\t\t\t\ticon: 'download',\n\t\t\t\tcommand: new AddBelowCommand({\n\t\t\t\t\tcopilotTextController,\n\t\t\t\t}),\n\t\t\t\tnotHighlight: true,\n\t\t\t}\n\t\t\t: null;\n\n\t\treturn [\n\t\t\tsaveMenuItem,\n\t\t\taddBelowMenuItem,\n\t\t\t{\n\t\t\t\tseparator: true,\n\t\t\t},\n\t\t\teditMenuItem,\n\t\t\t...getResultMenuPromptItems(prompts),\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_REPEAT'),\n\t\t\t\tcode: 'repeat',\n\t\t\t\ticon: 'left-semicircular-anticlockwise-arrow-1',\n\t\t\t\tcommand: new RepeatGenerateCommand({\n\t\t\t\t\tcopilotTextController,\n\t\t\t\t}),\n\t\t\t\tnotHighlight: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\tseparator: true,\n\t\t\t},\n\t\t\tgetFeedbackMenuItem(category, copilotTextController),\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_CANCEL'),\n\t\t\t\tcode: 'cancel',\n\t\t\t\ticon: 'cross-45',\n\t\t\t\tnotHighlight: true,\n\t\t\t\tcommand: new CancelCommand({\n\t\t\t\t\tinputField,\n\t\t\t\t\tcopilotTextController,\n\t\t\t\t}),\n\t\t\t},\n\t\t].filter((item) => item);\n\t}\n\n\tstatic getMenuItemsForReadonlyResult(\n\t\tcategory: string,\n\t\tcopilotTextController: CopilotTextController,\n\t\tinputField: CopilotInput,\n\t\tcopilotContainer,\n\t): CopilotMenuItem[]\n\t{\n\t\treturn [\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_COPY'),\n\t\t\t\tcode: 'copy',\n\t\t\t\ticon: Actions.COPY_PLATES,\n\t\t\t\tnotHighlight: true,\n\t\t\t\tcommand: {\n\t\t\t\t\texecute()\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.clipboard.copy(copilotTextController.getAiResultText());\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Loc.getMessage('AI_COPILOT_TEXT_IS_COPIED'),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tcopilotTextController.getAnalytics().sendEventCopyResult();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_EDIT'),\n\t\t\t\tcode: 'cancel',\n\t\t\t\ticon: Actions.PENCIL_60,\n\t\t\t\tcommand: new CancelCommand({\n\t\t\t\t\tinputField,\n\t\t\t\t\tcopilotTextController,\n\t\t\t\t\tcopilotContainer,\n\t\t\t\t}),\n\t\t\t\tnotHighlight: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\tseparator: true,\n\t\t\t},\n\t\t\tgetFeedbackMenuItem(category, copilotTextController),\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_CLOSE'),\n\t\t\t\tcode: 'close',\n\t\t\t\ticon: Actions.CROSS_45,\n\t\t\t\tnotHighlight: true,\n\t\t\t\tcommand: new CloseCommand({\n\t\t\t\t\tcopilotTextController,\n\t\t\t\t}),\n\t\t\t},\n\t\t];\n\t}\n}\n\nfunction getResultMenuPromptItems(prompts: Prompt[]): CopilotMenuItem[]\n{\n\tconst workWithResultPrompts = prompts.filter((prompt: Prompt) => {\n\t\treturn prompt.workWithResult;\n\t});\n\n\treturn workWithResultPrompts.map((prompt) => {\n\t\treturn {\n\t\t\ttext: prompt.title,\n\t\t\tcode: prompt.code,\n\t\t\ticon: prompt.icon,\n\t\t};\n\t});\n}\n\nfunction getFeedbackMenuItem(category: string, copilotTextController: CopilotTextController): CopilotMenuItem\n{\n\treturn {\n\t\tcode: 'feedback',\n\t\ttext: Loc.getMessage('AI_COPILOT_MENU_ITEM_AI_FEEDBACK'),\n\t\ticon: Main.FEEDBACK,\n\t\tnotHighlight: true,\n\t\tcommand: new OpenFeedbackFormCommand({\n\t\t\tcategory,\n\t\t\tisBeforeGeneration: false,\n\t\t\tcopilotTextController,\n\t\t}),\n\t};\n}\n","import type { CopilotTextController } from 'ai.copilot.copilot-text-controller';\nimport {\n\tGenerateWithRequiredUserMessageCommand,\n\tGenerateWithoutRequiredUserMessage,\n\tOpenFeedbackFormCommand,\n\tOpenImageConfigurator, OpenAboutCopilot,\n} from '../menu-item-commands/index';\nimport { CopilotMenuItems } from './copilot-menu-items';\nimport type { CopilotMenuItem } from 'ai.copilot';\nimport type { EngineInfo } from '../types/engine-info';\nimport type { Prompt } from 'ai.engine';\nimport { Loc } from 'main.core';\nimport { CopilotProvidersMenuItems } from './copilot-providers-menu-items';\nimport { Main as MainIconSet, Main } from 'ui.icon-set.api.core';\n\ntype CopilotGeneralMenuItemsOptions = {\n\tengines: EngineInfo[],\n\tprompts: Prompt[],\n\tselectedEngineCode: string,\n\tcanEditSettings: boolean,\n\tcopilotTextController: CopilotTextController,\n\taddImageMenuItem: boolean;\n}\nexport class CopilotGeneralMenuItems extends CopilotMenuItems\n{\n\tstatic getMenuItems(options: CopilotGeneralMenuItemsOptions): CopilotMenuItem[] {\n\t\tconst {\n\t\t\tprompts,\n\t\t\tengines,\n\t\t\tselectedEngineCode,\n\t\t\tcanEditSettings = false,\n\t\t\tcopilotTextController,\n\t\t\taddImageMenuItem = false,\n\t\t} = options;\n\n\t\tconst imageMenuItem = addImageMenuItem\n\t\t\t? [{\n\t\t\t\tcode: 'image',\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_MENU_ITEM_AI_IMAGE'),\n\t\t\t\ticon: Main.MAGIC_IMAGE,\n\t\t\t\tcommand: new OpenImageConfigurator({\n\t\t\t\t\tcopilotTextController,\n\t\t\t\t}),\n\t\t\t\tlabelText: Loc.getMessage('AI_COPILOT_MENU_ITEM_LABEL_NEW'),\n\t\t\t}] : [];\n\n\t\treturn [\n\t\t\t...imageMenuItem,\n\t\t\t...getGeneralMenuItemsFromPrompts(prompts, copilotTextController),\n\t\t\t...getSelectedEngineMenuItem(engines, selectedEngineCode, copilotTextController, canEditSettings),\n\t\t\t{\n\t\t\t\tcode: 'about_open_copilot',\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_MENU_ITEM_ABOUT_COPILOT'),\n\t\t\t\ticon: MainIconSet.INFO,\n\t\t\t\tcommand: new OpenAboutCopilot(),\n\t\t\t},\n\t\t\t{\n\t\t\t\tcode: 'feedback',\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_MENU_ITEM_AI_FEEDBACK'),\n\t\t\t\ticon: Main.FEEDBACK,\n\t\t\t\tcommand: (new OpenFeedbackFormCommand({\n\t\t\t\t\tcopilotTextController,\n\t\t\t\t\tcategory: copilotTextController.getCategory(),\n\t\t\t\t\tisBeforeGeneration: false,\n\t\t\t\t})),\n\t\t\t},\n\t\t];\n\t}\n}\n\nfunction getGeneralMenuItemsFromPrompts(\n\tprompts: Prompt[],\n\tcopilotTextController: CopilotTextController,\n): CopilotMenuItem[]\n{\n\treturn prompts.map((prompt) => {\n\t\tlet command = null;\n\t\tif (prompt.required)\n\t\t{\n\t\t\tcommand = prompt.type === 'simpleTemplate'\n\t\t\t\t? new GenerateWithRequiredUserMessageCommand({\n\t\t\t\t\tcopilotTextController,\n\t\t\t\t\tcommandCode: prompt.code,\n\t\t\t\t})\n\t\t\t\t: new GenerateWithoutRequiredUserMessage({\n\t\t\t\t\tcopilotTextController,\n\t\t\t\t\tprompts,\n\t\t\t\t\tcommandCode: prompt.code,\n\t\t\t\t});\n\t\t}\n\n\t\treturn {\n\t\t\tcommand,\n\t\t\tcode: prompt.code,\n\t\t\ttext: prompt.title,\n\t\t\tchildren: getGeneralMenuItemsFromPrompts(prompt.children || [], copilotTextController),\n\t\t\tseparator: prompt.separator,\n\t\t\ttitle: prompt.title,\n\t\t\ticon: prompt.icon,\n\t\t\tsection: prompt.section,\n\t\t};\n\t}).filter((item) => item.code !== 'zero_prompt');\n}\n\nfunction getSelectedEngineMenuItem(\n\tengines: EngineInfo[],\n\tselectedEngineCode: string,\n\tcopilotTextController: CopilotTextController,\n\tcanEditSettings: boolean = false,\n): CopilotMenuItem[]\n{\n\treturn [\n\t\t{\n\t\t\tseparator: true,\n\t\t\ttitle: Loc.getMessage('AI_COPILOT_PROVIDER_MENU_SECTION'),\n\t\t\ttext: Loc.getMessage('AI_COPILOT_PROVIDER_MENU_SECTION'),\n\t\t},\n\t\t{\n\t\t\tcode: 'provider',\n\t\t\ttext: Loc.getMessage('AI_COPILOT_MENU_ITEM_OPEN_COPILOT'),\n\t\t\tchildren: CopilotProvidersMenuItems.getMenuItems({\n\t\t\t\tengines,\n\t\t\t\tselectedEngineCode,\n\t\t\t\tcanEditSettings,\n\t\t\t\tcopilotTextController,\n\t\t\t}),\n\t\t\ticon: Main.COPILOT_AI,\n\t\t},\n\t];\n}\n","import { EventEmitter } from 'main.core.events';\n\nexport type BaseMenuItemOptions = {\n\tcode: string;\n\ttext?: string;\n\thref?: string;\n\ticon?: string;\n\tchildren?: BaseMenuItem[],\n\tonClick?: Function;\n\tdisabled: boolean;\n}\n\nexport type BaseMenuItemGetOptions = {\n\tcode: string;\n\ttext: string;\n\ticon: string;\n\tcommand: Function;\n\tnotHighlight?: boolean;\n}\n\nexport class BaseMenuItem extends EventEmitter\n{\n\tcode: string;\n\ttext: string;\n\ticon: string;\n\thref: string;\n\tchildren: BaseMenuItem[];\n\tonClick: Function;\n\tnotHighlight: boolean;\n\tdisabled: boolean;\n\n\tconstructor(options: BaseMenuItemOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('AI.CopilotMenuItem');\n\n\t\tthis.code = options.code;\n\t\tthis.text = options.text;\n\t\tthis.icon = options.icon;\n\t\tthis.href = options.href;\n\t\tthis.children = options.children ?? [];\n\t\tthis.onClick = options.onClick;\n\t\tthis.disabled = options.disabled;\n\t}\n\n\tgetOptions(): BaseMenuItemGetOptions\n\t{\n\t\treturn {\n\t\t\tcode: this.code,\n\t\t\ttext: this.text,\n\t\t\ticon: this.icon,\n\t\t\thref: this.href,\n\t\t\tcommand: this.onClick,\n\t\t\tdisabled: this.disabled,\n\t\t\tchildren: this.children.map((childrenMenuItem) => {\n\t\t\t\tif (childrenMenuItem instanceof BaseMenuItem)\n\t\t\t\t{\n\t\t\t\t\treturn childrenMenuItem.getOptions();\n\t\t\t\t}\n\n\t\t\t\treturn childrenMenuItem;\n\t\t\t}),\n\t\t};\n\t}\n}\n","import { Loc, Reflection } from 'main.core';\nimport { BaseMenuItem, type BaseMenuItemOptions } from '../../../src/copilot-menu/copilot-menu-item';\nimport { Main } from 'ui.icon-set.api.core';\n\nimport 'ui.icon-set.main';\n\nexport class AboutCopilotMenuItem extends BaseMenuItem\n{\n\tconstructor(options: BaseMenuItemOptions)\n\t{\n\t\tsuper({\n\t\t\ttext: Loc.getMessage('AI_COPILOT_MENU_ITEM_ABOUT_COPILOT'),\n\t\t\ticon: Main.INFO,\n\t\t\tonClick: () => {\n\t\t\t\tconst articleCode = '19092894';\n\t\t\t\tconst Helper = Reflection.getClass('top.BX.Helper');\n\n\t\t\t\tif (Helper)\n\t\t\t\t{\n\t\t\t\t\tHelper.show(`redirect=detail&code=${articleCode}`);\n\t\t\t\t}\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Loc } from 'main.core';\nimport { Main } from 'ui.icon-set.api.core';\n\nimport { BaseMenuItem } from '../../../src/copilot-menu/copilot-menu-item';\nimport type { BaseMenuItemOptions } from '../../../src/copilot-menu/copilot-menu-item';\n\nexport class ChangeRequestMenuItem extends BaseMenuItem\n{\n\tconstructor(options: BaseMenuItemOptions)\n\t{\n\t\tsuper({\n\t\t\ttext: Loc.getMessage('AI_COPILOT_READONLY_COMMAND_EDIT'),\n\t\t\ticon: Main.EDIT_PENCIL,\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { type CopilotMenu } from 'ai.copilot';\nimport { type MenuItem } from 'main.popup';\nimport { Loc } from 'main.core';\n\nimport { BaseMenuItem, type BaseMenuItemOptions } from '../../../src/copilot-menu/copilot-menu-item';\n\ntype CopyResultMenuItemOptions = BaseMenuItemOptions & {\n\tgetText: Function;\n}\n\nexport class CopyResultMenuItem extends BaseMenuItem\n{\n\t#getText: Function;\n\n\tconstructor(options: CopyResultMenuItemOptions)\n\t{\n\t\tsuper({\n\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_COPY'),\n\t\t\tonClick: (event, menuItem: MenuItem, menu: CopilotMenu) => {\n\t\t\t\tconst isCopyingSuccess = BX.clipboard.copy(this.#getText());\n\n\t\t\t\tif (isCopyingSuccess === false)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tmenu.markMenuItemSelected(menuItem.getId());\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tmenu.unmarkMenuItemSelected(menuItem.getId());\n\t\t\t\t}, 800);\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\n\t\tthis.#getText = options.getText;\n\t}\n}\n","import { Loc, Runtime } from 'main.core';\nimport { Main } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.main';\n\nimport { BaseMenuItem, type BaseMenuItemOptions } from '../../../src/copilot-menu/copilot-menu-item';\nimport { CopilotTextControllerEngine } from '../copilot-text-controller-engine';\n\nexport type FeedbackMenuItemOptions = BaseMenuItemOptions & {\n\tonClick: Function;\n\tengine: CopilotTextControllerEngine;\n\tisBeforeGeneration: boolean;\n}\n\nexport class FeedbackMenuItem extends BaseMenuItem\n{\n\t#isOpenBeforeGeneration: boolean;\n\t#engine: CopilotTextControllerEngine;\n\n\tconstructor(options: FeedbackMenuItemOptions)\n\t{\n\t\tsuper({\n\t\t\tcode: 'feedback',\n\t\t\ticon: Main.FEEDBACK,\n\t\t\ttext: Loc.getMessage('AI_COPILOT_MENU_ITEM_AI_FEEDBACK'),\n\t\t\tonClick: async () => {\n\t\t\t\treturn this.#openFeedbackForm();\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\n\t\tthis.#isOpenBeforeGeneration = options.isBeforeGeneration;\n\t\tthis.#engine = options.engine;\n\t}\n\n\tasync #openFeedbackForm(): void\n\t{\n\t\tconst senderPagePreset = `${this.#engine.getCategory()},${this.#isOpenBeforeGeneration ? 'before' : 'after'}`;\n\t\tlet data = null;\n\n\t\tif (this.#isOpenBeforeGeneration === false)\n\t\t{\n\t\t\tdata = await this.#engine.getDataForFeedbackForm();\n\t\t}\n\n\t\tconst contextMessages = data?.context_messages?.length > 0 ? data?.context_messages : undefined;\n\t\tconst authorMessage = data?.author_message ?? undefined;\n\n\t\ttry\n\t\t{\n\t\t\tawait Runtime.loadExtension(['ui.feedback.form']);\n\n\t\t\tBX.UI.Feedback.Form.open(\n\t\t\t\t{\n\t\t\t\t\tid: 'ai.copilot.feedback',\n\t\t\t\t\tforms: [\n\t\t\t\t\t\t{ zones: ['es'], id: 684, lang: 'es', sec: 'svvq1x' },\n\t\t\t\t\t\t{ zones: ['en'], id: 686, lang: 'en', sec: 'tjwodz' },\n\t\t\t\t\t\t{ zones: ['de'], id: 688, lang: 'de', sec: 'nrwksg' },\n\t\t\t\t\t\t{ zones: ['com.br'], id: 690, lang: 'com.br', sec: 'kpte6m' },\n\t\t\t\t\t\t{ zones: ['ru', 'by', 'kz'], id: 692, lang: 'ru', sec: 'jbujn0' },\n\t\t\t\t\t],\n\t\t\t\t\tpresets: {\n\t\t\t\t\t\tsender_page: senderPagePreset,\n\t\t\t\t\t\tprompt_code: data?.prompt?.code,\n\t\t\t\t\t\tuser_message: data?.user_message,\n\t\t\t\t\t\toriginal_message: data?.original_message,\n\t\t\t\t\t\tauthor_message: authorMessage,\n\t\t\t\t\t\tcontext_messages: contextMessages,\n\t\t\t\t\t\tlast_result0: data?.current_result?.[1],\n\t\t\t\t\t\tlanguage: Loc.getMessage('LANGUAGE_ID'),\n\t\t\t\t\t\tcp_answer: data?.current_result?.[0],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t\tcatch (err)\n\t\t{\n\t\t\tconsole.error(err);\n\t\t}\n\t}\n}\n","import { Loc } from 'main.core';\nimport { BaseMenuItem, type BaseMenuItemOptions } from '../../../src/copilot-menu/copilot-menu-item';\nimport { Main } from 'ui.icon-set.api.core';\n\nimport 'ui.icon-set.main';\n\nexport class MarketMenuItem extends BaseMenuItem\n{\n\tconstructor(options: BaseMenuItemOptions)\n\t{\n\t\tsuper({\n\t\t\ticon: Main.MARKET_1,\n\t\t\ttext: Loc.getMessage('AI_COPILOT_SEARCH_IN_MARKET'),\n\t\t\thref: '/market/collection/ai_provider_partner_crm/',\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Loc } from 'main.core';\nimport { Main } from 'ui.icon-set.api.core';\n\nimport 'ui.icon-set.main';\n\nimport { BaseMenuItem } from '../../../src/copilot-menu/copilot-menu-item';\nimport type { BaseMenuItemOptions } from '../../../src/copilot-menu/copilot-menu-item';\n\nexport class OpenCopilotMenuItem extends BaseMenuItem\n{\n\tconstructor(options: BaseMenuItemOptions)\n\t{\n\t\tsuper({\n\t\t\tcode: 'open-copilot',\n\t\t\ticon: Main.COPILOT_AI,\n\t\t\ttext: Loc.getMessage('AI_COPILOT_MENU_ITEM_OPEN_COPILOT'),\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Main } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.main';\n\nimport type { BaseMenuItemGetOptions, BaseMenuItemOptions } from '../../../src/copilot-menu/copilot-menu-item';\nimport { BaseMenuItem } from '../../../src/copilot-menu/copilot-menu-item';\n\nexport type ProviderMenuItemOptions = BaseMenuItemOptions & {\n\tselected: boolean;\n}\n\ntype ProviderMenuItemGetOptions = BaseMenuItemGetOptions & {\n\tselected: boolean;\n}\n\nexport class ProviderMenuItem extends BaseMenuItem\n{\n\tselected: boolean;\n\tconstructor(options: ProviderMenuItemOptions)\n\t{\n\t\tsuper({\n\t\t\ticon: Main.ROBOT,\n\t\t\t...options,\n\t\t});\n\n\t\tthis.selected = options.selected === true;\n\t}\n\n\tgetOptions(): ProviderMenuItemGetOptions\n\t{\n\t\treturn {\n\t\t\t...super.getOptions(),\n\t\t\tselected: this.selected,\n\t\t};\n\t}\n}\n","import { Loc } from 'main.core';\nimport { BaseMenuItem, type BaseMenuItemOptions } from '../../../src/copilot-menu/copilot-menu-item';\nimport { Actions } from 'ui.icon-set.api.core';\n\nimport 'ui.icon-set.main';\nexport class RepeatCopilotMenuItem extends BaseMenuItem\n{\n\tconstructor(options: BaseMenuItemOptions)\n\t{\n\t\tsuper({\n\t\t\ticon: Actions.LEFT_SEMICIRCULAR_ANTICLOCKWISE_ARROW_1,\n\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_REPEAT'),\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Extension, Loc } from 'main.core';\nimport { Main } from 'ui.icon-set.api.core';\n\nimport 'ui.icon-set.main';\n\nimport { BaseMenuItem } from '../../../src/copilot-menu/copilot-menu-item';\nimport type { BaseMenuItemOptions } from '../../../src/copilot-menu/copilot-menu-item';\n\nexport class SettingsMenuItem extends BaseMenuItem\n{\n\tconstructor(options: BaseMenuItemOptions)\n\t{\n\t\tconst settingsPageLink = Extension.getSettings('ai.copilot.copilot-text-controller').settingsPageLink;\n\n\t\tsuper({\n\t\t\ttext: Loc.getMessage('AI_COPILOT_MENU_ITEM_AI_SETTINGS'),\n\t\t\ticon: Main.SETTINGS,\n\t\t\thref: settingsPageLink,\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Loc } from 'main.core';\nimport { BaseMenuItem, type BaseMenuItemOptions } from '../../../src/copilot-menu/copilot-menu-item';\nimport { Actions } from 'ui.icon-set.api.core';\n\nimport 'ui.icon-set.main';\n\nexport class CancelCopilotMenuItem extends BaseMenuItem\n{\n\tconstructor(options: BaseMenuItemOptions)\n\t{\n\t\tsuper({\n\t\t\ticon: Actions.CROSS_45,\n\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_CANCEL'),\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Loc } from 'main.core';\nimport { Actions } from 'ui.icon-set.api.core';\nimport { BaseMenuItem, type BaseMenuItemOptions } from '../../../src/copilot-menu/copilot-menu-item';\n\nexport class ConnectModelMenuItem extends BaseMenuItem\n{\n\tconstructor(options: BaseMenuItemOptions)\n\t{\n\t\tsuper({\n\t\t\ticon: Actions.PLUS_50,\n\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_CONNECT_AI'),\n\t\t\tdisabled: true,\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { type Role, type Engine, type GetToolingResultData, Text as PayloadText, type Prompt } from 'ai.engine';\nimport { Dom, Type, Loc, Runtime, Extension } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Popup, PopupManager } from 'main.popup';\nimport type { CopilotInput, CopilotInputEvents, CopilotMenu, CopilotMenuEvents, CopilotMenuItem, CopilotResult } from 'ai.copilot';\nimport type { CopilotAnalytics } from '../../src/copilot-analytics';\nimport { type CopilotMenuItemRoleInfo } from '../../src/copilot-menu/copilot-menu';\nimport type { CopilotWarningResultField } from '../../src/copilot-warning-result-field';\nimport { CopilotTextControllerEngine } from './copilot-text-controller-engine';\nimport type { RolesDialog as RolesDialogType, RolesDialogOptions, SelectRoleEventDataType } from 'ai.roles-dialog';\n\nimport { EditResultCommand, OpenFeedbackFormCommand } from './menu-item-commands/index';\nimport { CopilotErrorMenuItems } from './menu-items/copilot-error-menu-items';\nimport { CopilotProvidersMenuItems } from './menu-items/copilot-providers-menu-items';\nimport { CopilotResultMenuItems } from './menu-items/copilot-result-menu-items';\nimport type { EngineInfo } from './types/engine-info';\nimport { CopilotGeneralMenuItems } from './menu-items/copilot-general-menu-items';\nimport { AjaxErrorHandler } from 'ai.ajax-error-handler';\n\nexport * from './menu-item/index';\nexport {\n\tCopilotTextControllerEngine,\n};\n\ntype CopilotTextControllerOptions = {\n\tengine: Engine;\n\tinputField: CopilotInput;\n\tcategory: string;\n\tselectedText: string;\n\tcontext: string;\n\treadonly: boolean;\n\tresultField: any;\n\tcopilotPopup: Popup;\n\twarningField: CopilotWarningResultField;\n\taddImageMenuItem: boolean;\n\tcopilotInputEvents: CopilotInputEvents;\n\tcopilotMenu: CopilotMenu;\n\tcopilotMenuEvents: CopilotMenuEvents;\n\tanalytics: CopilotAnalytics;\n}\n\nexport class CopilotTextController extends EventEmitter\n{\n\t#engine: Engine;\n\t#inputField: CopilotInput;\n\t#resultField: CopilotResult;\n\t#copilotContainer: HTMLElement;\n\t#category: string;\n\t#readonly: boolean;\n\t#selectedEngineCode: string;\n\t#selectedPromptCodeWithSimpleTemplate: string;\n\t#generalMenu: CopilotMenu;\n\t#resultMenu: CopilotMenu;\n\t#errorMenu: CopilotMenu;\n\t#selectedText: string;\n\t#context: string;\n\t#resultStack: [] = [];\n\t#currentGenerateRequestId: number;\n\t#errorsCount: number = 0;\n\t#generationResultText: string | null = null;\n\t#warningField: CopilotWarningResultField;\n\t#addImageMenuItem: boolean;\n\t#copilotInputEvents: CopilotInputEvents;\n\t#CopilotMenu: CopilotMenu;\n\t#copilotMenuEvents: CopilotMenuEvents;\n\t#analytics: CopilotAnalytics;\n\t#currentRole: Role;\n\t#rolesDialog: RolesDialogType;\n\n\t#inputFieldContainerClickEventHandler: Function;\n\t#inputFieldSubmitEventHandler: Function;\n\t#inputFieldInputEventHandler: Function;\n\t#inputFieldGoOutFromBottomEventHandler: Function;\n\t#inputFieldStartRecordingEventHandler: Function;\n\t#inputFieldStopRecordingEventHandler: Function;\n\t#inputFieldCancelLoadingEventHandler: Function;\n\t#inputFieldAdjustHeightEventHandler: Function;\n\n\tstatic #toolingDataByCategory: {data: GetToolingResultData} = {};\n\n\tconstructor(options: CopilotTextControllerOptions)\n\t{\n\t\tsuper();\n\n\t\tthis.#engine = options.engine;\n\t\tthis.#inputField = options.inputField;\n\t\tthis.#category = options.category;\n\t\tthis.#resultField = options.resultField;\n\t\tthis.#readonly = options.readonly === true;\n\t\tthis.#warningField = options.warningField;\n\t\tthis.#context = options.context;\n\t\tthis.#selectedText = options.selectedText;\n\t\tthis.#addImageMenuItem = options.addImageMenuItem === true;\n\t\tthis.#copilotInputEvents = options.copilotInputEvents;\n\t\tthis.#CopilotMenu = options.copilotMenu;\n\t\tthis.#copilotMenuEvents = options.copilotMenuEvents;\n\t\tthis.#analytics = options.analytics;\n\n\t\tthis.#inputFieldContainerClickEventHandler = this.#handleInputContainerClickEvent.bind(this);\n\t\tthis.#inputFieldSubmitEventHandler = this.#handleInputFieldSubmitEvent.bind(this);\n\t\tthis.#inputFieldInputEventHandler = this.#handleInputFieldInputEvent.bind(this);\n\t\tthis.#inputFieldGoOutFromBottomEventHandler = this.#handleInputFieldGoOutFromBottomEvent.bind(this);\n\t\tthis.#inputFieldStartRecordingEventHandler = this.#handleInputFieldStartRecordingEvent.bind(this);\n\t\tthis.#inputFieldStopRecordingEventHandler = this.#handleInputFieldStopRecordingEvent.bind(this);\n\t\tthis.#inputFieldCancelLoadingEventHandler = this.#handleInputFieldCancelLoadingEvent.bind(this);\n\t\tthis.#inputFieldAdjustHeightEventHandler = this.#handleInputFieldAdjustHeightEvent.bind(this);\n\n\t\tthis.setEventNamespace('AI.Copilot.TextController');\n\t}\n\n\tsetSelectedPromptCodeWithSimpleTemplate(code: string): void\n\t{\n\t\tthis.#selectedPromptCodeWithSimpleTemplate = code;\n\t}\n\n\tgetSelectedPromptCodeWithSimpleTemplate(): ?string\n\t{\n\t\treturn this.#selectedPromptCodeWithSimpleTemplate;\n\t}\n\n\tsetCopilotContainer(copilotContainer: HTMLElement): void\n\t{\n\t\tthis.#copilotContainer = copilotContainer;\n\t}\n\n\tsetSelectedText(text: string): void\n\t{\n\t\tif (Type.isString(text))\n\t\t{\n\t\t\tthis.#selectedText = text;\n\t\t}\n\t}\n\n\tgetSelectedText(): string\n\t{\n\t\treturn this.#selectedText;\n\t}\n\n\tsetContext(text: string): void\n\t{\n\t\tthis.#context = text;\n\t}\n\n\tgetContext(): string\n\t{\n\t\treturn this.#context;\n\t}\n\n\tsetSelectedEngine(engineCode: string): void\n\t{\n\t\tthis.#setSelectedEngine(engineCode);\n\t}\n\n\tsetExtraMarkers(extraMarkers: Object = {}): void\n\t{\n\t\tconst payload = this.#engine?.getPayload() || new PayloadText();\n\n\t\tpayload.setMarkers({\n\t\t\t...payload.getMarkers(),\n\t\t\t...extraMarkers,\n\t\t});\n\n\t\tthis.#engine.setPayload(payload);\n\t}\n\n\tasync init(): void\n\t{\n\t\tif (CopilotTextController.#toolingDataByCategory[this.#category] === undefined)\n\t\t{\n\t\t\tCopilotTextController.#toolingDataByCategory[this.#category] = this.#engine.getTooling('text');\n\t\t}\n\n\t\tconst res = await CopilotTextController.#toolingDataByCategory[this.#category];\n\t\tCopilotTextController.#toolingDataByCategory[this.#category] = res;\n\n\t\tthis.#selectedEngineCode = this.#getSelectedEngineCode(res.data.engines);\n\n\t\tthis.#currentRole = res.data.role;\n\t}\n\n\topenGeneralMenu(): void\n\t{\n\t\tif (!this.#generalMenu)\n\t\t{\n\t\t\tthis.#initGeneralMenu();\n\t\t}\n\t\tthis.#generalMenu.getPopup().subscribeFromOptions({\n\t\t\tonBeforeShow: () => {\n\t\t\t\tif (this.#readonly)\n\t\t\t\t{\n\t\t\t\t\tthis.#inputField.disable();\n\t\t\t\t}\n\t\t\t},\n\t\t\tonAfterShow: () => {\n\t\t\t\tif (this.#readonly === false)\n\t\t\t\t{\n\t\t\t\t\tthis.#inputField.enable();\n\t\t\t\t\tthis.#inputField.focus();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t\tthis.#generalMenu.setBindElement(this.#copilotContainer, { top: 8 });\n\t\tthis.#generalMenu.open();\n\t\tthis.#generalMenu.show();\n\t}\n\n\tclearResultStack(): void\n\t{\n\t\tthis.#resultStack = [];\n\t}\n\n\tshowMenu(): void\n\t{\n\t\tthis.#resultMenu?.show();\n\t\tthis.#errorMenu?.show();\n\t\tthis.#generalMenu?.show();\n\t}\n\n\tgetOpenMenu(): CopilotMenu | null\n\t{\n\t\tif (this.#generalMenu?.isShown())\n\t\t{\n\t\t\treturn this.#generalMenu;\n\t\t}\n\n\t\tif (this.#errorMenu?.isShown())\n\t\t{\n\t\t\treturn this.#errorMenu;\n\t\t}\n\n\t\tif (this.#resultMenu?.isShown())\n\t\t{\n\t\t\treturn this.#resultMenu;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetAiResultText(): string\n\t{\n\t\treturn this.#generationResultText;\n\t}\n\n\tgetCategory(): string\n\t{\n\t\treturn this.#category;\n\t}\n\n\tgetLastCommandCode(): string\n\t{\n\t\treturn this.#engine.getPayload().getRawData()?.prompt?.code || '';\n\t}\n\n\tisContainsElem(elem: HTMLElement): boolean\n\t{\n\t\treturn this.#generalMenu?.contains(elem) || this.#errorMenu?.contains(elem) || this.#resultMenu?.contains(elem);\n\t}\n\n\tgenerateWithRequiredUserMessage(commandCode: string): void\n\t{\n\t\tthis.#setEnginePayload({\n\t\t\tcommand: commandCode,\n\t\t\tmarkers: {\n\t\t\t\toriginalMessage: this.#selectedText || this.#context,\n\t\t\t\tuserMessage: this.#inputField.getValue(),\n\t\t\t},\n\t\t});\n\n\t\tthis.setSelectedPromptCodeWithSimpleTemplate(commandCode);\n\n\t\tconst prompt = this.#getPromptByCode(this.#getTooling().prompts, commandCode);\n\n\t\tif (prompt)\n\t\t{\n\t\t\tthis.#inputField.setHtmlContent(prompt.text);\n\t\t}\n\n\t\tthis.#inputField.focus(true);\n\t}\n\n\tgenerateWithoutRequiredUserMessage(commandCode: string, prompts: Prompt[]): void\n\t{\n\t\tthis.#setEnginePayload({\n\t\t\tcommand: commandCode,\n\t\t\tmarkers: {\n\t\t\t\toriginalMessage: this.#selectedText || this.#context,\n\t\t\t\tuserMessage: this.#inputField.getValue(),\n\t\t\t},\n\t\t});\n\n\t\tconst commandTextForInputField = this.#getPromptTitleByCommandFromPrompts(prompts, commandCode);\n\n\t\tthis.#inputField.setValue(commandTextForInputField);\n\t\tthis.generate();\n\t}\n\n\thideAllMenus(): void\n\t{\n\t\tthis.#rolesDialog?.hide();\n\t\tthis.#rolesDialog = null;\n\n\t\tthis.#generalMenu?.hide();\n\t\tthis.#errorMenu?.hide();\n\t\tthis.#resultMenu?.hide();\n\t}\n\n\tdestroyAllMenus(): void\n\t{\n\t\tthis.#rolesDialog?.hide();\n\t\tthis.#rolesDialog = null;\n\n\t\tthis.#generalMenu?.close();\n\t\tthis.#errorMenu?.close();\n\t\tthis.#resultMenu?.close();\n\n\t\tthis.#generalMenu = null;\n\t\tthis.#errorMenu = null;\n\t\tthis.#resultMenu = null;\n\t}\n\n\tstart(): void\n\t{\n\t\tthis.openGeneralMenu();\n\t\tthis.#subscribeToInputFieldEvents();\n\t}\n\n\tisFirstLaunch(): boolean\n\t{\n\t\treturn this.#getTooling().first_launch;\n\t}\n\n\tfinish(): void\n\t{\n\t\tthis.reset();\n\t\tthis.destroyAllMenus();\n\t\tthis.#unsubscribeToInputFieldEvents();\n\t}\n\n\treset(): void\n\t{\n\t\tthis.#selectedText = '';\n\t\tthis.#context = '';\n\t\tthis.#currentGenerateRequestId = -1;\n\t\tthis.#resultStack = [];\n\n\t\tthis.#inputField?.clear();\n\t}\n\n\tisInitFinished(): boolean\n\t{\n\t\treturn Boolean(this.#getTooling());\n\t}\n\n\tisPromptsLoaded(): boolean\n\t{\n\t\treturn Boolean(this.#getTooling()?.prompts);\n\t}\n\n\tclearResultField(): void\n\t{\n\t\tthis.#resultField.clearResult();\n\t\tthis.#adjustMenus();\n\t}\n\n\tisReadonly(): boolean\n\t{\n\t\treturn this.#readonly === true;\n\t}\n\n\t#subscribeToInputFieldEvents(): void\n\t{\n\t\tthis.#inputField.subscribe(this.#copilotInputEvents.containerClick, this.#inputFieldContainerClickEventHandler);\n\t\tthis.#inputField.subscribe(this.#copilotInputEvents.submit, this.#inputFieldSubmitEventHandler);\n\t\tthis.#inputField.subscribe(this.#copilotInputEvents.input, this.#inputFieldInputEventHandler);\n\t\tthis.#inputField.subscribe(this.#copilotInputEvents.goOutFromBottom, this.#inputFieldGoOutFromBottomEventHandler);\n\t\tthis.#inputField.subscribe(this.#copilotInputEvents.startRecording, this.#inputFieldStartRecordingEventHandler);\n\t\tthis.#inputField.subscribe(this.#copilotInputEvents.stopRecording, this.#inputFieldStopRecordingEventHandler);\n\t\tthis.#inputField.subscribe(this.#copilotInputEvents.cancelLoading, this.#inputFieldCancelLoadingEventHandler);\n\t\tthis.#inputField.subscribe(this.#copilotInputEvents.adjustHeight, this.#inputFieldAdjustHeightEventHandler);\n\t}\n\n\t#unsubscribeToInputFieldEvents(): void\n\t{\n\t\tthis.#inputField.unsubscribe(this.#copilotInputEvents.containerClick, this.#inputFieldContainerClickEventHandler);\n\t\tthis.#inputField.unsubscribe(this.#copilotInputEvents.submit, this.#inputFieldSubmitEventHandler);\n\t\tthis.#inputField.unsubscribe(this.#copilotInputEvents.input, this.#inputFieldInputEventHandler);\n\t\tthis.#inputField.unsubscribe(this.#copilotInputEvents.goOutFromBottom, this.#inputFieldGoOutFromBottomEventHandler);\n\t\tthis.#inputField.unsubscribe(this.#copilotInputEvents.startRecording, this.#inputFieldStartRecordingEventHandler);\n\t\tthis.#inputField.unsubscribe(this.#copilotInputEvents.stopRecording, this.#inputFieldStopRecordingEventHandler);\n\t\tthis.#inputField.unsubscribe(this.#copilotInputEvents.cancelLoading, this.#inputFieldCancelLoadingEventHandler);\n\t\tthis.#inputField.unsubscribe(this.#copilotInputEvents.adjustHeight, this.#inputFieldAdjustHeightEventHandler);\n\t}\n\n\t#handleInputContainerClickEvent(): void\n\t{\n\t\tif (this.#inputField.isDisabled() && this.#resultMenu?.isShown() && this.#readonly === false)\n\t\t{\n\t\t\tconst editCommand = new EditResultCommand({\n\t\t\t\tcopilotTextController: this,\n\t\t\t\tinputField: this.#inputField,\n\t\t\t});\n\n\t\t\teditCommand.execute();\n\t\t}\n\t}\n\n\t#handleInputFieldGoOutFromBottomEvent(): void\n\t{\n\t\tthis.#generalMenu.enableArrowsKey();\n\t}\n\n\t#handleInputFieldInputEvent(e: BaseEvent): void\n\t{\n\t\tconst text: string = e.getData();\n\n\t\tif (!text)\n\t\t{\n\t\t\tthis.#selectedPromptCodeWithSimpleTemplate = null;\n\t\t}\n\n\t\tthis.#generalMenu?.disableArrowsKey();\n\n\t\trequestAnimationFrame(() => {\n\t\t\tthis.#adjustMenus();\n\t\t});\n\t}\n\n\t#handleInputFieldStartRecordingEvent(): void\n\t{\n\t\tthis.#generalMenu?.hide();\n\t}\n\n\t// eslint-disable-next-line consistent-return\n\tasync getDataForFeedbackForm(): Promise<any>\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst feedDataResult = await this.#engine.getFeedbackData();\n\t\t\tconst messages = feedDataResult.data.context_messages;\n\t\t\tconst authorMessage = feedDataResult.data.original_message;\n\t\t\tconst payload = this.#engine.getPayload();\n\n\t\t\treturn payload ? {\n\t\t\t\tcontext_messages: messages,\n\t\t\t\tauthor_message: authorMessage,\n\t\t\t\t...payload.getRawData(),\n\t\t\t\t...payload.getMarkers(),\n\t\t\t} : {};\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error(error);\n\t\t\tconst payload = this.#engine.getPayload();\n\n\t\t\treturn payload ? {\n\t\t\t\t...payload.getRawData(),\n\t\t\t\t...payload.getMarkers(),\n\t\t\t} : {};\n\t\t}\n\t}\n\n\t#handleInputFieldStopRecordingEvent(): void\n\t{\n\t\tthis.#generalMenu?.show();\n\t}\n\n\t#handleInputFieldCancelLoadingEvent(): void\n\t{\n\t\tthis.#currentGenerateRequestId = -1;\n\t\tthis.#inputField.finishGenerating();\n\t\tthis.#inputField.focus();\n\t\tif (this.#readonly)\n\t\t{\n\t\t\tthis.#inputField.clear();\n\t\t}\n\n\t\tthis.openGeneralMenu();\n\t}\n\n\t#handleInputFieldAdjustHeightEvent(): void\n\t{\n\t\tsetTimeout(() => {\n\t\t\t// this.#adjustMenus();\n\t\t}, 150);\n\t}\n\n\t#handleInputFieldSubmitEvent(): void\n\t{\n\t\tconst userPrompt = this.#inputField.getValue();\n\n\t\tif (!userPrompt)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#setEnginePayload({\n\t\t\tcommand: this.#selectedPromptCodeWithSimpleTemplate || 'zero_prompt',\n\t\t\tmarkers: {\n\t\t\t\tuserMessage: userPrompt,\n\t\t\t\toriginalMessage: this.#selectedText || this.#context || '',\n\t\t\t\tcurrent_result: this.#resultStack,\n\t\t\t},\n\t\t});\n\n\t\tthis.generate();\n\t}\n\n\t#adjustMenus(): void\n\t{\n\t\tthis.#generalMenu?.adjustPosition();\n\t}\n\n\t#getTooling(): GetToolingResultData\n\t{\n\t\treturn CopilotTextController.#toolingDataByCategory[this.#category]?.data;\n\t}\n\n\t#getSelectedEngineCode(engines: EngineInfo[]): string | undefined\n\t{\n\t\tconst selectedEngine = engines.find((engine: EngineInfo) => engine.selected);\n\n\t\treturn selectedEngine?.code || engines[0]?.code;\n\t}\n\n\t#initGeneralMenu()\n\t{\n\t\tconst { prompts, engines, permissions } = this.#getTooling();\n\n\t\tthis.#generalMenu = new this.#CopilotMenu({\n\t\t\troleInfo: this.#getRoleInfoForMenu({\n\t\t\t\twithOpenRolesDialogAction: true,\n\t\t\t\tsubtitle: Loc.getMessage('AI_COPILOT_GENERAL_MENU_ROLE_SUBTITLE'),\n\t\t\t}),\n\t\t\titems: CopilotGeneralMenuItems.getMenuItems({\n\t\t\t\tprompts,\n\t\t\t\tengines,\n\t\t\t\tselectedEngineCode: this.#selectedEngineCode,\n\t\t\t\tcanEditSettings: permissions.can_edit_settings === true,\n\t\t\t\tcopilotTextController: this,\n\t\t\t\taddImageMenuItem: this.#addImageMenuItem,\n\t\t\t}),\n\t\t\tkeyboardControlOptions: {\n\t\t\t\tclearHighlightAfterType: this.#readonly === false,\n\t\t\t\tcanGoOutFromTop: this.#readonly === false,\n\t\t\t\thighlightFirstItemAfterShow: this.#readonly === true,\n\t\t\t},\n\t\t\tforceTop: true,\n\t\t\tcacheable: false,\n\n\t\t});\n\n\t\tthis.#generalMenu.subscribe(this.#copilotMenuEvents.clearHighlight, () => {\n\t\t\tthis.#generalMenu?.disableArrowsKey();\n\t\t\tthis.#inputField.enableEnterAndArrows();\n\t\t});\n\n\t\tthis.#generalMenu.subscribe(this.#copilotMenuEvents.highlightMenuItem, () => {\n\t\t\tthis.#generalMenu?.enableArrowsKey();\n\t\t\tthis.#inputField.disableEnterAndArrows();\n\t\t});\n\t}\n\n\tasync #showRolesDialog(): Promise<void>\n\t{\n\t\tif (this.#rolesDialog)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tawait Runtime.loadExtension('ui.vue3');\n\t\tconst { RolesDialog, RolesDialogEvents } = await Runtime.loadExtension('ai.roles-dialog');\n\t\tconst dialogOptions: RolesDialogOptions = {\n\t\t\tmoduleId: this.#engine.getModuleId(),\n\t\t\tcontextId: this.#engine.getContextId(),\n\t\t\tselectedRoleCode: this.#currentRole?.code,\n\t\t\ttitle: Loc.getMessage('AI_COPILOT_ROLES_DIALOG_TITLE'),\n\t\t};\n\n\t\tthis.#rolesDialog = new RolesDialog(dialogOptions);\n\n\t\tthis.#rolesDialog.subscribe(RolesDialogEvents.SELECT_ROLE, (e: BaseEvent<SelectRoleEventDataType>) => {\n\t\t\tconst role: SelectRoleEventDataType = e.getData().role;\n\n\t\t\tthis.#currentRole = role;\n\n\t\t\tthis.#generalMenu?.updateRoleInfo(role);\n\t\t\tif (this.#rolesDialog?.hide)\n\t\t\t{\n\t\t\t\tthis.#rolesDialog.hide();\n\t\t\t}\n\t\t});\n\n\t\tthis.#rolesDialog.subscribe(RolesDialogEvents.HIDE, () => {\n\t\t\tthis.#rolesDialog = null;\n\t\t});\n\n\t\treturn this.#rolesDialog.show();\n\t}\n\n\t#getPromptTitleByCommandFromPrompts(prompts: Prompt[], command: string): string\n\t{\n\t\tlet result = '';\n\n\t\tfor (const currentPrompt of prompts)\n\t\t{\n\t\t\tif (currentPrompt.code === command)\n\t\t\t{\n\t\t\t\tresult = currentPrompt.title;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tconst promptChildren = currentPrompt.children;\n\n\t\t\tif (promptChildren && promptChildren.length > 0)\n\t\t\t{\n\t\t\t\tconst promptTitle = this.#getPromptTitleByCommandFromPrompts(promptChildren, command);\n\t\t\t\tif (promptTitle)\n\t\t\t\t{\n\t\t\t\t\tresult = `${currentPrompt.title} - ${promptTitle}`;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#setEnginePayload(options = {}): void\n\t{\n\t\tconst command = options.command || '';\n\t\tconst markers = options.markers || {};\n\t\tconst userMessage = markers.userMessage || undefined;\n\t\tconst originalMessage = markers.originalMessage || undefined;\n\n\t\tconst payload = new PayloadText({\n\t\t\tprompt: {\n\t\t\t\tcode: command,\n\t\t\t},\n\t\t\tengineCode: this.#selectedEngineCode,\n\t\t\troleCode: this.#useRole() ? this.#currentRole?.code : undefined,\n\t\t});\n\n\t\tconst oldPayloadMarkers = this.#engine.getPayload()?.getMarkers() ?? {};\n\n\t\tpayload.setMarkers({\n\t\t\t...oldPayloadMarkers,\n\t\t\toriginal_message: this.#isCommandRequiredContextMessage(command) ? originalMessage : undefined,\n\t\t\tuser_message: this.#isCommandRequiredUserMessage(command) ? userMessage : undefined,\n\t\t\tcurrent_result: this.#resultStack,\n\t\t\t// role: this.#useRole() ? this.#currentRole?.code : undefined,\n\t\t});\n\n\t\tthis.#engine.setPayload(payload);\n\n\t\tconst analytic = this.getAnalytics();\n\n\t\tthis.#engine.setAnalyticParameters({\n\t\t\tcategory: analytic.getCategory(),\n\t\t\ttype: analytic.getType(),\n\t\t\tc_sub_section: analytic.getCSubSection(),\n\t\t\tc_element: analytic.getCElement(),\n\t\t});\n\t}\n\n\t#isCommandRequiredUserMessage(commandCode): boolean\n\t{\n\t\tconst prompts = this.#getTooling().prompts;\n\t\tconst searchPrompt: Prompt | undefined = this.#getPromptByCode(prompts, commandCode);\n\n\t\tif (!searchPrompt)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn searchPrompt.required.user_message;\n\t}\n\n\t#isCommandRequiredContextMessage(commandCode): boolean\n\t{\n\t\tconst prompts = this.#getTooling().prompts;\n\t\tconst searchPrompt: Prompt | undefined = this.#getPromptByCode(prompts, commandCode);\n\n\t\tif (!searchPrompt)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn searchPrompt.required.context_message;\n\t}\n\n\t#getPromptByCode(prompts: Prompt[], commandCode: string): Prompt | null\n\t{\n\t\tlet searchPrompt = null;\n\n\t\tprompts.some((prompt: Prompt) => {\n\t\t\tif (prompt.code === commandCode)\n\t\t\t{\n\t\t\t\tsearchPrompt = prompt;\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn prompt.children?.some((childrenPrompt) => {\n\t\t\t\tif (childrenPrompt.code === commandCode)\n\t\t\t\t{\n\t\t\t\t\tsearchPrompt = childrenPrompt;\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t});\n\t\t});\n\n\t\treturn searchPrompt;\n\t}\n\n\t#setSelectedEngine(engineCode: string): void\n\t{\n\t\tconst data = this.#getTooling();\n\t\tthis.#selectedEngineCode = engineCode;\n\n\t\tthis.#generalMenu.replaceMenuItemSubmenu({\n\t\t\tcode: 'provider',\n\t\t\tchildren: CopilotProvidersMenuItems.getMenuItems({\n\t\t\t\tengines: data.engines,\n\t\t\t\tselectedEngineCode: engineCode,\n\t\t\t\tcanEditSettings: data.permissions.can_edit_settings,\n\t\t\t\tcopilotTextController: this,\n\t\t\t}),\n\t\t});\n\t}\n\n\tasync generate(): Promise<void>\n\t{\n\t\tthis.#inputField.startGenerating();\n\t\tDom.removeClass(this.#copilotContainer, '--error');\n\t\tthis.destroyAllMenus();\n\n\t\tconst id = Math.round(Math.random() * 10000);\n\n\t\tthis.#currentGenerateRequestId = id;\n\n\t\ttry\n\t\t{\n\t\t\tconst res = await this.#engine.textCompletions();\n\n\t\t\tconst result = res.data.result || res.data.last.data;\n\t\t\tif (this.#currentGenerateRequestId !== id)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#inputField.finishGenerating();\n\t\t\tthis.#inputField.disable();\n\n\t\t\tthis.#generationResultText = res.data.result;\n\n\t\t\tif (this.#selectedText || this.#readonly)\n\t\t\t{\n\t\t\t\tthis.#resultField?.clearResult();\n\t\t\t\tthis.#resultField?.addResult(this.#generationResultText);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.emit('aiResult', {\n\t\t\t\t\tresult,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.#addResultToStack(result);\n\n\t\t\tthis.#warningField?.expand();\n\t\t\tthis.#openResultMenu();\n\t\t}\n\t\tcatch (res)\n\t\t{\n\t\t\tif (this.#currentGenerateRequestId !== id)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getAnalytics().sendEventError();\n\n\t\t\tthis.#handleGenerateError(res);\n\t\t}\n\t}\n\n\t#addResultToStack(result: string): void\n\t{\n\t\tconst stackSize = 3;\n\n\t\tthis.#resultStack.unshift(result);\n\t\tif (this.#resultStack.length > stackSize)\n\t\t{\n\t\t\tthis.#resultStack.pop();\n\t\t}\n\t}\n\n\t// eslint-disable-next-line max-lines-per-function\n\t#handleGenerateError(res): void\n\t{\n\t\tconst maxGenerateRestartErrors = 4;\n\t\tconst firstErrorCode = res?.errors?.[0]?.code;\n\n\t\tif (res instanceof Error)\n\t\t{\n\t\t\tthis.#inputField.setErrors([{\n\t\t\t\tmessage: res.message,\n\t\t\t\tcode: -1,\n\t\t\t\tcustomData: {},\n\t\t\t}]);\n\t\t}\n\t\telse if (Type.isString(res))\n\t\t{\n\t\t\tthis.#inputField.setErrors([{\n\t\t\t\tmessage: res,\n\t\t\t\tcode: -1,\n\t\t\t\tcustomData: {},\n\t\t\t}]);\n\t\t}\n\t\telse if (firstErrorCode === 100 && this.#errorsCount < maxGenerateRestartErrors)\n\t\t{\n\t\t\tthis.#errorsCount += 1;\n\n\t\t\tthis.generate();\n\n\t\t\treturn;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tswitch (firstErrorCode)\n\t\t\t{\n\t\t\t\tcase 'AI_ENGINE_ERROR_OTHER': {\n\t\t\t\t\tconst command = new OpenFeedbackFormCommand({\n\t\t\t\t\t\tcategory: this.getCategory(),\n\t\t\t\t\t\tisBeforeGeneration: false,\n\t\t\t\t\t\tcopilotTextController: this,\n\t\t\t\t\t});\n\t\t\t\t\tres.errors[0].customData = {\n\t\t\t\t\t\tclickHandler: () => command.execute(),\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.#inputField.setErrors([{\n\t\t\t\t\t\tcode: 'AI_ENGINE_ERROR_OTHER',\n\t\t\t\t\t\tmessage: Loc.getMessage('AI_COPILOT_ERROR_OTHER'),\n\t\t\t\t\t\tcustomData: {\n\t\t\t\t\t\t\tclickHandler: () => command.execute(),\n\t\t\t\t\t\t},\n\t\t\t\t\t}]);\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase 'AI_ENGINE_ERROR_PROVIDER': {\n\t\t\t\t\tthis.#inputField.setErrors([{\n\t\t\t\t\t\tcode: 'AI_ENGINE_ERROR_PROVIDER',\n\t\t\t\t\t\tmessage: Loc.getMessage('AI_COPILOT_ERROR_PROVIDER'),\n\t\t\t\t\t}]);\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase 'LIMIT_IS_EXCEEDED_BAAS': {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tdefault: {\n\t\t\t\t\tthis.#inputField.setErrors(res.errors);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.#errorsCount = 0;\n\n\t\tthis.#inputField.finishGenerating();\n\n\t\tif (firstErrorCode === 'LIMIT_IS_EXCEEDED_BAAS')\n\t\t{\n\t\t\tthis.#inputField.disable();\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst baasPopup = PopupManager.getPopups().find((popup) => popup.getId().includes('baas'));\n\n\t\t\t\tif (!baasPopup)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst baasPopupAutoHide = baasPopup.autoHide;\n\n\t\t\t\tbaasPopup.subscribe('onClose', (e) => {\n\t\t\t\t\tbaasPopup.setAutoHide(baasPopupAutoHide);\n\t\t\t\t});\n\n\t\t\t\tbaasPopup?.setAutoHide(false);\n\t\t\t}, 200);\n\t\t}\n\t\telse if (firstErrorCode === 'LIMIT_IS_EXCEEDED_MONTHLY'\n\t\t\t|| firstErrorCode === 'LIMIT_IS_EXCEEDED_DAILY'\n\t\t\t|| firstErrorCode === 'SERVICE_IS_NOT_AVAILABLE_BY_TARIFF'\n\t\t)\n\t\t{\n\t\t\tthis.emit('close');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#initErrorMenu();\n\t\t\tthis.#errorMenu.adjustPosition();\n\t\t\tthis.#errorMenu.open();\n\t\t\tDom.addClass(this.#copilotContainer, '--error');\n\t\t}\n\n\t\tAjaxErrorHandler.handleTextGenerateError({\n\t\t\tbaasOptions: {\n\t\t\t\tbindElement: this.#inputField.getContainer().querySelector('.ai__copilot_input-field-baas-point'),\n\t\t\t\tcontext: this.#engine.getContextId(),\n\t\t\t\tuseAngle: false,\n\t\t\t},\n\t\t\terrorCode: firstErrorCode,\n\t\t});\n\t}\n\n\t#initErrorMenu(): void\n\t{\n\t\tthis.#errorMenu = new this.#CopilotMenu({\n\t\t\tbindElement: this.#copilotContainer,\n\t\t\toffsetTop: 8,\n\t\t\titems: CopilotErrorMenuItems.getMenuItems({\n\t\t\t\tinputField: this.#inputField,\n\t\t\t\tcopilotTextController: this,\n\t\t\t\tcopilotContainer: this.#copilotContainer,\n\t\t\t}),\n\t\t\tkeyboardControlOptions: {\n\t\t\t\tcanGoOutFromTop: false,\n\t\t\t\thighlightFirstItemAfterShow: true,\n\t\t\t\tclearHighlightAfterType: false,\n\t\t\t},\n\t\t});\n\n\t\tthis.#errorMenu.setBindElement(this.#copilotContainer, {\n\t\t\ttop: 8,\n\t\t});\n\t}\n\n\tadjustMenusPosition(): void\n\t{\n\t\tthis.#generalMenu?.adjustPosition();\n\t\tthis.#errorMenu?.adjustPosition();\n\t\tthis.#resultMenu?.adjustPosition();\n\t}\n\n\t#openResultMenu()\n\t{\n\t\tif (!this.#resultMenu)\n\t\t{\n\t\t\tthis.#initResultMenu();\n\t\t}\n\n\t\tthis.#resultMenu.setBindElement(this.#copilotContainer, { top: 8 });\n\t\tthis.#resultMenu.open();\n\t}\n\n\t#initResultMenu()\n\t{\n\t\tconst items = this.#getResultMenuItems();\n\n\t\tthis.#resultMenu = new this.#CopilotMenu({\n\t\t\titems,\n\t\t\troleInfo: this.#getRoleInfoForMenu({\n\t\t\t\twithOpenRolesDialogAction: false,\n\t\t\t\tsubtitle: Loc.getMessage('AI_COPILOT_RESULT_MENU_ROLE_SUBTITLE'),\n\t\t\t}),\n\t\t\tkeyboardControlOptions: {\n\t\t\t\tclearHighlightAfterType: false,\n\t\t\t\tcanGoOutFromTop: false,\n\t\t\t\thighlightFirstItemAfterShow: true,\n\t\t\t},\n\t\t\tcacheable: false,\n\t\t});\n\t}\n\n\t#getRoleInfoForMenu(params: GetRoleInfoForMenuParams): CopilotMenuItemRoleInfo | undefined\n\t{\n\t\tif (this.#useRole() === false)\n\t\t{\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst roleInfo = {\n\t\t\trole: this.#currentRole,\n\t\t\tsubtitle: params.subtitle,\n\t\t};\n\n\t\tif (params.withOpenRolesDialogAction)\n\t\t{\n\t\t\troleInfo.onclick = this.#showRolesDialog.bind(this);\n\t\t}\n\n\t\treturn roleInfo;\n\t}\n\n\t#useRole(): boolean\n\t{\n\t\treturn Extension.getSettings('ai.copilot.copilot-text-controller').hasRoleSelect === true;\n\t}\n\n\t#getResultMenuItems(): CopilotMenuItem[]\n\t{\n\t\tconst prompts = this.#getTooling().prompts;\n\n\t\tif (this.#readonly)\n\t\t{\n\t\t\treturn CopilotResultMenuItems.getMenuItemsForReadonlyResult(\n\t\t\t\tthis.#category,\n\t\t\t\tthis,\n\t\t\t\tthis.#inputField,\n\t\t\t\tthis.#copilotContainer,\n\t\t\t);\n\t\t}\n\n\t\treturn CopilotResultMenuItems.getMenuItems({\n\t\t\tprompts,\n\t\t\tselectedText: this.#selectedText,\n\t\t\tcopilotTextController: this,\n\t\t\tinputField: this.#inputField,\n\t\t\tcopilotContainer: this.#copilotContainer,\n\t\t}, this.#category);\n\t}\n\n\t// eslint-disable-next-line sonarjs/cognitive-complexity\n\tgetAnalytics(): CopilotAnalytics\n\t{\n\t\tif (!this.#selectedText || this.#selectedText === '')\n\t\t{\n\t\t\tthis.#analytics.setTypeTextNew();\n\t\t}\n\t\telse if (this.#readonly)\n\t\t{\n\t\t\tthis.#analytics.setTypeTextEdit();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#analytics.setTypeTextReply();\n\t\t}\n\n\t\tif (this.#engine && this.#engine.getPayload())\n\t\t{\n\t\t\tthis.#analytics\n\t\t\t\t.setP1('prompt', this.getLastCommandCode())\n\t\t\t\t.setP2('provider', this.#selectedEngineCode);\n\t\t}\n\n\t\tconst usedTextInput = this.#inputField.usedTextInput();\n\t\tconst usedVoiceRecord = this.#inputField.usedVoiceRecord();\n\n\t\tif (usedTextInput && usedVoiceRecord)\n\t\t{\n\t\t\tthis.#analytics.setContextTypeFromTextAndAudio();\n\t\t}\n\t\telse if (usedTextInput)\n\t\t{\n\t\t\tthis.#analytics.setContextTypeFromText();\n\t\t}\n\t\telse if (usedVoiceRecord)\n\t\t{\n\t\t\tthis.#analytics.setContextTypeFromAudio();\n\t\t}\n\n\t\tif (this.getSelectedText())\n\t\t{\n\t\t\tthis.#analytics.setContextElementPopupButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#analytics.setContextElementSpaceButton();\n\t\t}\n\n\t\tif (this.#readonly)\n\t\t{\n\t\t\tif (this.getSelectedText())\n\t\t\t{\n\t\t\t\tthis.#analytics.setContextElementReadonlyQuote();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#analytics.setContextElementReadonlyCommon();\n\t\t\t}\n\t\t}\n\n\t\treturn this.#analytics;\n\t}\n}\n\ntype GetRoleInfoForMenuParams = {\n\twithOpenRolesDialogAction: boolean;\n\tsubtitle: string;\n};\n"],"names":["CopilotTextControllerEngine","constructor","options","category","useResultStack","moduleId","contextId","contextParameters","init","undefined","getTooling","res","data","engines","completions","id","Math","round","random","textCompletions","result","last","getBaseErrorFromResponse","getPrompts","prompts","getPermissions","permissions","getEngines","setSelectedEngineCode","code","getSelectedEngineCode","getCategory","getContextId","setContext","context","setSelectedText","selectedText","getOriginalMessage","setUserMessage","userMessage","getCommandCode","setCommandCode","commandCode","cancelCompletion","isCopilotFirstLaunch","Boolean","first_launch","setCopilotBannerLaunchedFlag","setBannerLaunched","setAnalyticParameters","parameters","getDataForFeedbackForm","feedDataResult","getFeedbackData","messages","context_messages","authorMessage","original_message","payload","getPayload","author_message","getRawData","getMarkers","error","console","stackSize","unshift","length","pop","selectedEngine","find","engine","selected","command","originalMessage","PayloadText","prompt","engineCode","setMarkers","user_message","current_result","setPayload","searchPrompt","required","context_message","some","children","childrenPrompt","initEngineOptions","Engine","setModuleId","setContextId","setContextParameters","setParameters","promptCategory","Error","BaseError","message","Type","isString","firstErrorData","errors","customData","BaseCommand","copilotTextController","AddBelowCommand","execute","emit","getAiResultText","getLastCommandCode","CancelCommand","copilotContainer","inputField","destroyAllMenus","openGeneralMenu","clearResultStack","clearErrors","clear","isReadonly","enable","clearResultField","Dom","removeClass","focus","getAnalytics","sendEventCancel","EditResultCommand","sendEventEditResult","GenerateWithRequiredUserMessageCommand","generateWithRequiredUserMessage","GenerateWithoutRequiredUserMessage","generateWithoutRequiredUserMessage","OpenAboutCopilot","articleCode","Helper","Reflection","getClass","show","OpenFeedbackFormCommand","isBeforeGeneration","senderPagePreset","contextMessages","JSON","stringify","formIdNumber","Runtime","loadExtension","then","BX","UI","Feedback","Form","open","forms","zones","lang","sec","presets","sender_page","prompt_code","last_result0","language","Loc","getMessage","cp_answer","catch","err","RepeatCommand","generate","RepeatGenerateCommand","adjustMenusPosition","SaveCommand","BaseEvent","sendEventSave","SetEngineCommand","setSelectedEngine","CloseCommand","OpenImageConfigurator","CopilotErrorMenuItems","getMenuItems","text","icon","notHighlight","CopilotProvidersMenuItems","selectedEngineCode","canEditSettings","connectAiMenuItem","disabled","ActionsIconSet","PLUS_50","getMenuItemsFromEngines","separator","getMarketMenuItem","settingsPageLink","Extension","getSettings","SETTINGS_4","href","map","title","MainIconSet","ROBOT","MARKET_1","arrow","CopilotMenuItems","CopilotResultMenuItems","saveMenuItemText","saveMenuItem","editMenuItem","addBelowMenuItem","getResultMenuPromptItems","getFeedbackMenuItem","filter","item","getMenuItemsForReadonlyResult","Actions","COPY_PLATES","clipboard","copy","Notification","Center","notify","content","sendEventCopyResult","PENCIL_60","CROSS_45","workWithResultPrompts","workWithResult","Main","FEEDBACK","CopilotGeneralMenuItems","addImageMenuItem","imageMenuItem","MAGIC_IMAGE","labelText","getGeneralMenuItemsFromPrompts","getSelectedEngineMenuItem","INFO","type","section","COPILOT_AI","BaseMenuItem","EventEmitter","setEventNamespace","onClick","getOptions","childrenMenuItem","AboutCopilotMenuItem","ChangeRequestMenuItem","EDIT_PENCIL","CopyResultMenuItem","event","menuItem","menu","isCopyingSuccess","markMenuItemSelected","getId","setTimeout","unmarkMenuItemSelected","getText","FeedbackMenuItem","MarketMenuItem","OpenCopilotMenuItem","ProviderMenuItem","RepeatCopilotMenuItem","LEFT_SEMICIRCULAR_ANTICLOCKWISE_ARROW_1","SettingsMenuItem","SETTINGS","CancelCopilotMenuItem","ConnectModelMenuItem","CopilotTextController","resultField","readonly","warningField","copilotInputEvents","copilotMenu","copilotMenuEvents","analytics","bind","setSelectedPromptCodeWithSimpleTemplate","getSelectedPromptCodeWithSimpleTemplate","setCopilotContainer","getSelectedText","getContext","setExtraMarkers","extraMarkers","role","getPopup","subscribeFromOptions","onBeforeShow","disable","onAfterShow","setBindElement","top","showMenu","getOpenMenu","isShown","isContainsElem","elem","contains","markers","getValue","setHtmlContent","commandTextForInputField","setValue","hideAllMenus","hide","close","start","isFirstLaunch","finish","reset","isInitFinished","isPromptsLoaded","clearResult","startGenerating","finishGenerating","addResult","expand","sendEventError","adjustPosition","setTypeTextNew","setTypeTextEdit","setTypeTextReply","setP1","setP2","usedTextInput","usedVoiceRecord","setContextTypeFromTextAndAudio","setContextTypeFromText","setContextTypeFromAudio","setContextElementPopupButton","setContextElementSpaceButton","setContextElementReadonlyQuote","setContextElementReadonlyCommon","subscribe","containerClick","submit","input","goOutFromBottom","startRecording","stopRecording","cancelLoading","adjustHeight","unsubscribe","isDisabled","editCommand","enableArrowsKey","e","getData","disableArrowsKey","requestAnimationFrame","userPrompt","roleInfo","withOpenRolesDialogAction","subtitle","items","can_edit_settings","keyboardControlOptions","clearHighlightAfterType","canGoOutFromTop","highlightFirstItemAfterShow","forceTop","cacheable","clearHighlight","enableEnterAndArrows","highlightMenuItem","disableEnterAndArrows","Promise","resolve","RolesDialog","RolesDialogEvents","dialogOptions","getModuleId","selectedRoleCode","SELECT_ROLE","updateRoleInfo","HIDE","currentPrompt","promptChildren","promptTitle","roleCode","oldPayloadMarkers","analytic","getType","c_sub_section","getCSubSection","c_element","getCElement","replaceMenuItemSubmenu","maxGenerateRestartErrors","firstErrorCode","setErrors","clickHandler","baasPopup","PopupManager","getPopups","popup","includes","baasPopupAutoHide","autoHide","setAutoHide","addClass","AjaxErrorHandler","handleTextGenerateError","baasOptions","bindElement","getContainer","querySelector","useAngle","errorCode","offsetTop","params","onclick","hasRoleSelect"],"mappings":"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"}