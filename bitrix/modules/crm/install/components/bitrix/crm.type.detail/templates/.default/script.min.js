(function(e,t,i,n,s,r,o,a,l){"use strict";var c,d,u,h,m,f,p,y,v;function S(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=b(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var n=0;var s=function e(){};return{s:s,n:function t(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function e(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,o=false,a;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();r=t.done;return t},e:function e(t){o=true;a=t},f:function e(){try{if(!r&&i["return"]!=null)i["return"]()}finally{if(o)throw a}}}}function b(e,t){if(!e)return;if(typeof e==="string")return g(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return g(e,t)}function g(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function C(e,t){k(e,t);t.add(e)}function k(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function I(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var E=s.Reflection.namespace("BX.Crm.Component");var T=null;var D=new WeakSet;var w=new WeakSet;var B=function(){function e(t){babelHelpers.classCallCheck(this,e);C(this,w);C(this,D);babelHelpers.defineProperty(this,"isProgress",false);babelHelpers.defineProperty(this,"tabs",new Map);babelHelpers.defineProperty(this,"isRestricted",false);babelHelpers.defineProperty(this,"isExternal",false);babelHelpers.defineProperty(this,"isSaveFromTypeDetail",true);babelHelpers.defineProperty(this,"isCreateSectionsViaAutomatedSolutionDetails",false);if(s.Type.isPlainObject(t)){this.type=t.type;this.isNew=!this.type.isSaved();this.form=t.form;this.container=t.container;this.errorsContainer=t.errorsContainer;this.presets=t.presets;this.relations=t.relations;this.isRestricted=Boolean(t.isRestricted);this.restrictionErrorMessage=s.Type.isStringFilled(t.restrictionErrorMessage)?t.restrictionErrorMessage:"";this.restrictionSliderCode=s.Type.isStringFilled(t.restrictionSliderCode)&&this.isRestricted?t.restrictionSliderCode:null;this.isExternal=Boolean(t.isExternal);this.isCreateSectionsViaAutomatedSolutionDetails=Boolean(t.isCreateSectionsViaAutomatedSolutionDetails)}this.buttonsPanel=document.getElementById("ui-button-panel");this.saveButton=document.getElementById("ui-button-panel-save");this.cancelButton=document.getElementById("ui-button-panel-cancel");this.deleteButton=document.getElementById("ui-button-panel-remove");T=this}babelHelpers.createClass(e,[{key:"init",value:function e(){this.bindEvents();this.fillTabs();if(this.type.getId()){this.disablePresetsView();var t=document.querySelector('[data-role="preset-selector-container"]');if(t){s.Dom.addClass(t,"crm-type-hidden")}}else{this.enablePresetsView()}s.Dom.removeClass(document.querySelector("body"),"crm-type-hidden");this.initRelations();this.initCustomSections()}},{key:"bindEvents",value:function e(){var t=this;s.Event.bind(this.saveButton,"click",(function(e){t.save(e)}),{passive:false});if(this.deleteButton){s.Event.bind(this.deleteButton,"click",(function(e){t["delete"](e)}))}var i=this.getBooleanFieldNodeByName("isUseInUserfieldEnabled");if(i){s.Event.bind(i,"click",this.disableLinkedUserFieldsIfNotAvailable.bind(this))}this.form.querySelectorAll('[data-name*="linkedUserFields"]').forEach((function(e){s.Event.bind(e,"click",t.enableUserFieldIfAnyLinkedChecked.bind(t))}));this.handleSliderDestroy=this.handleSliderDestroy.bind(this);top.BX.Event.EventEmitter.subscribe("SidePanel.Slider:onDestroy",this.handleSliderDestroy)}},{key:"handleSliderDestroy",value:function e(t){var i=t.getData(),n=babelHelpers.slicedToArray(i,1),s=n[0];var r=s.getSlider();if(r.getFrameWindow()===window){this.destroy();top.BX.Event.EventEmitter.unsubscribe("SidePanel.Slider:onDestroy",this.handleSliderDestroy)}}},{key:"destroy",value:function e(){var t;(t=this.customSectionController)===null||t===void 0?void 0:t.destroy()}},{key:"enablePresetsView",value:function e(){s.Dom.addClass(document.querySelector("body"),"crm-type-settings-presets");var t=this.container.querySelector(".crm-type-tab-current");if(t){s.Dom.removeClass(t,"crm-type-tab-current")}var i=this.container.querySelector('[data-tab="presets"]');if(i){s.Dom.addClass(i,"crm-type-tab-current")}var n=document.querySelector('[data-role="preset-selector-container"]');if(n){s.Dom.addClass(n,"crm-type-hidden")}s.Dom.removeClass(document.getElementById("pagetitle"),"crm-type-hidden");s.Dom.addClass(this.buttonsPanel,"crm-type-hidden");this.hideErrors()}},{key:"disablePresetsView",value:function e(){var t;s.Dom.removeClass(document.querySelector("body"),"crm-type-settings-presets");((t=I(this,D,A).call(this))!==null&&t!==void 0?t:I(this,w,L).call(this)).click();var i=document.querySelector('[data-role="preset-selector-container"]');if(i){s.Dom.removeClass(i,"crm-type-hidden")}s.Dom.addClass(document.getElementById("pagetitle"),"crm-type-hidden");s.Dom.removeClass(this.buttonsPanel,"crm-type-hidden")}},{key:"disableLinkedUserFieldsIfNotAvailable",value:function e(){var t=this;var i=this.getBooleanFieldNodeByName("isUseInUserfieldEnabled");if(!this.isBooleanFieldChecked(i)){this.form.querySelectorAll('[data-name*="linkedUserFields"]').forEach((function(e){t.setBooleanFieldCheckedState(e,false)}))}}},{key:"enableUserFieldIfAnyLinkedChecked",value:function e(){var t=this;var i=this.getBooleanFieldNodeByName("isUseInUserfieldEnabled");if(!this.isBooleanFieldChecked(i)){this.form.querySelectorAll('[data-name*="linkedUserFields"]').forEach((function(e){if(t.isBooleanFieldChecked(e)){t.setBooleanFieldCheckedState(i,true)}}))}}},{key:"getLoader",value:function e(){if(!this.loader){this.loader=new o.Loader({size:150})}return this.loader}},{key:"startProgress",value:function e(){this.isProgress=true;if(!this.getLoader().isShown()){this.getLoader().show(this.form)}this.hideErrors()}},{key:"stopProgress",value:function e(){var t=this;this.isProgress=false;this.getLoader().hide();setTimeout((function(){s.Dom.removeClass(t.saveButton,"ui-btn-wait");s.Dom.removeClass(t.cancelButton,"ui-btn-wait");if(t.deleteButton){s.Dom.removeClass(t.deleteButton,"ui-btn-wait")}}),200)}},{key:"save",value:function e(t){var i=this;if(this.isRestricted){if(s.Type.isStringFilled(this.restrictionSliderCode)&&s.Reflection.getClass("BX.UI.InfoHelper.show")){BX.UI.InfoHelper.show(this.restrictionSliderCode)}else{this.showErrors([this.restrictionErrorMessage])}this.stopProgress();return}t.preventDefault();if(!this.form){return}if(this.isProgress){return}if(!this.type){return}this.startProgress();this.type.setTitle(this.form.querySelector('[name="title"]').value);n.TypeModel.getBooleanFieldNames().forEach((function(e){var t=i.getBooleanFieldNodeByName(e);if(t){i.type.data[e]=i.isBooleanFieldChecked(t)}}));var r={};this.form.querySelectorAll('[data-name*="linkedUserFields"]').forEach((function(e){var t=e.dataset.name.slice("linkedUserFields[".length).replace("]","");r[t]=i.isBooleanFieldChecked(e)}));this.type.setLinkedUserFields(r);this.type.setRelations({parent:this.parentRelationsController.getData(),child:this.childRelationsController.getData()});if(this.customSectionController){var o=this.customSectionController.getData();this.type.setCustomSectionId(o.customSectionId);this.type.setCustomSections(o.customSections);this.type.setIsExternalDynamicalType(this.isExternal);this.type.setIsSaveFromTypeDetail(this.isSaveFromTypeDetail)}this.type.save().then((function(e){i.stopProgress();i.afterSave(e);i.isNew=false}))["catch"]((function(e){i.showErrors(e);i.stopProgress()}))}},{key:"collectEntityTypeIds",value:function e(t){var i=[];var n=this.container.querySelectorAll('[data-role="'.concat(t,'"]'));babelHelpers.toConsumableArray(n).forEach((function(e){if(e.checked){i.push(e.dataset.entityTypeId)}}));return i}},{key:"afterSave",value:function e(i){var n;this.addDataToSlider("response",i);if(Object.hasOwn(i.data,"urlTemplates")){t.Router.Instance.setUrlTemplates(i.data.urlTemplates)}(n=this.getSlider())===null||n===void 0?void 0:n.close();this.emitTypeUpdatedEvent({isUrlChanged:i.data.isUrlChanged===true})}},{key:"getSlider",value:function e(){var t,i;return(t=BX.SidePanel)===null||t===void 0?void 0:(i=t.Instance)===null||i===void 0?void 0:i.getSliderByWindow(window)}},{key:"emitTypeUpdatedEvent",value:function e(t){i.ToolbarComponent.Instance.emitTypeUpdatedEvent(t)}},{key:"addDataToSlider",value:function e(t,i){if(s.Type.isString(t)&&s.Type.isPlainObject(i)){var n=this.getSlider();if(n){n.data.set(t,i)}}}},{key:"showErrors",value:function e(t){var i="";t.forEach((function(e){i+=e}));if(s.Type.isDomNode(this.errorsContainer)){this.errorsContainer.innerText=i;s.Dom.style(this.errorsContainer.parentNode,"display","block")}else{console.error(i)}}},{key:"hideErrors",value:function e(){if(s.Type.isDomNode(this.errorsContainer)){s.Dom.style(this.errorsContainer.parentNode,"display","none");this.errorsContainer.innerText=""}}},{key:"delete",value:function e(i){var n=this;i.preventDefault();if(!this.form){return}if(this.isProgress){return}if(!this.type){return}a.MessageBox.confirm(s.Loc.getMessage("CRM_TYPE_DETAIL_DELETE_CONFIRM"),(function(){return new Promise((function(e){n.startProgress();n.type["delete"]().then((function(e){n.stopProgress();var i=s.Type.isObject(e.data)&&e.data.isUrlChanged===true;n.emitTypeUpdatedEvent({isUrlChanged:i});t.Router.Instance.closeSliderOrRedirect(t.Router.Instance.getTypeListUrl())}))["catch"]((function(t){n.showErrors(t);n.stopProgress();e()}))}))}),null,(function(e){n.stopProgress();e.close()}))}},{key:"fillTabs",value:function e(){var t=this;if(this.container){this.container.querySelectorAll(".crm-type-tab").forEach((function(e){if(e.dataset.tab){t.tabs.set(e.dataset.tab,e)}}))}}},{key:"showTab",value:function e(t){var i=this;babelHelpers.toConsumableArray(this.tabs.keys()).forEach((function(e){if(e===t){s.Dom.addClass(i.tabs.get(e),"crm-type-tab-current")}else{s.Dom.removeClass(i.tabs.get(e),"crm-type-tab-current")}}))}},{key:"applyPreset",value:function e(t){var i=this;this.disablePresetsView();var n=document.querySelector('[data-role="crm-type-preset-selector"]');var r=this.container.querySelector('[data-role="preset"].crm-type-preset-active');if(r){var o=this.getPresetById(r.dataset.presetId);if(o&&o.data.title&&this.form.querySelector('[name="title"]').value===o.data.title){this.form.querySelector('[name="title"]').value=""}}var a=this.container.querySelectorAll('[data-role="preset"]');a.forEach((function(e){s.Dom.removeClass(e,"crm-type-preset-active");if(e.dataset.presetId===t){s.Dom.addClass(e,"crm-type-preset-active");var r=i.getPresetById(t);if(r){i.updateInputs(r.data);if(n){n.textContent=s.Text.encode(r.fields.title)}}}}))}},{key:"getPresetById",value:function e(t){var i=S(this.presets),n;try{for(i.s();!(n=i.n()).done;){var s=n.value;if(s.fields.id===t){return s}}}catch(e){i.e(e)}finally{i.f()}return null}},{key:"updateInputs",value:function e(t){var i=this;if(this.form.querySelector('[name="title"]').value.length<=0){this.form.querySelector('[name="title"]').value=t.title||""}n.TypeModel.getBooleanFieldNames().forEach((function(e){var n=i.getBooleanFieldNodeByName(e);if(n){i.setBooleanFieldCheckedState(n,t[e])}}));this.disableLinkedUserFieldsIfNotAvailable()}},{key:"toggleBooleanField",value:function e(t){var i=this.getBooleanFieldNodeByName(t);if(!i){return}if(i.nodeName==="INPUT"){i.checked=!i.checked}else{s.Dom.toggleClass(i,"crm-type-field-button-item-active")}}},{key:"getBooleanFieldNodeByName",value:function e(t){return this.container.querySelector('[data-name="'.concat(t,'"]'))}},{key:"isBooleanFieldChecked",value:function e(t){if(t.nodeName==="INPUT"){return t.checked}return s.Dom.hasClass(t,"crm-type-field-button-item-active")}},{key:"setBooleanFieldCheckedState",value:function e(t,i){if(t.nodeName==="INPUT"){t.checked=i;return}if(i){s.Dom.addClass(t,"crm-type-field-button-item-active")}else{s.Dom.removeClass(t,"crm-type-field-button-item-active")}}},{key:"initRelations",value:function e(){this.parentRelationsController=new N({switcher:BX.UI.Switcher.getById("crm-type-relation-parent-switcher"),container:this.container.querySelector('[data-role="crm-type-relation-parent-items"]'),typeSelectorContainer:this.container.querySelector('[data-role="crm-type-relation-parent-items-selector"]'),tabsContainer:this.container.querySelector('[data-role="crm-type-relation-parent-items-tabs"]'),tabsCheckbox:this.container.querySelector('[data-name="isRelationParentShowChildrenEnabled"]'),tabsSelectorContainer:this.container.querySelector('[data-role="crm-type-relation-parent-items-tabs-selector"]'),relations:this.relations.parent});this.childRelationsController=new N({switcher:BX.UI.Switcher.getById("crm-type-relation-child-switcher"),container:this.container.querySelector('[data-role="crm-type-relation-child-items"]'),typeSelectorContainer:this.container.querySelector('[data-role="crm-type-relation-child-items-selector"]'),tabsContainer:this.container.querySelector('[data-role="crm-type-relation-child-items-tabs"]'),tabsCheckbox:this.container.querySelector('[data-name="isRelationChildShowChildrenEnabled"]'),tabsSelectorContainer:this.container.querySelector('[data-role="crm-type-relation-child-items-tabs-selector"]'),relations:this.relations.child})}},{key:"initCustomSections",value:function e(){this.customSectionController=new P({switcher:BX.UI.Switcher.getById("crm-type-custom-section-switcher"),container:this.container.querySelector('[data-role="crm-type-custom-section-container"]'),selectorContainer:this.container.querySelector('[data-role="crm-type-custom-section-selector"]'),customSections:this.type.getCustomSections()||[],isCreateSectionsViaAutomatedSolutionDetails:this.isCreateSectionsViaAutomatedSolutionDetails})}}],[{key:"handleLeftMenuClick",value:function e(t){if(T){T.showTab(t)}}},{key:"handlePresetClick",value:function e(t){if(T){T.applyPreset(t)}}},{key:"handleHideDescriptionClick",value:function e(t){s.Dom.style(t.parentNode,"display","none")}},{key:"handleBooleanFieldClick",value:function e(t){if(T){T.toggleBooleanField(t)}}},{key:"handlePresetSelectorClick",value:function e(){if(T){T.enablePresetsView()}}}]);return e}();function A(){return document.querySelector(".ui-sidepanel-menu-item.ui-sidepanel-menu-active > [data-role^=tab-]")}function L(){return document.querySelector(".ui-sidepanel-menu-item > [data-role^=tab-]")}E.TypeDetail=B;var N=function(){function e(t){babelHelpers.classCallCheck(this,e);this.switcher=t.switcher;this.container=t.container;this.typeSelectorContainer=t.typeSelectorContainer;this.tabsContainer=t.tabsContainer;this.tabsCheckbox=t.tabsCheckbox;this.tabsSelectorContainer=t.tabsSelectorContainer;this.relations=t.relations;this.initSelectors();this.adjustInitialState();this.bindEvents();this.adjust()}babelHelpers.createClass(e,[{key:"initSelectors",value:function e(){var t=[];var i=[];var n=[];var s=[];this.relations.forEach((function(e){var r={id:e.entityTypeId,entityId:"crmType",title:e.title,tabs:"recents"};if(e.isChecked){i.push(r);if(e.isChildrenListEnabled){s.push(r)}else{n.push(r)}}else{t.push(r)}}));this.typeSelector=new l.TagSelector({dialogOptions:{enableSearch:false,multiple:false,items:t,selectedItems:i,dropdownMode:true,height:200,showAvatars:false},events:{onAfterTagAdd:this.adjust.bind(this),onAfterTagRemove:this.adjust.bind(this)}});this.typeSelector.renderTo(this.typeSelectorContainer);this.tabsSelector=new l.TagSelector({dialogOptions:{enableSearch:false,multiple:false,items:n,selectedItems:s,dropdownMode:true,height:200,showAvatars:false}});this.tabsSelector.renderTo(this.tabsSelectorContainer)}},{key:"adjustInitialState",value:function e(){var t=this.typeSelector.getDialog().getSelectedItems();if(t.length>0){this.switcher.check(true)}this.tabsCheckbox.checked=this.tabsSelector.getDialog().getSelectedItems().length>0}},{key:"bindEvents",value:function e(){r.EventEmitter.subscribe(this.switcher,"toggled",this.adjust.bind(this));s.Event.bind(this.tabsCheckbox,"click",this.adjust.bind(this))}},{key:"adjust",value:function e(){var t=this;if(this.switcher.isChecked()){s.Dom.removeClass(this.container,"crm-type-hidden")}else{s.Dom.addClass(this.container,"crm-type-hidden")}var i=this.typeSelector.getDialog().getSelectedItems();if(i.length>0){s.Dom.removeClass(this.tabsContainer,"crm-type-hidden")}else{s.Dom.addClass(this.tabsContainer,"crm-type-hidden")}if(this.tabsCheckbox.checked){s.Dom.removeClass(this.tabsSelectorContainer,"crm-type-hidden")}else{s.Dom.addClass(this.tabsSelectorContainer,"crm-type-hidden")}this.tabsSelector.getDialog().getItems().forEach((function(e){if(!t.isItemSelected(e,i)){e.deselect();t.tabsSelector.getDialog().removeItem(e);t.tabsSelector.removeTag({id:e.getId(),entityId:e.getEntityId()})}}));i.forEach((function(e){var i={id:e.getId(),entityId:e.getEntityId(),title:e.getTitle(),tabs:"recents"};var n=t.tabsSelector.getDialog().getItem(i);if(!n){var s=t.tabsSelector.getDialog().addItem(i);s.select()}}))}},{key:"isItemSelected",value:function e(t,i){return i.some((function(e){return t.id===e.id}))}},{key:"getData",value:function e(){var t=this;var i=[];if(!this.switcher.isChecked()){return[]}var n=this.tabsCheckbox.checked;var s=this.typeSelector.getDialog().getSelectedItems();s.forEach((function(e){var s={entityTypeId:e.getId(),isChildrenListEnabled:false};if(n&&t.isItemSelected(e,t.tabsSelector.getDialog().getSelectedItems())){s.isChildrenListEnabled=true}i.push(s)}));return i}}]);return e}();var P=function(){function e(t){babelHelpers.classCallCheck(this,e);this.switcher=t.switcher;this.container=t.container;this.selectorContainer=t.selectorContainer;if(s.Type.isArray(t.customSections)){this.customSections=t.customSections}else{this.customSections=[]}if(s.Type.isBoolean(t.isCreateSectionsViaAutomatedSolutionDetails)){this.isCreateSectionsViaAutomatedSolutionDetails=t.isCreateSectionsViaAutomatedSolutionDetails}this.initSelector();this.settingsContainer=s.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-type-hidden crm-type-custom-sections-settings-container">\n\t\t\t\t<div class="crm-type-relation-subtitle">',"</div>\n\t\t\t</div>\n\t\t"])),s.Loc.getMessage("CRM_TYPE_DETAIL_CUSTOM_SECTION_LIST_MSGVER_1"));this.container.append(this.settingsContainer);this.adjustInitialState();this.bindEvents();this.adjust()}babelHelpers.createClass(e,[{key:"destroy",value:function e(){var t;this.unbindEvents();(t=this.selector)===null||t===void 0?void 0:t.unsubscribeAll()}},{key:"initSelector",value:function e(){var t=[];var i=[];this.customSections.forEach((function(e){var n={id:e.id,entityId:"custom-section",title:e.title,tabs:"recents"};t.push(n);if(e.isSelected){i.push(n)}}));var n={multiple:false,dialogOptions:{items:t,selectedItems:i,dropdownMode:true,height:200,showAvatars:false}};if(this.isCreateSectionsViaAutomatedSolutionDetails){n.showCreateButton=false;n.dialogOptions.footer=s.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<a\n\t\t\t\t\tonclick="','"\n\t\t\t\t\tclass="ui-selector-footer-link ui-selector-footer-link-add"\n\t\t\t\t>',"</a>\n\t\t\t"])),this.onOpenAutomatedSolutionCreationSliderClick.bind(this),s.Loc.getMessage("CRM_COMMON_ACTION_CREATE"))}else{n.showCreateButton=true;n.createButtonCaption=s.Loc.getMessage("CRM_COMMON_ACTION_CONFIG");n.events={onCreateButtonClick:this.onCreateButtonClick.bind(this)}}this.selector=new l.TagSelector(n);this.selector.renderTo(this.selectorContainer)}},{key:"reInitSelector",value:function e(){this.selector.getDialog().destroy();this.selector.unsubscribeAll();this.selector=null;s.Dom.clean(this.selectorContainer);this.initSelector()}},{key:"showSelector",value:function e(){s.Dom.removeClass(this.selectorContainer,"crm-type-hidden")}},{key:"hideSelector",value:function e(){s.Dom.addClass(this.selectorContainer,"crm-type-hidden")}},{key:"adjustInitialState",value:function e(){var t=this.selector.getDialog().getSelectedItems();if(t.length>0){this.switcher.check(true)}}},{key:"bindEvents",value:function e(){this.adjust=this.adjust.bind(this);this.onAutomatedSolutionUpdate=this.onAutomatedSolutionUpdate.bind(this);r.EventEmitter.subscribe(this.switcher,"toggled",this.adjust);if(this.isCreateSectionsViaAutomatedSolutionDetails){i.ToolbarComponent.Instance.subscribeAutomatedSolutionUpdatedEvent(this.onAutomatedSolutionUpdate)}}},{key:"unbindEvents",value:function e(){r.EventEmitter.unsubscribe(this.switcher,"toggled",this.adjust);i.ToolbarComponent.Instance.unsubscribeAutomatedSolutionUpdatedEvent(this.onAutomatedSolutionUpdate)}},{key:"onAutomatedSolutionUpdate",value:function e(t){var i=s.Text.toInteger(t.getData().intranetCustomSectionId);var n=String(t.getData().title);if(i<=0||!s.Type.isStringFilled(n)){return}var r=this.customSections.find((function(e){return s.Text.toInteger(e.id)===i}));if(r){r.title=n}else{this.customSections.push({id:i,title:n})}this.reInitSelector();this.selectCustomSectionById(i)}},{key:"selectCustomSectionById",value:function e(t){var i;var n=this.selector.getDialog();n.deselectAll();(i=n.getItem({entityId:"custom-section",id:t}))===null||i===void 0?void 0:i.select()}},{key:"onOpenAutomatedSolutionCreationSliderClick",value:function e(){void t.Router.Instance.openAutomatedSolutionDetail()}},{key:"onCreateButtonClick",value:function e(){this.hideSelector();this.showSectionsList()}},{key:"renderSectionsConfig",value:function e(){var t=this;if(!this.sectionsListContainer){this.sectionsListContainer=s.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['<div class="crm-type-custom-sections-list-container"></div>'])));this.settingsContainer.append(this.sectionsListContainer)}this.renderSectionsList(this.sectionsListContainer);if(!this.addSectionItemButton){this.addSectionItemButton=s.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="crm-type-custom-section-add-item-container">\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass="crm-type-custom-section-add-item-button"\n\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t>\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t"])),(function(){return t.sectionsListContainer.append(t.renderSectionItem())}),s.Loc.getMessage("CRM_COMMON_ACTION_CREATE"));this.settingsContainer.append(this.addSectionItemButton)}if(!this.buttonsContainer){this.settingsContainer.append(s.Tag.render(m||(m=babelHelpers.taggedTemplateLiteral(['<hr class="crm-type-custom-sections-line">']))));this.buttonsContainer=s.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['<div class="crm-type-custom-sections-buttons-container"></div>'])));this.settingsContainer.append(this.buttonsContainer)}if(!this.saveButton){this.saveButton=s.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['<span class="ui-btn ui-btn-primary" onclick="','">',"</span>"])),this.onSaveConfigHandler.bind(this),s.Loc.getMessage("CRM_COMMON_ACTION_SAVE"));this.buttonsContainer.append(this.saveButton)}if(!this.cancelButton){this.cancelButton=s.Tag.render(y||(y=babelHelpers.taggedTemplateLiteral(['<span class="ui-btn ui-btn-light-border" onclick="','">',"</span>"])),this.onCancelConfigHandler.bind(this),s.Loc.getMessage("CRM_COMMON_ACTION_CANCEL"));this.buttonsContainer.append(this.cancelButton)}}},{key:"onSaveConfigHandler",value:function e(t){t.preventDefault();var i=this.getSelectedSection();var n=[];babelHelpers.toConsumableArray(this.sectionsListContainer.children).forEach((function(e){var t=e.querySelector('[name="id"]');var s=e.querySelector('[name="value"]');if(!t||!s){return}var r=t.value;var o=s.value;var a=false;if(i&&i.id===r){a=true}if(o){n.push({id:r,title:o,isSelected:a})}}));this.customSections=n;this.reInitSelector();this.showSelector();this.hideSectionsList()}},{key:"onCancelConfigHandler",value:function e(t){t.preventDefault();this.showSelector();this.hideSectionsList()}},{key:"renderSectionsList",value:function e(t){var i=this;s.Dom.clean(t);this.customSections.forEach((function(e){t.append(i.renderSectionItem(e))}));t.append(this.renderSectionItem())}},{key:"renderSectionItem",value:function e(t){var i=this;var n=new U(t);var r=s.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div style="margin-bottom: 10px;" class="ui-ctl ui-ctl-textbox ui-ctl-w100 ui-ctl-row">\n\t\t\t\t<input type="hidden" name="id" value="','" />\n\t\t\t\t<input class="ui-ctl-element" name="value" type="text" value="','">\n\t\t\t\t<div\n\t\t\t\t\tclass="crm-type-custom-section-remove-item"\n\t\t\t\t\tonclick="','">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])),n.getId(),s.Text.encode(n.getValue()),(function(e){e.preventDefault();i.sectionsListContainer.removeChild(n.getNode())}));n.setNode(r);return r}},{key:"showSectionsList",value:function e(){this.renderSectionsConfig();s.Dom.removeClass(this.settingsContainer,"crm-type-hidden")}},{key:"hideSectionsList",value:function e(){s.Dom.clean(this.sectionsListContainer);s.Dom.addClass(this.settingsContainer,"crm-type-hidden")}},{key:"adjust",value:function e(){if(this.switcher.isChecked()){s.Dom.removeClass(this.container,"crm-type-hidden")}else{s.Dom.addClass(this.container,"crm-type-hidden")}}},{key:"getSelectedSection",value:function e(){var t=this.selector.getDialog().getSelectedItems();if(t.length>0){return{id:t[0].getId(),title:t[0].getTitle()}}return null}},{key:"getData",value:function e(){var t={customSectionId:0,customSections:this.customSections};if(this.switcher.isChecked()){var i=this.getSelectedSection();if(i){t.customSectionId=i.id}}return t}}]);return e}();var U=function(){function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;babelHelpers.classCallCheck(this,e);this.id=t?t.id:"new_".concat(s.Text.getRandom());this.value=t?t.title:""}babelHelpers.createClass(e,[{key:"setNode",value:function e(t){this.node=t}},{key:"getId",value:function e(){return this.id}},{key:"getNode",value:function e(){return this.node}},{key:"getInput",value:function e(){var t=this.getNode();if(!t){return null}if(t instanceof HTMLInputElement){return t}return t.querySelector("input")}},{key:"getValue",value:function e(){var t=this.getInput();if(t&&t.value){return t.value}return this.value||""}}]);return e}()})(this.window=this.window||{},BX.Crm,BX.Crm,BX.Crm.Models,BX,BX.Event,BX,BX.UI.Dialogs,BX.UI.EntitySelector);
//# sourceMappingURL=script.map.js