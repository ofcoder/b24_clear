{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { Router } from 'crm.router';\nimport { ToolbarComponent } from 'crm.toolbar-component';\nimport { CustomSection, TypeModel, TypeModelData } from 'crm.type-model';\nimport { Dom, Event, Loc, Reflection, Tag, Text, Type } from 'main.core';\nimport { type BaseEvent, EventEmitter } from 'main.core.events';\nimport { Loader } from 'main.loader';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { TagSelector } from 'ui.entity-selector';\n\ndeclare type Preset = {\n\tfields: {\n\t\tid: string,\n\t\ttitle: string,\n\t\tcategory: string,\n\t\tdescription: string,\n\t\ticon: string,\n\t},\n\tdata: TypeModelData\n}\n\ndeclare type Relation = {\n\ttitle: string,\n\tisChecked: boolean,\n\tentityTypeId: number,\n\tisChildrenListEnabled: boolean,\n}\n\nconst namespace = Reflection.namespace('BX.Crm.Component');\n\nlet instance: TypeDetail = null;\n\n/**\n * @memberOf BX.Crm.Component\n */\nclass TypeDetail\n{\n\tform;\n\ttype: TypeModel;\n\tisProgress: boolean = false;\n\tcontainer: Element;\n\terrorsContainer: Element;\n\tisNew: boolean;\n\ttabs: Map<string, Element> = new Map();\n\tpresets: Array;\n\trelations: {\n\t\tparent: Relation[],\n\t\tchild: Relation[],\n\t};\n\n\tparentRelationsController: RelationsController;\n\tchildRelationsController: RelationsController;\n\tcustomSectionController: ?CustomSectionsController;\n\tisRestricted: boolean = false;\n\trestrictionErrorMessage: string;\n\trestrictionSliderCode: ?string;\n\tisExternal: boolean = false;\n\tisSaveFromTypeDetail: boolean = true;\n\tisCreateSectionsViaAutomatedSolutionDetails: boolean = false;\n\n\tconstructor(params: {\n\t\tform: Element,\n\t\ttype: TypeModel,\n\t\tcontainer: Element,\n\t\terrorsContainer: Element,\n\t\tpresets?: Array,\n\t\trelations: {\n\t\t\tparent: Relation[],\n\t\t\tchild: Relation[],\n\t\t},\n\t\tisCreateSectionsViaAutomatedSolutionDetails: boolean,\n\t\tisExternal: boolean,\n\t\tisRestricted: boolean,\n\t\trestrictionErrorMessage: string,\n\t\trestrictionSliderCode: ?string,\n    })\n\t{\n\t\tif (Type.isPlainObject(params))\n\t\t{\n\t\t\tthis.type = params.type;\n\t\t\tthis.isNew = !this.type.isSaved();\n\t\t\tthis.form = params.form;\n\t\t\tthis.container = params.container;\n\t\t\tthis.errorsContainer = params.errorsContainer;\n\t\t\tthis.presets = params.presets;\n\t\t\tthis.relations = params.relations;\n\t\t\tthis.isRestricted = Boolean(params.isRestricted);\n\t\t\tthis.restrictionErrorMessage = Type.isStringFilled(params.restrictionErrorMessage) ? params.restrictionErrorMessage : '';\n\t\t\tthis.restrictionSliderCode = Type.isStringFilled(params.restrictionSliderCode) && this.isRestricted\n\t\t\t\t? params.restrictionSliderCode\n\t\t\t\t: null\n\t\t\t;\n\t\t\tthis.isExternal = Boolean(params.isExternal);\n\t\t\tthis.isCreateSectionsViaAutomatedSolutionDetails = Boolean(params.isCreateSectionsViaAutomatedSolutionDetails);\n\t\t}\n\n\t\tthis.buttonsPanel = document.getElementById('ui-button-panel');\n\t\tthis.saveButton = document.getElementById('ui-button-panel-save');\n\t\tthis.cancelButton = document.getElementById('ui-button-panel-cancel');\n\t\tthis.deleteButton = document.getElementById('ui-button-panel-remove');\n\n\t\t// eslint-disable-next-line unicorn/no-this-assignment\n\t\tinstance = this;\n\t}\n\n\tinit()\n\t{\n\t\tthis.bindEvents();\n\n\t\tthis.fillTabs();\n\n\t\tif (this.type.getId())\n\t\t{\n\t\t\t// const customPreset = this.getPresetById('bitrix:empty');\n\t\t\t// const presetSelector = document.querySelector('[data-role=\"crm-type-preset-selector\"]');\n\t\t\t// if (customPreset && presetSelector)\n\t\t\t// {\n\t\t\t// \tpresetSelector.textContent = customPreset.fields.title;\n\t\t\t// }\n\t\t\tthis.disablePresetsView();\n\t\t\tconst presetSelectorContainer = document.querySelector('[data-role=\"preset-selector-container\"]');\n\t\t\tif (presetSelectorContainer)\n\t\t\t{\n\t\t\t\tDom.addClass(presetSelectorContainer, 'crm-type-hidden');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.enablePresetsView();\n\t\t}\n\n\t\tDom.removeClass(document.querySelector('body'), 'crm-type-hidden');\n\n\t\tthis.initRelations();\n\n\t\tthis.initCustomSections();\n\t}\n\n\tbindEvents()\n\t{\n\t\tEvent.bind(this.saveButton, 'click', (event) => {\n\t\t\tthis.save(event);\n\t\t}, {\n\t\t\tpassive: false,\n\t\t});\n\n\t\tif (this.deleteButton)\n\t\t{\n\t\t\tEvent.bind(this.deleteButton, 'click', (event) => {\n\t\t\t\tthis.delete(event);\n\t\t\t});\n\t\t}\n\n\t\tconst userFieldOption = this.getBooleanFieldNodeByName('isUseInUserfieldEnabled');\n\t\tif (userFieldOption)\n\t\t{\n\t\t\tEvent.bind(userFieldOption, 'click', this.disableLinkedUserFieldsIfNotAvailable.bind(this));\n\t\t}\n\n\t\tthis.form.querySelectorAll('[data-name*=\"linkedUserFields\"]').forEach((linkedUserFieldNode) => {\n\t\t\tEvent.bind(linkedUserFieldNode, 'click', this.enableUserFieldIfAnyLinkedChecked.bind(this));\n\t\t});\n\n\t\tthis.handleSliderDestroy = this.handleSliderDestroy.bind(this);\n\t\ttop.BX.Event.EventEmitter.subscribe('SidePanel.Slider:onDestroy', this.handleSliderDestroy);\n\t}\n\n\thandleSliderDestroy(event: BaseEvent): void\n\t{\n\t\tconst [sliderEvent] = event.getData();\n\t\tconst slider: BX.SidePanel.Slider = sliderEvent.getSlider();\n\n\t\tif (slider.getFrameWindow() === window)\n\t\t{\n\t\t\t// if we add event handler from iframe to the main page, they will live forever, even after slider destroys\n\t\t\t// sometimes it causes errors, like in this case\n\t\t\tthis.destroy();\n\t\t\ttop.BX.Event.EventEmitter.unsubscribe('SidePanel.Slider:onDestroy', this.handleSliderDestroy);\n\t\t}\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.customSectionController?.destroy();\n\t}\n\n\tenablePresetsView()\n\t{\n\t\tDom.addClass(document.querySelector('body'), 'crm-type-settings-presets');\n\t\tconst activeTab = this.container.querySelector('.crm-type-tab-current');\n\t\tif (activeTab)\n\t\t{\n\t\t\tDom.removeClass(activeTab, 'crm-type-tab-current');\n\t\t}\n\t\tconst presetsTab = this.container.querySelector('[data-tab=\"presets\"]');\n\t\tif (presetsTab)\n\t\t{\n\t\t\tDom.addClass(presetsTab, 'crm-type-tab-current');\n\t\t}\n\t\tconst presetSelectorContainer = document.querySelector('[data-role=\"preset-selector-container\"]');\n\t\tif (presetSelectorContainer)\n\t\t{\n\t\t\tDom.addClass(presetSelectorContainer, 'crm-type-hidden');\n\t\t}\n\t\tDom.removeClass(document.getElementById('pagetitle'), 'crm-type-hidden');\n\t\tDom.addClass(this.buttonsPanel, 'crm-type-hidden');\n\t\tthis.hideErrors();\n\t}\n\n\tdisablePresetsView()\n\t{\n\t\tDom.removeClass(document.querySelector('body'), 'crm-type-settings-presets');\n\n\t\t(this.#findActiveTabButton() ?? this.#findFirstTabButton()).click();\n\n\t\tconst presetSelectorContainer = document.querySelector('[data-role=\"preset-selector-container\"]');\n\t\tif (presetSelectorContainer)\n\t\t{\n\t\t\tDom.removeClass(presetSelectorContainer, 'crm-type-hidden');\n\t\t}\n\t\tDom.addClass(document.getElementById('pagetitle'), 'crm-type-hidden');\n\t\tDom.removeClass(this.buttonsPanel, 'crm-type-hidden');\n\t}\n\n\t#findActiveTabButton(): ?HTMLElement\n\t{\n\t\treturn document.querySelector('.ui-sidepanel-menu-item.ui-sidepanel-menu-active > [data-role^=tab-]');\n\t}\n\n\t#findFirstTabButton(): HTMLElement\n\t{\n\t\treturn document.querySelector('.ui-sidepanel-menu-item > [data-role^=tab-]');\n\t}\n\n\tdisableLinkedUserFieldsIfNotAvailable()\n\t{\n\t\tconst userFieldOption = this.getBooleanFieldNodeByName('isUseInUserfieldEnabled');\n\t\tif (!this.isBooleanFieldChecked(userFieldOption))\n\t\t{\n\t\t\tthis.form.querySelectorAll('[data-name*=\"linkedUserFields\"]').forEach((linkedUserFieldNode) => {\n\t\t\t\tthis.setBooleanFieldCheckedState(linkedUserFieldNode, false);\n\t\t\t});\n\t\t}\n\t}\n\n\tenableUserFieldIfAnyLinkedChecked()\n\t{\n\t\tconst userFieldOption = this.getBooleanFieldNodeByName('isUseInUserfieldEnabled');\n\t\tif (!this.isBooleanFieldChecked(userFieldOption))\n\t\t{\n\t\t\tthis.form.querySelectorAll('[data-name*=\"linkedUserFields\"]').forEach((linkedUserFieldNode) => {\n\t\t\t\tif (this.isBooleanFieldChecked(linkedUserFieldNode))\n\t\t\t\t{\n\t\t\t\t\tthis.setBooleanFieldCheckedState(userFieldOption, true);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tgetLoader(): Loader\n\t{\n\t\tif (!this.loader)\n\t\t{\n\t\t\tthis.loader = new Loader({ size: 150 });\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tstartProgress(): void\n\t{\n\t\tthis.isProgress = true;\n\t\tif (!this.getLoader().isShown())\n\t\t{\n\t\t\tthis.getLoader().show(this.form);\n\t\t}\n\t\tthis.hideErrors();\n\t}\n\n\tstopProgress()\n\t{\n\t\tthis.isProgress = false;\n\t\tthis.getLoader().hide();\n\t\tsetTimeout(() => {\n\t\t\tDom.removeClass(this.saveButton, 'ui-btn-wait');\n\t\t\tDom.removeClass(this.cancelButton, 'ui-btn-wait');\n\t\t\tif (this.deleteButton)\n\t\t\t{\n\t\t\t\tDom.removeClass(this.deleteButton, 'ui-btn-wait');\n\t\t\t}\n\t\t}, 200);\n\t}\n\n\tsave(event)\n\t{\n\t\tif (this.isRestricted)\n\t\t{\n\t\t\tif (\n\t\t\t\tType.isStringFilled(this.restrictionSliderCode)\n\t\t\t\t&& Reflection.getClass('BX.UI.InfoHelper.show')\n\t\t\t)\n\t\t\t{\n\t\t\t\tBX.UI.InfoHelper.show(this.restrictionSliderCode);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showErrors([this.restrictionErrorMessage]);\n\t\t\t}\n\n\t\t\tthis.stopProgress();\n\n\t\t\treturn;\n\t\t}\n\t\tevent.preventDefault();\n\t\tif (!this.form)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.type)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.startProgress();\n\n\t\tthis.type.setTitle(this.form.querySelector('[name=\"title\"]').value);\n\t\tTypeModel.getBooleanFieldNames().forEach((fieldName) => {\n\t\t\tconst fieldNode = this.getBooleanFieldNodeByName(fieldName);\n\t\t\tif (fieldNode)\n\t\t\t{\n\t\t\t\tthis.type.data[fieldName] = this.isBooleanFieldChecked(fieldNode);\n\t\t\t}\n\t\t});\n\t\t// this.type.setConversionMap({\n\t\t// \tsourceTypes: this.collectEntityTypeIds('conversion-source'),\n\t\t// \tdestinationTypes: this.collectEntityTypeIds('conversion-destination'),\n\t\t// });\n\t\tconst linkedUserFields = {};\n\t\tthis.form.querySelectorAll('[data-name*=\"linkedUserFields\"]').forEach((linkedUserFieldNode) => {\n\t\t\tconst name = linkedUserFieldNode.dataset.name.slice('linkedUserFields['.length).replace(']', '');\n\t\t\tlinkedUserFields[name] = this.isBooleanFieldChecked(linkedUserFieldNode);\n\t\t});\n\t\tthis.type.setLinkedUserFields(linkedUserFields);\n\t\tthis.type.setRelations({\n\t\t\tparent: this.parentRelationsController.getData(),\n\t\t\tchild: this.childRelationsController.getData(),\n\t\t});\n\t\tif (this.customSectionController)\n\t\t{\n\t\t\tconst customSectionData = this.customSectionController.getData();\n\t\t\tthis.type.setCustomSectionId(customSectionData.customSectionId);\n\t\t\tthis.type.setCustomSections(customSectionData.customSections);\n\t\t\tthis.type.setIsExternalDynamicalType(this.isExternal);\n\t\t\tthis.type.setIsSaveFromTypeDetail(this.isSaveFromTypeDetail);\n\t\t}\n\n\t\tthis.type.save().then((response) => {\n\t\t\tthis.stopProgress();\n\t\t\tthis.afterSave(response);\n\t\t\tthis.isNew = false;\n\t\t}).catch((errors) => {\n\t\t\tthis.showErrors(errors);\n\t\t\tthis.stopProgress();\n\t\t});\n\t}\n\n\tcollectEntityTypeIds(role: string): []\n\t{\n\t\tconst entityTypeIds = [];\n\n\t\tconst checkboxes = this.container.querySelectorAll(`[data-role=\"${role}\"]`);\n\t\t[...checkboxes].forEach((checkbox: HTMLInputElement) => {\n\t\t\tif (checkbox.checked)\n\t\t\t{\n\t\t\t\tentityTypeIds.push(checkbox.dataset.entityTypeId);\n\t\t\t}\n\t\t});\n\n\t\treturn entityTypeIds;\n\t}\n\n\tafterSave(response: {data: {}})\n\t{\n\t\tthis.addDataToSlider('response', response);\n\n\t\tif (Object.hasOwn(response.data, 'urlTemplates'))\n\t\t{\n\t\t\tRouter.Instance.setUrlTemplates(response.data.urlTemplates);\n\t\t}\n\n\t\tthis.getSlider()?.close();\n\n\t\tthis.emitTypeUpdatedEvent({\n\t\t\tisUrlChanged: (response.data.isUrlChanged === true),\n\t\t});\n\t}\n\n\tgetSlider(): ?BX.SidePanel.Slider\n\t{\n\t\treturn BX.SidePanel?.Instance?.getSliderByWindow(window);\n\t}\n\n\temitTypeUpdatedEvent(data): void\n\t{\n\t\tToolbarComponent.Instance.emitTypeUpdatedEvent(data);\n\t}\n\n\taddDataToSlider(key, data)\n\t{\n\t\tif (Type.isString(key) && Type.isPlainObject(data))\n\t\t{\n\t\t\tconst slider = this.getSlider();\n\t\t\tif (slider)\n\t\t\t{\n\t\t\t\tslider.data.set(key, data);\n\t\t\t}\n\t\t}\n\t}\n\n\tshowErrors(errors: string[])\n\t{\n\t\tlet text = '';\n\t\terrors.forEach((message) => {\n\t\t\ttext += message;\n\t\t});\n\t\tif (Type.isDomNode(this.errorsContainer))\n\t\t{\n\t\t\tthis.errorsContainer.innerText = text;\n\t\t\tDom.style(this.errorsContainer.parentNode, 'display', 'block');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error(text);\n\t\t}\n\t}\n\n\thideErrors()\n\t{\n\t\tif (Type.isDomNode(this.errorsContainer))\n\t\t{\n\t\t\tDom.style(this.errorsContainer.parentNode, 'display', 'none');\n\t\t\tthis.errorsContainer.innerText = '';\n\t\t}\n\t}\n\n\tdelete(event)\n\t{\n\t\tevent.preventDefault();\n\t\tif (!this.form)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.type)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tMessageBox.confirm(\n\t\t\tLoc.getMessage('CRM_TYPE_DETAIL_DELETE_CONFIRM'),\n\t\t\t() => {\n\t\t\t\treturn new Promise((resolve) => {\n\t\t\t\t\tthis.startProgress();\n\t\t\t\t\tthis.type.delete().then((response) => {\n\t\t\t\t\t\tthis.stopProgress();\n\n\t\t\t\t\t\tconst isUrlChanged = (Type.isObject(response.data) && (response.data.isUrlChanged === true));\n\t\t\t\t\t\tthis.emitTypeUpdatedEvent({ isUrlChanged });\n\n\t\t\t\t\t\tRouter.Instance.closeSliderOrRedirect(Router.Instance.getTypeListUrl());\n\t\t\t\t\t}).catch((errors: string[]) => {\n\t\t\t\t\t\tthis.showErrors(errors);\n\t\t\t\t\t\tthis.stopProgress();\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t},\n\t\t\tnull,\n\t\t\t(box) => {\n\t\t\t\tthis.stopProgress();\n\t\t\t\tbox.close();\n\t\t\t},\n\t\t);\n\t}\n\n\tfillTabs()\n\t{\n\t\tif (this.container)\n\t\t{\n\t\t\tthis.container.querySelectorAll('.crm-type-tab').forEach((tabNode: HTMLDivElement) => {\n\t\t\t\tif (tabNode.dataset.tab)\n\t\t\t\t{\n\t\t\t\t\tthis.tabs.set(tabNode.dataset.tab, tabNode);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tshowTab(tabNameToShow: string)\n\t{\n\t\t[...this.tabs.keys()].forEach((tabName: string) => {\n\t\t\tif (tabName === tabNameToShow)\n\t\t\t{\n\t\t\t\tDom.addClass(this.tabs.get(tabName), 'crm-type-tab-current');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(this.tabs.get(tabName), 'crm-type-tab-current');\n\t\t\t}\n\t\t});\n\t}\n\n\tapplyPreset(presetId: string)\n\t{\n\t\tthis.disablePresetsView();\n\t\tconst presetSelector = document.querySelector('[data-role=\"crm-type-preset-selector\"]');\n\t\tconst currentPresetNode = this.container.querySelector('[data-role=\"preset\"].crm-type-preset-active');\n\t\tif (currentPresetNode)\n\t\t{\n\t\t\tconst currentPreset = this.getPresetById(currentPresetNode.dataset.presetId);\n\t\t\tif (\n\t\t\t\tcurrentPreset\n\t\t\t\t&& currentPreset.data.title\n\t\t\t\t&& this.form.querySelector('[name=\"title\"]').value === currentPreset.data.title)\n\t\t\t{\n\t\t\t\tthis.form.querySelector('[name=\"title\"]').value = '';\n\t\t\t}\n\t\t}\n\t\tconst presets = this.container.querySelectorAll('[data-role=\"preset\"]');\n\t\tpresets.forEach((presetNode: HTMLDivElement) => {\n\t\t\tDom.removeClass(presetNode, 'crm-type-preset-active');\n\t\t\tif (presetNode.dataset.presetId === presetId)\n\t\t\t{\n\t\t\t\tDom.addClass(presetNode, 'crm-type-preset-active');\n\t\t\t\tconst preset = this.getPresetById(presetId);\n\t\t\t\tif (preset)\n\t\t\t\t{\n\t\t\t\t\tthis.updateInputs(preset.data);\n\t\t\t\t\tif (presetSelector)\n\t\t\t\t\t{\n\t\t\t\t\t\tpresetSelector.textContent = Text.encode(preset.fields.title);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tgetPresetById(presetId: string)\n\t{\n\t\tfor (const preset: Preset of this.presets)\n\t\t{\n\t\t\tif (preset.fields.id === presetId)\n\t\t\t{\n\t\t\t\treturn preset;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tupdateInputs(data: TypeModelData)\n\t{\n\t\tif (this.form.querySelector('[name=\"title\"]').value.length <= 0)\n\t\t{\n\t\t\tthis.form.querySelector('[name=\"title\"]').value = data.title || '';\n\t\t}\n\t\tTypeModel.getBooleanFieldNames().forEach((fieldName) => {\n\t\t\tconst node = this.getBooleanFieldNodeByName(fieldName);\n\t\t\tif (node)\n\t\t\t{\n\t\t\t\tthis.setBooleanFieldCheckedState(node, data[fieldName]);\n\t\t\t}\n\t\t});\n\t\tthis.disableLinkedUserFieldsIfNotAvailable();\n\t}\n\n\ttoggleBooleanField(fieldName: string): void\n\t{\n\t\tconst node = this.getBooleanFieldNodeByName(fieldName);\n\t\tif (!node)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (node.nodeName === 'INPUT')\n\t\t{\n\t\t\tnode.checked = !node.checked;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.toggleClass(node, 'crm-type-field-button-item-active');\n\t\t}\n\t}\n\n\tgetBooleanFieldNodeByName(fieldName: string): ?HTMLDivElement | HTMLInputElement\n\t{\n\t\treturn this.container.querySelector(`[data-name=\"${fieldName}\"]`);\n\t}\n\n\tisBooleanFieldChecked(node: HTMLDivElement | HTMLInputElement): boolean\n\t{\n\t\tif (node.nodeName === 'INPUT')\n\t\t{\n\t\t\treturn node.checked;\n\t\t}\n\n\t\treturn Dom.hasClass(node, 'crm-type-field-button-item-active');\n\t}\n\n\tsetBooleanFieldCheckedState(node: HTMLDivElement | HTMLInputElement, isChecked: boolean): void\n\t{\n\t\tif (node.nodeName === 'INPUT')\n\t\t{\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tnode.checked = isChecked;\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (isChecked)\n\t\t{\n\t\t\tDom.addClass(node, 'crm-type-field-button-item-active');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(node, 'crm-type-field-button-item-active');\n\t\t}\n\t}\n\n\tinitRelations(): void\n\t{\n\t\tthis.parentRelationsController = new RelationsController({\n\t\t\tswitcher: BX.UI.Switcher.getById('crm-type-relation-parent-switcher'),\n\t\t\tcontainer: this.container.querySelector('[data-role=\"crm-type-relation-parent-items\"]'),\n\t\t\ttypeSelectorContainer: this.container.querySelector('[data-role=\"crm-type-relation-parent-items-selector\"]'),\n\t\t\ttabsContainer: this.container.querySelector('[data-role=\"crm-type-relation-parent-items-tabs\"]'),\n\t\t\ttabsCheckbox: this.container.querySelector('[data-name=\"isRelationParentShowChildrenEnabled\"]'),\n\t\t\ttabsSelectorContainer: this.container.querySelector('[data-role=\"crm-type-relation-parent-items-tabs-selector\"]'),\n\t\t\trelations: this.relations.parent,\n\t\t});\n\n\t\tthis.childRelationsController = new RelationsController({\n\t\t\tswitcher: BX.UI.Switcher.getById('crm-type-relation-child-switcher'),\n\t\t\tcontainer: this.container.querySelector('[data-role=\"crm-type-relation-child-items\"]'),\n\t\t\ttypeSelectorContainer: this.container.querySelector('[data-role=\"crm-type-relation-child-items-selector\"]'),\n\t\t\ttabsContainer: this.container.querySelector('[data-role=\"crm-type-relation-child-items-tabs\"]'),\n\t\t\ttabsCheckbox: this.container.querySelector('[data-name=\"isRelationChildShowChildrenEnabled\"]'),\n\t\t\ttabsSelectorContainer: this.container.querySelector('[data-role=\"crm-type-relation-child-items-tabs-selector\"]'),\n\t\t\trelations: this.relations.child,\n\t\t});\n\t}\n\n\tinitCustomSections()\n\t{\n\t\tthis.customSectionController = new CustomSectionsController({\n\t\t\tswitcher: BX.UI.Switcher.getById('crm-type-custom-section-switcher'),\n\t\t\tcontainer: this.container.querySelector('[data-role=\"crm-type-custom-section-container\"]'),\n\t\t\tselectorContainer: this.container.querySelector('[data-role=\"crm-type-custom-section-selector\"]'),\n\t\t\tcustomSections: this.type.getCustomSections() || [],\n\t\t\tisCreateSectionsViaAutomatedSolutionDetails: this.isCreateSectionsViaAutomatedSolutionDetails,\n\t\t});\n\t}\n\n\tstatic handleLeftMenuClick(tabName: string)\n\t{\n\t\tif (instance)\n\t\t{\n\t\t\tinstance.showTab(tabName);\n\t\t}\n\t}\n\n\tstatic handlePresetClick(presetId: string)\n\t{\n\t\tif (instance)\n\t\t{\n\t\t\tinstance.applyPreset(presetId);\n\t\t}\n\t}\n\n\tstatic handleHideDescriptionClick(target: HTMLDivElement)\n\t{\n\t\tDom.style(target.parentNode, 'display', 'none');\n\t}\n\n\tstatic handleBooleanFieldClick(fieldName: string)\n\t{\n\t\tif (instance)\n\t\t{\n\t\t\tinstance.toggleBooleanField(fieldName);\n\t\t}\n\t}\n\n\tstatic handlePresetSelectorClick()\n\t{\n\t\tif (instance)\n\t\t{\n\t\t\tinstance.enablePresetsView();\n\t\t}\n\t}\n}\n\nnamespace.TypeDetail = TypeDetail;\n\nclass RelationsController\n{\n\tswitcher: BX.UI.Switcher;\n\tcontainer: HTMLDivElement;\n\ttypeSelectorContainer: HTMLDivElement;\n\ttabsContainer: HTMLDivElement;\n\ttabsCheckbox: HTMLInputElement;\n\ttabsSelectorContainer: HTMLDivElement;\n\trelations: Relation[];\n\ttypeSelector: TagSelector;\n\ttabsSelector: TagSelector;\n\n\tconstructor(options)\n\t{\n\t\tthis.switcher = options.switcher;\n\t\tthis.container = options.container;\n\t\tthis.typeSelectorContainer = options.typeSelectorContainer;\n\t\tthis.tabsContainer = options.tabsContainer;\n\t\tthis.tabsCheckbox = options.tabsCheckbox;\n\t\tthis.tabsSelectorContainer = options.tabsSelectorContainer;\n\t\tthis.relations = options.relations;\n\n\t\tthis.initSelectors();\n\n\t\tthis.adjustInitialState();\n\n\t\tthis.bindEvents();\n\n\t\tthis.adjust();\n\t}\n\n\tinitSelectors()\n\t{\n\t\tconst unselectedTypes = [];\n\t\tconst selectedTypes = [];\n\t\tconst unselectedTabs = [];\n\t\tconst selectedTabs = [];\n\t\tthis.relations.forEach((relation: Relation) => {\n\t\t\tconst item = {\n\t\t\t\tid: relation.entityTypeId,\n\t\t\t\tentityId: 'crmType',\n\t\t\t\ttitle: relation.title,\n\t\t\t\ttabs: 'recents',\n\t\t\t};\n\t\t\tif (relation.isChecked)\n\t\t\t{\n\t\t\t\tselectedTypes.push(item);\n\n\t\t\t\tif (relation.isChildrenListEnabled)\n\t\t\t\t{\n\t\t\t\t\tselectedTabs.push(item);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tunselectedTabs.push(item);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tunselectedTypes.push(item);\n\t\t\t}\n\t\t});\n\n\t\tthis.typeSelector = new TagSelector({\n\t\t\tdialogOptions: {\n\t\t\t\tenableSearch: false,\n\t\t\t\tmultiple: false,\n\t\t\t\titems: unselectedTypes,\n\t\t\t\tselectedItems: selectedTypes,\n\t\t\t\tdropdownMode: true,\n\t\t\t\theight: 200,\n\t\t\t\tshowAvatars: false,\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonAfterTagAdd: this.adjust.bind(this),\n\t\t\t\tonAfterTagRemove: this.adjust.bind(this),\n\t\t\t},\n\t\t});\n\t\tthis.typeSelector.renderTo(this.typeSelectorContainer);\n\n\t\tthis.tabsSelector = new TagSelector({\n\t\t\tdialogOptions: {\n\t\t\t\tenableSearch: false,\n\t\t\t\tmultiple: false,\n\t\t\t\titems: unselectedTabs,\n\t\t\t\tselectedItems: selectedTabs,\n\t\t\t\tdropdownMode: true,\n\t\t\t\theight: 200,\n\t\t\t\tshowAvatars: false,\n\t\t\t},\n\t\t});\n\t\tthis.tabsSelector.renderTo(this.tabsSelectorContainer);\n\t}\n\n\tadjustInitialState()\n\t{\n\t\tconst selectedTypes = this.typeSelector.getDialog().getSelectedItems();\n\t\tif (selectedTypes.length > 0)\n\t\t{\n\t\t\tthis.switcher.check(true);\n\t\t}\n\t\tthis.tabsCheckbox.checked = this.tabsSelector.getDialog().getSelectedItems().length > 0;\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe(this.switcher, 'toggled', this.adjust.bind(this));\n\t\tEvent.bind(this.tabsCheckbox, 'click', this.adjust.bind(this));\n\t}\n\n\tadjust()\n\t{\n\t\tif (this.switcher.isChecked())\n\t\t{\n\t\t\tDom.removeClass(this.container, 'crm-type-hidden');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(this.container, 'crm-type-hidden');\n\t\t}\n\t\tconst selectedTypes = this.typeSelector.getDialog().getSelectedItems();\n\t\tif (selectedTypes.length > 0)\n\t\t{\n\t\t\tDom.removeClass(this.tabsContainer, 'crm-type-hidden');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(this.tabsContainer, 'crm-type-hidden');\n\t\t}\n\n\t\tif (this.tabsCheckbox.checked)\n\t\t{\n\t\t\tDom.removeClass(this.tabsSelectorContainer, 'crm-type-hidden');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(this.tabsSelectorContainer, 'crm-type-hidden');\n\t\t}\n\n\t\tthis.tabsSelector.getDialog().getItems().forEach((item) => {\n\t\t\tif (!this.isItemSelected(item, selectedTypes))\n\t\t\t{\n\t\t\t\titem.deselect();\n\t\t\t\tthis.tabsSelector.getDialog().removeItem(item);\n\t\t\t\tthis.tabsSelector.removeTag({\n\t\t\t\t\tid: item.getId(),\n\t\t\t\t\tentityId: item.getEntityId(),\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tselectedTypes.forEach((item) => {\n\t\t\tconst itemData = {\n\t\t\t\tid: item.getId(),\n\t\t\t\tentityId: item.getEntityId(),\n\t\t\t\ttitle: item.getTitle(),\n\t\t\t\ttabs: 'recents',\n\t\t\t};\n\t\t\tconst tabItem = this.tabsSelector.getDialog().getItem(itemData);\n\t\t\tif (!tabItem)\n\t\t\t{\n\t\t\t\tconst newItem = this.tabsSelector.getDialog().addItem(itemData);\n\t\t\t\tnewItem.select();\n\t\t\t}\n\t\t});\n\t}\n\n\tisItemSelected(item, selectedItems: Array): boolean\n\t{\n\t\treturn selectedItems.some((selectedItem) => {\n\t\t\treturn item.id === selectedItem.id;\n\t\t});\n\t}\n\n\tgetData(): Array\n\t{\n\t\tconst data = [];\n\t\tif (!this.switcher.isChecked())\n\t\t{\n\t\t\treturn [];\n\t\t}\n\t\tconst isTabsCheckboxChecked = this.tabsCheckbox.checked;\n\t\tconst selectedTypes = this.typeSelector.getDialog().getSelectedItems();\n\t\tselectedTypes.forEach((selectedType) => {\n\t\t\tconst type = {\n\t\t\t\tentityTypeId: selectedType.getId(),\n\t\t\t\tisChildrenListEnabled: false,\n\t\t\t};\n\t\t\tif (\n\t\t\t\tisTabsCheckboxChecked\n\t\t\t\t&& this.isItemSelected(selectedType, this.tabsSelector.getDialog().getSelectedItems())\n\t\t\t)\n\t\t\t{\n\t\t\t\ttype.isChildrenListEnabled = true;\n\t\t\t}\n\t\t\tdata.push(type);\n\t\t});\n\n\t\treturn data;\n\t}\n}\n\nclass CustomSectionsController\n{\n\tswitcher: BX.UI.Switcher;\n\tcontainer: HTMLDivElement;\n\tselectorContainer: HTMLDivElement;\n\tcustomSections: CustomSection[];\n\tselector: TagSelector;\n\tsettingsContainer: HTMLDivElement;\n\tsectionsListContainer: HTMLDivElement;\n\tsaveButton: Element;\n\tcancelButton: Element;\n\taddSectionItemButton: Element;\n\tisCreateSectionsViaAutomatedSolutionDetails: false;\n\n\tconstructor(options: {\n\t\tswitcher: {},\n\t\tcontainer: Element,\n\t\tselectorContainer: Element,\n\t\tcustomSections?: CustomSection[],\n\t\tisCreateSectionsViaAutomatedSolutionDetails: boolean,\n\t})\n\t{\n\t\tthis.switcher = options.switcher;\n\t\tthis.container = options.container;\n\t\tthis.selectorContainer = options.selectorContainer;\n\t\tif (Type.isArray(options.customSections))\n\t\t{\n\t\t\tthis.customSections = options.customSections;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.customSections = [];\n\t\t}\n\n\t\tif (Type.isBoolean(options.isCreateSectionsViaAutomatedSolutionDetails))\n\t\t{\n\t\t\tthis.isCreateSectionsViaAutomatedSolutionDetails = options.isCreateSectionsViaAutomatedSolutionDetails;\n\t\t}\n\n\t\tthis.initSelector();\n\n\t\tthis.settingsContainer = Tag.render`\n\t\t\t<div class=\"crm-type-hidden crm-type-custom-sections-settings-container\">\n\t\t\t\t<div class=\"crm-type-relation-subtitle\">${Loc.getMessage('CRM_TYPE_DETAIL_CUSTOM_SECTION_LIST_MSGVER_1')}</div>\n\t\t\t</div>\n\t\t`;\n\t\tthis.container.append(this.settingsContainer);\n\n\t\tthis.adjustInitialState();\n\n\t\tthis.bindEvents();\n\n\t\tthis.adjust();\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.unbindEvents();\n\t\tthis.selector?.unsubscribeAll();\n\t}\n\n\tinitSelector()\n\t{\n\t\tconst items = [];\n\t\tconst selectedItems = [];\n\n\t\tthis.customSections.forEach((section) => {\n\t\t\tconst item = {\n\t\t\t\tid: section.id,\n\t\t\t\tentityId: 'custom-section',\n\t\t\t\ttitle: section.title,\n\t\t\t\ttabs: 'recents',\n\t\t\t};\n\n\t\t\titems.push(item);\n\n\t\t\tif (section.isSelected)\n\t\t\t{\n\t\t\t\tselectedItems.push(item);\n\t\t\t}\n\t\t});\n\n\t\tconst tagSelectorOptions = {\n\t\t\tmultiple: false,\n\t\t\tdialogOptions: {\n\t\t\t\titems,\n\t\t\t\tselectedItems,\n\t\t\t\tdropdownMode: true,\n\t\t\t\theight: 200,\n\t\t\t\tshowAvatars: false,\n\t\t\t},\n\t\t};\n\n\t\tif (this.isCreateSectionsViaAutomatedSolutionDetails)\n\t\t{\n\t\t\ttagSelectorOptions.showCreateButton = false;\n\t\t\ttagSelectorOptions.dialogOptions.footer = Tag.render`\n\t\t\t\t<a\n\t\t\t\t\tonclick=\"${this.onOpenAutomatedSolutionCreationSliderClick.bind(this)}\"\n\t\t\t\t\tclass=\"ui-selector-footer-link ui-selector-footer-link-add\"\n\t\t\t\t>${Loc.getMessage('CRM_COMMON_ACTION_CREATE')}</a>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttagSelectorOptions.showCreateButton = true;\n\t\t\ttagSelectorOptions.createButtonCaption = Loc.getMessage('CRM_COMMON_ACTION_CONFIG');\n\t\t\ttagSelectorOptions.events = {\n\t\t\t\tonCreateButtonClick: this.onCreateButtonClick.bind(this),\n\t\t\t};\n\t\t}\n\n\t\tthis.selector = new TagSelector(tagSelectorOptions);\n\t\tthis.selector.renderTo(this.selectorContainer);\n\t}\n\n\treInitSelector()\n\t{\n\t\tthis.selector.getDialog().destroy();\n\t\tthis.selector.unsubscribeAll();\n\t\tthis.selector = null;\n\t\tDom.clean(this.selectorContainer);\n\t\tthis.initSelector();\n\t}\n\n\tshowSelector()\n\t{\n\t\tDom.removeClass(this.selectorContainer, 'crm-type-hidden');\n\t}\n\n\thideSelector()\n\t{\n\t\tDom.addClass(this.selectorContainer, 'crm-type-hidden');\n\t}\n\n\tadjustInitialState()\n\t{\n\t\tconst selectedSection = this.selector.getDialog().getSelectedItems();\n\t\tif (selectedSection.length > 0)\n\t\t{\n\t\t\tthis.switcher.check(true);\n\t\t}\n\t}\n\n\tbindEvents()\n\t{\n\t\tthis.adjust = this.adjust.bind(this);\n\t\tthis.onAutomatedSolutionUpdate = this.onAutomatedSolutionUpdate.bind(this);\n\n\t\tEventEmitter.subscribe(this.switcher, 'toggled', this.adjust);\n\t\tif (this.isCreateSectionsViaAutomatedSolutionDetails)\n\t\t{\n\t\t\tToolbarComponent.Instance.subscribeAutomatedSolutionUpdatedEvent(\n\t\t\t\tthis.onAutomatedSolutionUpdate,\n\t\t\t);\n\t\t}\n\t}\n\n\tunbindEvents()\n\t{\n\t\tEventEmitter.unsubscribe(this.switcher, 'toggled', this.adjust);\n\t\tToolbarComponent.Instance.unsubscribeAutomatedSolutionUpdatedEvent(this.onAutomatedSolutionUpdate);\n\t}\n\n\tonAutomatedSolutionUpdate(event: BaseEvent): void\n\t{\n\t\tconst id = Text.toInteger(event.getData().intranetCustomSectionId);\n\t\tconst title = String(event.getData().title);\n\n\t\tif (id <= 0 || !Type.isStringFilled(title))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentCustomSection = this.customSections.find(\n\t\t\t(section) => Text.toInteger(section.id) === id,\n\t\t);\n\n\t\tif (currentCustomSection)\n\t\t{\n\t\t\tcurrentCustomSection.title = title;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.customSections.push({\n\t\t\t\tid,\n\t\t\t\ttitle,\n\t\t\t});\n\t\t}\n\n\t\tthis.reInitSelector();\n\n\t\tthis.selectCustomSectionById(id);\n\t}\n\n\tselectCustomSectionById(id: number): void\n\t{\n\t\tconst dialog = this.selector.getDialog();\n\n\t\tdialog.deselectAll();\n\t\tdialog.getItem({\n\t\t\tentityId: 'custom-section',\n\t\t\tid,\n\t\t})?.select();\n\t}\n\n\tonOpenAutomatedSolutionCreationSliderClick(): void\n\t{\n\t\tvoid Router.Instance.openAutomatedSolutionDetail();\n\t}\n\n\tonCreateButtonClick()\n\t{\n\t\tthis.hideSelector();\n\t\tthis.showSectionsList();\n\t}\n\n\trenderSectionsConfig(): HTMLDivElement\n\t{\n\t\tif (!this.sectionsListContainer)\n\t\t{\n\t\t\tthis.sectionsListContainer = Tag.render`<div class=\"crm-type-custom-sections-list-container\"></div>`;\n\t\t\tthis.settingsContainer.append(this.sectionsListContainer);\n\t\t}\n\n\t\tthis.renderSectionsList(this.sectionsListContainer);\n\n\t\tif (!this.addSectionItemButton)\n\t\t{\n\t\t\tthis.addSectionItemButton = Tag.render`\n\t\t\t\t<div class=\"crm-type-custom-section-add-item-container\">\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"crm-type-custom-section-add-item-button\"\n\t\t\t\t\t\tonclick=\"${() => this.sectionsListContainer.append(this.renderSectionItem())}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${Loc.getMessage('CRM_COMMON_ACTION_CREATE')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tthis.settingsContainer.append(this.addSectionItemButton);\n\t\t}\n\n\t\tif (!this.buttonsContainer)\n\t\t{\n\t\t\tthis.settingsContainer.append(Tag.render`<hr class=\"crm-type-custom-sections-line\">`);\n\t\t\tthis.buttonsContainer = Tag.render`<div class=\"crm-type-custom-sections-buttons-container\"></div>`;\n\t\t\tthis.settingsContainer.append(this.buttonsContainer);\n\t\t}\n\n\t\tif (!this.saveButton)\n\t\t{\n\t\t\tthis.saveButton = Tag.render`<span class=\"ui-btn ui-btn-primary\" onclick=\"${this.onSaveConfigHandler.bind(this)}\">${Loc.getMessage('CRM_COMMON_ACTION_SAVE')}</span>`;\n\t\t\tthis.buttonsContainer.append(this.saveButton);\n\t\t}\n\n\t\tif (!this.cancelButton)\n\t\t{\n\t\t\tthis.cancelButton = Tag.render`<span class=\"ui-btn ui-btn-light-border\" onclick=\"${this.onCancelConfigHandler.bind(this)}\">${Loc.getMessage('CRM_COMMON_ACTION_CANCEL')}</span>`;\n\t\t\tthis.buttonsContainer.append(this.cancelButton);\n\t\t}\n\t}\n\n\tonSaveConfigHandler(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tconst selectedSection = this.getSelectedSection();\n\t\tconst newCustomSections = [];\n\t\t[...this.sectionsListContainer.children].forEach((node) => {\n\t\t\tconst idInput = node.querySelector('[name=\"id\"]');\n\t\t\tconst valueInput = node.querySelector('[name=\"value\"]');\n\t\t\tif (!idInput || !valueInput)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst id = idInput.value;\n\t\t\tconst title = valueInput.value;\n\t\t\tlet isSelected = false;\n\t\t\tif (selectedSection && selectedSection.id === id)\n\t\t\t{\n\t\t\t\tisSelected = true;\n\t\t\t}\n\n\t\t\tif (title)\n\t\t\t{\n\t\t\t\tnewCustomSections.push({\n\t\t\t\t\tid,\n\t\t\t\t\ttitle,\n\t\t\t\t\tisSelected,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.customSections = newCustomSections;\n\n\t\tthis.reInitSelector();\n\t\tthis.showSelector();\n\n\t\tthis.hideSectionsList();\n\t}\n\n\tonCancelConfigHandler(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.showSelector();\n\t\tthis.hideSectionsList();\n\t}\n\n\trenderSectionsList(listContainer: HTMLDivElement)\n\t{\n\t\tDom.clean(listContainer);\n\t\tthis.customSections.forEach((section) => {\n\t\t\tlistContainer.append(this.renderSectionItem(section));\n\t\t});\n\n\t\tlistContainer.append(this.renderSectionItem());\n\t}\n\n\trenderSectionItem(section: ?CustomSection): HTMLDivElement\n\t{\n\t\tconst item = new CustomSectionItem(section);\n\t\tconst node = Tag.render`\n\t\t\t<div style=\"margin-bottom: 10px;\" class=\"ui-ctl ui-ctl-textbox ui-ctl-w100 ui-ctl-row\">\n\t\t\t\t<input type=\"hidden\" name=\"id\" value=\"${item.getId()}\" />\n\t\t\t\t<input class=\"ui-ctl-element\" name=\"value\" type=\"text\" value=\"${Text.encode(item.getValue())}\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"crm-type-custom-section-remove-item\"\n\t\t\t\t\tonclick=\"${(event) => {\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tthis.sectionsListContainer.removeChild(item.getNode());\n\t\t\t\t\t}}\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\titem.setNode(node);\n\n\t\treturn node;\n\t}\n\n\tshowSectionsList()\n\t{\n\t\tthis.renderSectionsConfig();\n\t\tDom.removeClass(this.settingsContainer, 'crm-type-hidden');\n\t}\n\n\thideSectionsList()\n\t{\n\t\tDom.clean(this.sectionsListContainer);\n\t\tDom.addClass(this.settingsContainer, 'crm-type-hidden');\n\t}\n\n\tadjust()\n\t{\n\t\tif (this.switcher.isChecked())\n\t\t{\n\t\t\tDom.removeClass(this.container, 'crm-type-hidden');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(this.container, 'crm-type-hidden');\n\t\t}\n\t}\n\n\tgetSelectedSection(): ?CustomSection\n\t{\n\t\tconst selectedItems = this.selector.getDialog().getSelectedItems();\n\t\tif (selectedItems.length > 0)\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: selectedItems[0].getId(),\n\t\t\t\ttitle: selectedItems[0].getTitle(),\n\t\t\t};\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetData()\n\t{\n\t\tconst data = {\n\t\t\tcustomSectionId: 0,\n\t\t\tcustomSections: this.customSections,\n\t\t};\n\n\t\tif (this.switcher.isChecked())\n\t\t{\n\t\t\tconst selectedSection = this.getSelectedSection();\n\t\t\tif (selectedSection)\n\t\t\t{\n\t\t\t\tdata.customSectionId = selectedSection.id;\n\t\t\t}\n\t\t}\n\n\t\treturn data;\n\t}\n}\n\nclass CustomSectionItem\n{\n\tconstructor(customSection: CustomSection = null)\n\t{\n\t\tthis.id = customSection ? customSection.id : `new_${Text.getRandom()}`;\n\t\tthis.value = customSection ? customSection.title : '';\n\t}\n\n\tsetNode(node: Element)\n\t{\n\t\tthis.node = node;\n\t}\n\n\tgetId(): ?number\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetNode(): ?Element\n\t{\n\t\treturn this.node;\n\t}\n\n\tgetInput(): ?Element\n\t{\n\t\tconst node = this.getNode();\n\t\tif (!node)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tif (node instanceof HTMLInputElement)\n\t\t{\n\t\t\treturn node;\n\t\t}\n\n\t\treturn node.querySelector('input');\n\t}\n\n\tgetValue(): string\n\t{\n\t\tconst input = this.getInput();\n\t\tif (input && input.value)\n\t\t{\n\t\t\treturn input.value;\n\t\t}\n\n\t\treturn this.value || '';\n\t}\n}\n"],"names":["namespace","Reflection","instance","TypeDetail","params","Map","Type","isPlainObject","type","isNew","isSaved","form","container","errorsContainer","presets","relations","isRestricted","Boolean","restrictionErrorMessage","isStringFilled","restrictionSliderCode","isExternal","isCreateSectionsViaAutomatedSolutionDetails","buttonsPanel","document","getElementById","saveButton","cancelButton","deleteButton","bindEvents","fillTabs","getId","disablePresetsView","presetSelectorContainer","querySelector","Dom","addClass","enablePresetsView","removeClass","initRelations","initCustomSections","Event","bind","event","save","passive","userFieldOption","getBooleanFieldNodeByName","disableLinkedUserFieldsIfNotAvailable","querySelectorAll","forEach","linkedUserFieldNode","enableUserFieldIfAnyLinkedChecked","handleSliderDestroy","top","BX","EventEmitter","subscribe","getData","sliderEvent","slider","getSlider","getFrameWindow","window","destroy","unsubscribe","customSectionController","activeTab","presetsTab","hideErrors","click","isBooleanFieldChecked","setBooleanFieldCheckedState","loader","Loader","size","isProgress","getLoader","isShown","show","hide","setTimeout","getClass","UI","InfoHelper","showErrors","stopProgress","preventDefault","startProgress","setTitle","value","TypeModel","getBooleanFieldNames","fieldName","fieldNode","data","linkedUserFields","name","dataset","slice","length","replace","setLinkedUserFields","setRelations","parent","parentRelationsController","child","childRelationsController","customSectionData","setCustomSectionId","customSectionId","setCustomSections","customSections","setIsExternalDynamicalType","setIsSaveFromTypeDetail","isSaveFromTypeDetail","then","response","afterSave","errors","role","entityTypeIds","checkboxes","checkbox","checked","push","entityTypeId","addDataToSlider","Object","hasOwn","Router","Instance","setUrlTemplates","urlTemplates","close","emitTypeUpdatedEvent","isUrlChanged","SidePanel","getSliderByWindow","ToolbarComponent","key","isString","set","text","message","isDomNode","innerText","style","parentNode","console","error","MessageBox","confirm","Loc","getMessage","Promise","resolve","isObject","closeSliderOrRedirect","getTypeListUrl","box","tabNode","tab","tabs","tabNameToShow","keys","tabName","get","presetId","presetSelector","currentPresetNode","currentPreset","getPresetById","title","presetNode","preset","updateInputs","textContent","Text","encode","fields","id","node","nodeName","toggleClass","hasClass","isChecked","RelationsController","switcher","Switcher","getById","typeSelectorContainer","tabsContainer","tabsCheckbox","tabsSelectorContainer","CustomSectionsController","selectorContainer","getCustomSections","showTab","applyPreset","target","toggleBooleanField","options","initSelectors","adjustInitialState","adjust","unselectedTypes","selectedTypes","unselectedTabs","selectedTabs","relation","item","entityId","isChildrenListEnabled","typeSelector","TagSelector","dialogOptions","enableSearch","multiple","items","selectedItems","dropdownMode","height","showAvatars","events","onAfterTagAdd","onAfterTagRemove","renderTo","tabsSelector","getDialog","getSelectedItems","check","getItems","isItemSelected","deselect","removeItem","removeTag","getEntityId","itemData","getTitle","tabItem","getItem","newItem","addItem","select","some","selectedItem","isTabsCheckboxChecked","selectedType","isArray","isBoolean","initSelector","settingsContainer","Tag","render","append","unbindEvents","selector","unsubscribeAll","section","isSelected","tagSelectorOptions","showCreateButton","footer","onOpenAutomatedSolutionCreationSliderClick","createButtonCaption","onCreateButtonClick","clean","selectedSection","onAutomatedSolutionUpdate","subscribeAutomatedSolutionUpdatedEvent","unsubscribeAutomatedSolutionUpdatedEvent","toInteger","intranetCustomSectionId","String","currentCustomSection","find","reInitSelector","selectCustomSectionById","dialog","deselectAll","openAutomatedSolutionDetail","hideSelector","showSectionsList","sectionsListContainer","renderSectionsList","addSectionItemButton","renderSectionItem","buttonsContainer","onSaveConfigHandler","onCancelConfigHandler","getSelectedSection","newCustomSections","children","idInput","valueInput","showSelector","hideSectionsList","listContainer","CustomSectionItem","getValue","removeChild","getNode","setNode","renderSectionsConfig","customSection","getRandom","HTMLInputElement","input","getInput"],"mappings":"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"}