{"version":3,"file":"script.js","sources":["src/components/card.js","src/components/tabs/common-tab.js","src/components/tabs/types-tab.js","src/components/main.js","src/store/validation.js","src/store/actions.js","src/store/mutations.js","src/store/index.js","src/app.js"],"sourcesContent":["import '../css/card.css';\n\nexport const Card = {\n\tprops: {\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tdescription: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): Object {\n\t\treturn {\n\t\t\tisShown: true,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div v-if=\"isShown\" class=\"crm-type-ui-card crm-type-ui-card-message\">\n\t\t\t<div class=\"crm-type-ui-card-header\">\n\t\t\t\t<div class=\"crm-type-ui-card-message-icon crm-type-ui-card-message-icon--custom-fields\"></div>\n\t\t\t\t<div class=\"crm-type-ui-card-message-title\">{{ title }}</div>\n\t\t\t</div>\n\t\t\t<div class=\"crm-type-ui-card-body\">\n\t\t\t\t<div class=\"crm-type-ui-card-message-description\">{{ description }}</div>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tclass=\"crm-type-ui-card-message-close-button\" \n\t\t\t\t:title=\"$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_CARD_CLOSE_TITLE')\"\n\t\t\t\t@click=\"isShown = false\"\n\t\t\t></div>\n\t\t</div>\n\t`,\n};\n","import { Card } from '../card';\nimport '../../css/tabs/common-tab.css';\n\nexport const CommonTab = {\n\tcomponents: {\n\t\tCard,\n\t},\n\tcomputed: {\n\t\ttitle: {\n\t\t\tget(): ?string\n\t\t\t{\n\t\t\t\treturn this.$store.state.automatedSolution.title;\n\t\t\t},\n\t\t\tset(title: string): void\n\t\t\t{\n\t\t\t\tthis.$store.dispatch('setTitle', title);\n\t\t\t},\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div data-tab=\"common\">\n\t\t\t<div class=\"ui-title-3\">{{ $Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_TAB_TITLE_COMMON') }}</div>\n\t\t\t<Card\n\t\t\t\t:title=\"$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_CARD_COMMON_TITLE')\"\n\t\t\t\t:description=\"$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_CARD_COMMON_DESCRIPTION')\"\n\t\t\t/>\n\t\t\t<div class=\"ui-form-row crm-automated-solution-details-form-label-xs\">\n\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">{{ $Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_FIELD_LABEL_TITLE') }}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tv-model=\"title\"\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\t\t:placeholder=\"$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_FIELD_PLACEHOLDER_TITLE')\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Router } from 'crm.router';\nimport { type BaseEvent } from 'main.core.events';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { TagSelector } from 'ui.entity-selector';\nimport { Card } from '../card';\n\nexport const TypesTab = {\n\tcomponents: {\n\t\tCard,\n\t},\n\t// tag selector should not be reactive (recreated on store mutations)\n\tboundTypesTagSelector: null,\n\texternalTypesTagSelector: null,\n\tcrmTypesTagSelector: null,\n\n\tmounted()\n\t{\n\t\tthis.boundTypesTagSelector = new TagSelector({\n\t\t\tmultiple: true,\n\t\t\tshowAddButton: false,\n\t\t\tshowCreateButton: true,\n\t\t\t// all preselected items go to this selector\n\t\t\titems: this.$store.state.automatedSolution.typeIds.map(\n\t\t\t\t(typeId: number) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid: typeId,\n\t\t\t\t\t\tentityId: 'dynamic_type',\n\t\t\t\t\t\ttitle: this.$store.state.dynamicTypesTitles[typeId],\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t),\n\t\t\tevents: {\n\t\t\t\tonCreateButtonClick: this.handleCreateTypeClick,\n\t\t\t\tonTagRemove: this.removeTypeIdByTagRemoveEvent,\n\t\t\t},\n\t\t});\n\t\tthis.boundTypesTagSelector.renderTo(this.$refs.boundTypesTagSelectorContainer);\n\n\t\t// these selectors contain types only if there were added here in the app lifetime by user interaction\n\t\t// selector states are not synced reactively in the app lifetime\n\t\tthis.crmTypesTagSelector = this.initFilteredTagSelector(true, false);\n\t\tthis.crmTypesTagSelector.renderTo(this.$refs.crmTypesTagSelectorContainer);\n\n\t\tthis.externalTypesTagSelector = this.initFilteredTagSelector(false, true);\n\t\tthis.externalTypesTagSelector.renderTo(this.$refs.externalTypesTagSelectorContainer);\n\t},\n\n\tmethods: {\n\t\tinitFilteredTagSelector(\n\t\t\tisOnlyCrmTypes,\n\t\t\tisOnlyExternalTypes,\n\t\t): TagSelector\n\t\t{\n\t\t\treturn new TagSelector({\n\t\t\t\tmultiple: true,\n\t\t\t\taddButtonCaption: this.$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_TAG_SELECTOR_ADD_BUTTON_CAPTION'),\n\t\t\t\taddButtonCaptionMore: this.$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_TAG_SELECTOR_ADD_BUTTON_CAPTION'),\n\t\t\t\tdialogOptions: {\n\t\t\t\t\theight: 200,\n\t\t\t\t\tenableSearch: true,\n\t\t\t\t\tcontext: 'crm.automated_solutions.details',\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\tshowAvatars: false,\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'dynamic_type',\n\t\t\t\t\t\t\tdynamicLoad: true,\n\t\t\t\t\t\t\tdynamicSearch: true,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tshowAutomatedSolutionBadge: true,\n\t\t\t\t\t\t\t\tisOnlyExternalTypes,\n\t\t\t\t\t\t\t\tisOnlyCrmTypes,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd: this.addTypeIdByTagAddEvent,\n\t\t\t\t\tonTagRemove: this.removeTypeIdByTagRemoveEvent,\n\t\t\t\t},\n\n\t\t\t});\n\t\t},\n\n\t\taddTypeIdByTagAddEvent(event: BaseEvent): void\n\t\t{\n\t\t\tconst { tag } = event.getData();\n\n\t\t\tthis.$store.dispatch('addTypeId', tag.getId());\n\t\t},\n\n\t\tremoveTypeIdByTagRemoveEvent(event: BaseEvent): void\n\t\t{\n\t\t\tconst { tag } = event.getData();\n\n\t\t\tthis.$store.dispatch('removeTypeId', tag.getId());\n\t\t},\n\n\t\thandleCreateTypeClick(): void\n\t\t{\n\t\t\tif (this.$store.getters.isSaved)\n\t\t\t{\n\t\t\t\tthis.openTypeCreationSlider();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tMessageBox.confirm(\n\t\t\t\tthis.$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_NEED_SAVE_POPUP_MESSAGE'),\n\t\t\t\t(messageBox) => {\n\t\t\t\t\treturn this.save()\n\t\t\t\t\t\t.then(() => this.openTypeCreationSlider())\n\t\t\t\t\t\t.finally(() => messageBox.close())\n\t\t\t\t\t;\n\t\t\t\t},\n\t\t\t\tthis.$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_NEED_SAVE_POPUP_YES_CAPTION'),\n\t\t\t);\n\t\t},\n\n\t\topenTypeCreationSlider(): void\n\t\t{\n\t\t\tvoid Router.Instance.openTypeDetail(\n\t\t\t\t0,\n\t\t\t\tnull,\n\t\t\t\t{\n\t\t\t\t\tautomatedSolutionId: this.$store.state.automatedSolution.id,\n\t\t\t\t\tactiveTabId: 'common',\n\t\t\t\t\tisExternal: 'Y',\n\t\t\t\t},\n\t\t\t).then(() => {\n\t\t\t\tthis.$Bitrix.Application.get().reloadWithNewUri(this.$store.state.automatedSolution.id, {\n\t\t\t\t\tactiveTabId: 'types',\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\tsave(): Promise\n\t\t{\n\t\t\treturn this.$store.dispatch('save');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div>\n\t\t\t<div class=\"ui-title-3\">{{ $Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_TAB_TITLE_TYPES') }}</div>\n\t\t\t<Card\n\t\t\t\t:title=\"$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_CARD_TYPES_TITLE')\"\n\t\t\t\t:description=\"$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_CARD_TYPES_DESCRIPTION')\"\n\t\t\t/>\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_FIELD_LABEL_CREATE_TYPE') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<div ref=\"boundTypesTagSelectorContainer\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_FIELD_LABEL_CRM_TYPES') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<div ref=\"crmTypesTagSelectorContainer\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_FIELD_LABEL_EXTERNAL_TYPES') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<div ref=\"externalTypesTagSelectorContainer\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Dom, Type } from 'main.core';\nimport { type BaseEvent, EventEmitter } from 'main.core.events';\nimport type { Error } from '../store';\nimport { CommonTab } from './tabs/common-tab';\nimport { TypesTab } from './tabs/types-tab';\nimport '../css/main.css';\n\nexport const Main = {\n\tcomponents: {\n\t\tCommonTab,\n\t\tTypesTab,\n\t},\n\tprops: {\n\t\tinitialActiveTabId: String,\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\ttabs: {\n\t\t\t\t// tab show flags\n\t\t\t\tcommon: this.initialActiveTabId === 'common',\n\t\t\t\ttypes: this.initialActiveTabId === 'types',\n\t\t\t},\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tallTabIds(): string[]\n\t\t{\n\t\t\treturn Object.keys(this.tabs);\n\t\t},\n\t\tsaveButton(): HTMLElement\n\t\t{\n\t\t\treturn document.getElementById('ui-button-panel-save');\n\t\t},\n\t\tcancelButton(): HTMLElement\n\t\t{\n\t\t\treturn document.getElementById('ui-button-panel-cancel');\n\t\t},\n\t\tdeleteButton(): ?HTMLElement\n\t\t{\n\t\t\treturn document.getElementById('ui-button-panel-remove');\n\t\t},\n\t\tallButtons(): HTMLElement[]\n\t\t{\n\t\t\tconst buttons = [this.saveButton, this.cancelButton];\n\n\t\t\tif (this.deleteButton)\n\t\t\t{\n\t\t\t\tbuttons.push(this.deleteButton);\n\t\t\t}\n\n\t\t\treturn buttons;\n\t\t},\n\n\t\terrors(): Error[]\n\t\t{\n\t\t\treturn this.$store.state.errors;\n\t\t},\n\n\t\thasErrors(): boolean\n\t\t{\n\t\t\treturn Type.isArrayFilled(this.errors);\n\t\t},\n\t},\n\n\tmounted()\n\t{\n\t\tEventEmitter.subscribe('BX.Crm.AutomatedSolution.Details:showTab', this.showTabFromEvent);\n\t\tEventEmitter.subscribe('BX.Crm.AutomatedSolution.Details:save', this.save);\n\t\tEventEmitter.subscribe('BX.Crm.AutomatedSolution.Details:delete', this.delete);\n\t},\n\n\tbeforeUnmount()\n\t{\n\t\tEventEmitter.unsubscribe('BX.Crm.AutomatedSolution.Details:showTab', this.showTabFromEvent);\n\t\tEventEmitter.unsubscribe('BX.Crm.AutomatedSolution.Details:save', this.save);\n\t\tEventEmitter.unsubscribe('BX.Crm.AutomatedSolution.Details:delete', this.delete);\n\t},\n\n\tmethods: {\n\t\tshowTabFromEvent(event: BaseEvent): void\n\t\t{\n\t\t\tconst { tabId } = event.getData();\n\n\t\t\tthis.showTab(tabId);\n\t\t},\n\n\t\tshowTab(tabId: string): void\n\t\t{\n\t\t\tif (!this.allTabIds.includes(tabId))\n\t\t\t{\n\t\t\t\tthrow new Error('invalid tab id');\n\t\t\t}\n\n\t\t\tfor (const id of this.allTabIds)\n\t\t\t{\n\t\t\t\tthis.tabs[id] = false;\n\t\t\t}\n\t\t\tthis.tabs[tabId] = true;\n\t\t},\n\n\t\tsave(): void\n\t\t{\n\t\t\tthis.$store.dispatch('save')\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.$Bitrix.Application.get().closeSliderOrRedirect();\n\t\t\t\t})\n\t\t\t\t.catch(() => {}) // errors will be displayed reactively\n\t\t\t\t.finally(() => this.unlockButtons())\n\t\t\t;\n\t\t},\n\n\t\tdelete(): void\n\t\t{\n\t\t\tthis.$store.dispatch('delete')\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.$Bitrix.Application.get().closeSliderOrRedirect();\n\t\t\t\t})\n\t\t\t\t.catch(() => {}) // errors will be displayed reactively\n\t\t\t\t.finally(() => this.unlockButtons())\n\t\t\t;\n\t\t},\n\n\t\tunlockButtons(): void\n\t\t{\n\t\t\tthis.allButtons.forEach((button: HTMLElement) => {\n\t\t\t\tDom.removeClass(button, 'ui-btn-wait');\n\t\t\t});\n\t\t},\n\n\t\thideError(error: Error): void\n\t\t{\n\t\t\tthis.$store.dispatch('removeError', error);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"crm-automated-solution-details\">\n\t\t\t<form class=\"ui-form\">\n\t\t\t\t<div v-if=\"hasErrors\" class=\"ui-alert ui-alert-danger\">\n\t\t\t\t\t<template\n\t\t\t\t\t\tv-for=\"error in errors\"\n\t\t\t\t\t\t:key=\"error.message\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class=\"ui-alert-message\">{{error.message}}</span>\n\t\t\t\t\t\t<span class=\"ui-alert-close-btn\" @click=\"hideError(error)\"></span>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t\t<CommonTab v-show=\"tabs.common\"/>\n\t\t\t\t<TypesTab v-show=\"tabs.types\"/>\n\t\t\t</form>\n\t\t</div>\n\t`,\n};\n","import { Text, Type } from 'main.core';\nimport type { Error } from './index';\n\nexport function normalizeId(id: any): ?number\n{\n\tif (Type.isNil(id))\n\t{\n\t\treturn null;\n\t}\n\n\treturn Text.toInteger(id);\n}\n\nexport function normalizeDynamicTypesTitles(titles: any): Object\n{\n\tif (!Type.isPlainObject(titles))\n\t{\n\t\treturn {};\n\t}\n\n\tconst result = {};\n\tfor (const [key, value] of Object.entries(titles))\n\t{\n\t\tif (Text.toInteger(key) > 0 && Type.isStringFilled(value))\n\t\t{\n\t\t\tresult[key] = value;\n\t\t}\n\t}\n\n\treturn result;\n}\n\nexport function normalizeTitle(title: any): ?string\n{\n\tif (Type.isNil(title))\n\t{\n\t\treturn null;\n\t}\n\n\treturn String(title);\n}\n\nexport function normalizeTypesIds(typeIds: any): number[]\n{\n\tif (!Type.isArrayFilled(typeIds))\n\t{\n\t\treturn [];\n\t}\n\n\treturn typeIds.map((x) => normalizeTypeId(x)).filter((x) => x > 0);\n}\n\nexport function normalizeTypeId(typeId: any): number\n{\n\treturn Text.toInteger(typeId);\n}\n\nexport function normalizeErrors(errors: any): Error[]\n{\n\tif (!Type.isArrayFilled(errors))\n\t{\n\t\treturn [];\n\t}\n\n\treturn errors.filter((x) => isValidError(x));\n}\n\nexport function isValidError(error: any): boolean\n{\n\treturn (\n\t\tType.isStringFilled(error.message)\n\t\t&& (\n\t\t\tType.isNil(error.code)\n\t\t\t|| Type.isStringFilled(error.code)\n\t\t\t|| Type.isInteger(error.code)\n\t\t)\n\t\t&& (\n\t\t\tType.isNil(error.customData)\n\t\t\t|| Type.isPlainObject(error.customData)\n\t\t)\n\t);\n}\n","import { ToolbarComponent } from 'crm.toolbar-component';\nimport { ajax as Ajax, Runtime, Type } from 'main.core';\nimport { FeaturePromotersRegistry } from 'ui.info-helper';\nimport { Error } from './index';\nimport { normalizeId, normalizeTitle } from './validation';\n\nexport default {\n\tsetState: (store, stateToSet: StateShape): void => {\n\t\tstore.commit('setState', stateToSet);\n\t},\n\n\tsetErrors: (store, errors: Error[]): void => {\n\t\tstore.commit('setErrors', errors);\n\t},\n\tremoveError: (store, error: Error): void => {\n\t\tstore.commit('removeError', error);\n\t},\n\n\tsetTitle: (store, title: string): void => {\n\t\tstore.commit('setTitle', title);\n\t},\n\n\taddTypeId: (store, typeId: number): void => {\n\t\tstore.commit('addTypeId', typeId);\n\t},\n\tremoveTypeId: (store, typeId: number): void => {\n\t\tstore.commit('removeTypeId', typeId);\n\t},\n\n\tsave: (store): Promise<void, string[]> => {\n\t\tlet savePromise: ?Promise = null;\n\n\t\tconst fields = Runtime.clone(store.state.automatedSolution);\n\t\tif (fields.typeIds.length <= 0)\n\t\t{\n\t\t\t// we cant send an empty array in form data\n\t\t\tfields.typeIds = false;\n\t\t}\n\n\t\tif (store.getters.isNew)\n\t\t{\n\t\t\tsavePromise = runAjaxAction('crm.automatedsolution.add', {\n\t\t\t\tdata: {\n\t\t\t\t\tfields,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsavePromise = runAjaxAction('crm.automatedsolution.update', {\n\t\t\t\tdata: {\n\t\t\t\t\tid: store.state.automatedSolution.id,\n\t\t\t\t\tfields,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\treturn savePromise\n\t\t\t.then(({ data }) => {\n\t\t\t\tstore.dispatch('setState', {\n\t\t\t\t\tautomatedSolution: data.automatedSolution,\n\t\t\t\t});\n\t\t\t\temitUpdateEventToOutsideWorld(data.automatedSolution);\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.warn('could not save automated solution', { response, state: Runtime.clone(store.state) });\n\n\t\t\t\tconst { errors } = response;\n\n\t\t\t\tlet wasErrorHandled = false;\n\t\t\t\tfor (const error of errors)\n\t\t\t\t{\n\t\t\t\t\tif (Type.isStringFilled(error.customData?.sliderCode))\n\t\t\t\t\t{\n\t\t\t\t\t\tFeaturePromotersRegistry.getPromoter({ code: error.customData.sliderCode }).show();\n\t\t\t\t\t\twasErrorHandled = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!wasErrorHandled)\n\t\t\t\t{\n\t\t\t\t\t// to show errors in ui\n\t\t\t\t\tstore.dispatch('setErrors', errors);\n\t\t\t\t}\n\n\t\t\t\tthrow errors;\n\t\t\t})\n\t\t;\n\t},\n\n\tdelete: (store): Promise<void, string[]> => {\n\t\treturn runAjaxAction('crm.automatedsolution.delete', {\n\t\t\tdata: {\n\t\t\t\tid: store.state.automatedSolution.id,\n\t\t\t},\n\t\t})\n\t\t\t.then(() => {\n\t\t\t\tstore.dispatch('setState', {});\n\t\t\t\temitUpdateEventToOutsideWorld({ id: store.state.automatedSolution.id });\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.warn('could not delete automated solution', { response, state: Runtime.clone(store.state) });\n\n\t\t\t\tstore.dispatch('setErrors', response.errors);\n\n\t\t\t\tthrow response.errors;\n\t\t\t})\n\t\t;\n\t},\n};\n\nfunction runAjaxAction(...ajaxRunActionArgs): Promise\n{\n\t// vuex don't understand BX.Promise. 'this.$store.dispatch.then' and 'subscribeAction({after})' won't work\n\t// wrap it in native Promise to fix it\n\n\treturn new Promise((resolve, reject) => {\n\t\tAjax.runAction(...ajaxRunActionArgs)\n\t\t\t.then(resolve)\n\t\t\t.catch(reject)\n\t\t;\n\t});\n}\n\nfunction emitUpdateEventToOutsideWorld({ id, title, intranetCustomSectionId }): void\n{\n\tconst data = {\n\t\tid: normalizeId(id),\n\t\ttitle: normalizeTitle(title),\n\t\tintranetCustomSectionId: normalizeId(intranetCustomSectionId),\n\t};\n\n\tToolbarComponent.Instance.emitAutomatedSolutionUpdatedEvent(data);\n}\n","/* eslint-disable no-param-reassign */\nimport { Error } from './index';\nimport {\n\tisValidError,\n\tnormalizeDynamicTypesTitles,\n\tnormalizeErrors,\n\tnormalizeId,\n\tnormalizeTitle,\n\tnormalizeTypeId,\n\tnormalizeTypesIds,\n} from './validation';\n\nexport default {\n\t/**\n\t * Sets new initial state for the store. Modification flag is reset\n\t */\n\tsetState: (state: StateShape, stateToSet: StateShape): void => {\n\t\tstate.automatedSolution.id = normalizeId(stateToSet.automatedSolution?.id);\n\n\t\tstate.automatedSolution.title = normalizeTitle(stateToSet.automatedSolution?.title);\n\n\t\tstate.automatedSolution.typeIds = normalizeTypesIds(stateToSet.automatedSolution?.typeIds);\n\n\t\tstate.dynamicTypesTitles = normalizeDynamicTypesTitles(stateToSet.dynamicTypesTitles);\n\n\t\tstate.errors = normalizeErrors(stateToSet.errors);\n\n\t\tstate.isModified = false;\n\t},\n\n\tsetErrors: (state: StateShape, errors: Error[]): void => {\n\t\tstate.errors = normalizeErrors(errors);\n\t},\n\tremoveError: (state: StateShape, error: Error): void => {\n\t\tif (!isValidError(error))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tstate.errors = state.errors.filter((x) => x !== error);\n\t},\n\n\tsetTitle: (state: StateShape, title: string): void => {\n\t\tconst newTitle = normalizeTitle(title);\n\n\t\tif (newTitle !== state.automatedSolution.title)\n\t\t{\n\t\t\tstate.isModified = true;\n\t\t}\n\n\t\tstate.automatedSolution.title = newTitle;\n\t},\n\n\taddTypeId: (state: StateShape, typeId: number): void => {\n\t\tconst normalizedTypeId = normalizeTypeId(typeId);\n\t\tif (normalizedTypeId <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (state.automatedSolution.typeIds.includes(normalizedTypeId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tstate.automatedSolution.typeIds.push(normalizedTypeId);\n\t\tstate.isModified = true;\n\t},\n\n\tremoveTypeId: (state: StateShape, typeId: number): void => {\n\t\tconst normalizedTypeId = normalizeTypeId(typeId);\n\t\tif (normalizedTypeId <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst newTypeIds = state.automatedSolution.typeIds.filter((id) => id !== normalizedTypeId);\n\n\t\tif (newTypeIds.length !== state.automatedSolution.typeIds.length)\n\t\t{\n\t\t\tstate.isModified = true;\n\t\t}\n\n\t\tstate.automatedSolution.typeIds = newTypeIds;\n\t},\n};\n","import actions from './actions';\nimport mutations from './mutations';\n\ntype StateShape = {\n\tautomatedSolution: {\n\t\tid?: ?number,\n\t\ttitle?: ?string,\n\t\ttypeIds?: number[],\n\t},\n\n\tdynamicTypesTitles: {[key: number]: string},\n\n\terrors: Error[],\n\tisModified: boolean,\n};\n\nexport type Error = {\n\tmessage: string,\n\tcode: string | number,\n\tcustomData: ?Object,\n};\n\nexport const store = {\n\tstrict: true,\n\tstate(): StateShape\n\t{\n\t\treturn {\n\t\t\tautomatedSolution: {\n\t\t\t\tid: null,\n\t\t\t\ttitle: null,\n\t\t\t\ttypeIds: [],\n\t\t\t},\n\n\t\t\tdynamicTypesTitles: {},\n\n\t\t\terrors: [],\n\n\t\t\tisModified: false,\n\t\t};\n\t},\n\tgetters: {\n\t\tisNew: (state: StateShape) => {\n\t\t\treturn state.automatedSolution.id <= 0;\n\t\t},\n\t\tisSaved: (state: StateShape, getters) => {\n\t\t\treturn !state.isModified && !getters.isNew;\n\t\t},\n\t},\n\tactions,\n\tmutations,\n};\n","import { Router } from 'crm.router';\nimport { Type } from 'main.core';\nimport { BitrixVue, VueCreateAppResult } from 'ui.vue3';\nimport { createStore } from 'ui.vue3.vuex';\nimport { Main } from './components/main';\nimport { store } from './store/index';\n\nexport class App\n{\n\t#container: HTMLElement;\n\t#initialActiveTabId: string;\n\t#initialState: ?Object;\n\n\t#app: ?VueCreateAppResult = null;\n\n\tconstructor({ containerId, activeTabId, state })\n\t{\n\t\tthis.#container = document.getElementById(containerId);\n\n\t\tif (!Type.isDomNode(this.#container))\n\t\t{\n\t\t\tthrow new Error('container not found');\n\t\t}\n\n\t\tthis.#initialActiveTabId = String(activeTabId);\n\n\t\tif (Type.isPlainObject(state))\n\t\t{\n\t\t\tthis.#initialState = state;\n\t\t}\n\t}\n\n\tstart(): void\n\t{\n\t\t// eslint-disable-next-line unicorn/no-this-assignment\n\t\tconst appWrapperRef = this;\n\n\t\tthis.#app = BitrixVue.createApp(\n\t\t\t{\n\t\t\t\t...Main,\n\t\t\t\tbeforeCreate(): void\n\t\t\t\t{\n\t\t\t\t\tthis.$bitrix.Application.set(appWrapperRef);\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tinitialActiveTabId: this.#initialActiveTabId,\n\t\t\t},\n\t\t);\n\n\t\tconst vuexStore = createStore(store);\n\t\tif (this.#initialState)\n\t\t{\n\t\t\tvuexStore.dispatch('setState', this.#initialState);\n\t\t}\n\n\t\tthis.#app.use(vuexStore);\n\n\t\tthis.#app.mount(this.#container);\n\t}\n\n\tstop(): void\n\t{\n\t\tthis.#app.unmount();\n\n\t\tthis.#app = null;\n\t}\n\n\treloadWithNewUri(automatedSolutionId: number, queryParams: Object = {}): never\n\t{\n\t\tsetTimeout(() => {\n\t\t\tconst uri = Router.Instance.getAutomatedSolutionDetailUrl(automatedSolutionId);\n\n\t\t\turi.setQueryParams({\n\t\t\t\t...queryParams,\n\t\t\t\tIFRAME: 'Y',\n\t\t\t\tIFRAME_TYPE: 'SIDE_SLIDER',\n\t\t\t});\n\n\t\t\twindow.location.href = uri.toString();\n\t\t});\n\t}\n\n\tcloseSliderOrRedirect(): never\n\t{\n\t\tsetTimeout(() => {\n\t\t\tRouter.Instance.closeSliderOrRedirect(\n\t\t\t\tRouter.Instance.getAutomatedSolutionListUrl(),\n\t\t\t\twindow,\n\t\t\t);\n\t\t});\n\t}\n}\n"],"names":["Card","props","title","type","String","required","description","data","isShown","template","CommonTab","components","computed","get","$store","state","automatedSolution","set","dispatch","TypesTab","boundTypesTagSelector","externalTypesTagSelector","crmTypesTagSelector","mounted","TagSelector","multiple","showAddButton","showCreateButton","items","typeIds","map","typeId","id","entityId","dynamicTypesTitles","events","onCreateButtonClick","handleCreateTypeClick","onTagRemove","removeTypeIdByTagRemoveEvent","renderTo","$refs","boundTypesTagSelectorContainer","initFilteredTagSelector","crmTypesTagSelectorContainer","externalTypesTagSelectorContainer","methods","isOnlyCrmTypes","isOnlyExternalTypes","addButtonCaption","$Bitrix","Loc","getMessage","addButtonCaptionMore","dialogOptions","height","enableSearch","context","dropdownMode","showAvatars","entities","dynamicLoad","dynamicSearch","options","showAutomatedSolutionBadge","onTagAdd","addTypeIdByTagAddEvent","event","getData","tag","getId","getters","isSaved","openTypeCreationSlider","MessageBox","confirm","messageBox","save","then","close","Router","Instance","openTypeDetail","automatedSolutionId","activeTabId","isExternal","Application","reloadWithNewUri","Main","initialActiveTabId","tabs","common","types","allTabIds","Object","keys","saveButton","document","getElementById","cancelButton","deleteButton","allButtons","buttons","push","errors","hasErrors","Type","isArrayFilled","EventEmitter","subscribe","showTabFromEvent","beforeUnmount","unsubscribe","tabId","showTab","includes","Error","closeSliderOrRedirect","unlockButtons","forEach","button","Dom","removeClass","hideError","error","normalizeId","isNil","Text","toInteger","normalizeDynamicTypesTitles","titles","isPlainObject","result","entries","key","value","isStringFilled","normalizeTitle","normalizeTypesIds","x","normalizeTypeId","filter","normalizeErrors","isValidError","message","code","isInteger","customData","setState","store","stateToSet","commit","setErrors","removeError","setTitle","addTypeId","removeTypeId","savePromise","fields","Runtime","clone","length","isNew","runAjaxAction","emitUpdateEventToOutsideWorld","response","console","warn","wasErrorHandled","sliderCode","FeaturePromotersRegistry","getPromoter","show","ajaxRunActionArgs","Promise","resolve","reject","Ajax","runAction","intranetCustomSectionId","ToolbarComponent","emitAutomatedSolutionUpdatedEvent","isModified","newTitle","normalizedTypeId","newTypeIds","strict","actions","mutations","App","containerId","isDomNode","appWrapperRef","BitrixVue","createApp","beforeCreate","$bitrix","vuexStore","createStore","use","mount","unmount","queryParams","setTimeout","uri","getAutomatedSolutionDetailUrl","setQueryParams","IFRAME","IFRAME_TYPE","window","location","href","toString","getAutomatedSolutionListUrl"],"mappings":"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"}