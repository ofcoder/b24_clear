{"version":3,"file":"manager.bundle.js","sources":["../src/manager.js"],"sourcesContent":["import { Loc, Type, Uri } from 'main.core';\n\nexport class BatchMergeManager\n{\n\tconstructor()\n\t{\n\t\tthis._id = \"\";\n\t\tthis._settings = {};\n\n\t\tthis._grid = null;\n\t\tthis._kanban = null;\n\t\tthis._entityTypeId = BX.CrmEntityType.enumeration.undefined;\n\t\tthis._entityIds = null;\n\n\t\tthis._errors = null;\n\t\tthis._isRunning = false;\n\n\t\tthis._documentUnloadHandler = BX.delegate(this.onDocumentUnload, this);\n\t\tthis._requestCompleteHandler = BX.delegate(this.onRequestComplete, this);\n\t\tthis._externalEventHandler = null;\n\t}\n\n\tinitialize(id, settings)\n\t{\n\t\tthis._id = Type.isStringFilled(id) ? id : \"crm_batch_merge_mgr_\" + Math.random().toString().substring(2);\n\t\tthis._settings = settings ? settings : {};\n\n\t\tconst gridId = BX.prop.getString(this._settings, \"gridId\", null);\n\t\tif (gridId && BX.Main.gridManager)\n\t\t{\n\t\t\tthis._grid = BX.Main.gridManager.getInstanceById(gridId);\n\t\t}\n\t\tthis._kanban = BX.prop.get(this._settings, \"kanban\", null);\n\n\t\tthis._entityTypeId = BX.prop.getInteger(\n\t\t\tthis._settings,\n\t\t\t\"entityTypeId\",\n\t\t\tBX.CrmEntityType.enumeration.undefined\n\t\t);\n\t\tthis._errors = [];\n\t}\n\tgetId()\n\t{\n\t\treturn this._id;\n\t}\n\tgetMessage (name)\n\t{\n\t\tconst entityTypeName = BX.CrmEntityType.resolveName(this._entityTypeId).toUpperCase();\n\t\treturn BX.prop.getString(\n\t\t\tBX.prop.getObject(this._settings, \"messages\", BX.Crm.BatchMergeManager.messages),\n\t\t\tname,\n\t\t\tLoc.getMessage('CRM_BATCH_MERGER_MANAGER_' + entityTypeName + '_' + name.toUpperCase())\n\t\t\t// CRM_BATCH_MERGER_MANAGER_LEAD_TITLE\n\t\t\t// CRM_BATCH_MERGER_MANAGER_LEAD_CONFIRMATION\n\t\t\t// CRM_BATCH_MERGER_MANAGER_LEAD_SUMMARYCAPTION\n\t\t\t// CRM_BATCH_MERGER_MANAGER_LEAD_SUMMARYSUCCEEDED\n\t\t\t// CRM_BATCH_MERGER_MANAGER_LEAD_SUMMARYFAILED\n\t\t\t// CRM_BATCH_MERGER_MANAGER_DEAL_TITLE\n\t\t\t// CRM_BATCH_MERGER_MANAGER_DEAL_CONFIRMATION\n\t\t\t// CRM_BATCH_MERGER_MANAGER_DEAL_SUMMARYCAPTION\n\t\t\t// CRM_BATCH_MERGER_MANAGER_DEAL_SUMMARYSUCCEEDED\n\t\t\t// CRM_BATCH_MERGER_MANAGER_DEAL_SUMMARYFAILED\n\t\t\t// CRM_BATCH_MERGER_MANAGER_CONTACT_TITLE\n\t\t\t// CRM_BATCH_MERGER_MANAGER_CONTACT_CONFIRMATION\n\t\t\t// CRM_BATCH_MERGER_MANAGER_CONTACT_SUMMARYCAPTION\n\t\t\t// CRM_BATCH_MERGER_MANAGER_CONTACT_SUMMARYSUCCEEDED\n\t\t\t// CRM_BATCH_MERGER_MANAGER_CONTACT_SUMMARYFAILED\n\t\t\t// CRM_BATCH_MERGER_MANAGER_COMPANY_TITLE\n\t\t\t// CRM_BATCH_MERGER_MANAGER_COMPANY_CONFIRMATION\n\t\t\t// CRM_BATCH_MERGER_MANAGER_COMPANY_SUMMARYCAPTION\n\t\t\t// CRM_BATCH_MERGER_MANAGER_COMPANY_SUMMARYSUCCEEDED\n\t\t\t// CRM_BATCH_MERGER_MANAGER_COMPANY_SUMMARYFAILED\n\t\t);\n\t}\n\tgetEntityIds()\n\t{\n\t\treturn this._entityIds;\n\t}\n\tsetEntityIds(entityIds)\n\t{\n\t\tthis._entityIds = Type.isArray(entityIds) ? entityIds : [];\n\t}\n\tresetEntityIds()\n\t{\n\t\tthis._entityIds = [];\n\t}\n\tgetErrors()\n\t{\n\t\treturn this._errors ? this._errors : [];\n\t}\n\texecute()\n\t{\n\t\tlet dialogId = this._id.toLowerCase();\n\t\tlet dialog = BX.Crm.ConfirmationDialog.get(dialogId);\n\t\tif(!dialog)\n\t\t{\n\t\t\tdialog = BX.Crm.ConfirmationDialog.create(\n\t\t\t\tdialogId,\n\t\t\t\t{\n\t\t\t\t\ttitle: this.getMessage(\"title\"),\n\t\t\t\t\tcontent: this.getMessage(\"confirmation\")\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tif(!dialog.isOpened())\n\t\t{\n\t\t\tdialog.open().then(\n\t\t\t\tfunction(result)\n\t\t\t\t{\n\t\t\t\t\tif(!BX.prop.getBoolean(result, \"cancel\", true))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.startRequest();\n\t\t\t\t\t}\n\t\t\t\t}.bind(this)\n\t\t\t);\n\t\t}\n\t}\n\tisRunning()\n\t{\n\t\treturn this._isRunning;\n\t}\n\tstartRequest()\n\t{\n\t\tif(this._isRunning)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._isRunning = true;\n\n\t\tthis.disableItemsList();\n\t\tBX.bind(window, \"beforeunload\", this._documentUnloadHandler);\n\n\t\tlet params =\n\t\t\t{\n\t\t\t\tentityTypeId: this._entityTypeId,\n\t\t\t\textras: BX.prop.getObject(this._settings, \"extras\", {})\n\t\t\t};\n\n\t\tif(Type.isArray(this._entityIds) && this._entityIds.length > 0)\n\t\t{\n\t\t\tparams[\"entityIds\"] = this._entityIds;\n\t\t}\n\n\t\tBX.ajax.runAction(\n\t\t\t\"crm.api.entity.mergeBatch\",\n\t\t\t{ data: { params:  params } }\n\t\t).then(\n\t\t\tthis._requestCompleteHandler\n\t\t).catch(\n\t\t\tthis._requestCompleteHandler\n\t\t);\n\t}\n\tdisableItemsList()\n\t{\n\t\tif (this._grid)\n\t\t{\n\t\t\tthis._grid.tableFade();\n\t\t}\n\t\tif (this._kanban)\n\t\t{\n\t\t\tthis._kanban.fadeOut();\n\t\t}\n\t}\n\tenableItemsList()\n\t{\n\t\tif (this._grid)\n\t\t{\n\t\t\tthis._grid.tableUnfade();\n\t\t}\n\t\tif (this._kanban)\n\t\t{\n\t\t\tthis._kanban.fadeIn();\n\t\t}\n\t}\n\treloadItemsList()\n\t{\n\t\tif (this._grid)\n\t\t{\n\t\t\tthis._grid.reload();\n\t\t}\n\t\tif (this._kanban)\n\t\t{\n\t\t\tthis._kanban.reload();\n\t\t}\n\t}\n\tonRequestComplete(response)\n\t{\n\t\tthis.enableItemsList();\n\t\tBX.unbind(window, \"beforeunload\", this._documentUnloadHandler);\n\t\tthis._isRunning = false;\n\t\tthis._errors = [];\n\n\t\tlet status = BX.prop.getString(response, \"status\", \"\");\n\t\tlet data = BX.prop.getObject(response, \"data\", {});\n\n\t\tif(status === \"error\")\n\t\t{\n\t\t\tif(BX.prop.getString(data, \"STATUS\", \"\") === \"CONFLICT\")\n\t\t\t{\n\t\t\t\tthis.openMerger();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet errorInfos = BX.prop.getArray(response, \"errors\", []);\n\t\t\tfor(let i = 0, length = errorInfos.length; i < length; i++)\n\t\t\t{\n\t\t\t\tthis._errors.push(BX.prop.getString(errorInfos[i], \"message\"));\n\t\t\t}\n\t\t}\n\n\t\tthis.displaySummary();\n\t\tif(this._errors.length === 0)\n\t\t{\n\t\t\twindow.setTimeout(\n\t\t\t\tthis.complete.bind(this),\n\t\t\t\t0\n\t\t\t);\n\t\t}\n\t}\n\tdisplaySummary()\n\t{\n\t\tlet messages = [this.getMessage(\"summaryCaption\")];\n\t\tif(this._errors.length > 0)\n\t\t{\n\t\t\tmessages.push(\n\t\t\t\tthis.getMessage(\"summaryFailed\").replace(/#number#/gi, this._entityIds.length)\n\t\t\t);\n\t\t\tmessages = messages.concat(this._errors);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tmessages.push(\n\t\t\t\tthis.getMessage(\"summarySucceeded\").replace(/#number#/gi, this._entityIds.length)\n\t\t\t);\n\t\t}\n\n\t\tBX.UI.Notification.Center.notify(\n\t\t\t{\n\t\t\t\tcontent: messages.join(\"<br/>\"),\n\t\t\t\tposition: \"top-center\",\n\t\t\t\tautoHideDelay: 5000\n\t\t\t}\n\t\t);\n\t}\n\topenMerger()\n\t{\n\t\tthis._contextId = this._id + \"_\" + BX.util.getRandomString(6).toUpperCase();\n\n\t\tBX.Crm.Page.open(this.#getMergerUrl());\n\n\t\tif(!this._externalEventHandler)\n\t\t{\n\t\t\tthis._externalEventHandler = BX.delegate(this.onExternalEvent, this);\n\t\t\tBX.addCustomEvent(window, \"onLocalStorageSet\", this._externalEventHandler);\n\t\t}\n\t}\n\n\t#getMergerUrl(): string\n\t{\n\t\tconst mergerBaseUrl = BX.prop.getString(this._settings, 'mergerUrl', this.#getDefaultMergerUrl());\n\n\t\tconst uri = new Uri(mergerBaseUrl);\n\t\turi.setQueryParams({\n\t\t\texternalContextId: this._contextId,\n\t\t\tid: this._entityIds,\n\t\t});\n\n\t\treturn uri.toString();\n\t}\n\n\t#getDefaultMergerUrl(): string\n\t{\n\t\tconst lowerEntityTypeName = BX.CrmEntityType.resolveName(this._entityTypeId).toLowerCase();\n\n\t\treturn `/crm/${lowerEntityTypeName}/merge/`;\n\t}\n\n\tcomplete()\n\t{\n\t\tBX.onCustomEvent(\n\t\t\twindow,\n\t\t\t\"BX.Crm.BatchMergeManager:onComplete\",\n\t\t\t[ this ]\n\t\t);\n\n\t\tthis.reloadItemsList();\n\t}\n\tonDocumentUnload(e)\n\t{\n\t\treturn(e.returnValue = this.getMessage(\"windowCloseConfirm\"));\n\t}\n\tonExternalEvent(params)\n\t{\n\t\tlet eventName = BX.prop.getString(params, \"key\", \"\");\n\n\t\tif(eventName !== \"onCrmEntityMergeComplete\")\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet value = BX.prop.getObject(params, \"value\", {});\n\n\t\tif(this._contextId !== BX.prop.getString(value, \"context\", \"\"))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.removeCustomEvent(window, \"onLocalStorageSet\", this._externalEventHandler);\n\t\tthis._externalEventHandler = null;\n\n\t\tthis.displaySummary();\n\t\twindow.setTimeout(\n\t\t\tthis.complete.bind(this),\n\t\t\t0\n\t\t);\n\t}\n\n\tstatic getItem(id)\n\t{\n\t\treturn BX.prop.get(this.items, id, null);\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new BatchMergeManager();\n\t\tself.initialize(id, settings);\n\t\tthis.items[self.getId()] = self;\n\t\treturn self;\n\t}\n}\n\nBatchMergeManager.messages = {};\nBatchMergeManager.items = {};\n"],"names":["BatchMergeManager","_id","_settings","_grid","_kanban","_entityTypeId","BX","CrmEntityType","enumeration","undefined","_entityIds","_errors","_isRunning","_documentUnloadHandler","delegate","onDocumentUnload","_requestCompleteHandler","onRequestComplete","_externalEventHandler","id","settings","Type","isStringFilled","Math","random","toString","substring","gridId","prop","getString","Main","gridManager","getInstanceById","get","getInteger","name","entityTypeName","resolveName","toUpperCase","getObject","Crm","messages","Loc","getMessage","entityIds","isArray","dialogId","toLowerCase","dialog","ConfirmationDialog","create","title","content","isOpened","open","then","result","getBoolean","startRequest","bind","disableItemsList","window","params","entityTypeId","extras","length","ajax","runAction","data","tableFade","fadeOut","tableUnfade","fadeIn","reload","response","enableItemsList","unbind","status","openMerger","errorInfos","getArray","i","push","displaySummary","setTimeout","complete","replace","concat","UI","Notification","Center","notify","join","position","autoHideDelay","_contextId","util","getRandomString","Page","onExternalEvent","addCustomEvent","onCustomEvent","reloadItemsList","e","returnValue","eventName","value","removeCustomEvent","items","self","initialize","getId","mergerBaseUrl","uri","Uri","setQueryParams","externalContextId","lowerEntityTypeName"],"mappings":"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"}