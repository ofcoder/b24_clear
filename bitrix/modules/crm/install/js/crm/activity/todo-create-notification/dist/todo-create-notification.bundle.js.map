{"version":3,"file":"todo-create-notification.bundle.js","sources":["../src/todo-create-notification.js"],"sourcesContent":["import { TodoEditor } from 'crm.activity.todo-editor';\nimport { TodoEditorV2 } from 'crm.activity.todo-editor-v2';\nimport { TodoNotificationSkip } from 'crm.activity.todo-notification-skip';\nimport { TodoNotificationSkipMenu } from 'crm.activity.todo-notification-skip-menu';\nimport { Event, Loc, Tag } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Popup, PopupManager } from 'main.popup';\nimport { Button, ButtonColor, ButtonState, CancelButton, SaveButton } from 'ui.buttons';\n\nimport './todo-create-notification.css';\n\ndeclare type TodoCreateNotificationParams = {\n\tentityTypeId: number,\n\tentityId: number,\n\tentityStageId: string,\n\tstageIdField: string,\n\tfinalStages: Array<string>,\n\tskipPeriod: ?string,\n\tuseTodoEditorV2?: boolean,\n}\n\nconst SAVE_BUTTON_ID = 'save';\nconst CANCEL_BUTTON_ID = 'cancel';\nconst SKIP_BUTTON_ID = 'skip';\n\nexport class TodoCreateNotification\n{\n\t#timeline: ?Object = null;\n\t#entityTypeId: string = null;\n\t#entityId: string = null;\n\t#entityStageId: string = null;\n\t#stageIdField: string = null;\n\t#finalStages: Array<string> = null;\n\n\t#allowCloseSlider: boolean = false;\n\t#isSkipped: boolean = false;\n\t#popup: ?Popup = null;\n\t#toDoEditor: ?TodoEditorV2 = null;\n\t#skipProvider: TodoNotificationSkip = null;\n\t#skipMenu: ?TodoNotificationSkipMenu = null;\n\t#sliderIsMinimizing: boolean = false;\n\t#useTodoEditorV2: boolean = false;\n\n\tconstructor(params: TodoCreateNotificationParams)\n\t{\n\t\tthis.#entityTypeId = params.entityTypeId;\n\t\tthis.#entityId = params.entityId;\n\t\tthis.#entityStageId = params.entityStageId;\n\t\tthis.#stageIdField = params.stageIdField;\n\t\tthis.#finalStages = params.finalStages;\n\t\tthis.#isSkipped = Boolean(params.skipPeriod);\n\t\tthis.#useTodoEditorV2 = (params.useTodoEditorV2 === true);\n\n\t\tif (BX.CrmTimelineManager)\n\t\t{\n\t\t\tthis.#timeline = BX.CrmTimelineManager.getDefault();\n\t\t}\n\n\t\tthis.#bindEvents();\n\n\t\tthis.#skipProvider = new TodoNotificationSkip({\n\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\tonSkippedPeriodChange: this.#onSkippedPeriodChange.bind(this),\n\t\t});\n\t\tthis.#skipMenu = new TodoNotificationSkipMenu({\n\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\tselectedValue: params.skipPeriod,\n\t\t});\n\t}\n\n\t#bindEvents(): void\n\t{\n\t\tif (this.#getSliderInstance())\n\t\t{\n\t\t\tEventEmitter.subscribe(this.#getSliderInstance(), 'SidePanel.Slider:onClose', this.#onCloseSlider.bind(this));\n\t\t\tEventEmitter.subscribe('Crm.EntityModel.Change', this.#onEntityModelChange.bind(this));\n\t\t\tEventEmitter.subscribe('onCrmEntityUpdate', this.#onEntityUpdate.bind(this));\n\t\t\tEventEmitter.subscribe('onCrmEntityDelete', this.#onEntityDelete.bind(this));\n\t\t}\n\n\t\tEventEmitter.subscribe('Crm.InterfaceToolbar.MenuBuild', this.#onToolbarMenuBuild.bind(this));\n\t}\n\n\t#getSliderInstance(): BX.SidePanel.Slider | null\n\t{\n\t\tif (top.BX && top.BX.SidePanel)\n\t\t{\n\t\t\tconst slider = top.BX.SidePanel.Instance.getSliderByWindow(window);\n\t\t\tif (slider && slider.isOpen())\n\t\t\t{\n\t\t\t\treturn slider;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#isSliderMinimizeAvailable(): boolean\n\t{\n\t\treturn Object.hasOwn(BX.SidePanel.Slider.prototype, 'minimize')\n\t\t\t&& Object.hasOwn(BX.SidePanel.Slider.prototype, 'isMinimizing')\n\t\t;\n\t}\n\n\t#onCloseSlider(event: BaseEvent): void\n\t{\n\t\tif (this.#allowCloseSlider || this.#isSkipped)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst [sliderEvent] = event.getCompatData();\n\n\t\tif (sliderEvent.getSlider() !== top.BX.SidePanel.Instance.getSliderByWindow(window))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!sliderEvent.isActionAllowed())\n\t\t{\n\t\t\treturn; // editor has unsaved fields\n\t\t}\n\n\t\tif (!this.#timeline || this.#timeline.hasScheduledItems())\n\t\t{\n\t\t\treturn; // timeline already has scheduled activities\n\t\t}\n\n\t\tif (this.#finalStages.includes(this.#entityStageId))\n\t\t{\n\t\t\treturn; // element has final stage\n\t\t}\n\n\t\tthis.#sliderIsMinimizing = this.#isSliderMinimizeAvailable() && sliderEvent.getSlider()?.isMinimizing();\n\t\tsliderEvent.denyAction();\n\n\t\tsetTimeout(() => {\n\t\t\tthis.#showTodoCreationNotification();\n\t\t}, 100);\n\t}\n\n\t#onEntityUpdate(event: BaseEvent): void\n\t{\n\t\tconst [eventParams] = event.getCompatData();\n\t\tif (\n\t\t\tObject.hasOwn(eventParams, 'entityData')\n\t\t\t&& Object.hasOwn(eventParams.entityData, this.#stageIdField)\n\t\t)\n\t\t{\n\t\t\tthis.#entityStageId = eventParams.entityData[this.#stageIdField];\n\t\t}\n\t}\n\n\t#onEntityDelete(event: BaseEvent): void\n\t{\n\t\tconst [eventParams] = event.getCompatData();\n\t\tif (\n\t\t\tObject.hasOwn(eventParams, 'id')\n\t\t\t&& Text.toString(eventParams.id) === Text.toString(this.#entityId)\n\t\t)\n\t\t{\n\t\t\tthis.#allowCloseSlider = true;\n\t\t}\n\t}\n\n\t#onEntityModelChange(event: BaseEvent): void\n\t{\n\t\tconst [model, eventParams] = event.getCompatData();\n\n\t\tif (eventParams.fieldName === this.#stageIdField)\n\t\t{\n\t\t\tthis.#entityStageId = model.getStringField(this.#stageIdField, this.#entityStageId);\n\t\t}\n\t}\n\n\t#onSkippedPeriodChange(period: string): void\n\t{\n\t\tthis.#isSkipped = Boolean(period);\n\t}\n\n\t#onToolbarMenuBuild(event: BaseEvent): void\n\t{\n\t\tconst [, { items }] = event.getData();\n\t\titems.push({ delimiter: true });\n\t\tfor (const skipItem of this.#skipMenu.getItems())\n\t\t{\n\t\t\titems.push(skipItem);\n\t\t}\n\t}\n\n\t#onChangeDescription(event: BaseEvent): void\n\t{\n\t\tconst { description } = event.getData();\n\t\tconst saveButton = this.#popup?.getButton(SAVE_BUTTON_ID);\n\t\tif (description.length === 0 && !saveButton.getState())\n\t\t{\n\t\t\tsaveButton.setState(ButtonState.DISABLED);\n\t\t}\n\t\telse if (description.length > 0 && saveButton.getState() === ButtonState.DISABLED)\n\t\t{\n\t\t\tsaveButton.setState(null);\n\t\t}\n\t}\n\n\t#onSaveHotkeyPressed(): void\n\t{\n\t\tconst saveButton = this.#popup?.getButton(SAVE_BUTTON_ID);\n\t\tif (!saveButton.getState()) // if save button is not disabled\n\t\t{\n\t\t\tthis.#saveTodo();\n\t\t}\n\t}\n\n\t#onChangeUploaderContainerSize()\n\t{\n\t\tif (this.#popup)\n\t\t{\n\t\t\tthis.#popup.adjustPosition();\n\t\t}\n\t}\n\n\t#onSkipMenuItemSelect(period): void\n\t{\n\t\tthis.#popup?.getButton(SKIP_BUTTON_ID)?.getMenuWindow()?.close();\n\n\t\tthis.#popup?.getButton(SAVE_BUTTON_ID)?.setState(ButtonState.DISABLED);\n\t\tthis.#popup?.getButton(CANCEL_BUTTON_ID)?.setState(ButtonState.DISABLED);\n\t\tthis.#popup?.getButton(SKIP_BUTTON_ID)?.setState(ButtonState.WAITING);\n\n\t\tthis.#toDoEditor.cancel({\n\t\t\tanalytics: {\n\t\t\t\tsubSection: TodoEditorV2.AnalyticsSubSection.notificationPopup,\n\t\t\t\telement: TodoEditorV2.AnalyticsElement.skipPeriodButton,\n\t\t\t\tnotificationSkipPeriod: period,\n\t\t\t},\n\t\t});\n\n\t\tthis.#skipProvider.saveSkippedPeriod(period).then(() => {\n\t\t\tthis.#isSkipped = Boolean(period);\n\t\t\tthis.#skipMenu.setSelectedValue(period);\n\t\t\tthis.#revertButtonsState();\n\t\t\tthis.#allowCloseSlider = true;\n\t\t\tthis.#showCancelNotificationInParentWindow();\n\t\t\tthis.#getSliderInstance()?.close();\n\t\t}).catch(() => {\n\t\t\tthis.#revertButtonsState();\n\t\t});\n\t}\n\n\t#saveTodo(): void\n\t{\n\t\tthis.#popup?.getButton(SAVE_BUTTON_ID)?.setState(ButtonState.WAITING);\n\t\tthis.#popup?.getButton(CANCEL_BUTTON_ID)?.setState(ButtonState.DISABLED);\n\t\tthis.#popup?.getButton(SKIP_BUTTON_ID)?.setState(ButtonState.DISABLED);\n\n\t\tthis.#toDoEditor.save().then((result) => {\n\t\t\tthis.#revertButtonsState();\n\n\t\t\tif (!(Object.hasOwn(result, 'errors') && result.errors.length > 0))\n\t\t\t{\n\t\t\t\tthis.#allowCloseSlider = true;\n\t\t\t\tthis.#closePopup();\n\t\t\t\tthis.#getSliderInstance()?.close();\n\t\t\t}\n\t\t}).catch(() => {\n\t\t\tthis.#revertButtonsState();\n\t\t});\n\t}\n\n\t#cancel(): void\n\t{\n\t\tvoid this.#toDoEditor.cancel({\n\t\t\tanalytics: {\n\t\t\t\tsubSection: TodoEditorV2.AnalyticsSubSection.notificationPopup,\n\t\t\t\telement: TodoEditorV2.AnalyticsElement.cancelButton,\n\t\t\t},\n\t\t}).then(() => {\n\t\t\tthis.#closePopup();\n\t\t});\n\t}\n\n\t#revertButtonsState()\n\t{\n\t\tthis.#popup?.getButton(SAVE_BUTTON_ID)?.setState(null);\n\t\tthis.#popup?.getButton(CANCEL_BUTTON_ID)?.setState(null);\n\t\tthis.#popup?.getButton(SKIP_BUTTON_ID)?.setState(null);\n\t}\n\n\t#closePopup(): void\n\t{\n\t\tthis.#popup?.close();\n\t}\n\n\t#closeSlider(): void\n\t{\n\t\tthis.#allowCloseSlider = true;\n\t\tif (this.#isSliderMinimizeAvailable() && this.#sliderIsMinimizing)\n\t\t{\n\t\t\tthis.#getSliderInstance()?.minimize();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#getSliderInstance()?.close();\n\t}\n\n\t#showTodoCreationNotification(): void\n\t{\n\t\tif (!this.#popup)\n\t\t{\n\t\t\tconst htmlStyles = getComputedStyle(document.documentElement);\n\t\t\tconst popupPadding = htmlStyles.getPropertyValue('--ui-space-inset-sm');\n\t\t\tconst popupPaddingNumberValue = parseFloat(popupPadding) || 12;\n\t\t\tconst popupOverlayColor = htmlStyles.getPropertyValue('--ui-color-base-solid') || '#000000';\n\n\t\t\tconst { innerWidth } = window;\n\n\t\t\tthis.#popup = PopupManager.create({\n\t\t\t\tid: `todo-create-confirm-${this.#entityTypeId}-${this.#entityId}`,\n\t\t\t\tcloseIcon: !this.#useTodoEditorV2,\n\t\t\t\tpadding: popupPaddingNumberValue,\n\t\t\t\toverlay: {\n\t\t\t\t\topacity: 40,\n\t\t\t\t\tbackgroundColor: popupOverlayColor,\n\t\t\t\t},\n\t\t\t\tcontent: this.#getPopupContent(),\n\t\t\t\tbuttons: this.#getPopupButtons(),\n\t\t\t\tminWidth: 537,\n\t\t\t\twidth: Math.round(innerWidth * 0.45),\n\t\t\t\tmaxWidth: 737,\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: this.#closeSlider.bind(this),\n\t\t\t\t},\n\t\t\t\tclassName: 'crm-activity__todo-create-notification-popup',\n\t\t\t});\n\t\t}\n\n\t\tthis.#popup.show();\n\n\t\tsetTimeout(() => {\n\t\t\tthis.#toDoEditor.setFocused();\n\t\t}, 10);\n\n\t\tsetTimeout(() => {\n\t\t\tthis.#popup.setClosingByEsc(true);\n\n\t\t\tEvent.bind(document, 'keyup', (event) => {\n\t\t\t\tif (event.key === 'Escape')\n\t\t\t\t{\n\t\t\t\t\tvoid this.#toDoEditor.cancel({\n\t\t\t\t\t\tanalytics: {\n\t\t\t\t\t\t\tsubSection: TodoEditorV2.AnalyticsSubSection.notificationPopup,\n\t\t\t\t\t\t\telement: TodoEditorV2.AnalyticsElement.cancelButton,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}, 300);\n\t}\n\n\t#getPopupDescription(): string\n\t{\n\t\t// eslint-disable-next-line init-declarations\n\t\tlet messagePhrase;\n\t\tswitch (this.#entityTypeId)\n\t\t{\n\t\t\tcase BX.CrmEntityType.enumeration.lead:\n\t\t\t\tmessagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_DESCRIPTION_LEAD';\n\t\t\t\tbreak;\n\t\t\tcase BX.CrmEntityType.enumeration.deal:\n\t\t\t\tmessagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_DESCRIPTION_DEAL';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tmessagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_DESCRIPTION';\n\t\t}\n\n\t\treturn Loc.getMessage(messagePhrase);\n\t}\n\n\t#getPopupContent(): HTMLElement\n\t{\n\t\tconst editorContainer = Tag.render`<div></div>`;\n\t\tlet content = null;\n\n\t\tif (this.#useTodoEditorV2)\n\t\t{\n\t\t\tconst buttonsContainer = Tag.render`\n\t\t\t\t<div class=\"crm-activity__todo-create-notification_footer\">\n\t\t\t\t\t<div class=\"crm-activity__todo-create-notification_buttons-container\">\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\tclass=\"ui-btn ui-btn-xs ui-btn-primary ui-btn-round\"\n\t\t\t\t\t\t\tonclick=\"${this.#saveTodo.bind(this)}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_OK_BUTTON_V2')}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"ui-btn ui-btn-xs ui-btn-link\"\n\t\t\t\t\t\t\tonclick=\"${this.#cancel.bind(this)}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_CANCEL_BUTTON_V2')}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.#getPreparedForV2NotificationSkipButton().render()}\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tcontent = Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<div class=\"crm-activity__todo-create-notification_title --v2\">\n\t\t\t\t\t\t${this.#getNotificationTitle()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t${editorContainer}\n\t\t\t\t\t</div>\n\t\t\t\t\t${buttonsContainer}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcontent = Tag.render`\n\t\t\t\t<div class=\"crm-activity__todo-create-notification\">\n\t\t\t\t\t<div class=\"crm-activity__todo-create-notification_title\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_TITLE')}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"crm-activity__todo-create-notification_content\">\n\t\t\t\t\t\t<div class=\"crm-activity__todo-create-notification_description\">\n\t\t\t\t\t\t\t${this.#getPopupDescription()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t${editorContainer}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tthis.#createToDoEditor(editorContainer).show();\n\n\t\treturn content;\n\t}\n\n\t#getNotificationTitle(): string\n\t{\n\t\tlet code = null;\n\n\t\tswitch (this.#entityTypeId)\n\t\t{\n\t\t\tcase BX.CrmEntityType.enumeration.lead:\n\t\t\t\tcode = 'CRM_ACTIVITY_TODO_NOTIFICATION_TITLE_V2_LEAD';\n\t\t\t\tbreak;\n\t\t\tcase BX.CrmEntityType.enumeration.deal:\n\t\t\t\tcode = 'CRM_ACTIVITY_TODO_NOTIFICATION_TITLE_V2_DEAL';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tcode = 'CRM_ACTIVITY_TODO_NOTIFICATION_TITLE_V2';\n\t\t}\n\n\t\treturn Loc.getMessage(code);\n\t}\n\n\t#getPreparedForV2NotificationSkipButton(): Button\n\t{\n\t\treturn this.#createNotificationSkipButton()\n\t\t\t.setNoCaps()\n\t\t\t.addClass('crm-activity__todo-create-notification_skip-button')\n\t\t;\n\t}\n\n\t#createToDoEditor(container: HTMLDivElement): TodoEditor | TodoEditorV2\n\t{\n\t\tconst params = {\n\t\t\tcontainer,\n\t\t\townerTypeId: this.#entityTypeId,\n\t\t\townerId: this.#entityId,\n\t\t\tcurrentUser: this.#timeline.getCurrentUser(),\n\t\t\tpingSettings: this.#timeline.getPingSettings(),\n\t\t\tevents: {\n\t\t\t\tonSaveHotkeyPressed: this.#onSaveHotkeyPressed.bind(this),\n\t\t\t\tonChangeUploaderContainerSize: this.#onChangeUploaderContainerSize.bind(this),\n\t\t\t},\n\t\t\tborderColor: TodoEditor.BorderColor.PRIMARY,\n\t\t};\n\n\t\tif (this.#useTodoEditorV2)\n\t\t{\n\t\t\tparams.calendarSettings = this.#timeline.getCalendarSettings();\n\t\t\tparams.colorSettings = this.#timeline.getColorSettings();\n\t\t\tparams.defaultDescription = '';\n\t\t\tparams.analytics = {\n\t\t\t\tsection: TodoEditorV2.AnalyticsSubSection.details,\n\t\t\t\tsubSection: TodoEditorV2.AnalyticsSubSection.notificationPopup,\n\t\t\t};\n\n\t\t\tthis.#toDoEditor = new TodoEditorV2(params);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tparams.events.onChangeDescription = this.#onChangeDescription.bind(this);\n\t\t\tthis.#toDoEditor = new TodoEditor(params);\n\t\t}\n\n\t\treturn this.#toDoEditor;\n\t}\n\n\t#getPopupButtons(): Array<Button>\n\t{\n\t\tif (this.#useTodoEditorV2)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\treturn [\n\t\t\tthis.#createSaveButton(),\n\t\t\tthis.#createCancelButton(),\n\t\t\tthis.#createNotificationSkipButton(),\n\t\t];\n\t}\n\n\t#createSaveButton(): Button\n\t{\n\t\treturn new SaveButton({\n\t\t\tid: SAVE_BUTTON_ID,\n\t\t\tround: true,\n\t\t\tstate: this.#toDoEditor.getDescription() ? null : ButtonState.DISABLED,\n\t\t\tevents: {\n\t\t\t\tclick: this.#saveTodo.bind(this),\n\t\t\t},\n\t\t});\n\t}\n\n\t#createCancelButton(): Button\n\t{\n\t\treturn new CancelButton({\n\t\t\ttext: Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_CANCEL'),\n\t\t\tcolor: ButtonColor.LIGHT_BORDER,\n\t\t\tid: CANCEL_BUTTON_ID,\n\t\t\tround: true,\n\t\t\tevents: {\n\t\t\t\tclick: this.#cancel.bind(this),\n\t\t\t},\n\t\t});\n\t}\n\n\t#createNotificationSkipButton(): Button\n\t{\n\t\treturn new Button({\n\t\t\ttext: Loc.getMessage(\n\t\t\t\tthis.#useTodoEditorV2\n\t\t\t\t\t? 'CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_V2'\n\t\t\t\t\t: 'CRM_ACTIVITY_TODO_NOTIFICATION_SKIP',\n\t\t\t),\n\t\t\tcolor: ButtonColor.LINK,\n\t\t\tid: SKIP_BUTTON_ID,\n\t\t\tdropdown: true,\n\t\t\tmenu: {\n\t\t\t\tcloseByEsc: true,\n\t\t\t\titems: this.#getSkipMenuItems(),\n\t\t\t\tminWidth: 233,\n\t\t\t},\n\t\t});\n\t}\n\n\t#getSkipMenuItems(): Array\n\t{\n\t\treturn [\n\t\t\t{\n\t\t\t\tid: 'day',\n\t\t\t\ttext: Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOR_DAY'),\n\t\t\t\tonclick: this.#onSkipMenuItemSelect.bind(this, 'day'),\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'week',\n\t\t\t\ttext: Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOR_WEEK'),\n\t\t\t\tonclick: this.#onSkipMenuItemSelect.bind(this, 'week'),\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'month',\n\t\t\t\ttext: Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOR_MONTH'),\n\t\t\t\tonclick: this.#onSkipMenuItemSelect.bind(this, 'month'),\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'forever',\n\t\t\t\ttext: Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOREVER'),\n\t\t\t\tonclick: this.#onSkipMenuItemSelect.bind(this, 'forever'),\n\t\t\t},\n\t\t];\n\t}\n\n\t#showCancelNotificationInParentWindow()\n\t{\n\t\tif (top.BX && top.BX.Runtime)\n\t\t{\n\t\t\tconst entityTypeId = this.#entityTypeId;\n\t\t\tvoid top.BX.Runtime.loadExtension('crm.activity.todo-notification-skip')\n\t\t\t\t.then((exports) => {\n\t\t\t\t\tconst skipProvider = new exports.TodoNotificationSkip({\n\t\t\t\t\t\tentityTypeId,\n\t\t\t\t\t});\n\t\t\t\t\tskipProvider.showCancelPeriodNotification();\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\t}\n}\n"],"names":["SAVE_BUTTON_ID","CANCEL_BUTTON_ID","SKIP_BUTTON_ID","TodoCreateNotification","constructor","params","entityTypeId","entityId","entityStageId","stageIdField","finalStages","Boolean","skipPeriod","useTodoEditorV2","BX","CrmTimelineManager","getDefault","TodoNotificationSkip","onSkippedPeriodChange","bind","TodoNotificationSkipMenu","selectedValue","EventEmitter","subscribe","top","SidePanel","slider","Instance","getSliderByWindow","window","isOpen","Object","hasOwn","Slider","prototype","event","sliderEvent","getCompatData","getSlider","isActionAllowed","hasScheduledItems","includes","isMinimizing","denyAction","setTimeout","eventParams","entityData","Text","toString","id","model","fieldName","getStringField","period","items","getData","push","delimiter","skipItem","getItems","description","saveButton","getButton","length","getState","setState","ButtonState","DISABLED","adjustPosition","getMenuWindow","close","WAITING","cancel","analytics","subSection","TodoEditorV2","AnalyticsSubSection","notificationPopup","element","AnalyticsElement","skipPeriodButton","notificationSkipPeriod","saveSkippedPeriod","then","setSelectedValue","catch","save","result","errors","cancelButton","minimize","htmlStyles","getComputedStyle","document","documentElement","popupPadding","getPropertyValue","popupPaddingNumberValue","parseFloat","popupOverlayColor","innerWidth","PopupManager","create","closeIcon","padding","overlay","opacity","backgroundColor","content","buttons","minWidth","width","Math","round","maxWidth","events","onClose","className","show","setFocused","setClosingByEsc","Event","key","messagePhrase","CrmEntityType","enumeration","lead","deal","Loc","getMessage","editorContainer","Tag","render","buttonsContainer","code","setNoCaps","addClass","container","ownerTypeId","ownerId","currentUser","getCurrentUser","pingSettings","getPingSettings","onSaveHotkeyPressed","onChangeUploaderContainerSize","borderColor","TodoEditor","BorderColor","PRIMARY","calendarSettings","getCalendarSettings","colorSettings","getColorSettings","defaultDescription","section","details","onChangeDescription","SaveButton","state","getDescription","click","CancelButton","text","color","ButtonColor","LIGHT_BORDER","Button","LINK","dropdown","menu","closeByEsc","onclick","Runtime","loadExtension","exports","skipProvider","showCancelPeriodNotification"],"mappings":"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"}