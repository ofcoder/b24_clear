this.BX=this.BX||{};this.BX.Intranet=this.BX.Intranet||{};this.BX.Intranet.Grid=this.BX.Intranet.Grid||{};(function(e,t,i,a,n,r,s,l){"use strict";function o(e,t,i){d(e,t);t.set(e,i)}function d(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var c=new WeakMap;var u=new WeakMap;var T=function(){function e(t){var i;babelHelpers.classCallCheck(this,e);o(this,c,{writable:true,value:void 0});o(this,u,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,c,t.fieldId);babelHelpers.classPrivateFieldSet(this,u,(i=t.gridId)!==null&&i!==void 0?i:null)}babelHelpers.createClass(e,[{key:"getGridId",value:function e(){return babelHelpers.classPrivateFieldGet(this,u)}},{key:"getFieldId",value:function e(){return babelHelpers.classPrivateFieldGet(this,c)}},{key:"getGrid",value:function e(){var t;var i=null;if(babelHelpers.classPrivateFieldGet(this,u)){i=BX.Main.gridManager.getById(babelHelpers.classPrivateFieldGet(this,u))}return(t=i)===null||t===void 0?void 0:t.instance}},{key:"getFieldNode",value:function e(){return document.getElementById(this.getFieldId())}},{key:"appendToFieldNode",value:function e(t){r.Dom.append(t,this.getFieldNode())}}]);return e}();var p;var g=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"render",value:function e(t){r.Dom.addClass(this.getFieldNode(),"user-grid_user-photo");if(t.photoUrl){r.Dom.style(this.getFieldNode(),{"background-image":'url("'.concat(t.photoUrl,'")')})}else{var i=t.isInvited||!t.isConfirmed&&t.isInvited?"--person-clock":"--person";var a=r.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-icon-set ','" style="--ui-icon-set__icon-size: 35px; --ui-icon-set__icon-color: #fff;"></div>\n\t\t\t'])),i);r.Dom.append(a,this.getFieldNode())}}}]);return t}(T);var v,I,_,b,f,N;function E(e,t){h(e,t);t.add(e)}function h(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function L(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var A=new WeakSet;var m=new WeakSet;var C=new WeakSet;var R=new WeakSet;var O=new WeakSet;var S=new WeakSet;var B=new WeakSet;var y=function(e){babelHelpers.inherits(t,e);function t(){var e;var i;babelHelpers.classCallCheck(this,t);for(var a=arguments.length,n=new Array(a),r=0;r<a;r++){n[r]=arguments[r]}i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(n)));E(babelHelpers.assertThisInitialized(i),B);E(babelHelpers.assertThisInitialized(i),S);E(babelHelpers.assertThisInitialized(i),O);E(babelHelpers.assertThisInitialized(i),R);E(babelHelpers.assertThisInitialized(i),C);E(babelHelpers.assertThisInitialized(i),m);E(babelHelpers.assertThisInitialized(i),A);return i}babelHelpers.createClass(t,[{key:"render",value:function e(t){var i=r.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="user-grid_full-name-container">',"</div>\n\t\t"])),L(this,A,M).call(this,t.fullName,t.profileLink));if(t.position){r.Dom.append(L(this,R,w).call(this,r.Text.encode(t.position)),i)}if(!t.isInvited&&t.isConfirmed){if(t.isIntegrator){r.Dom.append(L(this,O,k).call(this),i)}else if(t.isAdmin){r.Dom.append(L(this,S,D).call(this),i)}else if(t.isExtranet){r.Dom.append(L(this,B,F).call(this),i)}}else if(t.isInvited&&!t.isConfirmed){r.Dom.append(L(this,C,U).call(this),i)}else if(t.isInvited){r.Dom.append(L(this,m,H).call(this),i)}this.appendToFieldNode(i)}}]);return t}(T);function M(e,t){return r.Tag.render(I||(I=babelHelpers.taggedTemplateLiteral(['<a class="user-grid_full-name-label" href="','">',"</a>"])),t,e)}function H(){var e=new t.Label({text:r.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_INVITATION_NOT_ACCEPTED"),color:t.LabelColor.LIGHT_BLUE,fill:true,size:t.Label.Size.MD,customClass:"user-grid_label"});return e.render()}function U(){var e=new t.Label({text:r.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_NOT_CONFIRMED"),color:t.LabelColor.YELLOW,fill:true,size:t.Label.Size.MD,customClass:"user-grid_label"});return e.render()}function w(e){return r.Tag.render(_||(_=babelHelpers.taggedTemplateLiteral(['<div class="user-grid_position-label">',"</div>"])),e)}function k(){return r.Tag.render(b||(b=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="user-grid_role-label --integrator">\n\t\t\t\t',"\n\t\t\t</span>\n\t\t"])),r.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_INTEGRATOR"))}function D(){return r.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="user-grid_role-label --admin">\n\t\t\t\t',"\n\t\t\t</span>\n\t\t"])),r.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_ADMIN"))}function F(){return r.Tag.render(N||(N=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="user-grid_role-label --extranet">\n\t\t\t\t',"\n\t\t\t</span>\n\t\t"])),r.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_EXTRANET"))}var X,P;var G=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"render",value:function e(t){var i=r.Text.getRandom(6);var a=r.Text.getRandom(6);this.appendToFieldNode(r.Tag.render(X||(X=babelHelpers.taggedTemplateLiteral(['<span id="','"></span>'])),i));this.appendToFieldNode(r.Tag.render(P||(P=babelHelpers.taggedTemplateLiteral(['<span class="user-grid_full-name-wrapper" id="','"></span>'])),a));new g({fieldId:i}).render(t);new y({fieldId:a}).render(t);r.Dom.addClass(this.getFieldNode(),"user-grid_employee-card-container")}}]);return t}(T);function x(e,t,i){z(e,t);t.set(e,i)}function z(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var W=new WeakMap;var V=function(){function e(t){var i;babelHelpers.classCallCheck(this,e);x(this,W,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,W,(i=BX.Main.gridManager.getById(t))===null||i===void 0?void 0:i.instance)}babelHelpers.createClass(e,[{key:"confirmAction",value:function e(t){var i=this;if(t.userId){this.confirmUser(t.isAccept?"confirm":"decline",(function(){var e=babelHelpers.classPrivateFieldGet(i,W).getRows().getById(t.userId);e===null||e===void 0?void 0:e.stateLoad();BX.ajax.runAction("intranet.controller.invite.confirmUserRequest",{data:{userId:t.userId,isAccept:t.isAccept?"Y":"N"}}).then((function(t){e===null||e===void 0?void 0:e.update()}))["catch"]((function(a){e===null||e===void 0?void 0:e.stateUnload();if(!t.isAccept){i.activityAction({userId:t.userId,action:"deactivateInvited"})}}))}))}}},{key:"activityAction",value:function e(t){var i,a,n=this;var r=(i=t.userId)!==null&&i!==void 0?i:null;var s=(a=t.action)!==null&&a!==void 0?a:null;if(r){this.confirmUser(s,(function(){var e=babelHelpers.classPrivateFieldGet(n,W).getRows().getById(t.userId);e===null||e===void 0?void 0:e.stateLoad();BX.ajax.runComponentAction("bitrix:intranet.user.list","setActivity",{mode:"class",data:{params:{userId:r,action:s}}}).then((function(){e===null||e===void 0?void 0:e.update()}))["catch"]((function(t){e===null||e===void 0?void 0:e.stateUnload();if(BX.type.isNotEmptyObject(t)&&BX.type.isArray(t.errors)&&s==="delete"){return n.activityAction({action:"deactivateInvited",userId:r})}}))}))}}},{key:"confirmUser",value:function e(t,i){var n,r;a.MessageBox.show({title:(n=this.getConfirmTitle(t))!==null&&n!==void 0?n:"",message:(r=this.getConfirmMessage(t))!==null&&r!==void 0?r:"",buttons:a.MessageBoxButtons.YES_CANCEL,yesCaption:this.getConfirmButtonText(t),onYes:function e(t){i();t.close()}})}},{key:"getConfirmTitle",value:function e(t){switch(t){case"restore":return r.Loc.getMessage("INTRANET_USER_LIST_ACTION_RESTORE_TITLE");case"confirm":return r.Loc.getMessage("INTRANET_USER_LIST_ACTION_CONFIRM_TITLE");case"delete":return r.Loc.getMessage("INTRANET_USER_LIST_ACTION_DELETE_TITLE");case"deactivate":return r.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_TITLE");case"deactivateInvited":return r.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_TITLE");case"decline":return r.Loc.getMessage("INTRANET_USER_LIST_ACTION_DECLINE_TITLE");default:return""}}},{key:"getConfirmMessage",value:function e(t){switch(t){case"restore":case"confirm":return r.Loc.getMessage("INTRANET_USER_LIST_ACTION_CONFIRM_MESSAGE");case"delete":return r.Loc.getMessage("INTRANET_USER_LIST_ACTION_DELETE_MESSAGE");case"deactivate":return r.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_MESSAGE");case"deactivateInvited":return r.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_MESSAGE");case"decline":return r.Loc.getMessage("INTRANET_USER_LIST_ACTION_DECLINE_MESSAGE");default:return""}}},{key:"getConfirmButtonText",value:function e(t){switch(t){case"restore":return r.Loc.getMessage("INTRANET_USER_LIST_ACTION_RESTORE_BUTTON");case"confirm":return r.Loc.getMessage("INTRANET_USER_LIST_ACTION_CONFIRM_BUTTON");case"delete":return r.Loc.getMessage("INTRANET_USER_LIST_ACTION_DELETE_BUTTON");case"deactivate":return r.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_BUTTON");case"deactivateInvited":return r.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_BUTTON");case"decline":return r.Loc.getMessage("INTRANET_USER_LIST_ACTION_DECLINE_BUTTON");default:return null}}}],[{key:"getInstance",value:function t(i){if(!this.instances[i]){this.instances[i]=new e(i)}return this.instances[i]}},{key:"setSort",value:function e(t){var a,n;(a=i.PopupManager.getPopupById(t.menuId))===null||a===void 0?void 0:a.close();var s=(n=BX.Main.gridManager.getById(t.gridId))===null||n===void 0?void 0:n.instance;if(r.Type.isObject(s)){s.tableFade();s.getUserOptions().setSort(t.sortBy,t.order,(function(){s.reload()}))}}},{key:"setFilter",value:function e(t){var i;var a=(i=BX.Main.gridManager.getById(t.gridId))===null||i===void 0?void 0:i.instance;var n=BX.Main.filterManager.getById(t.gridId);if(r.Type.isObject(a)&&r.Type.isObject(n)){n.getApi().extendFilter(t.filter)}}},{key:"reinviteAction",value:function e(t,i){return BX.ajax.runAction("intranet.controller.invite.reinvite",{data:{params:{userId:t,extranet:i?"Y":"N"}}}).then((function(e){if(e.data.result){var t=new BX.PopupWindow({content:"<p>".concat(r.Loc.getMessage("INTRANET_USER_LIST_ACTION_REINVITE_SUCCESS"),"</p>"),autoHide:true});t.show()}return e}))}}]);return e}();babelHelpers.defineProperty(V,"instances",[]);var j;var J=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"render",value:function e(t){var i;var a="";var n="";switch((i=t.action)!==null&&i!==void 0?i:"invite"){case"accept":a=r.Loc.getMessage("INTRANET_JS_CONTROL_BUTTON_ACCEPT_ENTER");n=BX.UI.Button.Color.PRIMARY;break;case"invite":default:a=r.Loc.getMessage("INTRANET_JS_CONTROL_BUTTON_INVITE_AGAIN");n=BX.UI.Button.Color.LIGHT_BORDER;break}var s=function e(){if(t.action==="invite"){o.setWaiting(true);V.reinviteAction(t.userId,t.isExtranet).then((function(){o.setWaiting(false)}))}else if(t.action==="accept"){V.getInstance(t.gridId).confirmAction({isAccept:true,userId:t.userId})}};var l=r.Tag.render(j||(j=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-counter user-grid_invitation-counter">\n\t\t\t\t<div class="ui-counter-inner">1</div>\n\t\t\t</div>\n\t\t'])));r.Dom.append(l,this.getFieldNode());var o=new BX.UI.Button({text:a,color:n,noCaps:true,size:BX.UI.Button.Size.EXTRA_SMALL,tag:BX.UI.Button.Tag.INPUT,round:true,onclick:s});o.renderTo(this.getFieldNode())}}]);return t}(T);var Y,q,K;var Q=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"render",value:function e(t){var i=this;r.Dom.addClass(this.getFieldNode(),"user-grid_department-container");if(t.departments.length===0&&t.canEdit){return;var a=function e(){var t=new l.Dialog({width:300,height:300,targetNode:n,compactView:true,multiple:false,entities:[{id:"department",options:{selectMode:"departmentsOnly",allowSelectRootDepartment:true}}]});t.show()};var n=r.Tag.render(Y||(Y=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="user-grid_department-btn" onclick="','">\n\t\t\t\t\t<div class="user-grid_department-icon-container">\n\t\t\t\t\t\t<div class="ui-icon-set --plus-30" style="--ui-icon-set__icon-size: 18px; --ui-icon-set__icon-color: #2fc6f6;"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="user-grid_department-name-container">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"])),a,r.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_ADD_DEPARTMENT"));this.appendToFieldNode(n)}else{Object.values(t.departments).forEach((function(e){var a=e.id===t.selectedDepartment;var n=function t(){V.setFilter({gridId:i.getGridId(),filter:{DEPARTMENT:a?"":e.id,DEPARTMENT_label:a?"":e.name}})};var s=r.Tag.render(q||(q=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="user-grid_department-btn ','"\n\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t<div class="user-grid_department-name-container">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"])),a?"--selected":"",n,e.name);if(a){r.Dom.append(r.Tag.render(K||(K=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t<div class="user-grid_department-btn-remove ui-icon-set --cross-60"></div>\n\t\t\t\t\t']))),s)}i.appendToFieldNode(s)}))}}}]);return t}(T);e.BaseField=T;e.PhotoField=g;e.FullNameField=y;e.EmployeeField=G;e.ActivityField=J;e.DepartmentField=Q;e.GridManager=V})(this.BX.Intranet.Grid.UserGrid=this.BX.Intranet.Grid.UserGrid||{},BX.UI,BX.Main,BX.UI.Dialogs,BX.UI,BX,BX,BX.UI.EntitySelector);
//# sourceMappingURL=grid.bundle.map.js