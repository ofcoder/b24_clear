{"version":3,"file":"script.js","sources":["src/workflow-loader.js","src/workflow-renderer.js","src/counter-panel.js","src/user-processes.js"],"sourcesContent":["import { TaskControls } from 'bizproc.task';\nimport { WorkflowId } from 'bizproc.types';\nimport { ajax } from 'main.core';\n\nexport type LoadWorkflowsResponseData = {\n\tdata: {\n\t\tworkflows: Array<WorkflowData>,\n\t},\n};\n\nexport type WorkflowData = {\n\tworkflowId: string,\n\tuserId: number,\n\tstartedById: number,\n\tstartedBy?: string,\n\ttaskProgress: {},\n\tname: string,\n\tdescription: string,\n\ttypeName: string,\n\tstatusText: string,\n\tmodified: string,\n\ttemplateName?: string,\n\tworkflowStarted: string,\n\tdocument: {\n\t\turl?: string,\n\t\tname: string,\n\t},\n\ttask: Partial<{\n\t\tid: number,\n\t\tname: string,\n\t\tdescription: string,\n\t\turl: string,\n\t\tusers: Array<{ id: number, status: number }>,\n\t\tstatus: number | string,\n\t\tcontrols: TaskControls,\n\t\tapproveType: string,\n\t\tcomments: number,\n\t\tmodified: string,\n\t\tmodifiedDate: number,\n\t\toverdueDate: string,\n\t}>,\n\ttaskCnt: number,\n\tcommentCnt: number,\n\tisCompleted: boolean,\n};\n\nexport class WorkflowLoader\n{\n\tloadWorkflows(ids: WorkflowId[]): Promise<LoadWorkflowsResponseData, Array<{ message: string }>>\n\t{\n\t\treturn this.#runComponentAction('loadWorkflows', { ids });\n\t}\n\n\t#runComponentAction(action: string, data: Object = {}): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax.runComponentAction('bitrix:bizproc.user.processes', action, {\n\t\t\t\tmode: 'class',\n\t\t\t\tdata,\n\t\t\t}).catch((response) => {\n\t\t\t\treject(response);\n\t\t\t}).then((response) => {\n\t\t\t\tresolve(response);\n\t\t\t});\n\t\t});\n\t}\n}\n","import { Text, Tag, Type, Dom, Uri, Loc } from 'main.core';\nimport { Task, InlineTaskView } from 'bizproc.task';\nimport type { UserProcesses } from './user-processes';\nimport { WorkflowData } from './workflow-loader';\nimport { WorkflowFaces } from 'bizproc.workflow.faces';\nimport { Summary } from 'bizproc.workflow.faces.summary';\nimport { Counter, CounterColor } from 'ui.cnt';\n\nexport class WorkflowRenderer\n{\n\t#currentUserId: number;\n\t#targetUserId: ?number;\n\t#data: WorkflowData;\n\t#task: Task;\n\t#inlineTaskView: InlineTaskView;\n\t#faces: ?WorkflowFaces = null;\n\n\tconstructor(data: {\n\t\tuserProcesses: UserProcesses,\n\t\tcurrentUserId: number,\n\t\tworkflow: WorkflowData,\n\t})\n\t{\n\t\tthis.#data = data.workflow;\n\t\tthis.#currentUserId = Type.isNumber(data.currentUserId) ? data.currentUserId : 0;\n\t\tthis.#targetUserId = this.#data.userId;\n\n\t\tif (this.#data.task)\n\t\t{\n\t\t\tthis.#task = new Task(this.#data.task);\n\t\t\tif (Type.isArrayFilled(this.#task.controls.buttons))\n\t\t\t{\n\t\t\t\tthis.#task.setButtons(\n\t\t\t\t\tthis.#task.buttons.map((button) => ({\n\t\t\t\t\t\tonclick: () => data.userProcesses.doTask({\n\t\t\t\t\t\t\ttaskId: this.#task.id,\n\t\t\t\t\t\t\tworkflowId: this.#data.workflowId,\n\t\t\t\t\t\t\ttaskName: this.#task.name,\n\t\t\t\t\t\t\ttaskRequest: {\n\t\t\t\t\t\t\t\t[button.NAME]: button.VALUE,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\t...button,\n\t\t\t\t\t})),\n\t\t\t\t);\n\t\t\t}\n\t\t\tthis.#inlineTaskView = new InlineTaskView({\n\t\t\t\ttask: this.#task,\n\t\t\t\tresponsibleUser: this.#targetUserId,\n\t\t\t});\n\t\t}\n\t}\n\n\trenderProcess(): HTMLElement | string\n\t{\n\t\tconst itemName = Type.isString(this.#data?.name) ? this.#data.name : '';\n\t\tconst typeName = Type.isString(this.#data?.typeName) ? this.#data.typeName : '';\n\t\tconst documentUrl = this.#data.task?.url || this.#getWorkflowInfoUrl();\n\n\t\tconst description = Type.isString(this.#data?.description) ? this.#data.description : '';\n\t\tconst lengthLimit = 80;\n\t\tconst collapsedDescription = Dom.create('span', { html: description?.replace(/(<br \\/>)+/gm, ' ') }).textContent.replace(/\\n+/, ' ').slice(0, lengthLimit);\n\t\tconst collapsed = description?.length > lengthLimit;\n\n\t\treturn Tag.render`\n\t\t\t\t<div class=\"bp-user-processes\">\n\t\t\t\t\t<a class=\"bp-user-processes__title-link ui-typography-text-lg\"\n\t\t\t\t\t\thref=\"${Text.encode(documentUrl)}\">${Text.encode(itemName)}\n\t\t\t\t\t</a>\n\t\t\t\t\t<div class=\"bp-user-processes__appointment\">${Text.encode(typeName.toUpperCase())}</div>\n\t\t\t\t\t<div class=\"bp-user-processes__description-box ${collapsed ? '' : '--expanded'}\">\n\t\t\t\t\t\t<span class=\"bp-user-processes__short_description\">\n\t\t\t\t\t\t\t${Text.encode(collapsedDescription)}\n\t\t\t\t\t\t\t...<a href=\"#\" onclick=\"this.closest('div').classList.add('--expanded'); return false;\" class=\"bp-user-processes__description-link\">${Loc.getMessage('BIZPROC_USER_PROCESSES_TEMPLATE_DESCRIPTION_MORE')}</a>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class=\"bp-user-processes__description\">\n\t\t\t\t\t\t\t${description}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getWorkflowInfoUrl(): string\n\t{\n\t\tconst uri = new Uri('/bitrix/components/bitrix/bizproc.workflow.info/');\n\t\turi.setQueryParam('workflow', this.#data.workflowId);\n\n\t\tif (!Type.isNil(this.#data.task?.id))\n\t\t{\n\t\t\turi.setQueryParam('task', this.#data.task?.id);\n\t\t}\n\n\t\treturn uri.toString();\n\t}\n\n\trenderTaskName(): ?HTMLElement\n\t{\n\t\treturn this.#inlineTaskView?.render();\n\t}\n\n\trenderTask(): ?HTMLElement\n\t{\n\t\tif (!this.#data.task || this.#data.userId !== this.#currentUserId)\n\t\t{\n\t\t\tconst completedClassName = this.#data.isCompleted ? '--success' : '';\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"bp-status-panel ${completedClassName}\">\n\t\t\t\t\t\t<div class=\"bp-status-item\">\n\t\t\t\t\t\t\t<div class=\"bp-status-name\">${Text.encode(this.#data.statusText.toUpperCase())}</div>\n\t\t\t\t\t\t\t${''/* completedClassName ? '' : '<div class=\"ui-icon-set --help bp-status-icon\"></div>' */}\n\t\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.renderTaskName();\n\t}\n\n\trenderDocumentName(): HTMLElement\n\t{\n\t\tconst documentName = Type.isString(this.#data?.document?.name) ? this.#data.document.name : '';\n\n\t\tif (Type.isString(this.#data?.document?.url))\n\t\t{\n\t\t\tconst url = new Uri(this.#data.document.url);\n\n\t\t\treturn Tag.render`\n\t\t\t\t<a href=\"${Text.encode(url.toString())}\">\n\t\t\t\t\t${Text.encode(documentName)}\n\t\t\t\t</a>\n\t\t\t`;\n\t\t}\n\n\t\treturn Text.encode(documentName);\n\t}\n\n\trenderWorkflowFaces(): HTMLElement\n\t{\n\t\tconst target = Tag.render`<div></div>`;\n\n\t\tthis.#faces = (new WorkflowFaces({\n\t\t\tworkflowId: this.#data.workflowId,\n\t\t\ttargetUserId: this.#targetUserId,\n\t\t\ttarget,\n\t\t\tdata: {\n\t\t\t\t...this.#data.taskProgress,\n\t\t\t\tsummaryProps: {\n\t\t\t\t\tshowContent: false,\n\t\t\t\t},\n\t\t\t},\n\t\t}));\n\t\tthis.#faces.render();\n\n\t\treturn target;\n\t}\n\n\trenderSummary(): HTMLElement\n\t{\n\t\treturn (\n\t\t\t(new Summary({\n\t\t\t\tworkflowId: this.#data.workflowId,\n\t\t\t\ttime: this.#data.taskProgress.time.total,\n\t\t\t\tworkflowIsCompleted: this.#data.taskProgress.workflowIsCompleted,\n\t\t\t\tshowArrow: false,\n\t\t\t})\n\t\t\t).render()\n\t\t);\n\t}\n\n\trenderModified(): HTMLElement\n\t{\n\t\tlet counter = null;\n\t\tif (this.#data.userId === this.#currentUserId && (this.#data.taskCnt > 0 || this.#data.commentCnt > 0))\n\t\t{\n\t\t\tconst primaryColor = this.#data.taskCnt === 0 && this.#data.commentCnt > 0\n\t\t\t\t? CounterColor.SUCCESS\n\t\t\t\t: CounterColor.DANGER\n\t\t\t;\n\n\t\t\tcounter = new Counter({\n\t\t\t\tvalue: this.#data.taskCnt || this.#data.commentCnt,\n\t\t\t\tcolor: primaryColor,\n\t\t\t\tsecondaryColor: CounterColor.SUCCESS,\n\t\t\t\tisDouble: this.#data.taskCnt > 0 && this.#data.commentCnt > 0,\n\t\t\t});\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"bp-modified-cell\">\n\t\t\t\t<span class=\"bp-row-counters\">${counter?.getContainer()}</span>\n\t\t\t\t<span>${Text.encode(this.#data.modified)}</span>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.#data = null;\n\t\tthis.#task = null;\n\t\tthis.#inlineTaskView = null;\n\n\t\tif (!Type.isNil(this.#faces))\n\t\t{\n\t\t\tthis.#faces.destroy();\n\t\t\tthis.#faces = null;\n\t\t}\n\t}\n}\n","import { Loc } from 'main.core';\n\ntype Counters = {\n\ttask: number,\n\tcomment: number,\n}\n\nexport class CounterPanel\n{\n\tfilterId: string;\n\tcounters: Counters;\n\tuiPanel;\n\n\tconstructor(options: {\n\t\tfilterId: string,\n\t\tcounters: Counters,\n\t})\n\t{\n\t\tthis.filterId = options.filterId;\n\t\tthis.counters = options.counters;\n\t}\n\n\trenderTo(target: HTMLElement)\n\t{\n\t\tthis.uiPanel = new BX.UI.CounterPanel({\n\t\t\ttarget,\n\t\t\tmultiselect: false,\n\t\t\ttitle: Loc.getMessage('BIZPROC_USER_PROCESSES_TEMPLATE_COUNTERS_LABEL'),\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\tid: 'task',\n\t\t\t\t\tvalue: {\n\t\t\t\t\t\tvalue: this.counters?.task || 0,\n\t\t\t\t\t\torder: 1,\n\t\t\t\t\t},\n\t\t\t\t\ttitle: {\n\t\t\t\t\t\tvalue: Loc.getMessage('BIZPROC_USER_PROCESSES_TEMPLATE_COUNTERS_TASK'),\n\t\t\t\t\t\torder: 2,\n\t\t\t\t\t},\n\t\t\t\t\tcolor: this.#getTaskColor(this.counters?.task),\n\t\t\t\t\tseparator: false,\n\t\t\t\t\teventsForActive: {\n\t\t\t\t\t\tclick: this.#setFilterPreset.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\teventsForUnActive: {\n\t\t\t\t\t\tclick: this.#setFilterPreset.bind(this, 'active_task'),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'comment',\n\t\t\t\t\tvalue: this.counters?.comment || 0,\n\t\t\t\t\ttitle: Loc.getMessage('BIZPROC_USER_PROCESSES_TEMPLATE_COUNTERS_COMMENT'),\n\t\t\t\t\tcolor: this.#getCommentColor(this.counters?.comment),\n\t\t\t\t\teventsForActive: {\n\t\t\t\t\t\tclick: this.#setFilterPreset.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\teventsForUnActive: {\n\t\t\t\t\t\tclick: this.#setFilterPreset.bind(this, 'comment'),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\n\t\tthis.uiPanel.init();\n\t\tthis.#subscribeToPulls();\n\t}\n\n\t#subscribeToPulls()\n\t{\n\t\tBX.PULL.subscribe({\n\t\t\tmoduleId: 'main',\n\t\t\tcommand: 'user_counter',\n\t\t\tcallback: (params) => {\n\t\t\t\tconst taskCounterValue = (params[BX.message('SITE_ID')])?.bp_tasks ?? null;\n\t\t\t\tif (taskCounterValue !== null)\n\t\t\t\t{\n\t\t\t\t\tthis.uiPanel.getItemById('task').updateValue(taskCounterValue);\n\t\t\t\t\tthis.uiPanel.getItemById('task').updateColor(this.#getTaskColor(taskCounterValue));\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tBX.PULL.subscribe({\n\t\t\tmoduleId: 'bizproc',\n\t\t\tcommand: 'comment',\n\t\t\tcallback: (params) => {\n\t\t\t\tconst allUnreadValue: number | null = params.counter?.allUnread ?? null;\n\n\t\t\t\tif (allUnreadValue !== null)\n\t\t\t\t{\n\t\t\t\t\tthis.uiPanel.getItemById('comment').updateValue(allUnreadValue);\n\t\t\t\t\tthis.uiPanel.getItemById('comment').updateColor(this.#getCommentColor(allUnreadValue));\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\t#getTaskColor(value): string\n\t{\n\t\treturn value > 0 ? 'DANGER' : 'THEME';\n\t}\n\n\t#getCommentColor(value): string\n\t{\n\t\treturn value > 0 ? 'SUCCESS' : 'THEME';\n\t}\n\n\t#setFilterPreset(presetId: string): void\n\t{\n\t\tconst filterManager = this.#getFilterManager();\n\t\tif (!filterManager)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst api = filterManager.getApi();\n\t\tconst fields = {\n\t\t\tSYSTEM_PRESET: presetId ?? 'in_work',\n\t\t};\n\n\t\tapi.setFields(fields);\n\t\tapi.apply();\n\t}\n\n\t#getFilterManager(): ?BX.Main.Filter\n\t{\n\t\tif (this.filterId)\n\t\t{\n\t\t\treturn BX.Main.filterManager?.getById(this.filterId);\n\t\t}\n\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.warn('Filter not found');\n\n\t\treturn null;\n\t}\n}\n","import { ajax, Type, Dom, Tag, Text, Loc, Event, Runtime } from 'main.core';\nimport { Alert, AlertColor } from 'ui.alerts';\nimport { TagSelector } from 'ui.entity-selector';\nimport { Menu } from 'main.popup';\nimport type { WorkflowData } from './workflow-loader';\nimport { WorkflowLoader, LoadWorkflowsResponseData } from './workflow-loader';\nimport { WorkflowRenderer } from './workflow-renderer';\nimport { CounterPanel } from './counter-panel.js';\nimport { UI } from 'ui.notification';\n\nimport './style.css';\n\nimport 'ui.design-tokens';\n\ntype WorkflowId = string;\ntype TaskId = number;\n\nexport class UserProcesses\n{\n\tgridId: string;\n\tdelegateToSelector: TagSelector;\n\tdelegateToUserId: number = 0;\n\tactionPanel: {\n\t\twrapperElementId: string,\n\t\tactionButtonName: string,\n\t\tuserWrapperElement: ?HTMLElement,\n\t};\n\n\t#workflowTasks: Map<WorkflowId, TaskId> = new Map();\n\t#workflowRenderer: Object<WorkflowId, WorkflowRenderer> = {};\n\tcurrentUserId: number;\n\n\tloader: WorkflowLoader;\n\n\tconstructor(options: {\n\t\tgridId: string,\n\t\tactionPanelUserWrapperId: string,\n\t\terrors: Array<{ message: string }>,\n\t\tcurrentUserId: number,\n\t\tmustSubscribeToPushes: boolean,\n\t})\n\t{\n\t\tlet mustSubscribeToPushes = false;\n\n\t\tif (Type.isPlainObject(options))\n\t\t{\n\t\t\tthis.gridId = options.gridId;\n\n\t\t\tif (Type.isArray(options.errors))\n\t\t\t{\n\t\t\t\tthis.showErrors(options.errors);\n\t\t\t}\n\t\t\tthis.actionPanel = {\n\t\t\t\twrapperElementId: options.actionPanelUserWrapperId,\n\t\t\t\tactionButtonName: `${this.gridId}_action_button`,\n\t\t\t};\n\n\t\t\tthis.currentUserId = options.currentUserId;\n\n\t\t\tmustSubscribeToPushes = options.mustSubscribeToPushes === true;\n\t\t}\n\n\t\tthis.bindAnchors();\n\n\t\tthis.loader = new WorkflowLoader();\n\n\t\tif (mustSubscribeToPushes)\n\t\t{\n\t\t\tthis.#subscribeToPushes();\n\t\t}\n\n\t\tthis.init();\n\t\tthis.initCounterPanel(options.counters, options.filterId);\n\t}\n\n\t#subscribeToPushes()\n\t{\n\t\tBX.PULL.subscribe({\n\t\t\tmoduleId: 'bizproc',\n\t\t\tcommand: 'workflow',\n\t\t\tcallback: (params) => {\n\t\t\t\tif (params.eventName === 'DELETED' || params.eventName === 'UPDATED')\n\t\t\t\t{\n\t\t\t\t\tparams.items.forEach((workflow) => this.removeWorkflow(workflow.id));\n\t\t\t\t}\n\n\t\t\t\tif (params.eventName === 'ADDED' || params.eventName === 'UPDATED')\n\t\t\t\t{\n\t\t\t\t\tconst rowsCollectionWrapper: BX.Grid.Rows = this.getGrid().getRows();\n\t\t\t\t\tlet ids = params.items.map((workflow) => workflow.id);\n\t\t\t\t\tif (params.eventName === 'ADDED')\n\t\t\t\t\t{\n\t\t\t\t\t\tids = ids.filter((id) => !rowsCollectionWrapper.getById(id));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (ids.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.loader\n\t\t\t\t\t\t\t.loadWorkflows(ids)\n\t\t\t\t\t\t\t.then(this.#updateWorkflows.bind(this))\n\t\t\t\t\t\t\t.catch((response) => this.showErrors(response))\n\t\t\t\t\t\t;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\t#updateWorkflows(response: LoadWorkflowsResponseData): void\n\t{\n\t\tconst { workflows } = response.data;\n\t\tif (!Type.isArray(workflows))\n\t\t{\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.warn('Unexpected response from server. Expected workflow.data to be an array');\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst gridRealtime = this.getGrid()?.getRealtime();\n\n\t\tif (gridRealtime)\n\t\t{\n\t\t\tlet lastWorkflowId = null;\n\t\t\tworkflows.forEach((workflow) => {\n\t\t\t\tconst isActual = Boolean(\n\t\t\t\t\tworkflow.taskCnt > 0\n\t\t\t\t\t|| workflow.commentCnt > 0\n\t\t\t\t\t|| (\n\t\t\t\t\t\tworkflow.startedById === this.currentUserId\n\t\t\t\t\t\t&& workflow.isCompleted === false\n\t\t\t\t\t),\n\t\t\t\t);\n\n\t\t\t\tif (isActual)\n\t\t\t\t{\n\t\t\t\t\tthis.#appendWorkflow({\n\t\t\t\t\t\tworkflow,\n\t\t\t\t\t\trenderer: this.#createWorkflowRenderer(workflow.workflowId, workflow),\n\t\t\t\t\t\tinsertAfter: lastWorkflowId,\n\t\t\t\t\t});\n\t\t\t\t\tlastWorkflowId = workflow.workflowId;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t#appendWorkflow({ workflow, renderer, insertAfter }): void\n\t{\n\t\tif (workflow.task)\n\t\t{\n\t\t\tthis.#workflowTasks.set(workflow.workflowId, workflow.task.id);\n\t\t}\n\n\t\tconst gridRealtime = this.getGrid()?.getRealtime();\n\t\tif (!gridRealtime)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst addRowOptions = this.getDefaultAddRowOptions(workflow, renderer);\n\n\t\tif (Type.isStringFilled(insertAfter))\n\t\t{\n\t\t\taddRowOptions.insertAfter = insertAfter;\n\t\t}\n\t\telse\n\t\t{\n\t\t\taddRowOptions.prepend = true;\n\t\t}\n\n\t\tgridRealtime.addRow(addRowOptions);\n\n\t\t// temporary crutches for the GRID :-)\n\t\tconst row: BX.Grid.Row = this.getGrid()?.getRows().getById(workflow.workflowId);\n\t\tif (row)\n\t\t{\n\t\t\tif (addRowOptions.columnClasses)\n\t\t\t{\n\t\t\t\tfor (const [columnId, columnClass] of Object.entries(addRowOptions.columnClasses))\n\t\t\t\t{\n\t\t\t\t\tif (columnClass)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.addClass(row.getCellById(columnId), columnClass);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tDom.addClass(row.getNode(), 'main-ui-grid-show-new-row');\n\t\t\tEvent.bind(row.getNode(), 'animationend', (event: AnimationEvent) => {\n\t\t\t\tif (event.animationName === 'showNewRow')\n\t\t\t\t{\n\t\t\t\t\tDom.removeClass(row.getNode(), 'main-ui-grid-show-new-row');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tgetDefaultAddRowOptions(workflow: WorkflowData, renderer: WorkflowRenderer): Object\n\t{\n\t\tconst actions = [\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('BIZPROC_USER_PROCESSES_TEMPLATE_ROW_ACTION_DOCUMENT'),\n\t\t\t\thref: workflow.document.url || '#',\n\t\t\t},\n\t\t];\n\n\t\tif (workflow.task)\n\t\t{\n\t\t\tactions.push({\n\t\t\t\ttext: Loc.getMessage('BIZPROC_USER_PROCESSES_TEMPLATE_ROW_ACTION_TASK'),\n\t\t\t\thref: workflow.task.url,\n\t\t\t});\n\t\t}\n\n\t\treturn {\n\t\t\tid: workflow.workflowId,\n\t\t\tanimation: false,\n\t\t\tcolumns: {\n\t\t\t\tID: workflow.workflowId,\n\t\t\t\tPROCESS: renderer.renderProcess(),\n\t\t\t\tTASK_PROGRESS: renderer.renderWorkflowFaces(),\n\t\t\t\tTASK: renderer.renderTask(),\n\t\t\t\tWORKFLOW_STATE: Text.encode(workflow.statusText),\n\t\t\t\tDOCUMENT_NAME: renderer.renderDocumentName(),\n\t\t\t\tWORKFLOW_TEMPLATE_NAME: Text.encode(workflow.templateName),\n\t\t\t\tTASK_DESCRIPTION: Dom.create('span', { html: workflow.task?.description || '' }),\n\t\t\t\tMODIFIED: renderer.renderModified(),\n\t\t\t\tWORKFLOW_STARTED: Text.encode(workflow.workflowStarted),\n\t\t\t\tWORKFLOW_STARTED_BY: Text.encode(workflow.startedBy),\n\t\t\t\tOVERDUE_DATE: Text.encode(workflow.task?.overdueDate),\n\t\t\t\tSUMMARY: renderer.renderSummary(),\n\t\t\t},\n\t\t\tactions,\n\t\t\tcolumnClasses: {\n\t\t\t\tTASK_PROGRESS: 'bp-task-progress-cell',\n\t\t\t\tSUMMARY: 'bp-summary-cell',\n\t\t\t\tTASK: workflow.isCompleted ? 'bp-status-completed-cell' : '',\n\t\t\t},\n\t\t\teditable: Boolean(workflow.task),\n\t\t};\n\t}\n\n\tinit(): void\n\t{\n\t\tthis.actionPanel.userWrapperElement = document.getElementById(this.actionPanel.wrapperElementId);\n\t\tthis.initUserSelector();\n\t\tthis.renderCells();\n\n\t\tthis.onActionPanelChanged();\n\t}\n\n\tinitCounterPanel(counters, filterId): void\n\t{\n\t\tconst panelWrapperNode = document.querySelector('[data-role=\"bizproc-counterpanel\"]');\n\t\tif (!panelWrapperNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t(new CounterPanel({ counters, filterId })).renderTo(panelWrapperNode);\n\t}\n\n\trenderCells()\n\t{\n\t\tconst updated = new Map();\n\n\t\tdocument.querySelectorAll('[data-role=\"bp-render-cell\"]').forEach(\n\t\t\t(target) => {\n\t\t\t\tconst workflow = Dom.attr(target, 'data-workflow');\n\t\t\t\tconst columnId = Dom.attr(target, 'data-column');\n\n\t\t\t\tif (workflow)\n\t\t\t\t{\n\t\t\t\t\tif (!updated.has(workflow.workflowId))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#deleteWorkflowRendererById(workflow.workflowId);\n\t\t\t\t\t\tupdated.set(workflow.workflowId);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (workflow.task)\n\t\t\t\t\t{\n\t\t\t\t\t\t// set workflow task map\n\t\t\t\t\t\tthis.#workflowTasks.set(workflow.workflowId, workflow.task.id);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.renderColumnCell(target, columnId, workflow);\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t}\n\n\trenderColumnCell(target, columnId, workflow)\n\t{\n\t\tconst renderer = (\n\t\t\tthis.#getWorkflowRendererById(String(workflow.workflowId))\n\t\t\t?? this.#createWorkflowRenderer(String(workflow.workflowId), workflow)\n\t\t);\n\n\t\tlet childNode = null;\n\t\tswitch (columnId)\n\t\t{\n\t\t\tcase 'DOCUMENT_NAME':\n\t\t\t\tchildNode = renderer.renderDocumentName();\n\t\t\t\tbreak;\n\n\t\t\tcase 'PROCESS':\n\t\t\t\tchildNode = renderer.renderProcess();\n\t\t\t\tbreak;\n\n\t\t\tcase 'TASK_PROGRESS':\n\t\t\t\tchildNode = renderer.renderWorkflowFaces();\n\t\t\t\tbreak;\n\n\t\t\tcase 'TASK':\n\t\t\t\tchildNode = renderer.renderTask();\n\t\t\t\tbreak;\n\n\t\t\tcase 'SUMMARY':\n\t\t\t\tchildNode = renderer.renderSummary();\n\t\t\t\tbreak;\n\n\t\t\tcase 'MODIFIED':\n\t\t\t\tchildNode = renderer.renderModified();\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\t// do nothing\n\t\t}\n\n\t\tif (childNode)\n\t\t{\n\t\t\tDom.replace(\n\t\t\t\ttarget,\n\t\t\t\tchildNode,\n\t\t\t);\n\t\t}\n\t}\n\n\tbindAnchors()\n\t{\n\t\tBX.SidePanel.Instance.bindAnchors({\n\t\t\trules:\n\t\t\t\t[\n\t\t\t\t\t{\n\t\t\t\t\t\tcondition: [\n\t\t\t\t\t\t\t'/rpa/task/',\n\t\t\t\t\t\t],\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\twidth: 580,\n\t\t\t\t\t\t\tcacheable: false,\n\t\t\t\t\t\t\tallowChangeHistory: false,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tcondition: [\n\t\t\t\t\t\t\t'/bitrix/components/bitrix/bizproc.workflow.info/',\n\t\t\t\t\t\t],\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tcacheable: false,\n\t\t\t\t\t\t\tallowChangeHistory: false,\n\t\t\t\t\t\t\tloader: '/bitrix/components/bitrix/bizproc.workflow.info/templates/slider/images/skeleton.svg',\n\t\t\t\t\t\t\twidth: this.#detectSliderWidth(),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t});\n\t}\n\n\t#detectSliderWidth(): number\n\t{\n\t\tif (window.innerWidth < 1500)\n\t\t{\n\t\t\treturn null; // default slider width\n\t\t}\n\n\t\treturn 1500 + Math.floor((window.innerWidth - 1500) / 3);\n\t}\n\n\tasync initStartWorkflowButton(buttonId: ?string)\n\t{\n\t\tconst button = Type.isStringFilled(buttonId) && document.getElementById(buttonId);\n\t\tconst lists = Type.isStringFilled(button?.dataset.lists) && JSON.parse(button.dataset.lists);\n\t\tlet selectedIBlockSliderParams = null;\n\n\t\tif (lists)\n\t\t{\n\t\t\tconst popupMenu = new Menu({\n\t\t\t\tangle: true,\n\t\t\t\toffsetLeft: Dom.getPosition(button).width / 2,\n\t\t\t\tautoHide: true,\n\t\t\t\tbindElement: button,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\titems: Object.values(lists).map((list) => {\n\t\t\t\t\tconst item = {\n\t\t\t\t\t\ttext: list.name,\n\t\t\t\t\t\tclassName: 'feed-add-post-form-link-lists',\n\t\t\t\t\t\tdataset: {\n\t\t\t\t\t\t\ticonUrl: list.icon,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\n\t\t\t\t\tif (Type.isNil(list.url))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst params = {\n\t\t\t\t\t\t\tiBlockTypeId: list.iBlockTypeId,\n\t\t\t\t\t\t\tiBlockId: list.iBlockId,\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (list.selected === true)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tselectedIBlockSliderParams = params;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\titem.onclick = () => {\n\t\t\t\t\t\t\tpopupMenu.close();\n\t\t\t\t\t\t\tRuntime.loadExtension('lists.element.creation-guide')\n\t\t\t\t\t\t\t\t.then(({ CreationGuide }) => {\n\t\t\t\t\t\t\t\t\tCreationGuide?.open(params);\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.catch(() => {})\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\titem.href = list.url;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn item;\n\t\t\t\t}),\n\t\t\t});\n\t\t\tconst popupElement = popupMenu.getMenuContainer();\n\t\t\tfor (const iconElement of popupElement.querySelectorAll('.menu-popup-item-icon'))\n\t\t\t{\n\t\t\t\tDom.append(\n\t\t\t\t\tTag.render`\n\t\t\t\t\t\t<img src = \"${iconElement.parentElement.dataset.iconUrl}\" alt=\"\" width = \"19\" height = \"16\"/>\n\t\t\t\t\t`,\n\t\t\t\t\ticonElement,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tbutton.onclick = (event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tpopupMenu.show();\n\t\t\t};\n\t\t}\n\n\t\tif (selectedIBlockSliderParams)\n\t\t{\n\t\t\tRuntime.loadExtension('lists.element.creation-guide')\n\t\t\t\t.then(({ CreationGuide }) => {\n\t\t\t\t\tCreationGuide?.open(selectedIBlockSliderParams);\n\t\t\t\t})\n\t\t\t\t.catch(() => {})\n\t\t\t;\n\t\t}\n\t}\n\n\tinitUserSelector(): void\n\t{\n\t\tif (!this.delegateToSelector)\n\t\t{\n\t\t\tthis.delegateToSelector = new TagSelector({\n\t\t\t\tmultiple: false,\n\t\t\t\ttagMaxWidth: 180,\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd: (event) => {\n\t\t\t\t\t\tthis.delegateToUserId = parseInt(event.getData().tag.getId(), 10);\n\n\t\t\t\t\t\tif (!Type.isInteger(this.delegateToUserId))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.delegateToUserId = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tonTagRemove: () => {\n\t\t\t\t\t\tthis.delegateToUserId = 0;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tdialogOptions: {\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'user',\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tintranetUsersOnly: true,\n\t\t\t\t\t\t\t\tinviteEmployeeLink: false,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tif (Type.isDomNode(this.actionPanel.userWrapperElement))\n\t\t{\n\t\t\tDom.clean(this.actionPanel.userWrapperElement);\n\t\t\tthis.delegateToSelector.renderTo(this.actionPanel.userWrapperElement);\n\t\t}\n\t}\n\n\tshowErrors(errors: Array<{ message: string }>): void\n\t{\n\t\tif (!Type.isArrayFilled(errors))\n\t\t{\n\t\t\tif (!Type.isArray(errors))\n\t\t\t{\n\t\t\t\tconsole.error(errors);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst errorsContainer = document.getElementById('bp-user-processes-errors-container');\n\n\t\tif (errorsContainer)\n\t\t{\n\t\t\tlet errorCounter = 0;\n\t\t\tconst fixStyles = () => {\n\t\t\t\tif (errorCounter > 0)\n\t\t\t\t{\n\t\t\t\t\tDom.style(errorsContainer, { margin: '10px' });\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tDom.style(errorsContainer, { margin: '0px' });\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tfor (const error of errors)\n\t\t\t{\n\t\t\t\terrorCounter += 1;\n\n\t\t\t\tconst alert = new Alert({\n\t\t\t\t\ttext: Text.encode(error.message),\n\t\t\t\t\tcolor: AlertColor.DANGER,\n\t\t\t\t\tcloseBtn: true,\n\t\t\t\t\tanimated: true,\n\t\t\t\t});\n\n\t\t\t\talert.renderTo(errorsContainer);\n\n\t\t\t\tif (alert.getCloseBtn())\n\t\t\t\t{\n\t\t\t\t\t// eslint-disable-next-line no-loop-func\n\t\t\t\t\talert.getCloseBtn().onclick = () => {\n\t\t\t\t\t\terrorCounter -= 1;\n\t\t\t\t\t\tfixStyles();\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfixStyles();\n\t\t}\n\t}\n\n\tonActionPanelChanged(): void\n\t{\n\t\tconst grid = this.getGrid();\n\t\tconst actionPanel = grid?.getActionsPanel();\n\n\t\tif (actionPanel)\n\t\t{\n\t\t\tconst action = actionPanel.getValues()[this.actionPanel.actionButtonName];\n\t\t\tif (!Type.isString(action) || action.includes('set_status'))\n\t\t\t{\n\t\t\t\tDom.hide(this.actionPanel.userWrapperElement);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.show(this.actionPanel.userWrapperElement);\n\t\t\t}\n\t\t}\n\t}\n\n\tapplyActionPanelValues(): void\n\t{\n\t\tconst grid = this.getGrid();\n\t\tconst actionsPanel = grid?.getActionsPanel();\n\n\t\tif (grid && actionsPanel)\n\t\t{\n\t\t\tconst isApplyingForAll = actionsPanel.getForAllCheckbox()?.checked === true;\n\t\t\t// TODO - implement doing all tasks\n\t\t\tif (isApplyingForAll)\n\t\t\t{\n\t\t\t\tthis.showErrors([{ message: 'Not implemented currently' }]);\n\t\t\t}\n\n\t\t\tconst action: string = actionsPanel.getValues()[this.actionPanel.actionButtonName];\n\n\t\t\tif (Type.isString(action))\n\t\t\t{\n\t\t\t\tconst selectedTasks = this.getSelectedTaskIds(grid.getRows().getSelectedIds());\n\n\t\t\t\tif (selectedTasks.length === 0)\n\t\t\t\t{\n\t\t\t\t\t// todo: show error?\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (action.includes('set_status_'))\n\t\t\t\t{\n\t\t\t\t\tconst status = parseInt(action.split('_').pop(), 10);\n\n\t\t\t\t\tif (Type.isNumber(status))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setTasksStatuses(selectedTasks, status);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (action.startsWith('delegate_to'))\n\t\t\t\t{\n\t\t\t\t\tthis.delegateTasks(selectedTasks, this.delegateToUserId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetSelectedTaskIds(selectedWorkflowIds: Array<WorkflowId>): Array<TaskId>\n\t{\n\t\treturn (\n\t\t\tselectedWorkflowIds\n\t\t\t\t.map((workflowId) => this.#workflowTasks.get(workflowId))\n\t\t\t\t.filter((taskId) => Type.isNumber(taskId))\n\t\t);\n\t}\n\n\tsetTasksStatuses(taskIds: Array<TaskId>, newStatus: number): void\n\t{\n\t\t// eslint-disable-next-line promise/catch-or-return\n\t\tajax\n\t\t\t.runAction('bizproc.task.doInlineTasks', {\n\t\t\t\tdata: {\n\t\t\t\t\ttaskIds,\n\t\t\t\t\tnewStatus,\n\t\t\t\t},\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.showErrors(response.errors);\n\t\t\t\tthis.reloadGrid();\n\t\t\t})\n\t\t\t// .then(() => this.reloadGrid())\n\t\t;\n\t}\n\n\tdelegateTasks(taskIds: Array<TaskId>, toUserId: number): void\n\t{\n\t\t// eslint-disable-next-line promise/catch-or-return\n\t\tajax\n\t\t\t.runComponentAction('bitrix:bizproc.user.processes', 'delegateTasks', {\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\ttaskIds,\n\t\t\t\t\ttoUserId,\n\t\t\t\t},\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.showErrors(response.errors);\n\t\t\t\tthis.reloadGrid();\n\t\t\t})\n\t\t\t// .then(() => this.reloadGrid())\n\t\t;\n\t}\n\n\treloadGrid(): void\n\t{\n\t\tthis.getGrid()?.reload();\n\t}\n\n\tdoTask(props: {\n\t\ttaskId: TaskId,\n\t\tworkflowId: WorkflowId,\n\t\ttaskName: string,\n\t\ttaskRequest: Object,\n\t}): void\n\t{\n\t\tthis.#hideRow(props.workflowId);\n\n\t\tajax.runAction('bizproc.task.do', {\n\t\t\tdata: props,\n\t\t}).then(() => {\n\t\t\tif (props.taskName)\n\t\t\t{\n\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage(\n\t\t\t\t\t\t'BIZPROC_USER_PROCESSES_TEMPLATE_TASK_TOUCHED',\n\t\t\t\t\t\t{ '#TASK_NAME#': Text.encode(props.taskName) },\n\t\t\t\t\t),\n\t\t\t\t});\n\t\t\t}\n\t\t}).catch((response) => {\n\t\t\tthis.showErrors(response.errors);\n\t\t\tthis.#showRow(props.workflowId);\n\t\t});\n\t}\n\n\tremoveWorkflow(workflowId: string): void\n\t{\n\t\tthis.#hideRow(workflowId, true);\n\t\tthis.#deleteWorkflowRendererById(workflowId);\n\t\tthis.#workflowTasks.delete(workflowId);\n\t}\n\n\tgetGrid(): ?BX.Main.grid\n\t{\n\t\tif (this.gridId)\n\t\t{\n\t\t\treturn BX.Main.gridManager?.getInstanceById(this.gridId);\n\t\t}\n\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.warn('Grid not found');\n\n\t\treturn null;\n\t}\n\n\t#createWorkflowRenderer(workflowId: WorkflowId, workflow): WorkflowRenderer\n\t{\n\t\tthis.#workflowRenderer[workflowId] = new WorkflowRenderer({\n\t\t\tuserProcesses: this,\n\t\t\tcurrentUserId: this.currentUserId,\n\t\t\tworkflow,\n\t\t});\n\n\t\treturn this.#workflowRenderer[workflowId];\n\t}\n\n\t#getWorkflowRendererById(workflowId: WorkflowId): ?WorkflowRenderer\n\t{\n\t\treturn Type.isNil(this.#workflowRenderer[workflowId]) ? null : this.#workflowRenderer[workflowId];\n\t}\n\n\t#deleteWorkflowRendererById(workflowId: WorkflowId)\n\t{\n\t\tconst renderer = this.#getWorkflowRendererById(workflowId);\n\t\tif (renderer)\n\t\t{\n\t\t\trenderer.destroy();\n\t\t\tdelete this.#workflowRenderer[workflowId];\n\t\t}\n\t}\n\n\t#hideRow(id: string, remove: boolean = false): void\n\t{\n\t\tconst grid = this.getGrid();\n\t\tconst row = grid?.getRows().getById(id);\n\n\t\tif (row)\n\t\t{\n\t\t\trow.hide();\n\t\t\tif (remove)\n\t\t\t{\n\t\t\t\tDom.remove(row.getNode());\n\t\t\t}\n\n\t\t\tif (grid.getRows().getCountDisplayed() === 0)\n\t\t\t{\n\t\t\t\tgrid.getRealtime().showStub();\n\t\t\t}\n\t\t}\n\t}\n\n\t#showRow(id: string): void\n\t{\n\t\tthis.getGrid()?.getRows().getById(id)?.show();\n\t}\n}\n"],"names":["WorkflowLoader","loadWorkflows","ids","action","data","Promise","resolve","reject","ajax","runComponentAction","mode","catch","response","then","WorkflowRenderer","constructor","workflow","Type","isNumber","currentUserId","userId","task","Task","isArrayFilled","controls","buttons","setButtons","map","button","onclick","userProcesses","doTask","taskId","id","workflowId","taskName","name","taskRequest","NAME","VALUE","InlineTaskView","responsibleUser","renderProcess","itemName","isString","typeName","documentUrl","url","description","lengthLimit","collapsedDescription","Dom","create","html","replace","textContent","slice","collapsed","length","Tag","render","Text","encode","toUpperCase","Loc","getMessage","renderTaskName","renderTask","completedClassName","isCompleted","statusText","renderDocumentName","documentName","document","Uri","toString","renderWorkflowFaces","target","WorkflowFaces","targetUserId","taskProgress","summaryProps","showContent","renderSummary","Summary","time","total","workflowIsCompleted","showArrow","renderModified","counter","taskCnt","commentCnt","primaryColor","CounterColor","SUCCESS","DANGER","Counter","value","color","secondaryColor","isDouble","getContainer","modified","destroy","isNil","uri","setQueryParam","CounterPanel","options","filterId","counters","renderTo","uiPanel","BX","UI","multiselect","title","items","order","separator","eventsForActive","click","bind","eventsForUnActive","comment","init","PULL","subscribe","moduleId","command","callback","params","taskCounterValue","message","bp_tasks","getItemById","updateValue","updateColor","allUnreadValue","allUnread","presetId","filterManager","api","getApi","fields","SYSTEM_PRESET","setFields","apply","Main","getById","console","warn","UserProcesses","delegateToUserId","Map","mustSubscribeToPushes","isPlainObject","gridId","isArray","errors","showErrors","actionPanel","wrapperElementId","actionPanelUserWrapperId","actionButtonName","bindAnchors","loader","initCounterPanel","getDefaultAddRowOptions","renderer","actions","text","href","push","animation","columns","ID","PROCESS","TASK_PROGRESS","TASK","WORKFLOW_STATE","DOCUMENT_NAME","WORKFLOW_TEMPLATE_NAME","templateName","TASK_DESCRIPTION","MODIFIED","WORKFLOW_STARTED","workflowStarted","WORKFLOW_STARTED_BY","startedBy","OVERDUE_DATE","overdueDate","SUMMARY","columnClasses","editable","Boolean","userWrapperElement","getElementById","initUserSelector","renderCells","onActionPanelChanged","panelWrapperNode","querySelector","updated","querySelectorAll","forEach","attr","columnId","has","set","renderColumnCell","String","childNode","SidePanel","Instance","rules","condition","width","cacheable","allowChangeHistory","initStartWorkflowButton","buttonId","isStringFilled","lists","dataset","JSON","parse","selectedIBlockSliderParams","popupMenu","Menu","angle","offsetLeft","getPosition","autoHide","bindElement","closeByEsc","Object","values","list","item","className","iconUrl","icon","iBlockTypeId","iBlockId","selected","close","Runtime","loadExtension","CreationGuide","open","popupElement","getMenuContainer","iconElement","append","parentElement","event","preventDefault","show","delegateToSelector","TagSelector","multiple","tagMaxWidth","events","onTagAdd","parseInt","getData","tag","getId","isInteger","onTagRemove","dialogOptions","entities","intranetUsersOnly","inviteEmployeeLink","isDomNode","clean","error","errorsContainer","errorCounter","fixStyles","style","margin","alert","Alert","AlertColor","closeBtn","animated","getCloseBtn","grid","getGrid","getActionsPanel","getValues","includes","hide","applyActionPanelValues","actionsPanel","isApplyingForAll","getForAllCheckbox","checked","selectedTasks","getSelectedTaskIds","getRows","getSelectedIds","status","split","pop","setTasksStatuses","startsWith","delegateTasks","selectedWorkflowIds","get","filter","taskIds","newStatus","runAction","reloadGrid","toUserId","reload","props","Notification","Center","notify","content","removeWorkflow","delete","gridManager","getInstanceById","eventName","rowsCollectionWrapper","workflows","gridRealtime","getRealtime","lastWorkflowId","isActual","startedById","insertAfter","addRowOptions","prepend","addRow","row","columnClass","entries","addClass","getCellById","getNode","Event","animationName","removeClass","window","innerWidth","Math","floor","remove","getCountDisplayed","showStub"],"mappings":"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"}