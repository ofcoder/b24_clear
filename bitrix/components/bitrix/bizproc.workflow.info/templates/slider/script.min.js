this.BX=this.BX||{};this.BX.Bizproc=this.BX.Bizproc||{};(function(e,t,s,o,a,i){"use strict";var r=babelHelpers.classPrivateFieldLooseKey("renderButtons");var n=babelHelpers.classPrivateFieldLooseKey("handleTaskButtonClick");var l=babelHelpers.classPrivateFieldLooseKey("handleDelegateButtonClick");var c=babelHelpers.classPrivateFieldLooseKey("delegateTask");var d=babelHelpers.classPrivateFieldLooseKey("sendMarkAsRead");var u=babelHelpers.classPrivateFieldLooseKey("clearError");var h=babelHelpers.classPrivateFieldLooseKey("showError");class b{constructor(e){Object.defineProperty(this,h,{value:I});Object.defineProperty(this,u,{value:v});Object.defineProperty(this,d,{value:k});Object.defineProperty(this,c,{value:B});Object.defineProperty(this,l,{value:m});Object.defineProperty(this,n,{value:f});Object.defineProperty(this,r,{value:p});this.currentUserId=e.currentUserId;this.workflowId=e.workflowId;this.taskId=e.taskId;this.taskUserId=e.taskUserId;this.taskButtons=e.taskButtons;this.taskForm=e.taskForm;this.buttonsPanel=e.buttonsPanel;this.canDelegateTask=e.canDelegateTask;this.handleMarkAsRead=t.Runtime.debounce(babelHelpers.classPrivateFieldLooseBase(this,d)[d],100,this)}init(){if(this.buttonsPanel){babelHelpers.classPrivateFieldLooseBase(this,r)[r]()}this.handleMarkAsRead();s.EventEmitter.subscribe("OnUCCommentWasRead",(e=>{const[t]=e.getData();if(t===`WF_${this.workflowId}`){this.handleMarkAsRead()}}));if(this.taskForm){t.Event.bind(this.taskForm,"input",(e=>{const t=e.target;if(t.matches("input, textarea, select")){const e=t.closest(".ui-form-content");if(e){babelHelpers.classPrivateFieldLooseBase(this,u)[u](e)}}}));this.taskForm.querySelectorAll(".ui-form-content").forEach((e=>{t.Event.bind(e,"click",(e=>{const t=e.currentTarget;babelHelpers.classPrivateFieldLooseBase(this,u)[u](t)}))}));s.EventEmitter.subscribe("BX.UI.Selector:onChange",(e=>{const t=BX(`crm-${e.data[0].selectorId}-box`);const s=t.closest(".ui-form-content");if(s){babelHelpers.classPrivateFieldLooseBase(this,u)[u](s)}}));s.EventEmitter.subscribe("OnIframeKeyup",(e=>{const t=e.target.dom.cont;const s=t.closest(".ui-form-content");if(s){babelHelpers.classPrivateFieldLooseBase(this,u)[u](s)}}))}}}function p(){if(this.taskButtons){this.taskButtons.forEach((e=>{const s=new a.UserStatus(e.TARGET_USER_STATUS);const i=s.isNo()||s.isCancel();const r=new o.Button({color:i?o.ButtonColor.LIGHT_BORDER:o.ButtonColor.SUCCESS,round:true,size:o.ButtonSize.MEDIUM,text:e.TEXT,onclick:t=>babelHelpers.classPrivateFieldLooseBase(this,n)[n](e,t)});t.Dom.style(r.getContainer(),"minWidth","160px");t.Dom.style(r.getContainer(),"maxWidth","200px");t.Dom.attr(r.getContainer(),"title",e.TEXT);t.Dom.append(r.getContainer(),this.buttonsPanel)}))}if(this.canDelegateTask){const e=new o.Button({color:o.ButtonColor.LINK,size:o.ButtonSize.MEDIUM,text:t.Loc.getMessage("BPWFI_SLIDER_BUTTON_DELEGATE"),onclick:e=>babelHelpers.classPrivateFieldLooseBase(this,l)[l](e)});t.Dom.style(e.getContainer(),"minWidth","160px");t.Dom.style(e.getContainer(),"maxWidth","200px");t.Dom.append(e.getContainer(),this.buttonsPanel)}}function f(e,s){const o=new FormData(this.taskForm);o.append("taskId",this.taskId);o.append(e.NAME,e.VALUE);s.setDisabled(true);t.ajax.runAction("bizproc.task.do",{data:o}).then((()=>{var e;s.setDisabled(false);(e=BX.SidePanel.Instance.getSliderByWindow(window))==null?void 0:e.close()})).catch((e=>{if(BX.type.isArray(e.errors)){const t=[];e.errors.forEach((e=>{const s=e.customData;if(this.taskForm&&s){const t=this.taskForm.querySelector(`[data-cid="${s}"]`);if(t){babelHelpers.classPrivateFieldLooseBase(this,h)[h](e,t)}}else{t.push(e.message)}}));if(t.length>0){i.MessageBox.alert(t.join(", "))}}s.setDisabled(false)}))}function m(e){e.setDisabled(true);t.Runtime.loadExtension("ui.entity-selector").then((t=>{const{Dialog:s}=t;e.setDisabled(false);const o=new s({targetNode:e.getContainer(),context:"bp-task-delegation",entities:[{id:"user",options:{intranetUsersOnly:true,emailUsers:false,inviteEmployeeLink:false,inviteGuestLink:false}},{id:"department",options:{selectMode:"usersOnly"}}],popupOptions:{bindOptions:{forceBindPosition:true}},enableSearch:true,events:{"Item:onSelect":e=>{const t=e.getData().item;babelHelpers.classPrivateFieldLooseBase(this,c)[c](t.getId())},onHide:e=>{e.getTarget().destroy()}},hideOnSelect:true,offsetTop:3,clearUnavailableItems:true,multiple:false});o.show()})).catch((t=>{console.error(t);e.setDisabled(false)}))}function B(e){const s={taskIds:[this.taskId],fromUserId:this.taskUserId||this.currentUserId,toUserId:e};t.ajax.runAction("bizproc.task.delegate",{data:s}).then((e=>{var t;(t=BX.SidePanel.Instance.getSliderByWindow(window))==null?void 0:t.close()})).catch((e=>{i.MessageBox.alert(e.errors.pop().message)}))}function k(){t.ajax.runAction("bizproc.workflow.comment.markAsRead",{data:{workflowId:this.workflowId,userId:this.currentUserId}})}function v(e){const t=e.querySelector(".ui-form-notice");if(t){BX.Dom.remove(t)}}function I(e,t){const s=t.querySelector(".ui-form-content");let o=t.querySelector(".ui-form-notice");if(!o){o=BX.Dom.create("div",{attrs:{className:"ui-form-notice"}});o.innerText=e.message;if(s){BX.Dom.append(o,s)}}}e.WorkflowInfo=b})(this.BX.Bizproc.Component=this.BX.Bizproc.Component||{},BX,BX.Event,BX.UI,BX.Bizproc,BX.UI.Dialogs);
//# sourceMappingURL=script.map.js