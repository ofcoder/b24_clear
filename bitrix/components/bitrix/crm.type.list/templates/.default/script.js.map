{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { Router } from 'crm.router';\nimport { ajax as Ajax, Dom, Loc, Reflection, Text, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { MessageBox, MessageBoxButtons } from 'ui.dialogs.messagebox';\n\nconst namespace = Reflection.namespace('BX.Crm');\n\nclass TypeListComponent\n{\n\tgridId: string;\n\tgrid: BX.Main.grid;\n\terrorTextContainer: Element;\n\twelcomeMessageContainer: Element;\n\n\tconstructor(params): void\n\t{\n\t\tif (Type.isPlainObject(params))\n\t\t{\n\t\t\tif (Type.isString(params.gridId))\n\t\t\t{\n\t\t\t\tthis.gridId = params.gridId;\n\t\t\t}\n\n\t\t\tif (this.gridId && BX.Main.grid && BX.Main.gridManager)\n\t\t\t{\n\t\t\t\tthis.grid = BX.Main.gridManager.getInstanceById(this.gridId);\n\t\t\t}\n\n\t\t\tif (Type.isElementNode(params.errorTextContainer))\n\t\t\t{\n\t\t\t\tthis.errorTextContainer = params.errorTextContainer;\n\t\t\t}\n\n\t\t\tif (Type.isElementNode(params.welcomeMessageContainer))\n\t\t\t{\n\t\t\t\tthis.welcomeMessageContainer = params.welcomeMessageContainer;\n\t\t\t}\n\t\t}\n\t}\n\n\tinit(): void\n\t{\n\t\tthis.bindEvents();\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tEventEmitter.subscribe('BX.Crm.TypeListComponent:onClickCreate', this.handleTypeCreate.bind(this));\n\t\tEventEmitter.subscribe('BX.Crm.TypeListComponent:onClickDelete', this.handleTypeDelete.bind(this));\n\t\tEventEmitter.subscribe('BX.Crm.TypeListComponent:onFilterByAutomatedSolution', this.handleFilterByAutomatedSolution.bind(this));\n\t\tEventEmitter.subscribe('BX.Crm.TypeListComponent:onResetFilterByAutomatedSolution', this.handleFilterByAutomatedSolution.bind(this));\n\n\t\tconst toolbarComponent = this.getToolbarComponent();\n\n\t\tif (toolbarComponent)\n\t\t{\n\t\t\t/** @see BX.Crm.ToolbarComponent.subscribeTypeUpdatedEvent */\n\t\t\ttoolbarComponent.subscribeTypeUpdatedEvent((event: BaseEvent) => {\n\t\t\t\tconst isUrlChanged = Type.isObject(event.getData()) && (event.getData().isUrlChanged === true);\n\t\t\t\tif (isUrlChanged)\n\t\t\t\t{\n\t\t\t\t\twindow.location.reload();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.gridId && Reflection.getClass('BX.Main.gridManager.reload'))\n\t\t\t\t{\n\t\t\t\t\tDom.removeClass(document.getElementById('crm-type-list-container'), 'crm-type-list-grid-empty');\n\t\t\t\t\tBX.Main.gridManager.reload(this.gridId);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tshowErrors(errors: []): void\n\t{\n\t\tlet text = '';\n\t\terrors.forEach((message) => {\n\t\t\ttext = `${text + message} `;\n\t\t});\n\n\t\tif (Type.isElementNode(this.errorTextContainer))\n\t\t{\n\t\t\tthis.errorTextContainer.innerText = text;\n\t\t\tDom.style(this.errorTextContainer.parentElement, { display: 'block' });\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error(text);\n\t\t}\n\t}\n\n\thideErrors(): void\n\t{\n\t\tif (Type.isElementNode(this.errorTextContainer))\n\t\t{\n\t\t\tthis.errorTextContainer.innerText = '';\n\t\t\tDom.style(this.errorTextContainer.parentElement, { display: 'none' });\n\t\t}\n\t}\n\n\tshowErrorsFromResponse({ errors }): void\n\t{\n\t\tconst messages = [];\n\t\terrors.forEach(({ message }) => messages.push(message));\n\t\tthis.showErrors(messages);\n\t}\n\n\t// region EventHandlers\n\thandleTypeCreate(event: BaseEvent<Object>): void\n\t{\n\t\tlet { queryParams } = event.getData();\n\n\t\tif (!Type.isPlainObject(queryParams))\n\t\t{\n\t\t\tqueryParams = {};\n\t\t}\n\n\t\tconst automatedSolutionId = this.#getAutomatedSolutionIdFromFilter();\n\t\tif (automatedSolutionId > 0)\n\t\t{\n\t\t\tqueryParams.automatedSolutionId = automatedSolutionId;\n\t\t}\n\n\t\tvoid Router.Instance.openTypeDetail(0, null, queryParams);\n\t}\n\n\t#getAutomatedSolutionIdFromFilter(): ?number\n\t{\n\t\tconst { AUTOMATED_SOLUTION: automatedSolutionId } = this.#getCurrentFilter();\n\n\t\tif (Text.toInteger(automatedSolutionId) > 0)\n\t\t{\n\t\t\treturn Text.toInteger(automatedSolutionId);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\thandleTypeDelete(event: BaseEvent): void\n\t{\n\t\tconst id = Text.toInteger(event.data.id);\n\n\t\tif (!id)\n\t\t{\n\t\t\tthis.showErrors([Loc.getMessage('CRM_TYPE_TYPE_NOT_FOUND')]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tMessageBox.show({\n\t\t\ttitle: Loc.getMessage('CRM_TYPE_TYPE_DELETE_CONFIRMATION_TITLE'),\n\t\t\tmessage: Loc.getMessage('CRM_TYPE_TYPE_DELETE_CONFIRMATION_MESSAGE'),\n\t\t\tmodal: true,\n\t\t\tbuttons: MessageBoxButtons.YES_CANCEL,\n\t\t\tonYes: (messageBox) => {\n\t\t\t\tAjax.runAction('crm.controller.type.delete', {\n\t\t\t\t\tanalyticsLabel: 'crmTypeListDeleteType',\n\t\t\t\t\tdata:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t},\n\t\t\t\t}).then((response: {data: {}}) => {\n\t\t\t\t\tconst isUrlChanged = Type.isObject(response.data) && (response.data.isUrlChanged === true);\n\t\t\t\t\tif (isUrlChanged)\n\t\t\t\t\t{\n\t\t\t\t\t\twindow.location.reload();\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.grid.reloadTable();\n\t\t\t\t}).catch(this.showErrorsFromResponse.bind(this));\n\n\t\t\t\tmessageBox.close();\n\t\t\t},\n\t\t});\n\t}\n\t// endregion\n\n\tgetToolbarComponent(): ?BX.Crm.ToolbarComponent\n\t{\n\t\tif (Reflection.getClass('BX.Crm.ToolbarComponent'))\n\t\t{\n\t\t\treturn BX.Crm.ToolbarComponent.Instance;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\thandleFilterByAutomatedSolution(event: BaseEvent): void\n\t{\n\t\tconst data = {\n\t\t\t...this.#getCurrentFilter(),\n\t\t\tAUTOMATED_SOLUTION: event.data || null,\n\t\t};\n\n\t\tconst api = BX.Main.filterManager?.getList()[0]?.getApi();\n\t\tif (!api)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tapi.setFields(data);\n\t\tapi.apply();\n\t}\n\n\t#getCurrentFilter(): Object\n\t{\n\t\treturn BX.Main.filterManager?.getList()[0]?.getFilterFieldsValues() || {};\n\t}\n}\n\nnamespace.TypeListComponent = TypeListComponent;\n"],"names":["namespace","Reflection","TypeListComponent","params","Type","isPlainObject","isString","gridId","BX","Main","grid","gridManager","getInstanceById","isElementNode","errorTextContainer","welcomeMessageContainer","bindEvents","EventEmitter","subscribe","handleTypeCreate","bind","handleTypeDelete","handleFilterByAutomatedSolution","toolbarComponent","getToolbarComponent","subscribeTypeUpdatedEvent","event","isUrlChanged","isObject","getData","window","location","reload","getClass","Dom","removeClass","document","getElementById","errors","text","forEach","message","innerText","style","parentElement","display","console","error","messages","push","showErrors","queryParams","automatedSolutionId","Router","Instance","openTypeDetail","id","Text","toInteger","data","Loc","getMessage","MessageBox","show","title","modal","buttons","MessageBoxButtons","YES_CANCEL","onYes","messageBox","Ajax","runAction","analyticsLabel","then","response","reloadTable","showErrorsFromResponse","close","Crm","ToolbarComponent","AUTOMATED_SOLUTION","api","filterManager","getList","getApi","setFields","apply","getFilterFieldsValues"],"mappings":"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"}