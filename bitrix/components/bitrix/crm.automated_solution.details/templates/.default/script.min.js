this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};this.BX.Crm.AutomatedSolution=this.BX.Crm.AutomatedSolution||{};(function(t,e,i,n,r,o,a,s,l,u){"use strict";var c={props:{title:{type:String,required:true},description:{type:String,required:true}},data:function t(){return{isShown:true}},template:'\n\t\t<div v-if="isShown" class="crm-type-ui-card crm-type-ui-card-message">\n\t\t\t<div class="crm-type-ui-card-header">\n\t\t\t\t<div class="crm-type-ui-card-message-icon crm-type-ui-card-message-icon--custom-fields"></div>\n\t\t\t\t<div class="crm-type-ui-card-message-title">{{ title }}</div>\n\t\t\t</div>\n\t\t\t<div class="crm-type-ui-card-body">\n\t\t\t\t<div class="crm-type-ui-card-message-description">{{ description }}</div>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tclass="crm-type-ui-card-message-close-button" \n\t\t\t\t:title="$Bitrix.Loc.getMessage(\'CRM_AUTOMATED_SOLUTION_DETAILS_CARD_CLOSE_TITLE\')"\n\t\t\t\t@click="isShown = false"\n\t\t\t></div>\n\t\t</div>\n\t'};var d={components:{Card:c},computed:{title:{get:function t(){return this.$store.state.automatedSolution.title},set:function t(e){this.$store.dispatch("setTitle",e)}}},template:'\n\t\t<div data-tab="common">\n\t\t\t<div class="ui-title-3">{{ $Bitrix.Loc.getMessage(\'CRM_AUTOMATED_SOLUTION_DETAILS_TAB_TITLE_COMMON\') }}</div>\n\t\t\t<Card\n\t\t\t\t:title="$Bitrix.Loc.getMessage(\'CRM_AUTOMATED_SOLUTION_DETAILS_CARD_COMMON_TITLE\')"\n\t\t\t\t:description="$Bitrix.Loc.getMessage(\'CRM_AUTOMATED_SOLUTION_DETAILS_CARD_COMMON_DESCRIPTION\')"\n\t\t\t/>\n\t\t\t<div class="ui-form-row crm-automated-solution-details-form-label-xs">\n\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t<div class="ui-ctl-label-text">{{ $Bitrix.Loc.getMessage(\'CRM_AUTOMATED_SOLUTION_DETAILS_FIELD_LABEL_TITLE\') }}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tv-model="title"\n\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t:placeholder="$Bitrix.Loc.getMessage(\'CRM_AUTOMATED_SOLUTION_DETAILS_FIELD_PLACEHOLDER_TITLE\')"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'};var f={components:{Card:c},boundTypesTagSelector:null,externalTypesTagSelector:null,crmTypesTagSelector:null,mounted:function t(){var e=this;this.boundTypesTagSelector=new a.TagSelector({multiple:true,showAddButton:false,showCreateButton:true,items:this.$store.state.automatedSolution.typeIds.map((function(t){return{id:t,entityId:"dynamic_type",title:e.$store.state.dynamicTypesTitles[t]}})),events:{onCreateButtonClick:this.handleCreateTypeClick,onTagRemove:this.removeTypeIdByTagRemoveEvent}});this.boundTypesTagSelector.renderTo(this.$refs.boundTypesTagSelectorContainer);this.crmTypesTagSelector=this.initFilteredTagSelector(true,false);this.crmTypesTagSelector.renderTo(this.$refs.crmTypesTagSelectorContainer);this.externalTypesTagSelector=this.initFilteredTagSelector(false,true);this.externalTypesTagSelector.renderTo(this.$refs.externalTypesTagSelectorContainer)},methods:{initFilteredTagSelector:function t(e,i){return new a.TagSelector({multiple:true,addButtonCaption:this.$Bitrix.Loc.getMessage("CRM_AUTOMATED_SOLUTION_DETAILS_TAG_SELECTOR_ADD_BUTTON_CAPTION"),addButtonCaptionMore:this.$Bitrix.Loc.getMessage("CRM_AUTOMATED_SOLUTION_DETAILS_TAG_SELECTOR_ADD_BUTTON_CAPTION"),dialogOptions:{height:200,enableSearch:true,context:"crm.automated_solutions.details",dropdownMode:true,showAvatars:false,entities:[{id:"dynamic_type",dynamicLoad:true,dynamicSearch:true,options:{showAutomatedSolutionBadge:true,isOnlyExternalTypes:i,isOnlyCrmTypes:e}}]},events:{onTagAdd:this.addTypeIdByTagAddEvent,onTagRemove:this.removeTypeIdByTagRemoveEvent}})},addTypeIdByTagAddEvent:function t(e){var i=e.getData(),n=i.tag;this.$store.dispatch("addTypeId",n.getId())},removeTypeIdByTagRemoveEvent:function t(e){var i=e.getData(),n=i.tag;this.$store.dispatch("removeTypeId",n.getId())},handleCreateTypeClick:function t(){var e=this;if(this.$store.getters.isSaved){this.openTypeCreationSlider();return}o.MessageBox.confirm(this.$Bitrix.Loc.getMessage("CRM_AUTOMATED_SOLUTION_DETAILS_NEED_SAVE_POPUP_MESSAGE"),(function(t){return e.save().then((function(){return e.openTypeCreationSlider()}))["finally"]((function(){return t.close()}))}),this.$Bitrix.Loc.getMessage("CRM_AUTOMATED_SOLUTION_DETAILS_NEED_SAVE_POPUP_YES_CAPTION"))},openTypeCreationSlider:function t(){var e=this;void r.Router.Instance.openTypeDetail(0,null,{automatedSolutionId:this.$store.state.automatedSolution.id,activeTabId:"common",isExternal:"Y"}).then((function(){e.$Bitrix.Application.get().reloadWithNewUri(e.$store.state.automatedSolution.id,{activeTabId:"types"})}))},save:function t(){return this.$store.dispatch("save")}},template:'\n\t\t<div>\n\t\t\t<div class="ui-title-3">{{ $Bitrix.Loc.getMessage(\'CRM_AUTOMATED_SOLUTION_DETAILS_TAB_TITLE_TYPES\') }}</div>\n\t\t\t<Card\n\t\t\t\t:title="$Bitrix.Loc.getMessage(\'CRM_AUTOMATED_SOLUTION_DETAILS_CARD_TYPES_TITLE\')"\n\t\t\t\t:description="$Bitrix.Loc.getMessage(\'CRM_AUTOMATED_SOLUTION_DETAILS_CARD_TYPES_DESCRIPTION\')"\n\t\t\t/>\n\t\t\t<div class="ui-form-row">\n\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'CRM_AUTOMATED_SOLUTION_DETAILS_FIELD_LABEL_CREATE_TYPE\') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t<div ref="boundTypesTagSelectorContainer"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="ui-form-row">\n\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'CRM_AUTOMATED_SOLUTION_DETAILS_FIELD_LABEL_CRM_TYPES\') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t<div ref="crmTypesTagSelectorContainer"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="ui-form-row">\n\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'CRM_AUTOMATED_SOLUTION_DETAILS_FIELD_LABEL_EXTERNAL_TYPES\') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t<div ref="externalTypesTagSelectorContainer"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'};function m(t,e){var i=typeof Symbol!=="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=v(t))||e&&t&&typeof t.length==="number"){if(i)t=i;var n=0;var r=function t(){};return{s:r,n:function e(){if(n>=t.length)return{done:true};return{done:false,value:t[n++]}},e:function t(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=true,a=false,s;return{s:function e(){i=i.call(t)},n:function t(){var e=i.next();o=e.done;return e},e:function t(e){a=true;s=e},f:function t(){try{if(!o&&i["return"]!=null)i["return"]()}finally{if(a)throw s}}}}function v(t,e){if(!t)return;if(typeof t==="string")return T(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor)i=t.constructor.name;if(i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return T(t,e)}function T(t,e){if(e==null||e>t.length)e=t.length;for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var p={components:{CommonTab:d,TypesTab:f},props:{initialActiveTabId:String},data:function t(){return{tabs:{common:this.initialActiveTabId==="common",types:this.initialActiveTabId==="types"}}},computed:{allTabIds:function t(){return Object.keys(this.tabs)},saveButton:function t(){return document.getElementById("ui-button-panel-save")},cancelButton:function t(){return document.getElementById("ui-button-panel-cancel")},deleteButton:function t(){return document.getElementById("ui-button-panel-remove")},allButtons:function t(){var e=[this.saveButton,this.cancelButton];if(this.deleteButton){e.push(this.deleteButton)}return e},errors:function t(){return this.$store.state.errors},hasErrors:function t(){return u.Type.isArrayFilled(this.errors)}},mounted:function t(){n.EventEmitter.subscribe("BX.Crm.AutomatedSolution.Details:showTab",this.showTabFromEvent);n.EventEmitter.subscribe("BX.Crm.AutomatedSolution.Details:save",this.save);n.EventEmitter.subscribe("BX.Crm.AutomatedSolution.Details:delete",this["delete"])},beforeUnmount:function t(){n.EventEmitter.unsubscribe("BX.Crm.AutomatedSolution.Details:showTab",this.showTabFromEvent);n.EventEmitter.unsubscribe("BX.Crm.AutomatedSolution.Details:save",this.save);n.EventEmitter.unsubscribe("BX.Crm.AutomatedSolution.Details:delete",this["delete"])},methods:{showTabFromEvent:function t(e){var i=e.getData(),n=i.tabId;this.showTab(n)},showTab:function t(e){if(!this.allTabIds.includes(e)){throw new Error("invalid tab id")}var i=m(this.allTabIds),n;try{for(i.s();!(n=i.n()).done;){var r=n.value;this.tabs[r]=false}}catch(t){i.e(t)}finally{i.f()}this.tabs[e]=true},save:function t(){var e=this;this.$store.dispatch("save").then((function(){e.$Bitrix.Application.get().closeSliderOrRedirect()}))["catch"]((function(){}))["finally"]((function(){return e.unlockButtons()}))},delete:function t(){var e=this;this.$store.dispatch("delete").then((function(){e.$Bitrix.Application.get().closeSliderOrRedirect()}))["catch"]((function(){}))["finally"]((function(){return e.unlockButtons()}))},unlockButtons:function t(){this.allButtons.forEach((function(t){u.Dom.removeClass(t,"ui-btn-wait")}))},hideError:function t(e){this.$store.dispatch("removeError",e)}},template:'\n\t\t<div class="crm-automated-solution-details">\n\t\t\t<form class="ui-form">\n\t\t\t\t<div v-if="hasErrors" class="ui-alert ui-alert-danger">\n\t\t\t\t\t<template\n\t\t\t\t\t\tv-for="error in errors"\n\t\t\t\t\t\t:key="error.message"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class="ui-alert-message">{{error.message}}</span>\n\t\t\t\t\t\t<span class="ui-alert-close-btn" @click="hideError(error)"></span>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t\t<CommonTab v-show="tabs.common"/>\n\t\t\t\t<TypesTab v-show="tabs.types"/>\n\t\t\t</form>\n\t\t</div>\n\t'};function h(t){if(u.Type.isNil(t)){return null}return u.Text.toInteger(t)}function y(t){if(!u.Type.isPlainObject(t)){return{}}var e={};for(var i=0,n=Object.entries(t);i<n.length;i++){var r=babelHelpers.slicedToArray(n[i],2),o=r[0],a=r[1];if(u.Text.toInteger(o)>0&&u.Type.isStringFilled(a)){e[o]=a}}return e}function S(t){if(u.Type.isNil(t)){return null}return String(t)}function b(t){if(!u.Type.isArrayFilled(t)){return[]}return t.map((function(t){return g(t)})).filter((function(t){return t>0}))}function g(t){return u.Text.toInteger(t)}function E(t){if(!u.Type.isArrayFilled(t)){return[]}return t.filter((function(t){return A(t)}))}function A(t){return u.Type.isStringFilled(t.message)&&(u.Type.isNil(t.code)||u.Type.isStringFilled(t.code)||u.Type.isInteger(t.code))&&(u.Type.isNil(t.customData)||u.Type.isPlainObject(t.customData))}function I(t,e){var i=typeof Symbol!=="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=_(t))||e&&t&&typeof t.length==="number"){if(i)t=i;var n=0;var r=function t(){};return{s:r,n:function e(){if(n>=t.length)return{done:true};return{done:false,value:t[n++]}},e:function t(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=true,a=false,s;return{s:function e(){i=i.call(t)},n:function t(){var e=i.next();o=e.done;return e},e:function t(e){a=true;s=e},f:function t(){try{if(!o&&i["return"]!=null)i["return"]()}finally{if(a)throw s}}}}function _(t,e){if(!t)return;if(typeof t==="string")return O(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor)i=t.constructor.name;if(i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return O(t,e)}function O(t,e){if(e==null||e>t.length)e=t.length;for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var C={setState:function t(e,i){e.commit("setState",i)},setErrors:function t(e,i){e.commit("setErrors",i)},removeError:function t(e,i){e.commit("removeError",i)},setTitle:function t(e,i){e.commit("setTitle",i)},addTypeId:function t(e,i){e.commit("addTypeId",i)},removeTypeId:function t(e,i){e.commit("removeTypeId",i)},save:function t(e){var i=null;var n=u.Runtime.clone(e.state.automatedSolution);if(n.typeIds.length<=0){n.typeIds=false}if(e.getters.isNew){i=B("crm.automatedsolution.add",{data:{fields:n}})}else{i=B("crm.automatedsolution.update",{data:{id:e.state.automatedSolution.id,fields:n}})}return i.then((function(t){var i=t.data;e.dispatch("setState",{automatedSolution:i.automatedSolution});D(i.automatedSolution)}))["catch"]((function(t){console.warn("could not save automated solution",{response:t,state:u.Runtime.clone(e.state)});var i=t.errors;var n=false;var r=I(i),o;try{for(r.s();!(o=r.n()).done;){var a;var s=o.value;if(u.Type.isStringFilled((a=s.customData)===null||a===void 0?void 0:a.sliderCode)){l.FeaturePromotersRegistry.getPromoter({code:s.customData.sliderCode}).show();n=true}}}catch(t){r.e(t)}finally{r.f()}if(!n){e.dispatch("setErrors",i)}throw i}))},delete:function t(e){return B("crm.automatedsolution.delete",{data:{id:e.state.automatedSolution.id}}).then((function(){e.dispatch("setState",{});D({id:e.state.automatedSolution.id})}))["catch"]((function(t){console.warn("could not delete automated solution",{response:t,state:u.Runtime.clone(e.state)});e.dispatch("setErrors",t.errors);throw t.errors}))}};function B(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++){e[i]=arguments[i]}return new Promise((function(t,i){u.ajax.runAction.apply(u.ajax,e).then(t)["catch"](i)}))}function D(t){var e=t.id,i=t.title,n=t.intranetCustomSectionId;var r={id:h(e),title:S(i),intranetCustomSectionId:h(n)};s.ToolbarComponent.Instance.emitAutomatedSolutionUpdatedEvent(r)}var L={setState:function t(e,i){var n,r,o;e.automatedSolution.id=h((n=i.automatedSolution)===null||n===void 0?void 0:n.id);e.automatedSolution.title=S((r=i.automatedSolution)===null||r===void 0?void 0:r.title);e.automatedSolution.typeIds=b((o=i.automatedSolution)===null||o===void 0?void 0:o.typeIds);e.dynamicTypesTitles=y(i.dynamicTypesTitles);e.errors=E(i.errors);e.isModified=false},setErrors:function t(e,i){e.errors=E(i)},removeError:function t(e,i){if(!A(i)){return}e.errors=e.errors.filter((function(t){return t!==i}))},setTitle:function t(e,i){var n=S(i);if(n!==e.automatedSolution.title){e.isModified=true}e.automatedSolution.title=n},addTypeId:function t(e,i){var n=g(i);if(n<=0){return}if(e.automatedSolution.typeIds.includes(n)){return}e.automatedSolution.typeIds.push(n);e.isModified=true},removeTypeId:function t(e,i){var n=g(i);if(n<=0){return}var r=e.automatedSolution.typeIds.filter((function(t){return t!==n}));if(r.length!==e.automatedSolution.typeIds.length){e.isModified=true}e.automatedSolution.typeIds=r}};var M={strict:true,state:function t(){return{automatedSolution:{id:null,title:null,typeIds:[]},dynamicTypesTitles:{},errors:[],isModified:false}},getters:{isNew:function t(e){return e.automatedSolution.id<=0},isSaved:function t(e,i){return!e.isModified&&!i.isNew}},actions:C,mutations:L};function w(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function R(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?w(Object(i),!0).forEach((function(e){babelHelpers.defineProperty(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):w(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function P(t,e,i){U(t,e);e.set(t,i)}function U(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var x=new WeakMap;var N=new WeakMap;var $=new WeakMap;var F=new WeakMap;var j=function(){function t(e){var i=e.containerId,n=e.activeTabId,r=e.state;babelHelpers.classCallCheck(this,t);P(this,x,{writable:true,value:void 0});P(this,N,{writable:true,value:void 0});P(this,$,{writable:true,value:void 0});P(this,F,{writable:true,value:null});babelHelpers.classPrivateFieldSet(this,x,document.getElementById(i));if(!u.Type.isDomNode(babelHelpers.classPrivateFieldGet(this,x))){throw new Error("container not found")}babelHelpers.classPrivateFieldSet(this,N,String(n));if(u.Type.isPlainObject(r)){babelHelpers.classPrivateFieldSet(this,$,r)}}babelHelpers.createClass(t,[{key:"start",value:function t(){var n=this;babelHelpers.classPrivateFieldSet(this,F,e.BitrixVue.createApp(R(R({},p),{},{beforeCreate:function t(){this.$bitrix.Application.set(n)}}),{initialActiveTabId:babelHelpers.classPrivateFieldGet(this,N)}));var r=i.createStore(M);if(babelHelpers.classPrivateFieldGet(this,$)){r.dispatch("setState",babelHelpers.classPrivateFieldGet(this,$))}babelHelpers.classPrivateFieldGet(this,F).use(r);babelHelpers.classPrivateFieldGet(this,F).mount(babelHelpers.classPrivateFieldGet(this,x))}},{key:"stop",value:function t(){babelHelpers.classPrivateFieldGet(this,F).unmount();babelHelpers.classPrivateFieldSet(this,F,null)}},{key:"reloadWithNewUri",value:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};setTimeout((function(){var t=r.Router.Instance.getAutomatedSolutionDetailUrl(e);t.setQueryParams(R(R({},i),{},{IFRAME:"Y",IFRAME_TYPE:"SIDE_SLIDER"}));window.location.href=t.toString()}))}},{key:"closeSliderOrRedirect",value:function t(){setTimeout((function(){r.Router.Instance.closeSliderOrRedirect(r.Router.Instance.getAutomatedSolutionListUrl(),window)}))}}]);return t}();t.App=j})(this.BX.Crm.AutomatedSolution.Details=this.BX.Crm.AutomatedSolution.Details||{},BX.Vue3,BX.Vue3.Vuex,BX.Event,BX.Crm,BX.UI.Dialogs,BX.UI.EntitySelector,BX.Crm,BX.UI,BX);
//# sourceMappingURL=script.map.js