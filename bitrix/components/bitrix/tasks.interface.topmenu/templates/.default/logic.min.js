"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TopMenu!="undefined"){return}BX.Tasks.Component.TopMenu=BX.Tasks.Component.extend({sys:{code:"topmenu"},methodsStatic:{instances:{},getInstance:function(e){return BX.Tasks.Component.TopMenu.instances[e]},addInstance:function(e,t){BX.Tasks.Component.TopMenu.instances[e]=t}},methods:{construct:function(){this.callConstruct(BX.Tasks.Component);BX.Tasks.Component.TopMenu.addInstance(this.sys.code,this);this.userId=Number(this.option("userId"));this.ownerId=Number(this.option("ownerId"));this.groupId=Number(this.option("groupId"));this.isScrumLimitExceeded=Boolean(this.option("isScrumLimitExceeded"));this.isTaskAccessPermissionsLimit=Boolean(this.option("isTaskAccessPermissionsLimit"));this.isRoleControlDisabled=Boolean(this.option("isRoleControlDisabled"))},bindEvents:function(){try{var e=this.option("use_ajax_filter")?this.scope().getElementsByClassName("tasks_role_link"):{};if(e.length){for(var t=0;t<e.length;t++){BX.bind(e[t],"click",(function(e){e.preventDefault();var t=e.target.className;var s=this.dataset.id=="view_all"?"":this.dataset.id;var n=this.dataset.url;if(t==="main-buttons-item-sublink "&&s===""||t==="main-buttons-item-edit-button"){return}BX.onCustomEvent("Tasks.TopMenu:onItem",[s,n]);var i=this.parentElement.getElementsByClassName("tasks_role_link");if(i.length){for(var o=0;o<i.length;o++){BX.removeClass(i[o],"main-buttons-item-active")}}BX.addClass(this,"main-buttons-item-active")}))}}}catch(e){}BX.addCustomEvent("onPullEvent-tasks",function(e,t){switch(e){case"user_counter":this.onUserCounter(t);break;case"project_add":this.onProjectAdd(t);break;case"project_remove":this.onProjectRemove(t);break}}.bind(this));BX.addCustomEvent("BX.Main.Filter:apply",function(e,t,s){this.onFilterApply(e,t,s)}.bind(this))},isMyList:function(){return this.userId===this.ownerId},onUserCounter:function(e){if(!this.isMyList()||this.userId!==Number(e.userId)){return}var t=BX("tasks_panel_menu_view_projects");if(t){t.querySelector(".main-buttons-item-counter").innerText=this.getCounterValue(e.projects_major)}Object.keys(e[0]).forEach(function(t){var s=BX("tasks_panel_menu_"+(this.groupId?"group_":"")+t);if(s){s.querySelector(".main-buttons-item-counter").innerText=this.getCounterValue(e[0][t].total)}}.bind(this));var s=BX("tasks_panel_menu_view_flow");if(s){s.querySelector(".main-buttons-item-counter").innerText=this.getCounterValue(e.flow_total)}var n=BX("tasks_panel_menu_view_scrum");if(n){n.querySelector(".main-buttons-item-counter").innerText=this.getCounterValue(e.scrum_total_comments)}},createScrum:function(e,t){if(this.isScrumLimitExceeded){BX.UI.InfoHelper.show(t,{isLimit:true,limitAnalyticsLabels:{module:"tasks",source:"scrumList"}})}else{BX.SidePanel.Instance.open(e)}},showConfigPermissions:function(){if(this.isTaskAccessPermissionsLimit){BX.UI.InfoHelper.show("limit_task_access_permissions",{isLimit:true,limitAnalyticsLabels:{module:"tasks",source:"topMenu"}})}else{BX.SidePanel.Instance.open("/tasks/config/permissions/",{cacheable:false,events:{onOpen:function(){var e=BX.Main.interfaceButtonsManager;for(var t in e.data){e.data[t].closeSubmenu()}}}})}},onProjectAdd:function(e){this.updateScrumLimit()},onProjectRemove:function(e){this.updateScrumLimit()},updateScrumLimit(){var e=BX("tasks_panel_menu_view_scrum");if(!e){return}this.checkScrumLimit().then(function(e){this.isScrumLimitExceeded=Boolean(e)}.bind(this))},checkScrumLimit:function(){return BX.ajax.runAction("bitrix:tasks.scrum.info.checkScrumLimit",{data:{},signedParameters:this.signedParameters}).then((function(e){return e.data}))},getCounterValue:function(e){if(!e){return""}var t=99;return e>t?t+"+":e},onFilterApply:function(e,t,s){if(this.isRoleControlDisabled){return}try{var n=s.getFilterFieldsValues().ROLEID;var i=BX.Tasks.Component.TopMenu.getInstance("topmenu").scope();var o=i.querySelectorAll(".tasks_role_link");for(var a=0;a<o.length;a++){BX.removeClass(o[a],"main-buttons-item-active")}if(typeof n!=="undefined"){if(!n){n="view_all"}BX.addClass(BX("tasks_panel_menu_"+n),"main-buttons-item-active");var r=BX.Tasks.Component.TasksToolbar.getInstance();if(r){r.rerender(n)}}}catch(e){}}}})}).call(this);
//# sourceMappingURL=logic.map.js