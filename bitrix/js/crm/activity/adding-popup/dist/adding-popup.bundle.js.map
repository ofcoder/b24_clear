{"version":3,"file":"adding-popup.bundle.js","sources":["../src/adding-popup.js"],"sourcesContent":["import { TodoEditor } from 'crm.activity.todo-editor';\nimport { TodoEditorMode, TodoEditorV2 } from 'crm.activity.todo-editor-v2';\nimport { ajax as Ajax, Loc, Tag, Text, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport type { PopupOptions } from 'main.popup';\nimport { Popup } from 'main.popup';\nimport { ButtonColor, ButtonSize, ButtonState, CancelButton, SaveButton } from 'ui.buttons';\nimport { UI } from 'ui.notification';\n\nimport './adding-popup.css';\n\ntype Context = {\n\tanalytics: Object;\n}\n\n/**\n * @event onSave\n * @event onClose\n */\nexport class AddingPopup\n{\n\t#entityId: Number = null;\n\t#entityTypeId: Number = null;\n\t#currentUser: Object = null;\n\t#pingSettings: Object = null;\n\t#calendarSettings: Object = null;\n\t#colorSettings: Object = null;\n\t#useTodoEditorV2: boolean = false;\n\t#popup: ?Popup = null;\n\t#popupContainer: HTMLElement = null;\n\t#popupToDoEditorContainer: HTMLElement = null;\n\t#todoEditor: TodoEditor | TodoEditorV2 | null = null;\n\t#eventEmitter: EventEmitter = null;\n\t#context: Context = {};\n\n\tconstructor(entityTypeId: Number, entityId: Number, currentUser: Object, settings: Object, params: Object)\n\t{\n\t\tthis.#entityId = Text.toInteger(entityId);\n\t\tthis.#entityTypeId = Text.toInteger(entityTypeId);\n\t\tthis.#currentUser = currentUser;\n\n\t\tthis.#eventEmitter = new EventEmitter();\n\t\tthis.#eventEmitter.setEventNamespace('Crm.Activity.AddingPopup');\n\n\t\tif (Type.isObject(settings))\n\t\t{\n\t\t\tthis.#pingSettings = settings.pingSettings ?? null;\n\t\t\tthis.#calendarSettings = settings.calendarSettings ?? null;\n\t\t\tthis.#colorSettings = settings.colorSettings ?? null;\n\t\t}\n\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tparams = {};\n\t\t}\n\n\t\tif (Type.isObject(params.events))\n\t\t{\n\t\t\tfor (const eventName in params.events)\n\t\t\t{\n\t\t\t\tif (Type.isFunction(params.events[eventName]))\n\t\t\t\t{\n\t\t\t\t\tthis.#eventEmitter.subscribe(eventName, params.events[eventName]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.#useTodoEditorV2 = params.useTodoEditorV2 ?? null;\n\n\t\tif (Type.isPlainObject(params.context))\n\t\t{\n\t\t\tthis.#context = params.context;\n\t\t}\n\t}\n\n\tshow(bindElement: HTMLElement, mode: String = TodoEditorMode.ADD)\n\t{\n\t\tconst popup = this.#createPopupIfNotExists();\n\n\t\tif (!this.#useTodoEditorV2)\n\t\t{\n\t\t\tpopup.setBindElement(bindElement);\n\t\t}\n\n\t\tif (popup.isShown())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#popupToDoEditorContainer.hasChildNodes())\n\t\t{\n\t\t\tthis.#createToDoEditor();\n\n\t\t\tpopup.setButtons([\n\t\t\t\tnew SaveButton({\n\t\t\t\t\tid: 'save',\n\t\t\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\t\t\tsize: ButtonSize.EXTRA_SMALL,\n\t\t\t\t\tround: true,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: this.#saveAndClose.bind(this),\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew CancelButton({\n\t\t\t\t\tid: 'cancel',\n\t\t\t\t\tsize: ButtonSize.EXTRA_SMALL,\n\t\t\t\t\tround: true,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => popup.close(),\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t]);\n\n\t\t\tpopup.subscribeOnce('onFirstShow', (event) => {\n\t\t\t\tevent.target.getZIndexComponent().setZIndex(1400);\n\t\t\t\tthis.#todoEditor.show();\n\t\t\t});\n\t\t\tpopup.subscribe('onAfterShow', () => {\n\t\t\t\tthis.#actualizePopupLayout(this.#todoEditor.getDescription());\n\t\t\t\tthis.#todoEditor.setFocused();\n\t\t\t});\n\t\t\tpopup.subscribe('onAfterClose', () => {\n\t\t\t\tvoid this.#todoEditor.resetToDefaults().then(() => {\n\t\t\t\t\tthis.#eventEmitter.emit('onClose');\n\t\t\t\t});\n\t\t\t});\n\t\t\tpopup.subscribe('onShow', () => {\n\t\t\t\tconst { mode: todoEditorMode, activity } = popup.params;\n\t\t\t\tif (todoEditorMode === TodoEditorMode.UPDATE && activity)\n\t\t\t\t{\n\t\t\t\t\tthis.#todoEditor\n\t\t\t\t\t\t.setMode(todoEditorMode)\n\t\t\t\t\t\t.setActivityId(activity.id)\n\t\t\t\t\t\t.setDescription(activity.description)\n\t\t\t\t\t\t.setDeadline(activity.deadline)\n\t\t\t\t\t;\n\n\t\t\t\t\tif (Type.isArrayFilled(activity.storageElementIds))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#todoEditor.setStorageElementIds(activity.storageElementIds);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.#prepareAndShowPopup(popup, mode);\n\t}\n\n\t#createToDoEditor(): TodoEditor | TodoEditorV2\n\t{\n\t\t// just created, initialize\n\t\tconst params = {\n\t\t\tcontainer: this.#popupToDoEditorContainer,\n\t\t\townerTypeId: this.#entityTypeId,\n\t\t\townerId: this.#entityId,\n\t\t\tcurrentUser: this.#currentUser,\n\t\t\tpingSettings: this.#pingSettings,\n\t\t\tevents: {\n\t\t\t\tonSaveHotkeyPressed: this.#onEditorSaveHotkeyPressed.bind(this),\n\t\t\t\tonChangeUploaderContainerSize: this.#onChangeUploaderContainerSize.bind(this),\n\t\t\t\tonFocus: this.#onFocus.bind(this),\n\t\t\t},\n\t\t\tpopupMode: true,\n\t\t};\n\n\t\tif (this.#useTodoEditorV2)\n\t\t{\n\t\t\tconst analytics = this.#context?.analytics ?? {};\n\t\t\tconst section = analytics.c_section ?? null;\n\t\t\tconst subSection = analytics.c_sub_section ?? null;\n\n\t\t\tparams.calendarSettings = this.#calendarSettings;\n\t\t\tparams.colorSettings = this.#colorSettings;\n\t\t\tparams.defaultDescription = '';\n\t\t\tparams.analytics = {\n\t\t\t\tsection,\n\t\t\t\tsubSection,\n\t\t\t};\n\n\t\t\tthis.#todoEditor = new TodoEditorV2(params);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tparams.events.onChangeDescription = this.#onChangeEditorDescription.bind(this);\n\t\t\tthis.#todoEditor = new TodoEditor(params);\n\t\t}\n\t}\n\n\t#prepareAndShowPopup(popup: Popup, mode: String = TodoEditorMode.ADD): void\n\t{\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tpopup.params.mode = mode;\n\t\tif (mode === TodoEditorMode.ADD)\n\t\t{\n\t\t\tpopup.show();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === TodoEditorMode.UPDATE)\n\t\t{\n\t\t\tvoid this.#fetchNearActivity().then((data) => {\n\t\t\t\tif (data)\n\t\t\t\t{\n\t\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\t\tpopup.params.activity = data;\n\t\t\t\t\tpopup.show();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tconsole.error('Wrong TodoEditor mode');\n\t}\n\n\t#fetchNearActivity(): Promise\n\t{\n\t\tconst data = {\n\t\t\townerTypeId: this.#entityTypeId,\n\t\t\townerId: this.#entityId,\n\t\t};\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tAjax.runAction('crm.activity.todo.getNearest', { data })\n\t\t\t\t.then(({ data: responseData }) => resolve(responseData))\n\t\t\t\t.catch((response) => {\n\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: response.errors[0].message,\n\t\t\t\t\t\tautoHideDelay: 5000,\n\t\t\t\t\t});\n\t\t\t\t\treject();\n\t\t\t\t});\n\t\t});\n\t}\n\n\t#createPopupIfNotExists(): Popup\n\t{\n\t\tif (!this.#popup || this.#popup.isDestroyed())\n\t\t{\n\t\t\tthis.#popupToDoEditorContainer = Tag.render`<div></div>`;\n\t\t\tthis.#popupContainer = Tag.render`\n\t\t\t\t<div class=\"crm-activity-adding-popup-container\">\n\t\t\t\t\t${this.#getPopupTitle()}\n\t\t\t\t\t${this.#popupToDoEditorContainer}\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tthis.#popup = new Popup(this.#getPopupParams());\n\t\t}\n\n\t\treturn this.#popup;\n\t}\n\n\t#getPopupTitle(): ?HTMLDivElement\n\t{\n\t\tif (this.#useTodoEditorV2)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-activity-adding-popup-title\">\n\t\t\t\t\t${Loc.getMessage('CRM_ACTIVITY_ADDING_POPUP_TITLE')}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#getPopupParams(): PopupOptions\n\t{\n\t\tconst { innerWidth } = window;\n\n\t\tconst params = {\n\t\t\tid: `kanban_planner_menu_${this.#entityId}`,\n\t\t\tcontent: this.#popupContainer,\n\t\t\tcacheable: false,\n\t\t\tisScrollBlock: true,\n\t\t\tclassName: 'crm-activity-adding-popup',\n\t\t\tcloseByEsc: true,\n\t\t\tcloseIcon: false,\n\t\t\tpadding: 16,\n\t\t\tminWidth: 537,\n\t\t\twidth: Math.round(innerWidth * 0.45),\n\t\t\tmaxWidth: 737,\n\t\t\tminHeight: 150,\n\t\t\tmaxHeight: 482,\n\t\t};\n\n\t\tif (this.#useTodoEditorV2)\n\t\t{\n\t\t\tparams.overlay = {\n\t\t\t\topacity: 50,\n\t\t\t};\n\t\t}\n\t\telse\n\t\t{\n\t\t\tparams.angle = {\n\t\t\t\toffset: 27,\n\t\t\t};\n\t\t}\n\n\t\treturn params;\n\t}\n\n\tbindPopup(bindElement: HTMLElement): void\n\t{\n\t\tif (!this.#popup || this.#useTodoEditorV2)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (bindElement !== this.#popup.bindElement)\n\t\t{\n\t\t\tthis.#popup.setBindElement(bindElement);\n\t\t}\n\t}\n\n\t#saveAndClose(): void\n\t{\n\t\tif (this.#popup)\n\t\t{\n\t\t\tconst saveButton = this.#popup.getButton('save');\n\t\t\tif (saveButton.getState())\n\t\t\t{\n\t\t\t\treturn; // button is disabled\n\t\t\t}\n\t\t\tsaveButton?.setWaiting(true);\n\t\t\tthis.#todoEditor.save()\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.#popup.close();\n\t\t\t\t\tthis.#eventEmitter.emit('onSave');\n\t\t\t\t})\n\t\t\t\t.catch(() => {})\n\t\t\t\t.finally(() => saveButton?.setWaiting(false))\n\t\t\t;\n\t\t}\n\t}\n\n\t#actualizePopupLayout(description): void\n\t{\n\t\tif (this.#popup && this.#popup.isShown())\n\t\t{\n\t\t\tthis.#eventEmitter.emit('onActualizePopupLayout', { entityId: this.#entityId });\n\n\t\t\tthis.#popup.adjustPosition({\n\t\t\t\tforceBindPosition: true,\n\t\t\t});\n\n\t\t\tconst saveButton = this.#popup.getButton('save');\n\n\t\t\tif (this.#useTodoEditorV2)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (description.length === 0 && saveButton && !saveButton.getState())\n\t\t\t{\n\t\t\t\tsaveButton.setState(ButtonState.DISABLED);\n\t\t\t}\n\t\t\telse if (description.length > 0 && saveButton && saveButton.getState() === ButtonState.DISABLED)\n\t\t\t{\n\t\t\t\tsaveButton.setState(null);\n\t\t\t}\n\t\t}\n\t}\n\n\t#onChangeEditorDescription(event: BaseEvent)\n\t{\n\t\tconst { description } = event.getData();\n\t\tthis.#actualizePopupLayout(description);\n\t}\n\n\t#onEditorSaveHotkeyPressed()\n\t{\n\t\tthis.#saveAndClose();\n\t}\n\n\t#onChangeUploaderContainerSize()\n\t{\n\t\tif (this.#popup)\n\t\t{\n\t\t\tthis.#eventEmitter.emit('onActualizePopupLayout', { entityId: this.#entityId });\n\t\t\tthis.#popup.adjustPosition();\n\t\t}\n\t}\n\n\t#onFocus()\n\t{\n\t\tsetTimeout(() => {\n\t\t\tconst popup = this.#createPopupIfNotExists();\n\n\t\t\tpopup.adjustPosition({\n\t\t\t\tforceBindPosition: true,\n\t\t\t});\n\t\t}, 0);\n\t}\n}\n"],"names":["AddingPopup","entityTypeId","entityId","currentUser","settings","params","Text","toInteger","EventEmitter","setEventNamespace","Type","isObject","pingSettings","calendarSettings","colorSettings","isPlainObject","events","eventName","isFunction","subscribe","useTodoEditorV2","context","bindElement","mode","TodoEditorMode","ADD","popup","setBindElement","isShown","hasChildNodes","setButtons","SaveButton","id","color","ButtonColor","PRIMARY","size","ButtonSize","EXTRA_SMALL","round","click","bind","CancelButton","close","subscribeOnce","event","target","getZIndexComponent","setZIndex","show","getDescription","setFocused","resetToDefaults","then","emit","todoEditorMode","activity","UPDATE","setMode","setActivityId","setDescription","description","setDeadline","deadline","isArrayFilled","storageElementIds","setStorageElementIds","container","ownerTypeId","ownerId","onSaveHotkeyPressed","onChangeUploaderContainerSize","onFocus","popupMode","analytics","section","c_section","subSection","c_sub_section","defaultDescription","TodoEditorV2","onChangeDescription","TodoEditor","data","console","error","Promise","resolve","reject","Ajax","runAction","responseData","catch","response","UI","Notification","Center","notify","content","errors","message","autoHideDelay","isDestroyed","Tag","render","Popup","Loc","getMessage","innerWidth","window","cacheable","isScrollBlock","className","closeByEsc","closeIcon","padding","minWidth","width","Math","maxWidth","minHeight","maxHeight","overlay","opacity","angle","offset","saveButton","getButton","getState","setWaiting","save","finally","adjustPosition","forceBindPosition","length","setState","ButtonState","DISABLED","getData","setTimeout"],"mappings":";;;;;;;;;;;;;AAAA,CAS4B;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAM5B;CACA;CACA;CACA;AACA,KAAaA,WAAW;GAgBvB,qBAAYC,YAAoB,EAAEC,QAAgB,EAAEC,WAAmB,EAAEC,QAAgB,EAAEC,OAAc,EACzG;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;OAAA;OAAA,OAfoB;;KAAI;OAAA;OAAA,OACA;;KAAI;OAAA;OAAA,OACL;;KAAI;OAAA;OAAA,OACH;;KAAI;OAAA;OAAA,OACA;;KAAI;OAAA;OAAA,OACP;;KAAI;OAAA;OAAA,OACD;;KAAK;OAAA;OAAA,OAChB;;KAAI;OAAA;OAAA,OACU;;KAAI;OAAA;OAAA,OACM;;KAAI;OAAA;OAAA,OACG;;KAAI;OAAA;OAAA,OACtB;;KAAI;OAAA;OAAA,OACd;;KAInB,sCAAI,aAAaC,cAAI,CAACC,SAAS,CAACL,QAAQ,CAAC;KACzC,sCAAI,iBAAiBI,cAAI,CAACC,SAAS,CAACN,YAAY,CAAC;KACjD,sCAAI,gBAAgBE,WAAW;KAE/B,sCAAI,iBAAiB,IAAIK,6BAAY,EAAE;KACvC,sCAAI,iBAAeC,iBAAiB,CAAC,0BAA0B,CAAC;KAEhE,IAAIC,cAAI,CAACC,QAAQ,CAACP,QAAQ,CAAC,EAC3B;OAAA;OACC,sCAAI,0CAAiBA,QAAQ,CAACQ,YAAY,yEAAI,IAAI;OAClD,sCAAI,8CAAqBR,QAAQ,CAACS,gBAAgB,yEAAI,IAAI;OAC1D,sCAAI,2CAAkBT,QAAQ,CAACU,aAAa,yEAAI,IAAI;;KAGrD,IAAI,CAACJ,cAAI,CAACK,aAAa,CAACV,OAAM,CAAC,EAC/B;;OAECA,OAAM,GAAG,EAAE;;KAGZ,IAAIK,cAAI,CAACC,QAAQ,CAACN,OAAM,CAACW,MAAM,CAAC,EAChC;OACC,KAAK,MAAMC,SAAS,IAAIZ,OAAM,CAACW,MAAM,EACrC;SACC,IAAIN,cAAI,CAACQ,UAAU,CAACb,OAAM,CAACW,MAAM,CAACC,SAAS,CAAC,CAAC,EAC7C;WACC,sCAAI,iBAAeE,SAAS,CAACF,SAAS,EAAEZ,OAAM,CAACW,MAAM,CAACC,SAAS,CAAC,CAAC;;;;KAKpE,sCAAI,4CAAoBZ,OAAM,CAACe,eAAe,yEAAI,IAAI;KAEtD,IAAIV,cAAI,CAACK,aAAa,CAACV,OAAM,CAACgB,OAAO,CAAC,EACtC;OACC,sCAAI,YAAYhB,OAAM,CAACgB,OAAO;;;GAE/B;KAAA;KAAA,qBAEIC,WAAwB,EAAEC,IAAY,GAAGC,wCAAc,CAACC,GAAG,EAChE;OACC,MAAMC,KAAK,0BAAG,IAAI,0DAAJ,IAAI,CAA0B;OAE5C,IAAI,mCAAC,IAAI,kBAAiB,EAC1B;SACCA,KAAK,CAACC,cAAc,CAACL,WAAW,CAAC;;OAGlC,IAAII,KAAK,CAACE,OAAO,EAAE,EACnB;SACC;;OAGD,IAAI,CAAC,sCAAI,6BAA2BC,aAAa,EAAE,EACnD;SACC,2BAAI,8CAAJ,IAAI;SAEJH,KAAK,CAACI,UAAU,CAAC,CAChB,IAAIC,qBAAU,CAAC;WACdC,EAAE,EAAE,MAAM;WACVC,KAAK,EAAEC,sBAAW,CAACC,OAAO;WAC1BC,IAAI,EAAEC,qBAAU,CAACC,WAAW;WAC5BC,KAAK,EAAE,IAAI;WACXvB,MAAM,EAAE;aACPwB,KAAK,EAAE,2BAAI,iCAAeC,IAAI,CAAC,IAAI;;UAEpC,CAAC,EACF,IAAIC,uBAAY,CAAC;WAChBV,EAAE,EAAE,QAAQ;WACZI,IAAI,EAAEC,qBAAU,CAACC,WAAW;WAC5BC,KAAK,EAAE,IAAI;WACXvB,MAAM,EAAE;aACPwB,KAAK,EAAE,MAAMd,KAAK,CAACiB,KAAK;;UAEzB,CAAC,CACF,CAAC;SAEFjB,KAAK,CAACkB,aAAa,CAAC,aAAa,EAAGC,KAAK,IAAK;WAC7CA,KAAK,CAACC,MAAM,CAACC,kBAAkB,EAAE,CAACC,SAAS,CAAC,IAAI,CAAC;WACjD,sCAAI,eAAaC,IAAI,EAAE;UACvB,CAAC;SACFvB,KAAK,CAACP,SAAS,CAAC,aAAa,EAAE,MAAM;WACpC,2BAAI,sDAAJ,IAAI,EAAuB,sCAAI,eAAa+B,cAAc,EAAE;WAC5D,sCAAI,eAAaC,UAAU,EAAE;UAC7B,CAAC;SACFzB,KAAK,CAACP,SAAS,CAAC,cAAc,EAAE,MAAM;WACrC,KAAK,sCAAI,eAAaiC,eAAe,EAAE,CAACC,IAAI,CAAC,MAAM;aAClD,sCAAI,iBAAeC,IAAI,CAAC,SAAS,CAAC;YAClC,CAAC;UACF,CAAC;SACF5B,KAAK,CAACP,SAAS,CAAC,QAAQ,EAAE,MAAM;WAC/B,MAAM;aAAEI,IAAI,EAAEgC,cAAc;aAAEC;YAAU,GAAG9B,KAAK,CAACrB,MAAM;WACvD,IAAIkD,cAAc,KAAK/B,wCAAc,CAACiC,MAAM,IAAID,QAAQ,EACxD;aACC,sCAAI,eACFE,OAAO,CAACH,cAAc,CAAC,CACvBI,aAAa,CAACH,QAAQ,CAACxB,EAAE,CAAC,CAC1B4B,cAAc,CAACJ,QAAQ,CAACK,WAAW,CAAC,CACpCC,WAAW,CAACN,QAAQ,CAACO,QAAQ,CAAC;aAGhC,IAAIrD,cAAI,CAACsD,aAAa,CAACR,QAAQ,CAACS,iBAAiB,CAAC,EAClD;eACC,sCAAI,eAAaC,oBAAoB,CAACV,QAAQ,CAACS,iBAAiB,CAAC;;;UAGnE,CAAC;;OAGH,2BAAI,oDAAJ,IAAI,EAAsBvC,KAAK,EAAEH,IAAI;;;KACrC;KAAA,0BA8JSD,WAAwB,EAClC;OACC,IAAI,mCAAC,IAAI,SAAO,sCAAI,IAAI,kBAAiB,EACzC;SACC;;OAGD,IAAIA,WAAW,KAAK,sCAAI,UAAQA,WAAW,EAC3C;SACC,sCAAI,UAAQK,cAAc,CAACL,WAAW,CAAC;;;;GAExC;CAAA;CAiFD,8BAvPA;;GAEC,MAAMjB,MAAM,GAAG;KACd8D,SAAS,oCAAE,IAAI,4BAA0B;KACzCC,WAAW,oCAAE,IAAI,gBAAc;KAC/BC,OAAO,oCAAE,IAAI,YAAU;KACvBlE,WAAW,oCAAE,IAAI,eAAa;KAC9BS,YAAY,oCAAE,IAAI,gBAAc;KAChCI,MAAM,EAAE;OACPsD,mBAAmB,EAAE,2BAAI,2DAA4B7B,IAAI,CAAC,IAAI,CAAC;OAC/D8B,6BAA6B,EAAE,2BAAI,mEAAgC9B,IAAI,CAAC,IAAI,CAAC;OAC7E+B,OAAO,EAAE,2BAAI,uBAAU/B,IAAI,CAAC,IAAI;MAChC;KACDgC,SAAS,EAAE;IACX;GAED,sCAAI,IAAI,oBACR;KAAA;KACC,MAAMC,SAAS,wFAAG,IAAI,sEAAJ,uBAAeA,SAAS,yEAAI,EAAE;KAChD,MAAMC,OAAO,2BAAGD,SAAS,CAACE,SAAS,uEAAI,IAAI;KAC3C,MAAMC,UAAU,4BAAGH,SAAS,CAACI,aAAa,yEAAI,IAAI;KAElDzE,MAAM,CAACQ,gBAAgB,qCAAG,IAAI,oBAAkB;KAChDR,MAAM,CAACS,aAAa,qCAAG,IAAI,iBAAe;KAC1CT,MAAM,CAAC0E,kBAAkB,GAAG,EAAE;KAC9B1E,MAAM,CAACqE,SAAS,GAAG;OAClBC,OAAO;OACPE;MACA;KAED,sCAAI,eAAe,IAAIG,sCAAY,CAAC3E,MAAM,CAAC;IAC3C,MAED;KACCA,MAAM,CAACW,MAAM,CAACiE,mBAAmB,GAAG,2BAAI,2DAA4BxC,IAAI,CAAC,IAAI,CAAC;KAC9E,sCAAI,eAAe,IAAIyC,kCAAU,CAAC7E,MAAM,CAAC;;CAE3C;CAAC,+BAEoBqB,KAAY,EAAEH,IAAY,GAAGC,wCAAc,CAACC,GAAG,EACpE;;GAECC,KAAK,CAACrB,MAAM,CAACkB,IAAI,GAAGA,IAAI;GACxB,IAAIA,IAAI,KAAKC,wCAAc,CAACC,GAAG,EAC/B;KACCC,KAAK,CAACuB,IAAI,EAAE;KAEZ;;GAGD,IAAI1B,IAAI,KAAKC,wCAAc,CAACiC,MAAM,EAClC;KACC,KAAK,2BAAI,gDAAJ,IAAI,EAAsBJ,IAAI,CAAE8B,IAAI,IAAK;OAC7C,IAAIA,IAAI,EACR;;SAECzD,KAAK,CAACrB,MAAM,CAACmD,QAAQ,GAAG2B,IAAI;SAC5BzD,KAAK,CAACuB,IAAI,EAAE;;MAEb,CAAC;KAEF;;GAGDmC,OAAO,CAACC,KAAK,CAAC,uBAAuB,CAAC;CACvC;CAAC,+BAGD;GACC,MAAMF,IAAI,GAAG;KACZf,WAAW,oCAAE,IAAI,gBAAc;KAC/BC,OAAO,oCAAE,IAAI;IACb;GAED,OAAO,IAAIiB,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;KACvCC,cAAI,CAACC,SAAS,CAAC,8BAA8B,EAAE;OAAEP;MAAM,CAAC,CACtD9B,IAAI,CAAC,CAAC;OAAE8B,IAAI,EAAEQ;MAAc,KAAKJ,OAAO,CAACI,YAAY,CAAC,CAAC,CACvDC,KAAK,CAAEC,QAAQ,IAAK;OACpBC,kBAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;SAC7BC,OAAO,EAAEL,QAAQ,CAACM,MAAM,CAAC,CAAC,CAAC,CAACC,OAAO;SACnCC,aAAa,EAAE;QACf,CAAC;OACFb,MAAM,EAAE;MACR,CAAC;IACH,CAAC;CACH;CAAC,oCAGD;GACC,IAAI,mCAAC,IAAI,SAAO,IAAI,sCAAI,UAAQc,WAAW,EAAE,EAC7C;KACC,sCAAI,6BAA6BC,aAAG,CAACC,MAAM,cAAC,aAAW;KACvD,sCAAI,mBAAmBD,aAAG,CAACC,MAAM,gBAAC;;OAEhC,CAAwB;OACxB,CAAiC;;IAEnC,0BAHI,IAAI,wCAAJ,IAAI,qCACJ,IAAI;KAIR,sCAAI,UAAU,IAAIC,gBAAK,wBAAC,IAAI,0CAAJ,IAAI,EAAmB;;GAGhD,yCAAO,IAAI;CACZ;CAAC,2BAGD;GACC,sCAAI,IAAI,oBACR;KACC,OAAOF,aAAG,CAACC,MAAM,gBAAC;;OAEhB,CAAoD;;IAEtD,GAFIE,aAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC;;GAKtD,OAAO,IAAI;CACZ;CAAC,4BAGD;GACC,MAAM;KAAEC;IAAY,GAAGC,MAAM;GAE7B,MAAMxG,MAAM,GAAG;KACd2B,EAAE,EAAG,uBAAoB,kCAAE,IAAI,YAAW,EAAC;KAC3CkE,OAAO,oCAAE,IAAI,kBAAgB;KAC7BY,SAAS,EAAE,KAAK;KAChBC,aAAa,EAAE,IAAI;KACnBC,SAAS,EAAE,2BAA2B;KACtCC,UAAU,EAAE,IAAI;KAChBC,SAAS,EAAE,KAAK;KAChBC,OAAO,EAAE,EAAE;KACXC,QAAQ,EAAE,GAAG;KACbC,KAAK,EAAEC,IAAI,CAAC/E,KAAK,CAACqE,UAAU,GAAG,IAAI,CAAC;KACpCW,QAAQ,EAAE,GAAG;KACbC,SAAS,EAAE,GAAG;KACdC,SAAS,EAAE;IACX;GAED,sCAAI,IAAI,oBACR;KACCpH,MAAM,CAACqH,OAAO,GAAG;OAChBC,OAAO,EAAE;MACT;IACD,MAED;KACCtH,MAAM,CAACuH,KAAK,GAAG;OACdC,MAAM,EAAE;MACR;;GAGF,OAAOxH,MAAM;CACd;CAAC,0BAgBD;GACC,sCAAI,IAAI,WACR;KACC,MAAMyH,UAAU,GAAG,sCAAI,UAAQC,SAAS,CAAC,MAAM,CAAC;KAChD,IAAID,UAAU,CAACE,QAAQ,EAAE,EACzB;OACC,OAAO;;;KAERF,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAEG,UAAU,CAAC,IAAI,CAAC;KAC5B,sCAAI,eAAaC,IAAI,EAAE,CACrB7E,IAAI,CAAC,MAAM;OACX,sCAAI,UAAQV,KAAK,EAAE;OACnB,sCAAI,iBAAeW,IAAI,CAAC,QAAQ,CAAC;MACjC,CAAC,CACDsC,KAAK,CAAC,MAAM,EAAE,CAAC,CACfuC,OAAO,CAAC,MAAML,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAEG,UAAU,CAAC,KAAK,CAAC,CAAC;;CAGhD;CAAC,gCAEqBpE,WAAW,EACjC;GACC,IAAI,sCAAI,aAAW,sCAAI,UAAQjC,OAAO,EAAE,EACxC;KACC,sCAAI,iBAAe0B,IAAI,CAAC,wBAAwB,EAAE;OAAEpD,QAAQ,oCAAE,IAAI;MAAY,CAAC;KAE/E,sCAAI,UAAQkI,cAAc,CAAC;OAC1BC,iBAAiB,EAAE;MACnB,CAAC;KAEF,MAAMP,UAAU,GAAG,sCAAI,UAAQC,SAAS,CAAC,MAAM,CAAC;KAEhD,sCAAI,IAAI,oBACR;OACC;;KAGD,IAAIlE,WAAW,CAACyE,MAAM,KAAK,CAAC,IAAIR,UAAU,IAAI,CAACA,UAAU,CAACE,QAAQ,EAAE,EACpE;OACCF,UAAU,CAACS,QAAQ,CAACC,sBAAW,CAACC,QAAQ,CAAC;MACzC,MACI,IAAI5E,WAAW,CAACyE,MAAM,GAAG,CAAC,IAAIR,UAAU,IAAIA,UAAU,CAACE,QAAQ,EAAE,KAAKQ,sBAAW,CAACC,QAAQ,EAC/F;OACCX,UAAU,CAACS,QAAQ,CAAC,IAAI,CAAC;;;CAG5B;CAAC,qCAE0B1F,KAAgB,EAC3C;GACC,MAAM;KAAEgB;IAAa,GAAGhB,KAAK,CAAC6F,OAAO,EAAE;GACvC,2BAAI,sDAAJ,IAAI,EAAuB7E,WAAW;CACvC;CAAC,uCAGD;GACC,2BAAI,sCAAJ,IAAI;CACL;CAAC,2CAGD;GACC,sCAAI,IAAI,WACR;KACC,sCAAI,iBAAeP,IAAI,CAAC,wBAAwB,EAAE;OAAEpD,QAAQ,oCAAE,IAAI;MAAY,CAAC;KAC/E,sCAAI,UAAQkI,cAAc,EAAE;;CAE9B;CAAC,qBAGD;GACCO,UAAU,CAAC,MAAM;KAChB,MAAMjH,KAAK,0BAAG,IAAI,0DAAJ,IAAI,CAA0B;KAE5CA,KAAK,CAAC0G,cAAc,CAAC;OACpBC,iBAAiB,EAAE;MACnB,CAAC;IACF,EAAE,CAAC,CAAC;CACN;;;;;;;;"}