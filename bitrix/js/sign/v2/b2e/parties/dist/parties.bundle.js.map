{"version":3,"file":"parties.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Loc, Tag, Dom, Type } from 'main.core';\nimport { CompanySelector, type Provider } from 'sign.v2.b2e.company-selector';\nimport { RepresentativeSelector } from 'sign.v2.b2e.representative-selector';\nimport { DocumentValidation } from 'sign.v2.b2e.document-validation';\nimport { type Role } from 'sign.v2.api';\nimport { Hint } from 'sign.v2.helper';\n\nconst blockWarningClass = 'sign-document-b2e-parties__item_content--warning';\n\nexport class Parties\n{\n\t#companySelector: CompanySelector = null;\n\t#representativeSelector: RepresentativeSelector = null;\n\t#documentValidation: DocumentValidation = null;\n\t#ui = {\n\t\tcontainer: HTMLDivElement = null,\n\t\tblocks: {\n\t\t\tcompanyContent: HTMLDivElement = null,\n\t\t\trepresentativeContent: HTMLDivElement = null,\n\t\t},\n\t};\n\n\tconstructor(region: string)\n\t{\n\t\tthis.#representativeSelector = new RepresentativeSelector({});\n\t\tthis.#companySelector = new CompanySelector({ region });\n\t\tthis.#documentValidation = new DocumentValidation();\n\t}\n\n\tsetEntityId(entityId: number): void\n\t{\n\t\tthis.#companySelector.setOptions({ entityId });\n\t}\n\n\tloadCompany(companyUid: string): void\n\t{\n\t\tthis.#companySelector.load(companyUid);\n\t}\n\n\tloadRepresentative(representativeId: number): void\n\t{\n\t\tthis.#representativeSelector.load(representativeId);\n\t}\n\n\tloadValidator(memberId: number, role: Role): void\n\t{\n\t\tthis.#documentValidation.load(memberId, role);\n\t}\n\n\tgetLayout(): HTMLElement\n\t{\n\t\tthis.#ui.blocks.companyContent = Tag.render`\n\t\t\t<div class=\"sign-b2e-settings__item\">\n\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t<span>${Loc.getMessage('SIGN_PARTIES_ITEM_COMPANY')}</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tdata-hint=\"${Loc.getMessage('SIGN_PARTIES_ITEM_COMPANY_HINT')}\"\n\t\t\t\t\t></span>\n\t\t\t\t</p>\n\t\t\t\t${this.#companySelector.getLayout()}\n\t\t\t</div>\n\t\t`;\n\t\tHint.create(this.#ui.blocks.companyContent);\n\t\tthis.#ui.blocks.representativeContent = Tag.render`\n\t\t\t<div class=\"sign-b2e-settings__item --representative\">\n\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t${Loc.getMessage('SIGN_PARTIES_ITEM_REPRESENTATIVE')}\n\t\t\t\t</p>\n\t\t\t\t${this.#representativeSelector.getLayout()}\n\t\t\t</div>\n\t\t`;\n\t\tconst providerLayout = Tag.render`\n\t\t\t<div class=\"sign-b2e-settings__item\">\n\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t${Loc.getMessage('SIGN_PARTIES_ITEM_PROVIDER')}\n\t\t\t\t</p>\n\t\t\t\t${this.#companySelector.getProviderLayout()}\n\t\t\t</div>\n\t\t`;\n\t\tconst validationReviewerLayout = Tag.render`\n\t\t\t<div class=\"sign-b2e-settings__item --reviewer\">\n\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t${Loc.getMessage('SIGN_PARTIES_ITEM_VALIDATION_REVIEWER')}\n\t\t\t\t</p>\n\t\t\t\t${this.#documentValidation.getReviewerLayout()}\n\t\t\t</div>\n\t\t`;\n\t\tconst validationEditorLayout = Tag.render`\n\t\t\t<div class=\"sign-b2e-settings__item --editor\">\n\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t${Loc.getMessage('SIGN_PARTIES_ITEM_VALIDATION_EDITOR')}\n\t\t\t\t</p>\n\t\t\t\t${this.#documentValidation.getEditorLayout()}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t<h1 class=\"sign-b2e-settings__header\">${Loc.getMessage('SIGN_PARTIES_HEADER')}</h1>\n\t\t\t\t${this.#ui.blocks.companyContent}\n\t\t\t\t${providerLayout}\n\t\t\t\t${this.#ui.blocks.representativeContent}\n\t\t\t\t${validationReviewerLayout}\n\t\t\t\t${validationEditorLayout}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#validate(): boolean\n\t{\n\t\tconst validationResults = [\n\t\t\tthis.#companySelector.validate(),\n\t\t\tthis.#representativeSelector.validate(),\n\t\t];\n\n\t\treturn validationResults.every((result: boolean) => result === true);\n\t}\n\n\tasync save(documentId: string)\n\t{\n\t\tthis.#removeWarningFromBlocks();\n\t\tif (!this.#validate())\n\t\t{\n\t\t\tthrow new Error();\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tawait this.#companySelector.save(documentId);\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tthis.#setWarning(this.#ui.blocks.companyContent);\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tgetSelectedProvider(): Provider | null\n\t{\n\t\treturn this.#companySelector.getSelectedCompanyProvider();\n\t}\n\n\tgetParties(): { [key: string]: { entityType: string, entityId: ?number, role?: Role } }\n\t{\n\t\tconst validationData = this.#documentValidation.getValidationData();\n\n\t\treturn {\n\t\t\trepresentative: {\n\t\t\t\tentityType: 'user',\n\t\t\t\tentityId: this.#representativeSelector.getRepresentativeId(),\n\t\t\t},\n\t\t\tcompany: {\n\t\t\t\tentityType: 'company',\n\t\t\t\tentityId: this.#companySelector.getCompanyId(),\n\t\t\t},\n\t\t\tvalidation: Object.keys(validationData).map((role) => {\n\t\t\t\treturn { entityType: 'user', entityId: validationData[role], role };\n\t\t\t}),\n\t\t};\n\t}\n\n\t#setWarning(block: HTMLDivElement): void\n\t{\n\t\tif (Type.isNull(block) || Type.isUndefined(block))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.addClass(block, blockWarningClass);\n\t}\n\n\t#removeWarningFromBlocks(): void\n\t{\n\t\tfor (const [key, block] of Object.entries(this.#ui.blocks))\n\t\t{\n\t\t\tif (Type.isNull(block))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tDom.removeClass(block, blockWarningClass);\n\t\t}\n\t}\n}\n"],"names":["blockWarningClass","Parties","region","babelHelpers","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","writable","value","container","HTMLDivElement","blocks","companyContent","representativeContent","RepresentativeSelector","CompanySelector","DocumentValidation","key","entityId","setOptions","companyUid","load","representativeId","memberId","role","Tag","render","Loc","getMessage","getLayout","Hint","create","providerLayout","getProviderLayout","validationReviewerLayout","getReviewerLayout","validationEditorLayout","getEditorLayout","documentId","_classPrivateMethodGet","this","_context","Error","save","getSelectedCompanyProvider","validationData","getValidationData","representative","entityType","getRepresentativeId","company","getCompanyId","validation","Object","keys","map","validate","every","result","block","Type","isNull","isUndefined","Dom","addClass","entries","removeClass"],"mappings":"kuNACA,gCAAA,oCAAA,kHAAA,8GAMA,IAAMA,EAAoB,qJAEbC,aAaZ,WAAYC,GACZC,oCAAAC,UAAAA,UAAAA,UAAAC,UAAAC,YAAAC,MAZoC,OAAIF,UAAAC,YAAAC,MACU,OAAIF,UAAAC,YAAAC,MACZ,OAAIF,UAAAC,YAAAC,MACxC,CACLC,UAAWC,eAAiB,KAC5BC,OAAQ,CACPC,eAAgBF,eAAiB,KACjCG,sBAAuBH,eAAiB,SAMzCN,yCAA+B,IAAIU,yBAAuB,KAC1DV,yCAAwB,IAAIW,kBAAgB,CAAEZ,OAAAA,KAC9CC,yCAA2B,IAAIY,4BAqI/B,OApIAZ,6BAAAa,kBAAAT,eAEWU,GAEXd,0CAAsBe,WAAW,CAAED,SAAAA,OACnCD,kBAAAT,eAEWY,GAEXhB,0CAAsBiB,KAAKD,MAC3BH,yBAAAT,eAEkBc,GAElBlB,0CAA6BiB,KAAKC,MAClCL,oBAAAT,eAEae,EAAkBC,GAE/BpB,0CAAyBiB,KAAKE,EAAUC,MACxCP,gBAAAT,iBAIAJ,0CAASO,OAAOC,eAAiBa,MAAIC,oSAG1BC,MAAIC,WAAW,6BAETD,MAAIC,WAAW,kCAG5BxB,0CAAsByB,aAG1BC,OAAKC,OAAO3B,0CAASO,OAAOC,gBAC5BR,0CAASO,OAAOE,sBAAwBY,MAAIC,sOAGvCC,MAAIC,WAAW,oCAEhBxB,0CAA6ByB,aAGjC,IAAMG,EAAiBP,MAAIC,qNAGtBC,MAAIC,WAAW,8BAEhBxB,0CAAsB6B,qBAGpBC,EAA2BT,MAAIC,gOAGhCC,MAAIC,WAAW,yCAEhBxB,0CAAyB+B,qBAGvBC,EAAyBX,MAAIC,8NAG9BC,MAAIC,WAAW,uCAEhBxB,0CAAyBiC,mBAI7B,OAAOZ,MAAIC,iNAE+BC,MAAIC,WAAW,uBACrDxB,0CAASO,OAAOC,eAChBoB,EACA5B,0CAASO,OAAOE,sBAChBqB,EACAE,MAGJnB,WAAAT,4DAYU8B,GAAkB,6BAAA,6BAAA,OAEI,GAAhCC,iBAAAC,QACKA,eAAAA,OAAIC,SAAA,MAAA,MAEF,IAAIC,MAAO,OAAA,OAAAD,SAAAA,SAKXrC,0CAAsBuC,KAAKL,GAAW,OAAAG,UAAA,MAAA,OAIK,MAJLA,SAAAA,gBAI5CF,iBAAAC,KAAiBpC,0CAASO,OAAOC,qBAAgB,QAAA,UAAA,uCAAA,YAAA,mCAAAK,0BAAAT,iBAOlD,OAAOJ,0CAAsBwC,gCAC7B3B,iBAAAT,iBAIA,IAAMqC,EAAiBzC,0CAAyB0C,oBAEhD,MAAO,CACNC,eAAgB,CACfC,WAAY,OACZ9B,SAAUd,0CAA6B6C,uBAExCC,QAAS,CACRF,WAAY,UACZ9B,SAAUd,0CAAsB+C,gBAEjCC,WAAYC,OAAOC,KAAKT,GAAgBU,KAAI,SAAC/B,GAC5C,MAAO,CAAEwB,WAAY,OAAQ9B,SAAU2B,EAAerB,GAAOA,KAAAA,YAG/D,IAwBD,aApEC,MAL0B,CACzBpB,0CAAsBoD,WACtBpD,0CAA6BoD,YAGLC,OAAM,SAACC,GAAe,OAAgB,IAAXA,IACrD,CAAC,WA6CWC,GAEPC,OAAKC,OAAOF,IAAUC,OAAKE,YAAYH,IAK3CI,MAAIC,SAASL,EAAO1D,EACrB,CAAC,aAIA,cAA2BoD,OAAOY,QAAQ7D,0CAASO,uBACnD,CADK,yCAAYgD,cAEhB,GAAIC,OAAKC,OAAOF,GAEf,OAGDI,MAAIG,YAAYP,EAAO1D,GAEzB"}