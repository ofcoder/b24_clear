{"version":3,"file":"sign-settings.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Dom, Loc, Tag, Type } from 'main.core';\nimport { Api, MemberRole, type SetupMember } from 'sign.v2.api';\nimport './style.css';\nimport { ProviderCode } from 'sign.v2.b2e.company-selector';\nimport { DocumentSend } from 'sign.v2.b2e.document-send';\nimport { DocumentSetup } from 'sign.v2.b2e.document-setup';\nimport { Parties as CompanyParty } from 'sign.v2.b2e.parties';\nimport { UserParty } from 'sign.v2.b2e.user-party';\nimport { SectionType } from 'sign.v2.editor';\nimport { type SignOptions, SignSettings } from 'sign.v2.sign-settings';\nimport type { Metadata } from 'ui.wizard';\n\nexport class B2ESignSettings extends SignSettings\n{\n\t#companyParty: CompanyParty;\n\t#userParty: UserParty;\n\t#api: Api;\n\n\tconstructor(containerId: string, signOptions: SignOptions)\n\t{\n\t\tsuper(containerId, signOptions, {\n\t\t\tnext: { className: 'ui-btn-success' },\n\t\t\tcomplete: { className: 'ui-btn-success' },\n\t\t\tswapButtons: true,\n\t\t});\n\t\tconst { config } = signOptions;\n\t\tconst { blankSelectorConfig, documentSendConfig, userPartyConfig } = config;\n\t\tthis.documentSetup = new DocumentSetup(blankSelectorConfig);\n\t\tthis.documentSend = new DocumentSend(documentSendConfig);\n\t\tthis.#companyParty = new CompanyParty(blankSelectorConfig.region);\n\t\tthis.#api = new Api();\n\t\tthis.#userParty = new UserParty({ mode: 'edit', ...userPartyConfig });\n\t\tthis.subscribeOnEvents();\n\t}\n\n\tsubscribeOnEvents(): void\n\t{\n\t\tsuper.subscribeOnEvents();\n\t\tthis.documentSend.subscribe('changeTitle', ({ data }) => {\n\t\t\tthis.documentSetup.setDocumentTitle(data.title);\n\t\t});\n\t\tthis.documentSend.subscribe('disableBack', () => {\n\t\t\tthis.wizard.toggleBtnActiveState('back', true);\n\t\t});\n\t\tthis.documentSend.subscribe('enableBack', () => {\n\t\t\tthis.wizard.toggleBtnActiveState('back', false);\n\t\t});\n\t}\n\n\tasync #setupParties()\n\t{\n\t\tconst { uid } = this.documentSetup.setupData;\n\t\tconst companyData = this.#companyParty.getParties();\n\t\tconst { representative, company, validation } = companyData;\n\t\tconst { entityId: companyId } = company;\n\t\tconst { entityId: representativeId } = representative;\n\t\tconst userPartyIds = this.#userParty.getUserIds();\n\t\tlet currentParty = 1;\n\t\tconst members = validation.map((item) => ({ ...item, party: currentParty++ }));\n\t\tmembers.push(this.#getAssignee(currentParty, companyId));\n\t\tcurrentParty++;\n\t\tmembers.push(...userPartyIds.map(userId => this.#getSigner(currentParty, userId)));\n\t\ttry\n\t\t{\n\t\t\tawait this.#api.setupB2eParties(uid, representativeId, members);\n\t\t}\n\t\tcatch (ex)\n\t\t{\n\t\t\tthrow ex;\n\t\t}\n\n\t\tconst membersData = await this.#api.loadMembers(uid);\n\t\tif (!Type.isArrayFilled(membersData))\n\t\t{\n\t\t\tthrow new Error();\n\t\t}\n\n\t\treturn membersData.map((memberData) => {\n\t\t\treturn {\n\t\t\t\tpresetId: memberData?.presetId,\n\t\t\t\tpart: memberData?.party,\n\t\t\t\tuid: memberData?.uid,\n\t\t\t\tentityTypeId: memberData?.entityTypeId ?? null,\n\t\t\t\tentityId: memberData?.entityId ?? null,\n\t\t\t\trole: memberData?.role ?? null,\n\t\t\t};\n\t\t});\n\t}\n\n\t#getAssignee(currentParty: number, companyId: number): SetupMember\n\t{\n\t\treturn {\n\t\t\tentityType: 'company',\n\t\t\tentityId: companyId,\n\t\t\tparty: currentParty,\n\t\t\trole: MemberRole.assignee,\n\t\t};\n\t}\n\n\t#getSigner(currentParty: number, userId: number): SetupMember\n\t{\n\t\treturn {\n\t\t\tentityType: 'user',\n\t\t\tentityId: userId,\n\t\t\tparty: currentParty,\n\t\t\trole: MemberRole.signer,\n\t\t};\n\t}\n\n\t#reflowLayout(layout: HTMLElement)\n\t{\n\t\tthis.#wrapContent(layout);\n\t\tdocument.documentElement.scrollTop = 0;\n\t}\n\n\t#wrapContent(layout: HTMLElement)\n\t{\n\t\tconst layoutItems = [...layout.children].filter((child) => {\n\t\t\treturn Dom.hasClass(child, 'sign-b2e-settings__item');\n\t\t});\n\t\tconst hasCounter = layoutItems.some((node) => {\n\t\t\treturn Dom.hasClass(node.firstElementChild, 'sign-b2e-settings__counter');\n\t\t});\n\t\tif (hasCounter)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlayoutItems.forEach((node, index) => {\n\t\t\tconst connectionNode = index === layoutItems.length - 1\n\t\t\t\t? Tag.render`<span class=\"sign-b2e-settings__counter_connect\">`\n\t\t\t\t: null;\n\t\t\tconst counter = Tag.render`\n\t\t\t\t<div class=\"sign-b2e-settings__counter\">\n\t\t\t\t\t<span class=\"sign-b2e-settings__counter_num\" data-num=\"${index + 1}\"></span>\n\t\t\t\t\t${connectionNode}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tDom.prepend(counter, node);\n\t\t});\n\t}\n\n\t#parseMembers(loadedMembers: SetupMember[]): { [$Keys<typeof MemberRole>]: number[]; }\n\t{\n\t\treturn loadedMembers.reduce((acc, member) => {\n\t\t\tconst { entityType, entityId } = member;\n\t\t\tif (entityType !== 'user')\n\t\t\t{\n\t\t\t\treturn acc;\n\t\t\t}\n\n\t\t\tconst role = `${member.role}s`;\n\n\t\t\treturn {\n\t\t\t\t...acc,\n\t\t\t\t[role]: [\n\t\t\t\t\t...acc[role] ?? [],\n\t\t\t\t\tentityId,\n\t\t\t\t],\n\t\t\t};\n\t\t}, {});\n\t}\n\n\tasync applyDocumentData(uid: string): Promise<boolean>\n\t{\n\t\tconst setupData = await this.setupDocument(uid, true);\n\t\tif (!setupData)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst { entityId, representativeId, companyUid } = setupData;\n\t\tthis.documentSend.documentData = setupData;\n\t\tthis.editor.documentData = setupData;\n\t\tthis.#companyParty.setEntityId(entityId);\n\t\tif (companyUid)\n\t\t{\n\t\t\tthis.#companyParty.loadCompany(companyUid);\n\t\t}\n\n\t\tif (representativeId)\n\t\t{\n\t\t\tthis.#companyParty.loadRepresentative(representativeId);\n\t\t}\n\n\t\tconst members = await this.#api.loadMembers(uid);\n\t\tconst parsedMembers = this.#parseMembers(members);\n\t\tconst { signers = [], reviewers = [], editors = [] } = parsedMembers;\n\t\tif (signers.length > 0)\n\t\t{\n\t\t\tthis.#userParty.load(signers);\n\t\t}\n\n\t\tif (reviewers.length > 0)\n\t\t{\n\t\t\tthis.#companyParty.loadValidator(reviewers[0], MemberRole.reviewer);\n\t\t}\n\n\t\tif (editors.length > 0)\n\t\t{\n\t\t\tthis.#companyParty.loadValidator(editors[0], MemberRole.editor);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tgetStepsMetadata(): Metadata\n\t{\n\t\tconst signSettings = this;\n\n\t\treturn {\n\t\t\tsetup: {\n\t\t\t\tget content()\n\t\t\t\t{\n\t\t\t\t\tconst layout = signSettings.documentSetup.layout;\n\t\t\t\t\tsignSettings.#reflowLayout(layout);\n\n\t\t\t\t\treturn layout;\n\t\t\t\t},\n\t\t\t\ttitle: Loc.getMessage('SIGN_SETTINGS_B2B_LOAD_DOCUMENT'),\n\t\t\t\tbeforeCompletion: async () => {\n\t\t\t\t\tconst isValid = this.documentSetup.validate();\n\t\t\t\t\tif (!isValid)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst setupData = await this.setupDocument();\n\t\t\t\t\tif (!setupData)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.#companyParty.setEntityId(setupData.entityId);\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t},\n\t\t\tcompany: {\n\t\t\t\tget content()\n\t\t\t\t{\n\t\t\t\t\tconst layout = signSettings.#companyParty.getLayout();\n\t\t\t\t\tsignSettings.#reflowLayout(layout);\n\n\t\t\t\t\treturn layout;\n\t\t\t\t},\n\t\t\t\ttitle: Loc.getMessage('SIGN_SETTINGS_B2E_COMPANY'),\n\t\t\t\tbeforeCompletion: async () => {\n\t\t\t\t\tconst { uid } = this.documentSetup.setupData;\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\tawait this.#companyParty.save(uid);\n\t\t\t\t\t}\n\t\t\t\t\tcatch\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t},\n\t\t\temployees: {\n\t\t\t\ttitle: Loc.getMessage('SIGN_SETTINGS_B2E_EMPLOYEES'),\n\t\t\t\tget content()\n\t\t\t\t{\n\t\t\t\t\tconst layout = signSettings.#userParty.getLayout();\n\t\t\t\t\tsignSettings.#reflowLayout(layout);\n\n\t\t\t\t\treturn layout;\n\t\t\t\t},\n\t\t\t\tbeforeCompletion: async () => {\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\tconst isValid = this.#userParty.validate();\n\t\t\t\t\t\tif (!isValid)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn isValid;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst entityData = await this.#setupParties();\n\t\t\t\t\t\tconst { uid, title, isTemplate, externalId, entityId } = this.documentSetup.setupData;\n\t\t\t\t\t\tconst blocks = await this.documentSetup.loadBlocks(uid);\n\t\t\t\t\t\tconst partiesData = this.#companyParty.getParties();\n\n\t\t\t\t\t\tconst selectedProvider = this.#companyParty.getSelectedProvider();\n\t\t\t\t\t\tthis.editor.setSectionVisibilityByType(\n\t\t\t\t\t\t\tSectionType.SecondParty,\n\t\t\t\t\t\t\tselectedProvider.code !== ProviderCode.sesRu,\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tObject.assign(partiesData, {\n\t\t\t\t\t\t\temployees: this.#userParty.getUserIds().map((userId) => {\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\tentityType: 'user',\n\t\t\t\t\t\t\t\t\tentityId: userId,\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.documentSend.documentData = { uid, title, blocks, externalId };\n\t\t\t\t\t\tthis.documentSend.setPartiesData(partiesData);\n\t\t\t\t\t\tthis.documentSend.members = entityData;\n\t\t\t\t\t\tthis.editor.documentData = { isTemplate, uid, blocks, entityId };\n\t\t\t\t\t\tthis.editor.entityData = entityData;\n\t\t\t\t\t\tawait this.editor.waitForPagesUrls();\n\t\t\t\t\t\tawait this.editor.renderDocument();\n\t\t\t\t\t\tthis.wizard.toggleBtnLoadingState('next', false);\n\t\t\t\t\t\tawait this.editor.show();\n\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e)\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.error(e);\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\tsend: {\n\t\t\t\tget content()\n\t\t\t\t{\n\t\t\t\t\tconst layout = signSettings.documentSend.getLayout();\n\t\t\t\t\tsignSettings.#reflowLayout(layout);\n\n\t\t\t\t\treturn layout;\n\t\t\t\t},\n\t\t\t\ttitle: Loc.getMessage('SIGN_SETTINGS_SEND_DOCUMENT'),\n\t\t\t\tbeforeCompletion: () => {\n\t\t\t\t\treturn this.documentSend.sendForSign();\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n}\n"],"names":["B2ESignSettings","SignSettings","constructor","containerId","signOptions","next","className","complete","swapButtons","config","blankSelectorConfig","documentSendConfig","userPartyConfig","documentSetup","DocumentSetup","documentSend","DocumentSend","CompanyParty","region","Api","UserParty","mode","subscribeOnEvents","subscribe","data","setDocumentTitle","title","wizard","toggleBtnActiveState","applyDocumentData","uid","setupData","setupDocument","entityId","representativeId","companyUid","documentData","editor","setEntityId","loadCompany","loadRepresentative","members","loadMembers","parsedMembers","signers","reviewers","editors","length","load","loadValidator","MemberRole","reviewer","getStepsMetadata","signSettings","setup","content","layout","Loc","getMessage","beforeCompletion","isValid","validate","company","getLayout","save","employees","entityData","isTemplate","externalId","blocks","loadBlocks","partiesData","getParties","selectedProvider","getSelectedProvider","setSectionVisibilityByType","SectionType","SecondParty","code","ProviderCode","sesRu","Object","assign","getUserIds","map","userId","entityType","setPartiesData","waitForPagesUrls","renderDocument","toggleBtnLoadingState","show","e","console","error","send","sendForSign","companyData","representative","validation","companyId","userPartyIds","currentParty","item","party","push","setupB2eParties","ex","membersData","Type","isArrayFilled","Error","memberData","presetId","part","entityTypeId","role","assignee","signer","document","documentElement","scrollTop","layoutItems","children","filter","child","Dom","hasClass","hasCounter","some","node","firstElementChild","forEach","index","connectionNode","Tag","render","counter","prepend","loadedMembers","reduce","acc","member"],"mappings":"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"}